"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{11920:function(e,t,n){let i,o,r;n.r(t),n.d(t,{DID:function(){return et},Hive:function(){return es},Interfaces:function(){return ea},UX:function(){return tI},Wallet:function(){return tA},connectivity:function(){return F},didAccessV2:function(){return J},localization:function(){return tE},logger:function(){return z},storage:function(){return $},theme:function(){return e7}});var s,a,l,d,c,u,p=n(62067),h=n.n(p),y=n(69810),g=n.n(y),f=n(65559),m=n(1347),v=n(54233),C=n(13001),b=n(31164);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function D(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}let x={},w=()=>D(void 0,void 0,void 0,function*(){return x["@elastosfoundation/did-js-sdk"]||(x["@elastosfoundation/did-js-sdk"]=yield Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(368)]).then(n.bind(n,26588))),{JWTParserBuilder:x["@elastosfoundation/did-js-sdk"].JWTParserBuilder,VerifiablePresentation:x["@elastosfoundation/did-js-sdk"].VerifiablePresentation,VerifiableCredential:x["@elastosfoundation/did-js-sdk"].VerifiableCredential,DID:x["@elastosfoundation/did-js-sdk"].DID,DIDStore:x["@elastosfoundation/did-js-sdk"].DIDStore,Mnemonic:x["@elastosfoundation/did-js-sdk"].Mnemonic,RootIdentity:x["@elastosfoundation/did-js-sdk"].RootIdentity}});class k{init(){return D(this,void 0,void 0,function*(){this.storage||(this.storage=yield(0,f.O)({name:"connectivity-sdk-storage",version:1}))})}set(e,t){return D(this,void 0,void 0,function*(){yield this.init(),yield this.storage.set(e,t)})}get(e,t){return D(this,void 0,void 0,function*(){return yield this.init(),(yield this.storage.get(e))||t})}unset(e){return D(this,void 0,void 0,function*(){yield this.init(),yield this.storage.delete(e)})}}function E(e,t){if(globalThis.elastosconnectivity||(globalThis.elastosconnectivity={}),globalThis.elastosconnectivity[e])return globalThis.elastosconnectivity[e];{let n=t();return globalThis.elastosconnectivity[e]=n,n}}let I="connectivitysdk_storage_index";class A{constructor(){this.storageLayer=new k,this.index=null}setStorageLayer(e){this.storageLayer=e}lazyLoadIndex(){return D(this,void 0,void 0,function*(){if(this.index)return;let e=yield this.storageLayer.get(I,null);this.index=e?JSON.parse(e):[]})}saveIndex(){return D(this,void 0,void 0,function*(){yield this.storageLayer.set(I,JSON.stringify(this.index))})}set(e,t,n){return D(this,void 0,void 0,function*(){yield this.lazyLoadIndex();let i=this.getFullKey(e,t);return this.index.includes(i)||(this.index.push(i),yield this.saveIndex()),this.storageLayer.set(i,n)})}get(e,t,n){return D(this,void 0,void 0,function*(){yield this.lazyLoadIndex();let i=this.getFullKey(e,t);return this.storageLayer.get(i,n)})}unset(e,t){return D(this,void 0,void 0,function*(){let n=this.getFullKey(e,t);return this.storageLayer.unset(n)})}clean(e){return D(this,void 0,void 0,function*(){for(let e of(yield this.lazyLoadIndex(),this.index))yield this.storageLayer.unset(e);this.index=[],yield this.saveIndex()})}getFullKey(e,t){return e+"_"+t}setJSON(e,t,n){return this.set(e,t,JSON.stringify(n))}getJSON(e,t,n){return D(this,void 0,void 0,function*(){return JSON.parse((yield this.get(e,t,JSON.stringify(n))))})}}let $=E("storage",()=>new A),S=(e=6)=>{let t=16,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[],o;if(t=t||n.length,e)for(o=0;o<e;o++)i[o]=n[0|Math.random()*t];else{let e;for(o=0,i[8]=i[13]=i[18]=i[23]="-",i[14]="4";o<36;o++)i[o]||(e=0|16*Math.random(),i[o]=n[19==o?3&e|8:e])}return i.join("")},P=()=>S(16),L=e=>Error(`Method ${e} is not implemented in the connector. Ask the connector developer to update the implementation`);class _{constructor(){}saveAppInstanceDIDInfo(e=null,t,n,i){return D(this,void 0,void 0,function*(){z.log("Saving app instance DID info for store "+t+" and did "+n+" and app did "+e);let o=e?`_${e}`:"";yield $.set(F.getActiveConnector().name,"dappsdk_appinstancedidstoreid"+o,t),yield $.set(F.getActiveConnector().name,"dappsdk_appinstancedidstring"+o,n),yield $.set(F.getActiveConnector().name,"dappsdk_appinstancedidstorepassword"+o,i)})}cleanupConnectorContext(e){return D(this,void 0,void 0,function*(){yield $.clean(e.name)})}generateRandomPassword(){return S()}static openDidStore(e){return new Promise(t=>D(this,void 0,void 0,function*(){try{let{DIDStore:n}=yield w(),i=yield n.open(e);t(i)}catch(e){t(null)}}))}static loadDID(e,t){return new Promise((n,i)=>D(this,void 0,void 0,function*(){try{let o=yield e.loadDid(t);o?n(o.getSubject()):i("Null DIDDocument loaded for did string "+e)}catch(e){i(e)}}))}static loadDIDCredentials(e,t){return new Promise((n,i)=>D(this,void 0,void 0,function*(){try{let i=yield e.listCredentials(t.toString()),o=[];for(let t of i)o.push((yield e.loadCredential(t)));n(o)}catch(e){i(e)}}))}}let O={},R=new m.X(null),q=new m.X(null);class M{registerResponseProcessors(){return D(this,void 0,void 0,function*(){var e,t;e=this.processRequestCredentialsResponse,O.requestCredentials=e,t=this.processImportCredentialsResponse,O.importCredentials=t})}processRequestCredentialsResponse(e,t){return D(this,void 0,void 0,function*(){if(t){if(e.data.nonceToVerifyInternally&&e.data.nonceToVerifyInternally!==t.getProof().getNonce()){let t=Error("Automatically generated nonce doesn't match nonce in the returned presentation");R.next([e.appData,null,t]);return}if(e.data.realmToVerifyInternally&&e.data.realmToVerifyInternally!==t.getProof().getRealm()){let t=Error("Automatically generated realm doesn't match realm in the returned presentation");R.next([e.appData,null,t]);return}R.next([e.appData,t])}else R.next([e.appData,null])})}processImportCredentialsResponse(e,t){return D(this,void 0,void 0,function*(){t?q.next([e.appData,t]):q.next([e.appData,null])})}}let T=E("didresponsev2",()=>new M);function B(e){return $.setJSON("deferredrequests",e.requestId,e)}class N{log(...e){console.log.apply(console,e)}warn(...e){console.warn.apply(console,e)}error(...e){console.error.apply(console,e)}}let z=new class{constructor(){this.logger=new N}setLoggerLayer(e){this.logger=e}log(...e){this.logger.log.apply(this.logger,e)}warn(...e){this.logger.warn.apply(this.logger,e)}error(...e){this.logger.error.apply(this.logger,e)}};class V{constructor(){this.connectors=[],this.activeConnector=null,this.genericUIHandler=null,this.applicationDID=null}registerConnector(e){var t;return D(this,void 0,void 0,function*(){if(e){if(z.log("Registering connector with name",e.name),this.connectors.findIndex(t=>t.name===e.name)>=0)throw Error("Connector with name "+e.name+" already exists");this.connectors.push(e);let n=yield $.get("global","activeconnectorname",null);n==e.name&&(z.log("Reactivating previously saved connector:"+n),this.activeConnector=e),T.registerResponseProcessors(),null===(t=e.registerResponseHandler)||void 0===t||t.call(e,(e,t)=>D(this,void 0,void 0,function*(){var n;let i=yield $.getJSON("deferredrequests",e,null);if(!i){z.warn("Connectivity SDK found no saved deferred request for request ID",e);return}null===(n=O[i.requestType])||void 0===n||n.call(O,i,t)}))}})}unregisterConnector(e){return D(this,void 0,void 0,function*(){this.activeConnector&&this.activeConnector.name==e&&this.setActiveConnector(null);let t=this.connectors.findIndex(t=>t.name===e);if(t<0)throw Error("Connector with name "+e+" doesn't exist");this.connectors.splice(t,1)})}setActiveConnector(e){return D(this,void 0,void 0,function*(){if(null==e&&this.activeConnector)yield this.cleanupConnectorContext(this.activeConnector),z.log("Forgetting the currently active connector"),this.activeConnector=null;else if(null!=e){let t=this.connectors.find(t=>t.name===e);if(!t)throw Error("Failed to set active connector. Connector "+e+" not found!");this.activeConnector&&this.activeConnector.name!==e&&(yield this.cleanupConnectorContext(this.activeConnector)),this.activeConnector=t}$.set("global","activeconnectorname",e)})}cleanupConnectorContext(e){return D(this,void 0,void 0,function*(){z.log("Cleaning up connector context for: "+e.name),yield new _().cleanupConnectorContext(e)})}getActiveConnector(){return"elastos"in window?window.elastos:this.activeConnector}getAvailableConnectors(){return this.connectors}setApplicationDID(e){this.applicationDID=e}getApplicationDID(){if(!this.applicationDID)throw Error("No application DID defined yet. Please call setApplicationDID() first.");return this.applicationDID}setGenericUIHandler(e){this.genericUIHandler=e}}let F=E("connectivity",()=>new V);(s=d||(d={})).PUBLISHED="published",s.ERROR="error",s.CANCELLED="cancelled";class W{static ensureActiveConnector(e,t){return D(this,void 0,void 0,function*(){null!=F.getActiveConnector()?(yield this.sendContextToActiveConnector(),e()):1==F.getAvailableConnectors().length?(yield F.setActiveConnector(F.getAvailableConnectors()[0].name),yield this.sendContextToActiveConnector(),e()):(yield F.genericUIHandler.showConnectorChooser())?(yield this.sendContextToActiveConnector(),e()):(z.warn("Cannot ensure active connector. No connector available, or user did not pick one"),t())})}static sendContextToActiveConnector(){return D(this,void 0,void 0,function*(){let e=yield Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(368)]).then(n.bind(n,26588));"setModuleContext"in F.getActiveConnector()&&F.getActiveConnector().setModuleContext(e,F)})}}let j=new(g())(1),H=(0,v.h)(e=>!!e);class K{onRequestCredentialsResponse(e){let t=R.pipe(H).subscribe(([t,n,i])=>{e(t,n,i)});return()=>t.unsubscribe}requestCredentials(e,t){return D(this,void 0,void 0,function*(){return new Promise((n,i)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().requestCredentialsV2){i(L("requestCredentialsV2"));return}try{let i={requestId:P(),requestType:"requestCredentials",data:{},appData:t};e.nonce||(e.nonce=S(),i.data.nonceToVerifyInternally=e.nonce),e.realm||(e.realm=S(),i.data.realmToVerifyInternally=e.realm),e.didMustBePublished||(e.didMustBePublished=!0),e._version=2,yield B(i),yield F.getActiveConnector().requestCredentialsV2(i.requestId,e),n()}catch(e){i(e)}}),()=>{n(null)})})})}onImportCredentialsResponse(e){let t=q.pipe(H).subscribe(([t,n,i])=>{e(t,n,i)});return()=>t.unsubscribe}importCredentials(e,t,n){return D(this,void 0,void 0,function*(){return new Promise((i,o)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().importCredentialsV2){o(L("importCredentialsV2"));return}try{let o={requestId:P(),requestType:"importCredentials",data:{},appData:n};yield B(o),yield F.getActiveConnector().importCredentialsV2(o.requestId,e,t),i()}catch(e){o(e)}}),()=>{i(null)})})})}}let J=E("didaccessv2",()=>new K);class U{constructor(){this.min=1,this.max=1}withReason(e){return this.reason=e,this}withMin(e){return this.min=e,this}withMax(e){return this.max=e,this}withNoMatchRecommendations(e){return this.noMatchRecommendations=e,this}withClaim(e){return this.claims=[e],this}withAnyOfClaims(e){return this.claims=e,this}}class Y{withQuery(e){return this.query=e,this}withIssuers(e){return this.issuers=e,this}}function G(e){return new Y().withQuery(e)}function X(e,t=!1){return new U().withReason(e).withMin(t?1:0)}function Q(e){return G(`$[?(@.type.indexOf('${e}') >= 0)]`)}function Z(e){return G(`$[?(@.id == "${e}" || @.id.match(/#${e}$/))]`)}function ee(e,t,n=!0){return X(e,n).withAnyOfClaims([Q(t)])}var et=Object.freeze({__proto__:null,didAccessV2:J,get UpdateHiveVaultAddressStatus(){return d},DIDAccess:class{constructor(){this.helper=null,this.helper=new _}getCredentials(e){return D(this,void 0,void 0,function*(){return new Promise((t,n)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().getCredentials){n(L("getCredentials"));return}e.didMustBePublished||(e.didMustBePublished=!0);try{let n=yield F.getActiveConnector().getCredentials(e);t(n)}catch(e){n(e)}}),()=>{t(null)})})})}requestCredentials(e){return D(this,void 0,void 0,function*(){return new Promise((t,n)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().requestCredentials){n(L("requestCredentials"));return}try{let i=!1;e.nonce||(e.nonce=S(),i=!0);let o=!1;e.realm||(e.realm=S(),o=!0),e.didMustBePublished||(e.didMustBePublished=!0),e._version=2;let r=yield F.getActiveConnector().requestCredentials(e);if(r){if(i&&e.nonce!==r.getProof().getNonce()){n(Error("Automatically generated nonce doesn't match nonce in the returned presentation"));return}if(o&&e.realm!==r.getProof().getRealm()){n(Error("Automatically generated realm doesn't match realm in the returned presentation"));return}}t(r)}catch(e){n(e)}}),()=>{t(null)})})})}issueCredential(e,t,n,i,o){return D(this,void 0,void 0,function*(){return new Promise((r,s)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().issueCredential){s(L("issueCredential"));return}try{let s=yield F.getActiveConnector().issueCredential(e,t,n,i,o);r(s)}catch(e){s(e)}}),()=>{r(null)})})})}importCredentials(e,t){return D(this,void 0,void 0,function*(){return new Promise((n,i)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().importCredentials){i(L("importCredentials"));return}try{let i=yield F.getActiveConnector().importCredentials(e,t);n(i)}catch(e){i(e)}}),()=>{n(null)})})})}deleteCredentials(e,t){return D(this,void 0,void 0,function*(){let n;return n="string"==typeof e?[e]:e,new Promise((e,i)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().deleteCredentials){i(L("deleteCredentials"));return}try{let i=yield F.getActiveConnector().deleteCredentials(n,t);e(i)}catch(e){i(e)}}),()=>{e(null)})})})}signData(e,t,n){return D(this,void 0,void 0,function*(){return new Promise((i,o)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().signData){o(L("signData"));return}try{let o=yield F.getActiveConnector().signData(e,t,n);i(o)}catch(e){o(e)}}),()=>{i(null)})})})}requestPublish(){return D(this,void 0,void 0,function*(){return new Promise((e,t)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().requestPublish){t(L("requestPublish"));return}try{let t=yield F.getActiveConnector().requestPublish();e(t)}catch(e){t(e)}}),()=>{e(null)})})})}updateHiveVaultAddress(e,t){return D(this,void 0,void 0,function*(){return new Promise((n,i)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().updateHiveVaultAddress){i(L("updateHiveVaultAddress"));return}try{let i=yield F.getActiveConnector().updateHiveVaultAddress(e,t);n(i)}catch(e){i(e)}}),()=>{n(null)})})})}importCredentialContext(e,t){return new Promise((n,i)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().importCredentialContext){i(L("importCredentialContext"));return}try{let i=yield F.getActiveConnector().importCredentialContext(e,t);n(i)}catch(e){i(e)}}),()=>{n(null)})})}generateAppIdCredential(e=null){return D(this,void 0,void 0,function*(){return new Promise((t,n)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().generateAppIdCredential){n(L("generateAppIdCredential"));return}try{let n=yield this.getOrCreateAppInstanceDID(e);if(!n){t(null);return}let i=n.did;z.log("Starting to generate a new App ID credential.");let o=yield F.getActiveConnector().generateAppIdCredential(i.toString(),e||F.getApplicationDID());yield n.didStore.storeCredential(o),t(o)}catch(e){n(e)}}),()=>{t(null)})})})}generateHiveBackupCredential(e,t,n){return D(this,void 0,void 0,function*(){return new Promise((i,o)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().generateHiveBackupCredential){o(L("generateHiveBackupCredential"));return}try{let o=yield F.getActiveConnector().generateHiveBackupCredential(e,t,n);i(o)}catch(e){o(e)}}),()=>{i(null)})})})}getExistingAppIdentityCredential(e=null){return D(this,void 0,void 0,function*(){z.log("Trying to get an existing app ID credential from storage");let t=yield this.getOrCreateAppInstanceDID(e);if(!t)return null;let n=t.did;z.log("App Instance DID:",n);let i=yield t.didStore.loadCredential(n.toString()+"#app-id-credential");if(i){if(h()((yield i.getExpirationDate())).isBefore(h()().subtract(1,"hours")))return z.log("Existing credential is expired or almost expired - renewing it"),null;z.log("Returning existing app id credential found in app's local storage")}return i})}getOrCreateAppInstanceDID(e=null){return D(this,void 0,void 0,function*(){let t=null,n=null,i=null;return j.add(()=>(z.log("Getting or creating app instance DID"),new Promise((o,r)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){try{let r=yield this.getExistingAppInstanceDIDInfo(e);if(r&&(t=yield _.openDidStore(r.storeId)))try{n=yield _.loadDID(t,r.didString),i=r.storePassword}catch(e){z.error(e)}if(!t||!n){z.log("No app instance DID found. Creating a new one");let o=yield this.createNewAppInstanceDID(e);t=o.didStore,n=o.did,i=o.storePassword}yield _.loadDIDCredentials(t,n),o({did:n,didStore:t,storePassword:i})}catch(e){r(e)}}),()=>{o(null)})})))})}getExistingAppInstanceDIDInfo(e=null){return D(this,void 0,void 0,function*(){let t=e?`_${e}`:"",n=yield $.get(F.getActiveConnector().name,"dappsdk_appinstancedidstoreid"+t,null),i=yield $.get(F.getActiveConnector().name,"dappsdk_appinstancedidstring"+t,null),o=yield $.get(F.getActiveConnector().name,"dappsdk_appinstancedidstorepassword"+t,null);return n&&i?{storeId:n,didString:i,storePassword:o}:null})}fastCreateDID(e){return z.log("Fast DID creation with language "+e),new Promise((t,n)=>D(this,void 0,void 0,function*(){try{let{Mnemonic:n,DIDStore:i,RootIdentity:o}=yield w(),r=yield n.getInstance(e).generate(),s=S(),a=yield i.open(s),l=this.helper.generateRandomPassword(),d=yield o.createFromMnemonic(r,null,a,l),c=yield d.newDid(l);t({didStoreId:s,didStore:a,did:c.getSubject(),storePassword:l})}catch(e){n(e)}}))}createNewAppInstanceDID(e=null){return D(this,void 0,void 0,function*(){let{Mnemonic:t}=yield w(),n=yield this.fastCreateDID(t.ENGLISH);return yield this.helper.saveAppInstanceDIDInfo(e,n.didStoreId,n.did.toString(),n.storePassword),{didStore:n.didStore,didStoreId:n.didStoreId,did:n.did,storePassword:n.storePassword}})}},DIDHelper:_,ClaimDescription:U,Claim:Y,claimWithJsonPathQuery:G,claimDescription:X,typeClaim:Q,idClaim:Z,simpleIdClaim:function(e,t,n=!0){return X(e,n).withAnyOfClaims([Z(t)])},simpleTypeClaim:ee,standardNameClaim:function(e,t=!0){return ee(e,"NameCredential",t)},standardEmailClaim:function(e,t=!0){return ee(e,"EmailCredential",t)}});(a=c||(c={})).Vault=class{getDatabase(){}},a.errorOfType=function(e,t){return!1};class en{}class ei{}class eo extends ei{static fromJson(e){if(!e)return null;let t=new eo;return t.key=e.key,t.creationDate=e.creationDate,t.modificationDate=e.modificationDate,t.deletionDate=e.deletionDate,t.data=e.data,t}}var er=Object.freeze({__proto__:null,HiveDataSync:class{constructor(e,t=!1){if(this.userVault=e,this.showDebugLogs=t,this.contexts=[],!e)throw Error("The backup restore helper can't be used without a user vault. Please make sure the vault was correctly initialized.");this.userVault=e,this.showDebugLogs=t}addSyncContext(e,t,n,i){let o=new en;o.name=e,o.onRemoteInsertion=t,o.onRemoteModification=n,o.onRemoteDeletion=i,this.contexts.push(o)}upsertDatabaseEntry(e,t,n){return D(this,void 0,void 0,function*(){yield this.upsertDatabaseEntryLocally(e,t,n),yield this.sync()})}upsertDatabaseEntryLocally(e,t,n){return D(this,void 0,void 0,function*(){let i=new Date().getTime(),o=yield this.loadLocalDatabaseEntry(e,t),r=null;o?((r=o).data=n,r.modificationDate=i,r.deletionDate=null,this.logDebug("upsertDatabaseEntryLocally() - updating existing entry",r)):(r={key:t,creationDate:i,modificationDate:i,deletionDate:null,syncDate:null,data:n},this.logDebug("upsertDatabaseEntryLocally() - creating new entry",r)),yield this.saveLocalDatabaseEntry(e,r)})}deleteDatabaseEntry(e,t,n=!1){return D(this,void 0,void 0,function*(){n?yield this.deleteDatabaseEntryLocallyForReal(e,t):(yield this.deleteDatabaseEntryLocallyMarkOnly(e,t),yield this.sync())})}getDatabaseEntry(e,t){return D(this,void 0,void 0,function*(){return this.loadLocalDatabaseEntry(e,t)})}loadLocalDatabaseEntry(e,t){return D(this,void 0,void 0,function*(){let n=yield this.loadSettingsEntry(e+"_"+t);return n?eo.fromJson(n):null})}saveLocalDatabaseEntry(e,t){return D(this,void 0,void 0,function*(){yield this.addKeyToSavedEntriesList(e,t.key),yield this.saveSettingsEntry(e+"_"+t.key,t)})}deleteDatabaseEntryLocallyMarkOnly(e,t){return D(this,void 0,void 0,function*(){let n=yield this.loadLocalDatabaseEntry(e,t);if(n){let t=new Date().getTime();n.deletionDate=t,n.modificationDate=t,yield this.saveLocalDatabaseEntry(e,n),this.logDebug("deleteDatabaseEntryLocallyMarkOnly() - marking entry as deleted",n)}else this.logWarn("Tried to mark entry as deleted but entry can't be found in local model!",t)})}deleteDatabaseEntryLocallyForReal(e,t){return D(this,void 0,void 0,function*(){this.logDebug("Really deleting local database entry",e,t),yield this.saveSettingsEntry(e+"_"+t,null),yield this.removeKeyFromSavedEntriesList(e,t)})}upsertDatabaseEntryOnVault(e,t){return D(this,void 0,void 0,function*(){let n={key:t.key,creationDate:t.creationDate,modificationDate:t.modificationDate,deletionDate:t.deletionDate,data:t.data};(yield this.getVaultDatabaseEntry(e,t.key))?(this.logDebug("Updating vault entry: ",e,t.key,n),yield this.userVault.getDatabase().updateOne(this.getCollectionNameForContext(e),{key:t.key},{$set:n})):(this.logDebug("Inserting new vault entry: ",e,t.key,n),yield this.userVault.getDatabase().insertOne(this.getCollectionNameForContext(e),n))})}getVaultDatabaseEntry(e,t){return D(this,void 0,void 0,function*(){let n=this.getCollectionNameForContext(e);this.logDebug("Fetching vault entry with key",t,"in collection",n);let i=yield this.userVault.getDatabase().findOne(n,{key:t});return this.logDebug("Fetched vault entry:",i),i})}createContextCollection(e){return D(this,void 0,void 0,function*(){let t=this.getCollectionNameForContext(e);this.logDebug("Making sure the collection "+t+" exists"),yield this.userVault.getDatabase().createCollection(t)})}sync(e=!0){return D(this,void 0,void 0,function*(){for(let t of(this.log("Synchronization starting..."),this.contexts)){for(let n of(this.log("Synchronizing context:",t),yield this.createContextCollection(t.name),e?yield this.getVaultModifiedEntriesSinceLastFullLocalSync(t.name):yield this.getAllVaultEntries(t.name))){let e=yield this.loadLocalDatabaseEntry(t.name,n.key);if(e){if(e.modificationDate<n.modificationDate){if(n.deletionDate){if(this.logDebug("Entry found on the vault and locally, and deleted on the vault. Calling onRemoteDeletion()"),!(yield t.onRemoteDeletion(n)))return this.logDebug("onRemoteDeletion() has failed on the app side. Stopping synchronization. Will retry later",t.name,n.key),!1;{let i=new Date().getTime();e.modificationDate=n.modificationDate,e.deletionDate=n.deletionDate,e.data=n.data,e.syncDate=i,yield this.saveLocalDatabaseEntry(t.name,e)}}else{if(this.logDebug("Entry found on the vault and locally, and modified more recently on the vault. Calling onRemoteModification()"),!(yield t.onRemoteModification(n)))return this.logDebug("onRemoteModification() has failed on the app side. Stopping synchronization. Will retry later",t.name,n.key),!1;{let i=new Date().getTime();e.modificationDate=n.modificationDate,e.data=n.data,e.syncDate=i,yield this.saveLocalDatabaseEntry(t.name,e)}}}}else if(!n.deletionDate){if(this.logDebug("Entry found on the vault but not existing locally. Calling onRemoteInsertion()"),!(yield t.onRemoteInsertion(n)))return this.logDebug("onRemoteInsertion() has failed on the app side. Stopping synchronization. Will retry later",t.name,n.key),!1;{let e={key:n.key,creationDate:n.creationDate,modificationDate:n.modificationDate,deletionDate:null,syncDate:new Date().getTime(),data:n.data};this.logDebug("After onRemoteInsertion() - creating new entry",e),yield this.saveLocalDatabaseEntry(t.name,e)}}}for(let e of yield this.getSavedEntriesList(t.name)){let n=yield this.loadLocalDatabaseEntry(t.name,e);if(this.logDebug("Checking if local entry needs to be synced with vault",n),n){if(!n.syncDate||n.syncDate<n.modificationDate){let i=yield this.getVaultDatabaseEntry(t.name,e);!i||n.modificationDate>i.modificationDate?(this.logDebug("Local entry has modifications, sending changes to the vault"),yield this.upsertDatabaseEntryOnVault(t.name,n),n.deletionDate?(this.logDebug("Local entry is deleted and was synced to vault. Now deleting permanently"),yield this.deleteDatabaseEntryLocallyForReal(t.name,n.key)):(this.logDebug("Local entry is not deleted, saving sync date"),n.syncDate=new Date().getTime(),yield this.saveLocalDatabaseEntry(t.name,n))):this.logDebug("Up to date (local modification not more recent than vault modification)",n)}else this.logDebug("Already synchronized (no local modification since last sync)",n)}else this.logWarn("Local entry with key "+e+" exists in saved entries list but the entry itself can't be found. This is an abnormal state. Local entry is skipped.")}this.saveLastFullSuccessfulSyncDate()}return!0})}wipeLocalContextData(e){return D(this,void 0,void 0,function*(){for(let t of(this.logDebug("Wiping local context data for context",e),yield this.getSavedEntriesList(e)))yield this.deleteDatabaseEntryLocallyForReal(e,t);yield this.clearLastFullSuccessfulSyncDate()})}getVaultModifiedEntriesSinceLastFullLocalSync(e){return D(this,void 0,void 0,function*(){let t=yield this.getLastFullSuccessfulSyncDate();this.logDebug("Fetching vault modified entries since last full local sync",t);let n=this.getCollectionNameForContext(e),i={};t&&(i.modificationDate={$gt:t});try{let e=yield this.userVault.getDatabase().findMany(n,i);return this.logDebug("Received vault modified entries since last full local sync:",e),e}catch(e){if(c.errorOfType(e,"COLLECTION_NOT_FOUND"))return this.logDebug("Backup collection does not exist on the vault yet, thus no modified entries returned"),[];throw e}})}getAllVaultEntries(e){return D(this,void 0,void 0,function*(){this.logDebug("Fetching all vault entries for context",e);let t=this.getCollectionNameForContext(e);try{let e=yield this.userVault.getDatabase().findMany(t,{});return this.logDebug("Received vault entries:",e),e}catch(e){if(e.getType&&"COLLECTION_NOT_FOUND"==e.getType())return this.logDebug("Backup collection does not exist on the vault yet, thus no entries returned"),[];throw e}})}getLastFullSuccessfulSyncDate(){return D(this,void 0,void 0,function*(){return yield this.loadSettingsEntry("lastfullsyncdate")})}saveLastFullSuccessfulSyncDate(){return D(this,void 0,void 0,function*(){return this.saveSettingsEntry("lastfullsyncdate",new Date().getTime())})}clearLastFullSuccessfulSyncDate(){return D(this,void 0,void 0,function*(){return this.logDebug("Clearing last full sync date"),this.saveSettingsEntry("lastfullsyncdate",null)})}getCollectionNameForContext(e){return"backup_"+e}addKeyToSavedEntriesList(e,t){return D(this,void 0,void 0,function*(){let n=e+"_index",i=yield this.getSavedEntriesList(e);0>i.indexOf(t)&&i.push(t),yield this.saveSettingsEntry(n,i)})}removeKeyFromSavedEntriesList(e,t){return D(this,void 0,void 0,function*(){let n=e+"_index",i=yield this.getSavedEntriesList(e),o=i.indexOf(t);o>=0&&i.splice(o,1),yield this.saveSettingsEntry(n,i)})}getSavedEntriesList(e){return D(this,void 0,void 0,function*(){return(yield this.loadSettingsEntry(e+"_index"))||[]})}saveSettingsEntry(e,t){return $.set("hivedatasync",e,t)}loadSettingsEntry(e){return $.get("hivedatasync",e,null)}log(e,...t){z.log("BackupRestore: ",e,t)}logWarn(e,...t){z.warn("BackupRestore: ",e,...t)}logDebug(e,...t){this.showDebugLogs&&z.log("BackupRestore[debug]: ",e,...t)}},SyncContext:en,BackupRestoreEntry:ei,LocalBackupRestoreEntry:eo}),es=Object.freeze({__proto__:null,HiveAccess:class{changeHiveProvider(){}},AuthHelper:class{constructor(){}},Utils:class{},DataSync:er}),ea=Object.freeze({__proto__:null,Connectors:Object.freeze({__proto__:null})});function el(){}let ed=e=>e;function ec(e){return e()}function eu(){return Object.create(null)}function ep(e){e.forEach(ec)}function eh(e){return"function"==typeof e}function ey(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function eg(e,t,n){e.$$.on_destroy.push(function(e,...t){if(null==e)return el;let n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function ef(e,t,n,i){return e[1]&&i?function(e,t){for(let n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}let em="undefined"!=typeof window,ev=em?()=>window.performance.now():()=>Date.now(),eC=em?e=>requestAnimationFrame(e):el,eb=new Set;function eD(e){eb.forEach(t=>{t.c(e)||(eb.delete(t),t.f())}),0!==eb.size&&eC(eD)}function ex(e,t){e.appendChild(t)}function ew(e,t,n){e.insertBefore(t,n||null)}function ek(e){e.parentNode.removeChild(e)}function eE(e){return document.createElement(e)}function eI(e){return document.createTextNode(e)}function eA(){return eI(" ")}function e$(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function eS(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function eP(e,t,n){t in e?e[t]=n:eS(e,t,n)}function eL(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function e_(e,t,n){e.classList[n?"add":"remove"](t)}let eO=new Set,eR=0;function eq(e,t,n,i,o,r,s,a=0){let l=16.666/i,d="{\n";for(let e=0;e<=1;e+=l){let i=t+(n-t)*r(e);d+=100*e+`%{${s(i,1-i)}}
`}let c=d+`100% {${s(n,1-n)}}
}`,u=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(c)}_${a}`,p=e.ownerDocument;eO.add(p);let h=p.__svelte_stylesheet||(p.__svelte_stylesheet=p.head.appendChild(eE("style")).sheet),y=p.__svelte_rules||(p.__svelte_rules={});y[u]||(y[u]=!0,h.insertRule(`@keyframes ${u} ${c}`,h.cssRules.length));let g=e.style.animation||"";return e.style.animation=`${g?`${g}, `:""}${u} ${i}ms linear ${o}ms 1 both`,eR+=1,u}let eM=[],eT=[],eB=[],eN=[],ez=Promise.resolve(),eV=!1;function eF(e){eB.push(e)}let eW=!1,ej=new Set;function eH(){if(!eW){eW=!0;do{for(let e=0;e<eM.length;e+=1){let t=eM[e];i=t,function(e){if(null!==e.fragment){e.update(),ep(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(eF)}}(t.$$)}for(i=null,eM.length=0;eT.length;)eT.pop()();for(let e=0;e<eB.length;e+=1){let t=eB[e];ej.has(t)||(ej.add(t),t())}eB.length=0}while(eM.length);for(;eN.length;)eN.pop()();eV=!1,eW=!1,ej.clear()}}function eK(e,t,n){e.dispatchEvent(function(e,t){let n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,void 0),n}(`${t?"intro":"outro"}${n}`))}let eJ=new Set;function eU(){r={r:0,c:[],p:r}}function eY(){r.r||ep(r.c),r=r.p}function eG(e,t){e&&e.i&&(eJ.delete(e),e.i(t))}function eX(e,t,n,i){e&&e.o&&!eJ.has(e)&&(eJ.add(e),r.c.push(()=>{eJ.delete(e),i&&(n&&e.d(1),i())}),e.o(t))}let eQ={duration:0};function eZ(e,t,n,i){let s=t(e,n),a=i?0:1,l=null,d=null,c=null;function u(){c&&function(e,t){let n=(e.style.animation||"").split(", "),i=n.filter(t?e=>0>e.indexOf(t):e=>-1===e.indexOf("__svelte")),o=n.length-i.length;!o||(e.style.animation=i.join(", "),(eR-=o)||eC(()=>{eR||(eO.forEach(e=>{let t=e.__svelte_stylesheet,n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}}),eO.clear())}))}(e,c)}function p(e,t){let n=e.b-a;return t*=Math.abs(n),{a:a,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function h(t){let{delay:n=0,duration:i=300,easing:o=ed,tick:h=el,css:y}=s||eQ,g={start:ev()+n,b:t};if(t||(g.group=r,r.r+=1),l||d)d=g;else{var f;y&&(u(),c=eq(e,a,t,i,n,o,y)),t&&h(0,1),l=p(g,i),eF(()=>eK(e,t,"start")),f=t=>{if(d&&t>d.start&&(l=p(d,i),d=null,eK(e,l.b,"start"),y&&(u(),c=eq(e,a,l.b,l.duration,0,o,s.css))),l){if(t>=l.end)h(a=l.b,1-a),eK(e,l.b,"end"),d||(l.b?u():--l.group.r||ep(l.group.c)),l=null;else if(t>=l.start){let e=t-l.start;h(a=l.a+l.d*o(e/l.duration),1-a)}}return!!(l||d)},0===eb.size&&eC(eD),new Promise(e=>{eb.add({c:f,f:e})})}}return{run(e){eh(s)?(o||(o=Promise.resolve()).then(()=>{o=null}),o).then(()=>{s=s(),h(e)}):h(e)},end(){u(),l=d=null}}}function e0(e){e&&e.c()}function e1(e,t,n,i){let{fragment:o,on_mount:r,on_destroy:s,after_update:a}=e.$$;o&&o.m(t,n),i||eF(()=>{let t=r.map(ec).filter(eh);s?s.push(...t):ep(t),e.$$.on_mount=[]}),a.forEach(eF)}function e9(e,t){let n=e.$$;null!==n.fragment&&(ep(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function e2(e,t,n,o,r,s,a=[-1]){let l=i;i=e;let d=e.$$={fragment:null,ctx:null,props:s,update:el,not_equal:r,bound:eu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:eu(),dirty:a,skip_bound:!1},c=!1;if(d.ctx=n?n(e,t.props||{},(t,n,...i)=>{let o=i.length?i[0]:n;return d.ctx&&r(d.ctx[t],d.ctx[t]=o)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](o),c)&&(-1===e.$$.dirty[0]&&(eM.push(e),eV||(eV=!0,ez.then(eH)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31),n}):[],d.update(),c=!0,ep(d.before_update),d.fragment=!!o&&o(d.ctx),t.target){if(t.hydrate){let e=Array.from(t.target.childNodes);d.fragment&&d.fragment.l(e),e.forEach(ek)}else d.fragment&&d.fragment.c();t.intro&&eG(e.$$.fragment),e1(e,t.target,t.anchor,t.customElement),eH()}i=l}class e3{$destroy(){e9(this,1),this.$destroy=el}$on(e,t){let n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&0!==Object.keys(e).length&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}let e8=[],e4=function(e,t=el){let n;let i=[];function o(t){if(ey(e,t)&&(e=t,n)){let t=!e8.length;for(let t=0;t<i.length;t+=1){let n=i[t];n[1](),e8.push(n,e)}if(t){for(let e=0;e<e8.length;e+=2)e8[e][0](e8[e+1]);e8.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(r,s=el){let a=[r,s];return i.push(a),1===i.length&&(n=t(o)||el),r(e),()=>{let e=i.indexOf(a);-1!==e&&i.splice(e,1),0===i.length&&(n(),n=null)}}}}(null);function e6(e,{delay:t=0,duration:n=400,easing:i=ed}={}){let o=+getComputedStyle(e).opacity;return{delay:t,duration:n,easing:i,css:e=>`opacity: ${e*o}`}}class e5{constructor(){this.darkMode=!1}enableDarkMode(e){this.darkMode=e}}let e7=E("theme",()=>new e5);function te(e){let t,n,i,o,r,s,a,l,d,c,u;let p=e[1].closeButton&&tt(e);var h=e[2];return h&&(s=new h({})),{c(){t=eE("div"),n=eE("div"),i=eE("div"),p&&p.c(),o=eA(),r=eE("div"),s&&e0(s.$$.fragment),eS(r,"class","content svelte-kqf8ju"),eS(r,"style",e[13]),eS(i,"class","window svelte-kqf8ju"),eS(i,"role","dialog"),eS(i,"aria-modal","true"),eS(i,"style",e[12]),e_(i,"dark-mode",e7.darkMode),eS(n,"class","window-wrap svelte-kqf8ju"),eS(n,"style",e[11]),eS(t,"class","bg svelte-kqf8ju"),eS(t,"style",e[10])},m(a,l){ew(a,t,l),ex(t,n),ex(n,i),p&&p.m(i,null),ex(i,o),ex(i,r),s&&e1(s,r,null),e[39](i),e[40](n),e[41](t),d=!0,c||(u=[e$(i,"introstart",function(){eh(e[6])&&e[6].apply(this,arguments)}),e$(i,"outrostart",function(){eh(e[7])&&e[7].apply(this,arguments)}),e$(i,"introend",function(){eh(e[8])&&e[8].apply(this,arguments)}),e$(i,"outroend",function(){eh(e[9])&&e[9].apply(this,arguments)}),e$(t,"click",e[19])],c=!0)},p(a,l){if((e=a)[1].closeButton?p?(p.p(e,l),2&l[0]&&eG(p,1)):((p=tt(e)).c(),eG(p,1),p.m(i,o)):p&&(eU(),eX(p,1,1,()=>{p=null}),eY()),h!==(h=e[2])){if(s){eU();let e=s;eX(e.$$.fragment,1,0,()=>{e9(e,1)}),eY()}h?(e0((s=new h({})).$$.fragment),eG(s.$$.fragment,1),e1(s,r,null)):s=null}(!d||8192&l[0])&&eS(r,"style",e[13]),(!d||4096&l[0])&&eS(i,"style",e[12]),(!d||2048&l[0])&&eS(n,"style",e[11]),(!d||1024&l[0])&&eS(t,"style",e[10])},i(n){d||(eG(p),s&&eG(s.$$.fragment,n),eF(()=>{a||(a=eZ(i,e[16],e[1].transitionWindowProps,!0)),a.run(1)}),eF(()=>{l||(l=eZ(t,e[15],e[1].transitionBgProps,!0)),l.run(1)}),d=!0)},o(n){eX(p),s&&eX(s.$$.fragment,n),a||(a=eZ(i,e[16],e[1].transitionWindowProps,!1)),a.run(0),l||(l=eZ(t,e[15],e[1].transitionBgProps,!1)),l.run(0),d=!1},d(n){n&&ek(t),p&&p.d(),s&&e9(s),e[39](null),n&&a&&a.end(),e[40](null),e[41](null),n&&l&&l.end(),c=!1,ep(u)}}}function tt(e){let t,n,i,o,r;let s=[ti,tn],a=[];function l(e,n){return(2&n[0]&&(t=!!e[17](e[1].closeButton)),t)?0:1}return i=a[n=l(e,[-1])]=s[n](e),{c(){i.c(),o=eI("")},m(e,t){a[n].m(e,t),ew(e,o,t),r=!0},p(e,t){let r=n;(n=l(e,t))===r?a[n].p(e,t):(eU(),eX(a[r],1,1,()=>{a[r]=null}),eY(),(i=a[n])?i.p(e,t):(i=a[n]=s[n](e)).c(),eG(i,1),i.m(o.parentNode,o))},i(e){r||(eG(i),r=!0)},o(e){eX(i),r=!1},d(e){a[n].d(e),e&&ek(o)}}}function tn(e){let t,n,i;return{c(){eS(t=eE("button"),"class","close svelte-kqf8ju"),eS(t,"style",e[14])},m(o,r){ew(o,t,r),n||(i=e$(t,"click",e[0]),n=!0)},p(e,n){16384&n[0]&&eS(t,"style",e[14])},i:el,o:el,d(e){e&&ek(t),n=!1,i()}}}function ti(e){let t,n,i;var o=e[1].closeButton;function r(e){return{props:{onClose:e[0]}}}return o&&(t=new o(r(e))),{c(){t&&e0(t.$$.fragment),n=eI("")},m(e,o){t&&e1(t,e,o),ew(e,n,o),i=!0},p(e,i){if(o!==(o=e[1].closeButton)){if(t){eU();let e=t;eX(e.$$.fragment,1,0,()=>{e9(e,1)}),eY()}o?(e0((t=new o(r(e))).$$.fragment),eG(t.$$.fragment,1),e1(t,n.parentNode,n)):t=null}},i(e){i||(t&&eG(t.$$.fragment,e),i=!0)},o(e){t&&eX(t.$$.fragment,e),i=!1},d(e){e&&ek(n),t&&e9(t,e)}}}function to(e){let t,n,i,o;let r=e[2]&&te(e),s=e[38].default,a=function(e,t,n,i){if(e){let i=ef(e,t,n,null);return e[0](i)}}(s,e,e[37],0);return{c(){r&&r.c(),t=eA(),a&&a.c()},m(s,l){r&&r.m(s,l),ew(s,t,l),a&&a.m(s,l),n=!0,i||(o=e$(window,"keydown",e[18]),i=!0)},p(e,n){e[2]?r?(r.p(e,n),4&n[0]&&eG(r,1)):((r=te(e)).c(),eG(r,1),r.m(t.parentNode,t)):r&&(eU(),eX(r,1,1,()=>{r=null}),eY()),a&&a.p&&64&n[1]&&function(e,t,n,i,o,r,s){let a=function(e,t,n,i){if(e[2]&&i){let o=e[2](i(n));if(void 0===t.dirty)return o;if("object"==typeof o){let e=[],n=Math.max(t.dirty.length,o.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|o[i];return e}return t.dirty|o}return t.dirty}(t,i,o,null);if(a){let o=ef(t,n,i,null);e.p(o,a)}}(a,s,e,e[37],n,0,0)},i(e){n||(eG(r),eG(a,e),n=!0)},o(e){eX(r),eX(a,e),n=!1},d(e){r&&r.d(e),e&&ek(t),a&&a.d(e),i=!1,o()}}}function tr(e,t={}){return function(n){return new e({...n,props:{...t,...n.props}})}}function ts(e,t,n){let i,o,r,s,a,l,d,c,u,p;let{$$slots:h={},$$scope:y}=t,g=(0,C.x)(),f=C.v,{show:m=null}=t,{key:v="simple-modal"}=t,{closeButton:b=!0}=t,{closeOnEsc:D=!0}=t,{closeOnOuterClick:x=!0}=t,{styleBg:w={top:0,left:0}}=t,{styleWindowWrap:k={}}=t,{styleWindow:E={}}=t,{styleContent:I={}}=t,{styleCloseButton:A={}}=t,{setContext:$=f}=t,{transitionBg:S=e6}=t,{transitionBgProps:P={duration:250}}=t,{transitionWindow:L=S}=t,{transitionWindowProps:_=P}=t,O={closeButton:b,closeOnEsc:D,closeOnOuterClick:x,styleBg:w,styleWindowWrap:k,styleWindow:E,styleContent:I,styleCloseButton:A,transitionBg:S,transitionBgProps:P,transitionWindow:L,transitionWindowProps:_},R=Object.assign({},O),q=null,M=e=>e.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase(),T=e=>Object.keys(e).reduce((t,n)=>`${t}; ${M(n)}: ${e[n]}`,""),B=e=>!!(e&&e.constructor&&e.call&&e.apply),N=()=>{},z=N,V=N,F=N,W=N,j={},H=(e,t={},i={})=>{n(2,q=tr(e,t)),n(1,R=Object.assign(Object.assign({},O),i)),n(6,z=()=>{j.onOpen&&j.onOpen(),g("opening")}),n(7,V=()=>{j.onClose&&j.onClose(),g("closing")}),n(8,F=()=>{j.onOpened&&j.onOpened(),g("opened")}),n(9,W=()=>{j.onClosed&&j.onClosed(),g("closed")})},K=(e={})=>{n(7,V=e.onClose||V),n(9,W=e.onClosed||W),n(2,q=null)};return $(v,{open:H,close:K}),e.$$set=e=>{"show"in e&&n(20,m=e.show),"key"in e&&n(21,v=e.key),"closeButton"in e&&n(22,b=e.closeButton),"closeOnEsc"in e&&n(23,D=e.closeOnEsc),"closeOnOuterClick"in e&&n(24,x=e.closeOnOuterClick),"styleBg"in e&&n(25,w=e.styleBg),"styleWindowWrap"in e&&n(26,k=e.styleWindowWrap),"styleWindow"in e&&n(27,E=e.styleWindow),"styleContent"in e&&n(28,I=e.styleContent),"styleCloseButton"in e&&n(29,A=e.styleCloseButton),"setContext"in e&&n(30,$=e.setContext),"transitionBg"in e&&n(31,S=e.transitionBg),"transitionBgProps"in e&&n(32,P=e.transitionBgProps),"transitionWindow"in e&&n(33,L=e.transitionWindow),"transitionWindowProps"in e&&n(34,_=e.transitionWindowProps),"$$scope"in e&&n(37,y=e.$$scope)},e.$$.update=()=>{2&e.$$.dirty[0]&&n(10,i=T(R.styleBg)),2&e.$$.dirty[0]&&n(11,o=T(R.styleWindowWrap)),2&e.$$.dirty[0]&&n(12,r=T(R.styleWindow)),2&e.$$.dirty[0]&&n(13,s=T(R.styleContent)),2&e.$$.dirty[0]&&n(14,a=T(R.styleCloseButton)),2&e.$$.dirty[0]&&n(15,l=R.transitionBg),2&e.$$.dirty[0]&&n(16,d=R.transitionWindow),1048576&e.$$.dirty[0]&&(B(m)?H(m):K())},[K,R,q,c,u,p,z,V,F,W,i,o,r,s,a,l,d,B,e=>{R.closeOnEsc&&q&&"Escape"===e.key&&(e.preventDefault(),K()),q&&e.key},e=>{R.closeOnOuterClick&&(e.target===c||e.target===u)&&(e.preventDefault(),K())},m,v,b,D,x,w,k,E,I,A,$,S,P,L,_,e=>{j=e},H,y,h,function(e){eT[e?"unshift":"push"](()=>{n(5,p=e)})},function(e){eT[e?"unshift":"push"](()=>{n(4,u=e)})},function(e){eT[e?"unshift":"push"](()=>{n(3,c=e)})}]}class ta extends e3{constructor(e){super(),e2(this,e,ts,to,ey,{show:20,key:21,closeButton:22,closeOnEsc:23,closeOnOuterClick:24,styleBg:25,styleWindowWrap:26,styleWindow:27,styleContent:28,styleCloseButton:29,setContext:30,transitionBg:31,transitionBgProps:32,transitionWindow:33,transitionWindowProps:34,setCallback:35,open:36,close:0},[-1,-1])}get setCallback(){return this.$$.ctx[35]}get open(){return this.$$.ctx[36]}get close(){return this.$$.ctx[0]}}function tl(e){let t,n,i,o,r;let s=e4&&(r={show:e[1]},i=new ta({props:r}),e[4](i),{c(){e0(i.$$.fragment)},m(e,t){e1(i,e,t),o=!0},p(e,t){let n={};2&t&&(n.show=e[1]),i.$set(n)},i(e){o||(eG(i.$$.fragment,e),o=!0)},o(e){eX(i.$$.fragment,e),o=!1},d(t){e[4](null),e9(i,t)}});return{c(){s&&s.c(),t=eI("")},m(e,i){s&&s.m(e,i),ew(e,t,i),n=!0},p(e,[t]){e4&&s.p(e,t)},i(e){n||(eG(s),n=!0)},o(e){eX(s),n=!1},d(e){s&&s.d(e),e&&ek(t)}}}function td(e,t,n){let i,o;return eg(e,e4,e=>n(1,i=e)),[o,i,function(e,t,n){e4.set(tr(e,t)),o.setCallback(n||{})},function(){o.close()},function(e){eT[e?"unshift":"push"](()=>{n(0,o=e)})}]}class tc extends e3{constructor(e){super(),e2(this,e,td,tl,ey,{show:2,close:3})}get show(){return this.$$.ctx[2]}get close(){return this.$$.ctx[3]}}class tu{constructor(){}getModal(){return this.genericModalContainer||(this.genericModalContainer=new tc({target:document.body})),this.genericModalContainer}}let tp=E("modal",()=>new tu);function th(e,t,n){let i=e.slice();return i[7]=t[n],i}function ty(e){return{c:el,m:el,p:el,d:el}}function tg(e){let t,n,i,o,r;let s=e[0](e[10])+"";function a(){return e[4](e[7])}return{c(){t=eE("button"),n=eI(s),i=eA(),eS(t,"class","svelte-r1kwme")},m(e,s){ew(e,t,s),ex(t,n),ew(e,i,s),o||(r=e$(t,"click",a),o=!0)},p(t,i){e=t,1&i&&s!==(s=e[0](e[10])+"")&&eL(n,s)},d(e){e&&ek(t),e&&ek(i),o=!1,r()}}}function tf(e){return{c:el,m:el,p:el,d:el}}function tm(e){let t;let n={ctx:e,current:null,token:null,hasCatch:!1,pending:tf,then:tg,catch:ty,value:10};return!function(e,t){let n=t.token={};function o(e,i,o,r){if(t.token!==n)return;t.resolved=r;let s=t.ctx;void 0!==o&&((s=s.slice())[o]=r);let a=e&&(t.current=e)(s),l=!1;t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==i&&e&&(eU(),eX(e,1,1,()=>{t.blocks[n]===e&&(t.blocks[n]=null)}),eY())}):t.block.d(1),a.c(),eG(a,1),a.m(t.mount(),t.anchor),l=!0),t.block=a,t.blocks&&(t.blocks[i]=a),l&&eH()}if(e&&"object"==typeof e&&"function"==typeof e.then){let n=function(){if(!i)throw Error("Function called outside component initialization");return i}();e.then(e=>{i=n,o(t.then,1,t.value,e),i=null},e=>{if(i=n,o(t.catch,2,t.error,e),i=null,!t.hasCatch)throw e}),t.current!==t.pending&&o(t.pending,0)}else{if(t.current!==t.then)return o(t.then,1,t.value,e);t.resolved=e}}(e[7].getDisplayName(),n),{c(){t=eI(""),n.block.c()},m(e,i){ew(e,t,i),n.block.m(e,n.anchor=i),n.mount=()=>t.parentNode,n.anchor=t},p(t,i){e=t;{let t=e.slice();t[10]=n.resolved,n.block.p(t,i)}},d(e){e&&ek(t),n.block.d(e),n.token=null,n=null}}}function tv(e){let t,n,i,o,r,s,a,l,d,c,u,p,h,y,g;let f=e[0]("credaccessprompt.please-choose")+"",m=e[0]("credaccessprompt.your-did")+"",v=e[0]("credaccessprompt.login-msg")+"",C=F.getAvailableConnectors(),b=[];for(let t=0;t<C.length;t+=1)b[t]=tm(th(e,C,t));return{c(){t=eE("ion-content"),n=eE("ion-grid"),i=eE("img"),r=eA(),s=eE("h1"),a=eI(f),l=eA(),d=eE("h2"),c=eI(m),u=eA(),p=eE("footer"),h=eE("p"),y=eI(v),g=eA();for(let e=0;e<b.length;e+=1)b[e].c();i.src!==(o="!theme.darkMode ? 'assets/icons/did.svg' : 'assets/icons/darkmode/did.svg'")&&eS(i,"src",o),eS(i,"alt",""),eS(s,"class","svelte-r1kwme"),eS(d,"class","svelte-r1kwme"),eP(n,"class","container"),eP(t,"class","ion-text-center"),eS(h,"class","svelte-r1kwme"),eS(p,"class","svelte-r1kwme"),e_(p,"dark-mode",e[1].darkMode)},m(e,o){ew(e,t,o),ex(t,n),ex(n,i),ex(n,r),ex(n,s),ex(s,a),ex(n,l),ex(n,d),ex(d,c),ew(e,u,o),ew(e,p,o),ex(p,h),ex(h,y),ex(p,g);for(let e=0;e<b.length;e+=1)b[e].m(p,null)},p(e,[t]){if(1&t&&f!==(f=e[0]("credaccessprompt.please-choose")+"")&&eL(a,f),1&t&&m!==(m=e[0]("credaccessprompt.your-did")+"")&&eL(c,m),1&t&&v!==(v=e[0]("credaccessprompt.login-msg")+"")&&eL(y,v),5&t){let n;for(n=0,C=F.getAvailableConnectors();n<C.length;n+=1){let i=th(e,C,n);b[n]?b[n].p(i,t):(b[n]=tm(i),b[n].c(),b[n].m(p,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=C.length}},i:el,o:el,d(e){e&&ek(t),e&&ek(u),e&&ek(p),function(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(b,e)}}}function tC(e,t,n){let i;eg(e,b._,e=>n(0,i=e));var o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})};let{onSelection:r=null}=t;function s(e){return o(this,void 0,void 0,function*(){F.setActiveConnector(e.name),tp.getModal().close(),setTimeout(()=>{r(e.name)},500)})}return e.$$set=e=>{"onSelection"in e&&n(3,r=e.onSelection)},[i,e7,s,r,e=>s(e)]}class tb extends e3{constructor(e){super(),e2(this,e,tC,tv,ey,{onSelection:3})}}let tD={"local-identity-name":"Temporary Identity",welcome:"Welcome to","my-first-did":"My First Identity","temp-did":"temporary identity",copied:"Copied to clipboard!",continue:"Continue",next:"Next",deadend:{"titlebar-title":"Forbidden",oops:"Ooops!",intro:"This application cannot be started manually. It must be started with specific intents only.","debug-revoke":"Debug: revoke hive auth","debug-call":"Debug: call vault API"},identitysetup:{"titlebar-title":"Identity Setup","slide2-msg":"This application uses decentralized identities (DIDs). With decentralized identities, you own your identity, your data.","slide2-msg2":"So it seems that you either don't know what this is yet, or you have never created your own identity? We are here to help, the following steps will automatically create and publish a brand new Elastos Identity and storage space for you.","slide3-msg":"In the future, if you want to better control or use this identity in other DID-powered applications, you may export it to a third party wallet application such as Elastos Essentials.","create-did":"Create Identity","create-did-msg":"Add a new identity to your device","publish-did":"Publish Identity","publish-did-msg":"Record identity to the public repository. This step takes between 10 and 15 minutes.","config-storage":"Configure Storage","config-storage-msg":"Setup a personal storage for your Identity's data.","progress-msg":"Please don't hesitate to leave at any time. You can return and resume your identity setup when you are ready.","done-msg":"All done, you now have a decentralized identity and storage space! When you better understand the advantages of DIDs later, you can export it and reuse it in other apps","create-my-did":"Create my Identity","error-msg":"Sorry, it seems like something unexpected happened. The problem has been reported to the team but in the meantime, would you like to restart the identity creation from the beginning?",restart:"Restart","takes-long-time":"(this takes several minutes)"},credaccess:{"titlebar-title":"Profile Request","profile-request":"Profile Request",intro:"You are currently using a",message:"This application is requesting some of your profile information. As this is a temporary identity, default information is going to be returned for now. Later on, you can fully manage your identity using an app such as Elastos Essentials."},credaccessprompt:{"titlebar-title":"Login","login-msg":"Select one of the following options","temp-did":"Temporary Identity","please-choose":"Please Choose","your-did":"Your Identity","elastos-essentials":"Elastos Essentials"},exportidentity:{"titlebar-title":"Export Identity",did:"Identity","copy-did":"Copy Identity","copy-paperkey":"Copy Paper Key",paperkey:"Paper Key","show-paperkey":"Show Paper Key","hide-paperkey":"Hide Paper Key","paperkey-not-copied-msg":"Safely store the words in your paper key in the right order. After that, you can copy and paste them in the import identity flow of your favorite identity apps (ex: Elastos Essentials).","paperkey-copied-msg":"Your paper key has been copied to your clipboard. Please save them safely. You can now open your third party identity app and import your identity using these words."},manageidentity:{"titlebar-title":"Manage Identity","did-management":"Identity Management",intro:"You are currently using a",intro2:"bound only to this application. Besides, this identity has currently not been saved and cannot be recovered if you reinstall the application, nor can it be shared with other applications.",intro3:"We recommend you to export your temporary identity to an external identity app such as Elastos Essentials (it has to be installed on your device first).","export-did":"Export Identity","edit-profile":"Edit Profile"},"edit-profile":{message:"Providing your information is optional. You can skip this step and continue.","enter-name":"Enter Name","enter-email":"Enter Email"}},tx={"local-identity-name":"Identit\xe9 temporaire",welcome:"Bienvenue sur","my-first-did":"Ma Premi\xe8re Identit\xe9","temp-did":"identit\xe9 temporaire",copied:"Copi\xe9 dans le presse-papier!",continue:"Continuer",next:"Suivant",deadend:{"titlebar-title":"Interdit",oops:"Ooops!",intro:"Cette application ne peut pas \xeatre lanc\xe9e manuellement. Elle doit \xeatre lanc\xe9e uniquement via des intents sp\xe9cifiques.","debug-revoke":"Debug: revoke hive auth","debug-call":"Debug: call vault API"},identitysetup:{"titlebar-title":"Cr\xe9ation d'une identit\xe9","slide2-msg":"Cette application utilise des identit\xe9s d\xe9centralis\xe9es (DIDs). Avec une identit\xe9 d\xe9centralis\xe9e, vous contr\xf4lez votre identit\xe9 et vos donn\xe9es.","slide2-msg2":"Il semble que vous ne saviez pas de quoi il s'agit, ou que vous n'ayez pas encore cr\xe9\xe9 ce genre d'identit\xe9? Les \xe9tapes suivante vont automatiquement cr\xe9er et publier une toute nouvelle identit\xe9 pour vous, puis configurer votre espace de stockage.","slide3-msg":"Dans l'avenir, pour mieux g\xe9rer cette identit\xe9 ou l'utiliser dans d'autres applications qui supportent les DIDs, vous pourrez l'exporter vers un portefeuille d'identit\xe9 tiers tel qu'Elastos Essentials.","create-did":"Cr\xe9ation de l'identit\xe9","create-did-msg":"Ajoute la nouvelle identit\xe9 sur votre appareil","publish-did":"Publication de l'identit\xe9","publish-did-msg":"Enregistre l'identit\xe9 dans le r\xe9pertoire public. Cette \xe9tape prend entre 10 et 15 minutes.","config-storage":"Espace de stockage","config-storage-msg":"Configure un espace de stockage pour les donn\xe9es de vos applications.","progress-msg":"Cette \xe9tape \xe9tant longue, vous pouvez quitter l'application \xe0 tout moment et revenir plus tard, rien ne sera perdu.","done-msg":"C'est pr\xeat, vous avez maintenant une identit\xe9 d\xe9centralis\xe9e et un espace de stockage! Lorsque vous aurez mieux compris les avantages des DIDs plus tard, vous pourrez l'exporter et l'utiliser dans d'autres applications.","create-my-did":"Cr\xe9er mon Identit\xe9","error-msg":"Hmm, il semble qu'il y ait eu une erreur. Le probl\xe8me a \xe9t\xe9 envoy\xe9 aux d\xe9veloppeurs mais pour l'instant, souhaitez-vous relancer la cr\xe9ation d'identit\xe9 depuis le d\xe9but?",restart:"Recommencer","takes-long-time":"(ceci prend plusieurs minutes)"},credaccess:{"titlebar-title":"Acc\xe8s au Profil","profile-request":"Acc\xe8s au Profil",intro:"Vous utilisez une",message:"Cette application demande un acc\xe8s \xe0 certaines informations de votre profile. Comme vous utilisez une identit\xe9 temporaire, des informations par d\xe9faut vont \xeatre retourn\xe9es pour le moment. Plus tard, vous pourrez g\xe9rer votre identit\xe9 en d\xe9tail via une portefeuille d'identit\xe9s tel qu'Elastos Essentials."},credaccessprompt:{"titlebar-title":"Connexion","login-msg":"S\xe9lectionnez l'une des options suivantes","temp-did":"Identit\xe9 Temporaire","please-choose":"Veuillez choisir","your-did":"Votre identit\xe9","elastos-essentials":"Elastos Essentials"},exportidentity:{"titlebar-title":"Exporter l'identit\xe9",did:"Identit\xe9","copy-did":"Copier l'identit\xe9","copy-paperkey":"Copy Paper Key",paperkey:"Paper Key","show-paperkey":"Show Paper Key","hide-paperkey":"Hide Paper Key","paperkey-not-copied-msg":"Safely store the words in your paper key in the right order. After that, you can copy and paste them in the import identity flow of your favorite identity apps (ex: Elastos Essentials).","paperkey-copied-msg":"Your paper key has been copied to your clipboard. Please save them safely. You can now open your third party identity app and import your identity using these words."},manageidentity:{"titlebar-title":"Mon l'identit\xe9","did-management":"Gestion de l'identit\xe9",intro:"Vous utilisez actuellement une ",intro2:"enregistr\xe9e uniquement dans cette application. De plus, cette identit\xe9 n'a psa encore \xe9t\xe9 sauvegard\xe9e et sera perdue si vous r\xe9installez l'application, et ne pourra pas \xeatre r\xe9utilis\xe9e dans d'autres applications.",intro3:"Nous vous recommandons d'exporter cette identit\xe9 vers un portefeuille d'identit\xe9 externe tel qu'Elastos Essentials (application tierce que vous devez d'abord installer).","export-did":"Exporter l'Identit\xe9","edit-profile":"Modifier le profil"},"edit-profile":{message:"Ces informations sont optionnelles. Vous pouvez passer cette \xe9tape si besoin.","enter-name":"Saisir un nom","enter-email":"Saisir une adresse email"}},tw={"local-identity-name":"Temporary Identity",welcome:"","my-first-did":"","temp-did":"",copied:"",continue:"",next:"",deadend:{"titlebar-title":"",oops:"",intro:" ","debug-revoke":" Hive ","debug-call":" vault API"},identitysetup:{"titlebar-title":"","slide2-msg":"DID ","slide2-msg2":" Elastos","slide3-msg":"DIDElastos Essentials","create-did":"","create-did-msg":"","publish-did":"","publish-did-msg":" ","config-storage":"","config-storage-msg":"","progress-msg":"","done-msg":"DID","create-my-did":"","error-msg":" ",restart:"","takes-long-time":""},credaccess:{"titlebar-title":"","profile-request":"",intro:"",message:"  Elastos Essentials"},credaccessprompt:{"titlebar-title":"","login-msg":"","temp-did":"","please-choose":"","your-did":"","elastos-essentials":"Elastos Essentials"},exportidentity:{"titlebar-title":"",did:"","copy-did":"","copy-paperkey":"Copy Paper Key",paperkey:"Paper Key","show-paperkey":"Show Paper Key","hide-paperkey":"Hide Paper Key","paperkey-not-copied-msg":"Safely store the words in your paper key in the right order. After that, you can copy and paste them in the import identity flow of your favorite identity apps (ex: Elastos Essentials).","paperkey-copied-msg":"Your paper key has been copied to your clipboard. Please save them safely. You can now open your third party identity app and import your identity using these words."},manageidentity:{"titlebar-title":"","did-management":"",intro:"",intro2:" ",intro3:"Elastos Essentials","export-did":"","edit-profile":""},"edit-profile":{message:" ","enter-name":"","enter-email":""}};class tk{constructor(){this.activeLanguage=new m.X("en"),this.baseLanguages={en:tD,fr:tx,zh:tw},this.currentLanguages=this.baseLanguages,this.init()}init(){b.SP.subscribe(e=>{this.activeLanguage.next(e)}),b.Fd.set(this.currentLanguages),this.setLanguage("en")}setLanguage(e){z.log("Setting connectivity SDK language to: ",e),b.SP.set(e)}getLanguage(){return this.activeLanguage.value}addLanguage(e,t){this.currentLanguages[e]=t,b.Fd.set(this.currentLanguages)}translateInstant(e){return(0,b.EQ)(e).format()}}let tE=E("localization",()=>new tk);var tI=Object.freeze({__proto__:null,UXAccess:class{constructor(){}onBoard(e,t,n,i){return D(this,void 0,void 0,function*(){return new Promise((o,r)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){if(!F.getActiveConnector().onBoard){r(L("onBoard"));return}if(!e){r(Error("Parameter feature must be given"));return}try{let r=yield F.getActiveConnector().onBoard(e,t,n,i);o(r)}catch(e){r(e)}}),()=>{o(null)})})})}}});(l=u||(u={})).Cancelled="cancelled",l.Published="published",l.Error="error";var tA=Object.freeze({__proto__:null,get TransactionStatus(){return u},WalletAccess:class{pay(e){return new Promise((t,n)=>{W.ensureActiveConnector(()=>D(this,void 0,void 0,function*(){try{let n=yield F.getActiveConnector().pay(e);t(n)}catch(e){n(e)}}),()=>{t(null)})})}voteForDPoS(){throw Error("Method not implemented.")}voteForCRCouncil(){throw Error("Method not implemented.")}voteForCRProposal(){throw Error("Method not implemented.")}sendSmartContractTransaction(e){throw Error("Method not implemented.")}}});F.setGenericUIHandler(new class{constructor(){}showConnectorChooser(){return D(this,void 0,void 0,function*(){return new Promise(e=>{tp.getModal().show(tb,{onSelection:t=>{z.log("Selected connector: "+t),e(t)}})})})}})}}]);