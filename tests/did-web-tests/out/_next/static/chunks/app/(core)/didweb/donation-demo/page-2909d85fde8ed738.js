(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{56947:function(e,t,n){Promise.resolve().then(n.bind(n,70810))},70810:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var a,i,r,s,l=n(57437),o=n(43226),d=n(2265),c=n(10061),u=n(66127),p=n(2582),m=n(64562),h=n(27760),y=n(25210);let f={accessKey:null,appDID:null,webServiceEndpoint:"https://didweb.com",webServiceAPIEndpoint:"https://api.didweb.com"},g=f;(a=r||(r={}))[a.NetworkError=20001]="NetworkError",a[a.EmptyResponse=20002]="EmptyResponse",a[a.InvalidResponse=20003]="InvalidResponse",a[a.ServerError=20004]="ServerError",a[a.Unspecified=20999]="Unspecified";class w{constructor(){}static create(e,t,n){let a=new w;return a.message=t,a.code=e,a.timestamp=new Date,a.errors=n,a}static isSDKException(e){return"object"==typeof e&&"code"in e}}async function I(e,t,n,a){let i;let s=`${g.webServiceAPIEndpoint}/graphql`,l=g.accessKey;try{let e=await fetch(s,{method:"POST",headers:new Headers({"content-type":"application/json",...l&&{"x-developer-key":l},...a&&{...a}}),body:JSON.stringify({query:t,variables:n})});i=await e?.json()}catch(e){if("Failed to fetch"===e?.message)throw w.create(r.NetworkError,"Unable to reach the backend service");return null}if(!i)throw w.create(r.EmptyResponse,`Empty response received from the backend during a call to ${e}`);if("object"!=typeof i)throw w.create(r.InvalidResponse,`Not a json response received during a call to ${e}`);if("errors"in i)throw w.create(r.ServerError,`Server errors during a call to ${e}`,i.errors);if(!("data"in i))throw w.create(r.InvalidResponse,`No 'data' field in graphql response during a call to ${e}`);if(!(e in i.data))throw w.create(r.InvalidResponse,`Expected graphql field '${e}' not found in response during a call to ${e}`);return i.data[e]}async function x(){return await I("createManagedIdentity","\n    mutation CreateManagedIdentity($input: CreateManagedIdentityInput!) {\n      createManagedIdentity (input: $input) {\n        identityAccessToken did\n      }\n    }\n  ",{input:{...g.appDID&&{appDID:g.appDID}}})}async function v(e){return await I("getManagedIdentityStatus","\n    query GetManagedIdentityStatus {\n      getManagedIdentityStatus  {\n        createdAt claimed claimedAt\n      }\n    }\n  ",null,{...e&&{"x-identity-access-token":e}})}async function b(e,t){return await I("importManagedIdentityCredentials","\n    mutation ImportManagedIdentityCredentials($input: ImportManagedIdentityCredentialsInput!) {\n      importManagedIdentityCredentials (input: $input) {\n        id\n      }\n    }\n  ",{input:{credentials:t.toString()}},{...e&&{"x-identity-access-token":e}})}async function j(e){return await I("createIdentityClaimRequest","\n    mutation CreateIdentityClaimRequest {\n      createIdentityClaimRequest {\n        id identityInfo { did createdAt } claimUrl\n      }\n    }\n  ",null,{...e&&{"x-identity-access-token":e}})}let N="store-password";async function S(){let{Features:e,DefaultDIDAdapter:t,DIDBackend:a,DIDStore:i,RootIdentity:r,Mnemonic:s,Issuer:l,VerifiableCredential:o,DID:d}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588));e.enableJsonLdContext(!0),a.initialize(new t("mainnet"));let c=await i.open("server-side-store"),u=await r.createFromMnemonic(s.getInstance().generate(),"",c,N,!0);console.log("Created issuer identity:",u);let p=await u.newDid(N,0,!0);console.log("Issuer DID:",p);let m=await l.create(p);return console.log("Issuer:",m),m}async function C(e,t,a){let{VerifiableCredential:i}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588)),r=new i.Builder(e,t),s=await r.id("#name"+Math.random()).properties({name:a}).types("https://ns.elastos.org/credentials/profile/name/v1#NameCredential","https://ns.elastos.org/credentials/displayable/v1#DisplayableCredential").seal(N);return console.log("Generated credential:",s),s}async function k(e,t){console.log("Producing user credentials");let{DID:a}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588)),i=await S(),r=a.from(e);console.log("Target DID:",r);let s=await C(i,r,t);return[s]}g=Object.assign({},f,{accessKey:"1541832b7ee8d65f35f7b0bb7a531b84333eca8754217c440ed9e7e83d1917f5",appDID:"did:elastos:iUXMv4b8NtNeZh32gEsTwyBwmTaqb6Fdpw",webServiceEndpoint:"https://didweb.trinity-tech.io",webServiceAPIEndpoint:"https://didweb-service.trinity-tech.io"});let E={"did:elastos:iqoh6bPpKuMozeLRGLHjxMrtBNGRnsVpAk":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXNzd29yZCI6IjA0MmMxODA5LWUwOTgtNGJiYy1iZjQxLWIyYzNiYzZhZGQ5NSIsImlkZW50aXR5RElEIjoiZGlkOmVsYXN0b3M6aXFvaDZiUHBLdU1vemVMUkdMSGp4TXJ0Qk5HUm5zVnBBayIsImlhdCI6MTY5NTk2MTEwOSwiZXhwIjoxNjk4NTUzMTA5fQ.SSeJtzR2Nus6TUmry_BQS_EQvX8CjrimjdLWELoYAW0"};async function R(){try{let e=await x();return console.log("Created identity:",e),E[e.did]=e.identityAccessToken,e.did}catch(e){return console.error("Failed to create managed identity:",e),null}}async function M(e,t,n){let a;let i=await k(e,t);if(n){let t=E[e];if(!t)throw Error("No access token stored for target managed user identity "+e);let n=await v(t);if(console.log("managedIdentityStatus",n),null==n?void 0:n.claimed)a=!1;else{let e=await b(t,i);console.log("importResult",e),a=!0}}else a=!1;return{credentials:i.map(e=>e.toString()),imported:a}}async function D(e){let t=E[e];if(!t)throw Error("No access token stored for target managed user identity "+e);let n=await j(t);return console.log("claimRequest",n),n}let Z=e=>{let{}=e,t=(0,d.useRef)(null),a=(0,d.useRef)(null),[i,r]=(0,d.useState)(!1),[s,o]=(0,d.useState)(!1),[f,g]=(0,d.useState)(!1),[w,I]=(0,d.useState)(null),[x,v]=(0,d.useState)(null),[b,j]=(0,d.useState)(null),[N,S]=(0,d.useState)(!1),C=async e=>{console.log("Importing user credentials to his identity wallet, client side");let{didAccessV2:t}=await Promise.all([n.e(990),n.e(988),n.e(18)]).then(n.bind(n,11920));await t.importCredentials(e)};(0,d.useEffect)(()=>{let e=null;return Promise.all([n.e(990),n.e(988),n.e(18)]).then(n.bind(n,11920)).then(t=>{let{didAccessV2:n}=t;e=n.onImportCredentialsResponse((e,t)=>{console.log("onImportCredentialsResponse",e,t),g(!1),v(t.map(e=>e.id.toString()))})}),()=>e},[]);let k=async()=>{console.log("Creating a managed identity"),r(!0),S(!1);let e=await R();if(e){console.log("Managed identity creation ended",e),r(!1),I(e),D(e).then(e=>{j(e.claimUrl)}),console.log("Creating and importing credentials"),g(!0);let a=await M(e,t.current.value,!0);if(console.log("credentialProductionResult",a),g(!1),a){let{VerifiableCredential:e}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588));if(a.imported){let t=a.credentials.map(t=>e.parse(t).getId().toString());v(t)}else{let t=a.credentials.map(t=>e.parse(t));await C(t)}}}else S(!0)};return(0,l.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,l.jsx)(u.Z,{className:"w-full",label:"Name",inputRef:t,autoFocus:!0,defaultValue:"Test user",variant:"outlined",size:"small",autoComplete:"off"}),(0,l.jsx)(u.Z,{className:"w-full",label:"Address",inputRef:a,autoFocus:!0,defaultValue:"15 Rover Street, London, England",variant:"outlined",size:"small",autoComplete:"off"}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(m.Z,{control:(0,l.jsx)(h.Z,{defaultChecked:!0}),label:"I confirm I'm a UK resident and tax payer"})}),(0,l.jsx)(c.c,{onClick:k,busy:i,disabled:!!w,children:"Submit tax payer information"}),(0,l.jsxs)("div",{className:"mt-4",children:[N&&(0,l.jsx)("div",{className:"text-red-600",children:"An unexpected error occured. Please check logs and report to developers."}),!w&&(0,l.jsx)("div",{children:"No identity created yet"}),w&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Created user identity"}),": ",w]})}),b&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Claim your identity"}),": ",(0,l.jsx)(y.Z,{href:b,target:"_blank",children:"Click to claim"})]})}),!x&&(0,l.jsx)("div",{children:"No credential produced yet"}),x&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Produced"})," ",C.length," credential"]})})]})]})},F=e=>{let{goToNextStep:t}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,l.jsx)(o.Z,{children:(0,l.jsx)("b",{children:"This demo processes several things:"})}),(0,l.jsxs)("ul",{className:"demo-items-list",children:[(0,l.jsx)("li",{children:"Considers the user has agreed to fill the donation form, and requests user to input his tax payer information"}),(0,l.jsx)("li",{children:"Demonstrates how to automatically create a user identity (DID) remotely, without user consent, and gets a management access token in return."}),(0,l.jsx)("li",{children:"Saves user name, address and UK tax payer confirmation as credentials into the new identity"})]}),(0,l.jsx)(c.c,{onClick:t,children:"Start"})]})};n(19269),(i=s||(s={}))[i.Intro=0]="Intro",i[i.FillForm=1]="FillForm";var T=()=>{let[e,t]=(0,d.useState)(s.Intro),[n,a]=(0,d.useState)(null);return(0,l.jsx)("div",{className:"col-span-full",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)(o.Z,{variant:"h6",children:"Donation demo"}),e===s.Intro&&(0,l.jsx)(F,{goToNextStep:()=>t(s.FillForm)}),e===s.FillForm&&(0,l.jsx)(Z,{onCreatedIdentity:a,onImportedCredentials:()=>{}})]})})}},10061:function(e,t,n){"use strict";n.d(t,{c:function(){return l}});var a=n(57437),i=n(6882),r=n(49050),s=n(57042);let l=e=>{let{leftIcon:t,size:n="medium",mode:l="default",onClick:o,children:d,busy:c=!1,disabled:u=!1,className:p}=e,m=(0,a.jsx)(i.Z,{size:16});return(0,a.jsx)("div",{className:(0,s.Z)("flex",p),children:(0,a.jsx)(r.Z,{className:"flex-1",startIcon:c?m:t,disabled:c||u,size:n,color:"default"===l?"primary":"error",variant:"contained",onClick:o,children:d})})}},19269:function(){}},function(e){e.O(0,[310,510,736,971,596,744],function(){return e(e.s=56947)}),_N_E=e.O()}]);