(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17],{31613:function(e,t,n){Promise.resolve().then(n.bind(n,80221))},80221:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var a,i,l=n(57437),s=n(43226),r=n(2265),o=n(10061),d=n(66127),c=n(2582),u=n(64562),m=n(27760),f=n(25210),h=n(58862);let p="store-password";async function x(){let{Features:e,DefaultDIDAdapter:t,DIDBackend:a,DIDStore:i,RootIdentity:l,Mnemonic:s,Issuer:r,VerifiableCredential:o,DID:d}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588));e.enableJsonLdContext(!0),a.initialize(new t("mainnet"));let c=await i.open("server-side-store"),u=await l.createFromMnemonic(s.getInstance().generate(),"",c,p,!0);console.log("Created issuer identity:",u);let m=await u.newDid(p,0,!0);console.log("Issuer DID:",m);let f=await r.create(m);return console.log("Issuer:",f),f}async function g(e,t,a){let{VerifiableCredential:i}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588)),l=new i.Builder(e,t),s=await l.id("#name"+Math.random()).properties({name:a}).types("https://ns.elastos.org/credentials/profile/name/v1#NameCredential","https://ns.elastos.org/credentials/displayable/v1#DisplayableCredential").seal(p);return console.log("Generated credential:",s),s}async function y(e,t){console.log("Producing user credentials");let{DID:a}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588)),i=await x(),l=a.from(e);console.log("Target DID:",l);let s=await g(i,l,t);return[s]}(0,h.jQ)({accessKey:"92f21d2582f7d0306ed0ffa85f56796a72ba6c026db6abfd2928c22d2128ffb4",appDID:"did:elastos:idrd5ipMC3rD8oNwdfQAvnEG13PBDV7QK3",webServiceEndpoint:"https://ownmydentity.com",webServiceAPIEndpoint:"https://api.ownmydentity.com"});let j={"did:elastos:iqoh6bPpKuMozeLRGLHjxMrtBNGRnsVpAk":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXNzd29yZCI6IjA0MmMxODA5LWUwOTgtNGJiYy1iZjQxLWIyYzNiYzZhZGQ5NSIsImlkZW50aXR5RElEIjoiZGlkOmVsYXN0b3M6aXFvaDZiUHBLdU1vemVMUkdMSGp4TXJ0Qk5HUm5zVnBBayIsImlhdCI6MTY5NTk2MTEwOSwiZXhwIjoxNjk4NTUzMTA5fQ.SSeJtzR2Nus6TUmry_BQS_EQvX8CjrimjdLWELoYAW0"};async function w(){try{let e=await (0,h.B0)();return console.log("Created identity:",e),j[e.did]=e.identityAccessToken,e.did}catch(e){return console.error("Failed to create managed identity:",e),null}}async function I(e,t,n){let a;let i=await y(e,t);if(n){let t=j[e];if(!t)throw Error("No access token stored for target managed user identity "+e);let n=await (0,h.IU)(t);if(console.log("managedIdentityStatus",n),null==n?void 0:n.claimed)a=!1;else{let e=await (0,h.UD)(t,i);console.log("importResult",e),a=!0}}else a=!1;return{credentials:i.map(e=>e.toString()),imported:a}}async function v(e){let t=j[e];if(!t)throw Error("No access token stored for target managed user identity "+e);let n=await (0,h.C5)(t);return console.log("claimRequest",n),n}let b=e=>{let{}=e,t=(0,r.useRef)(null),a=(0,r.useRef)(null),[i,s]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[x,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(null),[b,N]=(0,r.useState)(null),[C,S]=(0,r.useState)(null),[k,Z]=(0,r.useState)(!1),D=async e=>{console.log("Importing user credentials to his identity wallet, client side");let{didAccessV2:t}=await Promise.all([n.e(990),n.e(988),n.e(18)]).then(n.bind(n,11920));await t.importCredentials(e)};(0,r.useEffect)(()=>{let e=null;return Promise.all([n.e(990),n.e(988),n.e(18)]).then(n.bind(n,11920)).then(t=>{let{didAccessV2:n}=t;e=n.onImportCredentialsResponse((e,t)=>{console.log("onImportCredentialsResponse",e,t),g(!1),N(t.map(e=>e.id.toString()))})}),()=>e},[]);let F=async()=>{console.log("Creating a managed identity"),s(!0),Z(!1);let e=await w();if(e){console.log("Managed identity creation ended",e),s(!1),j(e),v(e).then(e=>{S(e.claimUrl)}),console.log("Creating and importing credentials"),g(!0);let a=await I(e,t.current.value,!0);if(console.log("credentialProductionResult",a),g(!1),a){let{VerifiableCredential:e}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588));if(a.imported){let t=a.credentials.map(t=>e.parse(t).getId().toString());N(t)}else{let t=a.credentials.map(t=>e.parse(t));await D(t)}}}else Z(!0)};return(0,l.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,l.jsx)(d.Z,{className:"w-full",label:"Name",inputRef:t,autoFocus:!0,defaultValue:"Test user",variant:"outlined",size:"small",autoComplete:"off"}),(0,l.jsx)(d.Z,{className:"w-full",label:"Address",inputRef:a,autoFocus:!0,defaultValue:"15 Rover Street, London, England",variant:"outlined",size:"small",autoComplete:"off"}),(0,l.jsx)(c.Z,{children:(0,l.jsx)(u.Z,{control:(0,l.jsx)(m.Z,{defaultChecked:!0}),label:"I confirm I'm a UK resident and tax payer"})}),(0,l.jsx)(o.c,{onClick:F,busy:i,disabled:!!y,children:"Submit tax payer information"}),(0,l.jsxs)("div",{className:"mt-4",children:[k&&(0,l.jsx)("div",{className:"text-red-600",children:"An unexpected error occured. Please check logs and report to developers."}),!y&&(0,l.jsx)("div",{children:"No identity created yet"}),y&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Created user identity"}),": ",y]})}),C&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Claim your identity"}),": ",(0,l.jsx)(f.Z,{href:C,target:"_blank",children:"Click to claim"})]})}),!b&&(0,l.jsx)("div",{children:"No credential produced yet"}),b&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Produced"})," ",D.length," credential"]})})]})]})},N=e=>{let{goToNextStep:t}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,l.jsx)(s.Z,{children:(0,l.jsx)("b",{children:"This demo processes several things:"})}),(0,l.jsxs)("ul",{className:"demo-items-list",children:[(0,l.jsx)("li",{children:"Considers the user has agreed to fill the donation form, and requests user to input his tax payer information"}),(0,l.jsx)("li",{children:"Demonstrates how to automatically create a user identity (DID) remotely, without user consent, and gets a management access token in return."}),(0,l.jsx)("li",{children:"Saves user name, address and UK tax payer confirmation as credentials into the new identity"})]}),(0,l.jsx)(o.c,{onClick:t,children:"Start"})]})};n(25980),(a=i||(i={}))[a.Intro=0]="Intro",a[a.FillForm=1]="FillForm";var C=()=>{let[e,t]=(0,r.useState)(i.Intro),[n,a]=(0,r.useState)(null);return(0,l.jsx)("div",{className:"col-span-full",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)(s.Z,{variant:"h6",children:"Donation demo"}),e===i.Intro&&(0,l.jsx)(N,{goToNextStep:()=>t(i.FillForm)}),e===i.FillForm&&(0,l.jsx)(b,{onCreatedIdentity:a,onImportedCredentials:()=>{}})]})})}},10061:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var a=n(57437),i=n(6882),l=n(49050),s=n(57042);let r=e=>{let{leftIcon:t,size:n="medium",mode:r="default",onClick:o,children:d,busy:c=!1,disabled:u=!1,className:m}=e,f=(0,a.jsx)(i.Z,{size:16});return(0,a.jsx)("div",{className:(0,s.Z)("flex",m),children:(0,a.jsx)(l.Z,{className:"flex-1",startIcon:c?f:t,disabled:c||u,size:n,color:"default"===r?"primary":"error",variant:"contained",onClick:o,children:d})})}},25980:function(){}},function(e){e.O(0,[310,510,278,971,596,744],function(){return e(e.s=31613)}),_N_E=e.O()}]);