(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{56947:function(e,t,n){Promise.resolve().then(n.bind(n,70810))},70810:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return A}});var i,a,r,s,l=n(57437),o=n(43226),d=n(2265),c=n(10061),u=n(66127),m=n(2582),p=n(64562),f=n(27760),h=n(25210);let y={accessKey:null,appDID:null,webServiceEndpoint:"https://didweb.com",webServiceAPIEndpoint:"https://api.didweb.com"},g=y;(i=r||(r={}))[i.NetworkError=20001]="NetworkError",i[i.EmptyResponse=20002]="EmptyResponse",i[i.InvalidResponse=20003]="InvalidResponse",i[i.ServerError=20004]="ServerError",i[i.Unspecified=20999]="Unspecified";class w{constructor(){}static create(e,t,n){let i=new w;return i.message=t,i.code=e,i.timestamp=new Date,i.errors=n,i}static isSDKException(e){return"object"==typeof e&&"code"in e}}async function I(e,t,n,i){let a;let s=`${g.webServiceAPIEndpoint}/graphql`,l=g.accessKey;try{let e=await fetch(s,{method:"POST",headers:new Headers({"content-type":"application/json",...l&&{"x-developer-key":l},...i&&{...i}}),body:JSON.stringify({query:t,variables:n})});a=await e?.json()}catch(e){if("Failed to fetch"===e?.message)throw w.create(r.NetworkError,"Unable to reach the backend service");return null}if(!a)throw w.create(r.EmptyResponse,`Empty response received from the backend during a call to ${e}`);if("object"!=typeof a)throw w.create(r.InvalidResponse,`Not a json response received during a call to ${e}`);if("errors"in a)throw w.create(r.ServerError,`Server errors during a call to ${e}`,a.errors);if(!("data"in a))throw w.create(r.InvalidResponse,`No 'data' field in graphql response during a call to ${e}`);if(!(e in a.data))throw w.create(r.InvalidResponse,`Expected graphql field '${e}' not found in response during a call to ${e}`);return a.data[e]}async function x(){return await I("createManagedIdentity","\n    mutation CreateManagedIdentity($input: CreateManagedIdentityInput!) {\n      createManagedIdentity (input: $input) {\n        identityAccessToken did\n      }\n    }\n  ",{input:{...g.appDID&&{appDID:g.appDID}}})}async function j(e){return await I("getManagedIdentityStatus","\n    query GetManagedIdentityStatus {\n      getManagedIdentityStatus  {\n        createdAt claimed claimedAt\n      }\n    }\n  ",null,{...e&&{"x-identity-access-token":e}})}async function v(e,t){return await I("importManagedIdentityCredentials","\n    mutation ImportManagedIdentityCredentials($input: ImportManagedIdentityCredentialsInput!) {\n      importManagedIdentityCredentials (input: $input) {\n        id\n      }\n    }\n  ",{input:{credentials:t.toString()}},{...e&&{"x-identity-access-token":e}})}async function b(e){return await I("createIdentityClaimRequest","\n    mutation CreateIdentityClaimRequest {\n      createIdentityClaimRequest {\n        id identity { did createdAt } claimUrl\n      }\n    }\n  ",null,{...e&&{"x-identity-access-token":e}})}let S="store-password";async function C(){let{Features:e,DefaultDIDAdapter:t,DIDBackend:i,DIDStore:a,RootIdentity:r,Mnemonic:s,Issuer:l,VerifiableCredential:o,DID:d}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588));e.enableJsonLdContext(!0),i.initialize(new t("mainnet"));let c=await a.open("server-side-store"),u=await r.createFromMnemonic(s.getInstance().generate(),"",c,S,!0);console.log("Created issuer identity:",u);let m=await u.newDid(S,0,!0);console.log("Issuer DID:",m);let p=await l.create(m);return console.log("Issuer:",p),p}async function N(e,t){let{VerifiableCredential:i}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588)),a=new i.Builder(e,t),r=await a.id("#name"+Math.random()).properties({name:"xxxx"}).types().seal(S);return console.log("Generated credential:",r),r}async function k(e){console.log("Producing user credentials");let{DID:t}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588)),i=await C(),a=t.from(e);console.log("Target DID:",a);let r=await N(i,a);return[r]}g=Object.assign({},y,{accessKey:"8d00f46ef4569428b3c438dd287441dc90f7606b301c0fc185da6104014b591e",appDID:"did:elastos:ijcRy92xMX7GHsZSK7sZm7c5eZXoEx4fiA",webServiceEndpoint:"https://didweb.trinity-tech.io",webServiceAPIEndpoint:"https://didweb-service.trinity-tech.io"});let E={"did:elastos:iqoh6bPpKuMozeLRGLHjxMrtBNGRnsVpAk":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXNzd29yZCI6IjA0MmMxODA5LWUwOTgtNGJiYy1iZjQxLWIyYzNiYzZhZGQ5NSIsImlkZW50aXR5RElEIjoiZGlkOmVsYXN0b3M6aXFvaDZiUHBLdU1vemVMUkdMSGp4TXJ0Qk5HUm5zVnBBayIsImlhdCI6MTY5NTk2MTEwOSwiZXhwIjoxNjk4NTUzMTA5fQ.SSeJtzR2Nus6TUmry_BQS_EQvX8CjrimjdLWELoYAW0"};async function R(){let e=await x();return console.log(e),E[e.did]=e.identityAccessToken,e.did}async function M(e,t){let n;let i=await k(e);if(t){let t=E[e];if(!t)throw Error("No access token stored for target managed user identity "+e);let a=await j(t);if(console.log("managedIdentityStatus",a),null==a?void 0:a.claimed)n=!1;else{let e=await v(t,i);console.log("importResult",e),n=!0}}else n=!1;return{credentials:i.map(e=>e.toString()),imported:n}}async function D(e){let t=E[e];if(!t)throw Error("No access token stored for target managed user identity "+e);let n=await b(t);return console.log("claimRequest",n),n}let Z=e=>{let{}=e,t=(0,d.useRef)(null),i=(0,d.useRef)(null),[a,r]=(0,d.useState)(!1),[s,o]=(0,d.useState)(!1),[y,g]=(0,d.useState)(!1),[w,I]=(0,d.useState)(null),[x,j]=(0,d.useState)(null),[v,b]=(0,d.useState)(null),S=async e=>{console.log("Importing user credentials to his identity wallet, client side");let{didAccessV2:t}=await Promise.all([n.e(990),n.e(988),n.e(18)]).then(n.bind(n,11920));await t.importCredentials(e)};(0,d.useEffect)(()=>{let e=null;return Promise.all([n.e(990),n.e(988),n.e(18)]).then(n.bind(n,11920)).then(t=>{let{didAccessV2:n}=t;e=n.onImportCredentialsResponse((e,t)=>{console.log("onImportCredentialsResponse",e,t),g(!1),j(t.map(e=>e.id.toString()))})}),()=>e},[]);let C=async()=>{console.log("Creating a managed identity"),r(!0);let e=await R();if(e){console.log("Managed identity creation ended",e),r(!1),I(e),D(e).then(e=>{b(e.claimUrl)}),console.log("Creating and importing credentials"),g(!0);let t=await M(e,!0);if(console.log("credentialProductionResult",t),g(!1),t){let{VerifiableCredential:e}=await Promise.all([n.e(787),n.e(443),n.e(218),n.e(431),n.e(573)]).then(n.bind(n,26588));if(t.imported){let n=t.credentials.map(t=>e.parse(t).getId().toString());j(n)}else{let n=t.credentials.map(t=>e.parse(t));await S(n)}}}};return(0,l.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,l.jsx)(u.Z,{className:"w-full",label:"Name",inputRef:t,autoFocus:!0,defaultValue:"Test user",variant:"outlined",size:"small",autoComplete:"off"}),(0,l.jsx)(u.Z,{className:"w-full",label:"Address",inputRef:i,autoFocus:!0,defaultValue:"15 Rover Street, London, England",variant:"outlined",size:"small",autoComplete:"off"}),(0,l.jsx)(m.Z,{children:(0,l.jsx)(p.Z,{control:(0,l.jsx)(f.Z,{defaultChecked:!0}),label:"I confirm I'm a UK resident and tax payer"})}),(0,l.jsx)(c.c,{onClick:C,busy:a,disabled:!!w,children:"Submit tax payer information"}),(0,l.jsxs)("div",{className:"mt-4",children:[!w&&(0,l.jsx)("div",{children:"No identity created yet"}),w&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Created user identity"}),": ",w]})}),v&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Claim your identity"}),": ",(0,l.jsx)(h.Z,{href:v,target:"_blank",children:"Click to claim"})]})}),!x&&(0,l.jsx)("div",{children:"No credential produced yet"}),x&&(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("b",{children:"Produced"})," ",S.length," credential"]})})]})]})},F=e=>{let{goToNextStep:t}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,l.jsx)(o.Z,{children:(0,l.jsx)("b",{children:"This demo processes several things:"})}),(0,l.jsxs)("ul",{className:"demo-items-list",children:[(0,l.jsx)("li",{children:"Considers the user has agreed to fill the donation form, and requests user to input his tax payer information"}),(0,l.jsx)("li",{children:"Demonstrates how to automatically create a user identity (DID) remotely, without user consent, and gets a management access token in return."}),(0,l.jsx)("li",{children:"Saves user name, address and UK tax payer confirmation as credentials into the new identity"})]}),(0,l.jsx)(c.c,{onClick:t,children:"Start"})]})};n(19269),(a=s||(s={}))[a.Intro=0]="Intro",a[a.FillForm=1]="FillForm";var A=()=>{let[e,t]=(0,d.useState)(s.Intro),[n,i]=(0,d.useState)(null);return(0,l.jsx)("div",{className:"col-span-full",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)(o.Z,{variant:"h6",children:"Donation demo"}),e===s.Intro&&(0,l.jsx)(F,{goToNextStep:()=>t(s.FillForm)}),e===s.FillForm&&(0,l.jsx)(Z,{onCreatedIdentity:i,onImportedCredentials:()=>{}})]})})}},10061:function(e,t,n){"use strict";n.d(t,{c:function(){return l}});var i=n(57437),a=n(6882),r=n(49050),s=n(57042);let l=e=>{let{leftIcon:t,size:n="medium",mode:l="default",onClick:o,children:d,busy:c=!1,disabled:u=!1,className:m}=e,p=(0,i.jsx)(a.Z,{size:16});return(0,i.jsx)("div",{className:(0,s.Z)("flex",m),children:(0,i.jsx)(r.Z,{className:"flex-1",startIcon:c?p:t,disabled:c||u,size:n,color:"default"===l?"primary":"error",variant:"contained",onClick:o,children:d})})}},19269:function(){}},function(e){e.O(0,[310,510,736,971,596,744],function(){return e(e.s=56947)}),_N_E=e.O()}]);