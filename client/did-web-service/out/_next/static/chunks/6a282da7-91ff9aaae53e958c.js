"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9787],{26588:function(tn,to,ta){ta.r(to),ta.d(to,{AbstractMetadata:function(){return jt},Aes256cbc:function(){return Ca},BASE64:function(){return Je},Base58:function(){return ka},Claims:function(){return Qt},CredentialBiography:function(){return Ya},CredentialBiographyStatus:function(){return qa},CredentialMetadata:function(){return re},CredentialRequest:function(){return Qa},CredentialTransaction:function(){return $a},DID:function(){return Jt},DIDBackend:function(){return ll},DIDBiography:function(){return nl},DIDBiographyStatus:function(){return rl},DIDDocument:function(){return ve},DIDEntity:function(){return Ft},DIDMetadata:function(){return Kt},DIDRequest:function(){return Ja},DIDStore:function(){return Be},DIDStoreMetadata:function(){return Ut},DIDTransaction:function(){return Xa},DIDURL:function(){return Xt},DecryptionStream:function(){return ce},DefaultDIDAdapter:function(){return cl},EcdsaSigner:function(){return He},EncryptionStream:function(){return ue},Exceptions:function(){return tP},Features:function(){return Gt},File:function(){return La},HDKey:function(){return Na},IDChainRequest:function(){return ja},IDTransaction:function(){return Ha},Issuer:function(){return Ve},JWT:function(){return te},JWTBuilder:function(){return $t},JWTHeader:function(){return Zt},JWTParser:function(){return ee},JWTParserBuilder:function(){return ie},Logger:function(){return T},Mnemonic:function(){return Fa},RootIdentity:function(){return we},SimulatedIDChainAdapter:function(){return hl},TransferTicket:function(){return Ee},VerifiableCredential:function(){return se},VerifiablePresentation:function(){return _e},VerificationEventListener:function(){return zt}});var tu,tc,th=ta(67133),td=ta(49197),tf=ta(68870),tp=ta(56662),ty=ta(46963),tg=ta(53258),tv=ta(21016),tm=ta(11575),tw=ta(7469),tS=ta(54642),tb=ta(9575),tE=ta(62074),tI=ta(25245),t_=ta(79468),tD=ta(67133).Buffer;/*
  @license
    DID.js v2.3.2
    Tue, 10 Oct 2023 06:13:41 GMT - commit unknown

    Released under the MIT License.
*/let D=class D{constructor(tn){this.LevelType=["ERROR","WARN","INFO","DEBUG","TRACE"],this.id=tn,this.name=this.LevelType[tn]}getLevel(){return this.id}};let T=class T{constructor(tn){this.context=tn||""}static setLevel(tn){tn<=T.TRACE&&tn>=T.INFO&&(T.logLevel=tn)}static getLevel(){return T.logLevel}static levelIs(tn){return tn<=T.logLevel}log(...tn){T.logLevel.id>=T.INFO.id&&console.log(this.format(T.INFO,tn))}info(...tn){T.logLevel.id>=T.INFO.id&&console.log(this.format(T.INFO,tn))}debug(...tn){T.logLevel.id>=T.DEBUG.id&&console.log(this.format(T.DEBUG,tn))}trace(...tn){T.logLevel.id>=T.TRACE.id&&console.log(this.format(T.TRACE,tn))}warn(...tn){T.logLevel.id>=T.WARNING.id&&console.log(this.format(T.WARNING,tn))}error(...tn){T.logLevel.id>=T.ERROR.id&&console.log(this.format(T.ERROR,tn))}format(tn,to){let ta=(new Date).toISOString()+" "+tn.name.toUpperCase()+" "+this.context+" ";if(!to||to.length<1)return ta;let tu=String(to[0]);for(let tn=1;tn<to.length;tn++)tu=tu.replace(/\{\}/,String(to[tn]));return ta+" "+tu}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function A(tn,to,ta,tu){return new(ta||(ta=Promise))(function(tc,th){function s(tn){try{l(tu.next(tn))}catch(tn){th(tn)}}function a(tn){try{l(tu.throw(tn))}catch(tn){th(tn)}}function l(tn){var to;tn.done?tc(tn.value):((to=tn.value)instanceof ta?to:new ta(function(tn){tn(to)})).then(s,a)}l((tu=tu.apply(tn,to||[])).next())})}T.TRACE=new D(4),T.DEBUG=new D(3),T.INFO=new D(2),T.WARNING=new D(1),T.ERROR=new D(0),T.logLevel=T.WARNING;let O=class O extends Error{constructor(tn,to){super(tn+(to?"\nCaused by: "+to.message+(to.stack?"\nCaused by: "+to.stack:""):"")),this.causedBy=to,Object.setPrototypeOf(this,new.target.prototype)}from(tn){return this.message+=" Caused by "+tn.message,this}};let P=class P extends O{};let x=class x extends O{};let R=class R extends O{};let k=class k extends O{};let N=class N extends O{};let C=class C extends O{};let F=class F extends O{};let L=class L extends O{};let M=class M extends O{};let j=class j extends O{};let K=class K extends O{};let U=class U extends O{};let z=class z extends O{};let B=class B extends O{};let V=class V extends O{};let q=class q extends O{};let Y=class Y extends O{};let W=class W extends O{};let H=class H extends O{};let J=class J extends O{};let X=class X extends O{};let G=class G extends O{};let Z=class Z extends O{};let Q=class Q extends O{};let $=class $ extends O{};let tt=class tt extends O{};let et=class et extends O{};let it=class it extends O{};let rt=class rt extends O{};let nt=class nt extends O{};let ot=class ot extends O{};let st=class st extends O{};let at=class at extends O{};let lt=class lt extends O{};let ut=class ut extends O{};let ct=class ct extends O{};let ht=class ht extends O{};let dt=class dt extends O{};let ft=class ft extends O{};let pt=class pt extends O{};let yt=class yt extends O{};let gt=class gt extends O{};let vt=class vt extends O{};let mt=class mt extends O{};let wt=class wt extends O{};let St=class St extends O{};let bt=class bt extends O{};let Et=class Et extends O{};let It=class It extends O{};let _t=class _t extends O{};let Dt=class Dt extends O{};let Tt=class Tt extends O{};let At=class At extends O{};let Ot=class Ot extends O{};let Pt=class Pt extends O{};var tA,tT,tx,tO,tP=Object.freeze({__proto__:null,ParentException:O,IllegalArgumentException:P,WrongPasswordException:x,DIDStoreException:R,DIDResolveException:k,MnemonicException:N,DIDDeactivatedException:C,DIDAlreadyExistException:F,RootIdentityAlreadyExistException:L,UnknownInternalException:M,DIDStoreCryptoException:j,MalformedDocumentException:K,NotCustomizedDIDException:U,NotAttachedWithStoreException:z,NotPrimitiveDIDException:B,NoEffectiveControllerException:V,NotControllerException:q,AlreadySignedException:Y,MalformedTransferTicketException:W,MalformedCredentialException:H,MalformedIDChainRequestException:J,InvalidKeyException:X,MalformedIDChainTransactionException:G,MalformedResolveResultException:Z,DIDSyntaxException:Q,MalformedResolveRequestException:$,MalformedResolveResponseException:tt,DIDNotFoundException:et,MalformedDIDURLException:it,AlreadySealedException:rt,CredentialNotGenuineException:nt,CredentialExpiredException:ot,CredentialRevokedException:st,CredentialAlreadyExistException:at,DIDNotGenuineException:lt,DIDExpiredException:ut,DIDNotUpToDateException:ct,DIDObjectAlreadyExistException:ht,IllegalUsage:dt,DIDObjectNotExistException:ft,CanNotRemoveEffectiveController:pt,DIDObjectHasReference:yt,MalformedPresentationException:gt,UnsupportedOperationException:vt,NetworkException:mt,ResolveException:wt,DIDStorageException:St,InvalidDateFormat:bt,OutOfBoundException:Et,DIDTransactionException:It,MalformedExportDataException:_t,DIDControllersChangedException:Dt,MalformedMetadataException:Tt,JWTException:At,MalformedDIDException:Ot,IOException:Pt});let Ft=class Ft{getSerializeContextDid(){return null}clone(){let tn=Object.assign({},this);return Object.setPrototypeOf(tn,Object.getPrototypeOf(this)),tn}static deserialize(tn,to,ta=null){let tu;qt(tn&&""!==tn,"Invalid JSON content"),tu="string"==typeof tn?JSON.parse(tn):tn;let tc=new to;return tc.fromJSON(tu,ta),tc}static deserializeAsync(tn,to,ta=null){return A(this,void 0,void 0,function*(){let tu;qt(tn&&""!==tn,"Invalid JSON content"),tu="string"==typeof tn?JSON.parse(tn):tn;let tc=new to;return yield tc.fromJSON(tu,ta),tc})}serialize(tn=Ft.NORMALIZED_DEFAULT){var to;try{let ta=tn?null:null===(to=this.getSerializeContextDid())||void 0===to?void 0:to.toString();return JSON.stringify(this.toJSON(ta)).normalize("NFC")}catch(tn){throw new M(tn)}}toString(tn=Ft.NORMALIZED_DEFAULT){return this.serialize(tn)}dateToString(tn){return tn?tn.toISOString().split(".")[0]+"Z":null}dateFromString(tn){if(tn&&isNaN(Date.parse(tn)))throw new bt(tn);return tn?new Date(tn+("Z"==tn.slice(tn.length-1)?"":"Z")):null}getString(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("string"!=typeof to)throw new Q("Invalid property value: "+tn+", type error");return to}getNumber(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("number"!=typeof to)throw new Q("Invalid property value: "+tn+", type error");return to}getBoolean(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("boolean"!=typeof to)throw new Q("Invalid property value: "+tn+", type error");return to}getStrings(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("string"==typeof to)return[to];if(Array.isArray(to))return Array.from(to,to=>("string"!=typeof to&&new Q("Invalid property value: "+tn+", type error"),to)).sort();throw new Q("Invalid property value: "+tn+", type error")}getContext(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if(Array.isArray(to))return Array.from(to,to=>("string"!=typeof to&&new Q("Invalid property value: "+tn+", type error"),to));throw new Q("Invalid property value: "+tn+", type error")}getDids(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("string"==typeof to)try{return[new Jt(to)]}catch(to){new Q("Invalid property value: "+tn+", "+to,to)}if(Array.isArray(to))return Array.from(to,to=>{"string"!=typeof to&&new Q("Invalid property value: "+tn+", type error");try{return new Jt(to)}catch(to){new Q("Invalid property value: "+tn+", "+to,to)}}).sort((tn,to)=>tn.compareTo(to));throw new Q("Invalid property value: "+tn+", type error")}getDate(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("string"!=typeof to)throw new Q("Invalid property value: "+tn+", type error");try{return this.dateFromString(to)}catch(to){throw new Q("Invalid property value: "+tn+", "+to,to)}}getDid(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("string"!=typeof to)throw new Q("Invalid property value: "+tn+", type error");try{return new Jt(to)}catch(to){throw new Q("Invalid property value: "+tn+", "+to,to)}}getDidUrl(tn,to,ta={}){if(void 0===to){if(ta.mandatory)throw new Q("Missing property: "+tn);return ta.defaultValue?ta.defaultValue:null}if(null===to){if(!ta.defaultValue&&!ta.nullable)throw new Q("Invalid property: "+tn+", can not be null");return ta.defaultValue?ta.defaultValue:null}if("string"!=typeof to)throw new Q("Invalid property value: "+tn+", type error");try{return new Xt(to,ta.context)}catch(to){throw new Q("Invalid property value: "+tn+", "+to,to)}}};function Mt(tn){let to=Object.keys(tn);to.sort((tn,to)=>tn<to?-1:tn>to?1:0);let ta={};for(var tu in to){let tc=to[tu],th=tn[tc];"object"==typeof th&&Object.keys(th).length>0&&!Array.isArray(th)?ta[tc]=Mt(th):Array.isArray(th)&&th.length>0?ta[tc]=function Lt(tn){return tn&&0!=tn.length?Array.from(tn,to=>"object"==typeof to&&Object.keys(to).length>0&&!Array.isArray(to)?Mt(to):Array.isArray(to)&&tn.length>0?Lt(to):to):tn}(th):ta[tc]=th}return ta}Ft.NORMALIZED_DEFAULT=!0;let jt=class jt extends Ft{constructor(tn){super(),this.props={},this.store=tn,this.props={}}attachStore(tn){qt(null!=tn,"Invalid store"),this.store=tn}detachStore(){this.store=null}getStore(){return this.store}attachedStore(){return null!=this.store}get(tn){return this.props[tn]}put(tn,to){null==to?delete this.props[tn]:this.props[tn]=to instanceof Date?to.toISOString():to,this.save()}getBoolean(tn,to=!1){let ta=this.get(tn);return null!=ta?new Boolean(ta).valueOf():to}getInteger(tn,to=-1){let ta=this.get(tn),tu=to;if(null!=ta)try{tu=new Number(ta).valueOf()}catch(tn){}return tu}getDate(tn,to=null){let ta=this.get(tn),tu=to;if(null!=ta)try{tu=new Date(ta)}catch(tn){}return tu}remove(tn){let to=this.props[tn];return delete this.props[tn],this.save(),to}isEmpty(){return 0==this.props.size}setAlias(tn){this.put(jt.ALIAS,tn)}getAlias(){return this.get(jt.ALIAS)}setExtra(tn,to){qt(null!=tn&&""!=tn,"Invalid key"),this.put(jt.USER_EXTRA_PREFIX+tn,to)}getExtra(tn){return qt(tn&&null!=tn,"Invalid key"),this.get(jt.USER_EXTRA_PREFIX+tn)}getExtraBoolean(tn,to=!1){return qt(tn&&null!=tn,"Invalid key"),this.getBoolean(jt.USER_EXTRA_PREFIX+tn,to)}getExtraInteger(tn,to=-1){return qt(tn&&null!=tn,"Invalid key"),this.getInteger(jt.USER_EXTRA_PREFIX+tn,to)}getExtraDate(tn,to=null){return qt(tn&&null!=tn,"Invalid key"),this.getDate(jt.USER_EXTRA_PREFIX+tn,to)}removeExtra(tn){return qt(tn&&null!=tn,"Invalid key"),this.remove(jt.USER_EXTRA_PREFIX+tn)}merge(tn){tn!=this&&null!=tn&&(this.props=Object.assign(Object.assign({},tn.props),this.props))}clone(){let tn=super.clone();return tn.store=this.store,tn.props=this.props,tn}toJSON(tn=null){return Mt(this.props)}fromJSON(tn,to=null){this.props=JSON.parse(JSON.stringify(tn))}};jt.ALIAS="alias",jt.USER_EXTRA_PREFIX="UX-";let Kt=class Kt extends jt{constructor(tn=null,to=null){super(to),this.did=null,this.did=tn}setDid(tn){this.did=tn}setRootIdentityId(tn){this.put(Kt.ROOT_IDENTITY,tn)}getRootIdentityId(){return this.get(Kt.ROOT_IDENTITY)}setIndex(tn){this.put(Kt.INDEX,tn)}getIndex(){return this.getInteger(Kt.INDEX,-1)}setTransactionId(tn){this.put(Kt.TXID,tn)}getTransactionId(){return this.get(Kt.TXID)}setPreviousSignature(tn){this.put(Kt.PREV_SIGNATURE,tn)}getPreviousSignature(){return this.get(Kt.PREV_SIGNATURE)}setSignature(tn){this.put(Kt.SIGNATURE,tn)}getSignature(){return this.get(Kt.SIGNATURE)}setPublished(tn){this.put(Kt.PUBLISHED,tn)}getPublished(){try{return this.getDate(Kt.PUBLISHED,null)}catch(tn){return null}}setDeactivated(tn){this.put(Kt.DEACTIVATED,tn)}isDeactivated(){return this.getBoolean(Kt.DEACTIVATED,!1)}clone(){let tn=new Kt;return tn.props=this.props,tn.did=this.did,tn.store=this.store,tn}save(){return A(this,void 0,void 0,function*(){if(this.attachedStore())try{yield this.getStore().storeDidMetadata(this.did,this)}catch(tn){throw tn instanceof R&&console.log("INTERNAL - error store metadata for DID {}",this.did),tn}})}static parse(tn,to=null){try{return Ft.deserialize(tn,Kt,to)}catch(tn){throw tn instanceof Tt?tn:new Tt(tn)}}};Kt.ROOT_IDENTITY="rootIdentity",Kt.INDEX="index",Kt.TXID="txid",Kt.PREV_SIGNATURE="prevSignature",Kt.SIGNATURE="signature",Kt.PUBLISHED="published",Kt.DEACTIVATED="deactivated";let Ut=class Ut extends jt{constructor(tn=null){super(tn),this.put(Ut.TYPE,Ut.DID_STORE_TYPE),this.put(Ut.VERSION,Ut.DID_STORE_VERSION)}getType(){return this.get(Ut.TYPE)}getVersion(){return this.getInteger(Ut.VERSION,-1)}setFingerprint(tn){qt(null!=tn&&""!=tn,"Invalid fingerprint"),this.put(Ut.FINGERPRINT,tn)}getFingerprint(){return this.get(Ut.FINGERPRINT)}setDefaultRootIdentity(tn){this.put(Ut.DEFAULT_ROOT_IDENTITY,tn)}getDefaultRootIdentity(){return this.get(Ut.DEFAULT_ROOT_IDENTITY)}save(){return A(this,void 0,void 0,function*(){if(this.attachedStore())try{yield this.getStore().storage.storeMetadata(this)}catch(tn){throw tn instanceof R&&Ut.log.error("INTERNAL - error store metadata for DIDStore"),tn}})}static parse(tn,to=null){try{return Ft.deserialize(tn,Ut,to)}catch(tn){throw tn instanceof Tt?tn:new Tt(tn)}}};Ut.DID_STORE_TYPE="did:elastos:store",Ut.DID_STORE_VERSION=3,Ut.TYPE="type",Ut.VERSION="version",Ut.FINGERPRINT="fingerprint",Ut.DEFAULT_ROOT_IDENTITY="defaultRootIdentity",Ut.log=new T("DIDStoreMetadata");let zt=class zt{done(tn,to,ta){}reset(){}eprintf(tn,to){let ta=String(tn);for(let tn=0;tn<to.length;tn++)ta=ta.replace(/\{\}/,String(to[tn]));return ta}succeeded(tn,to,...ta){let tu=this.eprintf(to,ta);this.done(tn,!0,tu)}failed(tn,to,...ta){let tu=this.eprintf(to,ta);this.done(tn,!1,tu)}static getDefault(tn,to,ta){return new Vt(tn,to,ta)}static getDefaultWithIdent(tn){return new Vt(tn,null,null)}};let Bt=class Bt{constructor(tn,to,ta){this.context=tn,this.succeeded=to,this.message=ta}};let Vt=class Vt extends zt{constructor(tn,to,ta){super(),this.ident=null==tn?Vt.EMPTY:tn,this.succeededPrefix=null==to?Vt.EMPTY:to,this.failedPrefix=null==ta?Vt.EMPTY:ta,this.records=[]}done(tn,to,ta){this.records.unshift(new Bt(tn,to,ta))}reset(){this.records=[]}toString(){let tn="";for(let to of this.records)tn=tn.concat(this.ident,to.succeeded?this.succeededPrefix:this.failedPrefix,to.message,"\n");return tn}};function qt(tn,to){if(!tn)throw Error(to)}function Yt(tn,to){qt(null!=tn&&""!==tn,to)}function Wt(tn,to){if(null===tn)throw Error(to)}function Ht(tn){if("string"==typeof tn){for(var to=0,ta=tn.length;ta>0;)to=(to<<5)-to+tn.charCodeAt(--ta)|0;return to}if("number"==typeof tn)return tn;if("boolean"==typeof tn)return!0===tn?1231:1237;throw new P("Unsupported type "+typeof tn)}Vt.EMPTY="";let Jt=class Jt{constructor(tn,to=null,ta,tu){(this.repr=null,this.parser=new class{constructor(tn){this.superThis=tn}isTokenChar(tn,to){return tn>="A"&&tn<="Z"||tn>="a"&&tn<="z"||tn>="0"&&tn<="9"||!to&&("."==tn||"_"==tn||"-"==tn)}scanNextPart(tn,to,ta,tu){let tc=ta,th=!0;for(let td=to;td<ta;td++){let to=tn.charAt(td);if("string"==typeof to){if(to==tu){tc=td;break}}else for(let tn=0;tn<tu.length;tn++)if(to==tu[tn]){tc=tn;break}if(!this.isTokenChar(to,th))throw new Ot("Invalid char at: "+td);th=!1}return tc}parse(tn,to=0,ta){if(null==tn)throw new Ot("null DID string");for(null==ta&&(ta=tn.length);ta>to&&" ">=tn.charAt(ta-1);)ta--;for(;to<ta&&" ">=tn.charAt(to);)to++;if(to==ta)throw new Ot("Empty DID string");let tu=to,tc=this.scanNextPart(tn,tu,ta,":"),th=tn.substring(tu,tc);if(th!=Jt.SCHEMA)throw new Ot("Invalid DID schema: '"+th+"', at: "+tu);if((tu=tc)+1>=ta||":"!=tn.charAt(tu))throw new Ot("Missing method and id string at: "+tu);tc=this.scanNextPart(tn,++tu,ta,":");let td=tn.substring(tu,tc);if(td!=Jt.METHOD)throw new Ot("Unknown DID method: '"+td+"', at: "+tu);if(this.superThis.method=Jt.METHOD,(tu=tc)+1>=ta||":"!=tn.charAt(tu))throw new Ot("Missing id string at: "+(tu+1>ta?tu:tu+1));tc=this.scanNextPart(tn,++tu,ta,"\x00"),this.superThis.methodSpecificId=tn.substring(tu,tc)}}(this),this.metadata=null,to)?(Yt(tn,"Invalid method"),Yt(to,"Invalid methodSpecificId"),this.method=tn,this.methodSpecificId=to):(ta||(ta=0),tu||(tu=tn.length),Yt(tn,"Invalid DID string"),this.parser.parse(tn,ta,tu))}static createFrom(tn,to,ta){return qt(null!=tn&&""!=tn,"Invalid DID string"),qt(to<ta,"Invalid offsets"),new Jt(tn,null,to,ta)}static from(tn){return tn?"string"==typeof tn?new Jt(tn):tn:null}getMethod(){return this.method}getMethodSpecificId(){return this.methodSpecificId}setMetadata(tn){this.metadata=tn}toJSON(tn=null){return this.toString()}getMetadata(){return A(this,void 0,void 0,function*(){if(null==this.metadata)try{let tn=yield this.resolve();this.metadata=null!=tn?tn.getMetadata():new Kt(this)}catch(tn){this.metadata=new Kt(this)}return this.metadata})}isDeactivated(){return A(this,void 0,void 0,function*(){if((yield this.getMetadata()).isDeactivated())return!0;let tn=yield ll.getInstance().resolveDidBiography(this);if(null==tn)return!1;let to=tn.getStatus()==rl.DEACTIVATED;return to&&(yield this.getMetadata()).setDeactivated(to),to})}resolve(tn=!1){return A(this,void 0,void 0,function*(){let to=yield ll.getInstance().resolveDid(this,tn);return null!=to&&this.setMetadata(to.getMetadata()),to})}resolveBiography(){return A(this,void 0,void 0,function*(){return yield ll.getInstance().resolveDidBiography(this)})}toString(){return null==this.repr&&(this.repr="did:"+this.method+":"+this.methodSpecificId),this.repr}hashCode(){return 3357+Ht(this.toString())}equals(tn){if(tn==this)return!0;if(tn instanceof Jt){let to=this.method===tn.method;return to?this.methodSpecificId===tn.methodSpecificId:to}return"string"==typeof tn&&this.toString()===tn}compareTo(tn){Wt(tn,"did is null");let e=(tn,to)=>tn<to?-1:tn>to?1:0,to=e(this.method,tn.method);return 0==to?e(this.methodSpecificId,tn.methodSpecificId):to}};Jt.SCHEMA="did",Jt.METHOD="elastos",Jt.METADATA="metadata";let Xt=class Xt{constructor(tn,to){if(this.did=null,this.path=null,this.fragment=null,this.parser=new class{constructor(tn){this.superThis=tn}isHexChar(tn){return tn>="A"&&tn<="F"||tn>="a"&&tn<="f"||tn>="0"&&tn<="9"}isTokenChar(tn,to){return tn>="A"&&tn<="Z"||tn>="a"&&tn<="z"||tn>="0"&&tn<="9"||!to&&("."==tn||"_"==tn||"-"==tn)}scanNextPart(tn,to,ta,tu,tc){let th=ta,td=!0;for(let tf=to;tf<ta;tf++){let to=tn.charAt(tf);if(null!=tu&&tu.indexOf(to)>=0){th=tf;break}if(null!=tc&&tc.indexOf(to)>=0){if(td)throw new it("Invalid char at: "+tf);td=!0}else if(this.isTokenChar(to,td))td=!1;else{if("%"!=to)throw new it("Invalid char at: "+tf);{if(tf+2>=ta)throw new it("Invalid char at: "+tf);let to=tn.charAt(++tf);if(!this.isHexChar(to)||(to=tn.charAt(++tf),!this.isHexChar(to)))throw new it("Invalid hex char at: "+tf);td=!1}}}return th}parse(tn,to){if(null==tn&&(tn=null),this.superThis.did=tn,null==to)throw new it("Null DIDURL string");let ta,tu=0,tc=to.length;for(;tc>0&&" ">=to.charAt(tc-1);)tc--;for(;tu<tc&&" ">=to.charAt(tu);)tu++;if(tu==tc)throw new it("Empty DIDURL string");let th=tu;if(th<tc&&"did:"==to.substring(th,th+4)){ta=this.scanNextPart(to,th,tc,"/?#",":");try{this.superThis.did=Jt.createFrom(to.toString(),th,ta)}catch(tn){throw new it("Invalid did at: "+th,tn)}th=ta}if(th<tc&&"/"==to.charAt(th)&&(ta=this.scanNextPart(to,th+1,tc,"?#","/"),this.superThis.path=to.substring(th,ta),th=ta),th<tc&&"?"==to.charAt(th)){ta=this.scanNextPart(to,th+1,tc,"#","&=");let tn=to.substring(th+1,ta);if(th=ta,""!=tn){let to=new Map;for(let ta of tn.split("&")){let tn=ta.split("=");if(tn.length>0&&""!=tn[0]){let ta=tn[0],tu=2==tn.length?tn[1]:null;to.set(ta,tu)}}this.superThis.query=to}}else this.superThis.query=new Map;if(th<tc&&"#"==to.charAt(th)||th==tu){"#"==to.charAt(th)&&th++,ta=this.scanNextPart(to,th,tc,"",null);let tn=to.substring(th,ta);""!=tn&&(this.superThis.fragment=tn)}}}(this),qt(!!tn||!!to,"Invalid context and url"),!tn)return this.did=to,this.query=new Map,this;"string"==typeof tn?this.parser.parse(to,tn):(null!=tn.did&&(this.did=tn.did),this.path=tn.path,this.query=tn.query,this.queryString=tn.queryString,this.fragment=tn.fragment,this.repr=tn.repr,this.metadata=tn.metadata)}static fromDID(tn){return new Xt(null,tn)}static from(tn,to){let ta;return tn?(ta=null==to?null:"string"==typeof to?Jt.from(to):to,"string"==typeof tn||ta?new Xt(tn,ta):tn):null}clone(tn){let to=Xt.fromDID(this.did);return to.path=this.path,to.query=0==this.query.size&&tn?new Map:new Map(this.query),to.queryString=this.queryString,to.fragment=this.fragment,to.repr=this.repr,to}getDid(){return this.did}setDid(tn){this.did=tn}mapToString(tn,to){let ta=!0,tu="";return tn.forEach((tn,tc)=>{ta?ta=!1:tu+=to,tu+=tc,null!=tn&&(tu+="="+tn)}),tu}getPath(){return this.path}setPath(tn){this.path=tn}getQueryString(){return 0==this.query.size?null:(null==this.queryString&&(this.queryString=this.mapToString(this.query,"&")),this.queryString)}getQuery(){return this.query}setQuery(tn){this.query=new Map(tn)}getQueryParameter(tn){qt(null!=tn&&""!==tn,"Invalid parameter name");let to=this.query.get(tn);return null==to?null:to}hasQueryParameter(tn){return qt(null!=tn&&""!=tn,"Invalid parameter name"),this.query.has(tn)}getFragment(){return this.fragment}setFragment(tn){this.fragment=tn}setMetadata(tn){this.metadata=tn}getMetadata(){return this.metadata}isQualified(){return null!=this.did&&null!=this.fragment}toJSON(tn=null){let to=null;return tn&&(to=new Jt(tn)),this.toString(to)}toString(tn=null){if(!tn&&this.repr)return this.repr;let to="";return null==this.did||null!=tn&&this.did.equals(tn)||(to+=this.did),null!=this.path&&""!==this.path&&(to+=this.path),null!=this.query&&0!=this.query.size&&(to+="?"+this.getQueryString()),null!=this.fragment&&""!==this.fragment&&(to+="#"+this.getFragment()),tn||(this.repr=to),to}equals(tn){return tn==this||(tn instanceof Xt?this.toString()===tn.toString():"string"==typeof tn&&this.toString()===tn)}compareTo(tn){var to,ta;return Wt(tn,"id is null"),(to=this.toString())<(ta=tn.toString())?-1:to>ta?1:0}hashCode(){return Ht(this.toString())}};Xt.SEPS=[":",";","/","?","#"],(t0=Xt||(Xt={})).Builder=class{constructor(tn){this.url=tn instanceof Jt?t0.fromDID(tn):tn.clone(!1)}setDid(tn){return qt(null!=tn,"Invalid did"),"string"==typeof tn?this.url.setDid(Jt.from(tn)):this.url.setDid(tn),this}clearDid(){return this.url.setDid(null),this}setPath(tn){return this.url.setPath(tn),this}clearPath(){return this.url.setPath(""),this}setQueryParameter(tn,to){return qt(null!=tn&&""!==tn,"Invalid parameter name"),this.url.getQuery().set(tn,to),this}setQueryParameters(tn){return this.url.getQuery().clear(),null!=tn&&tn.size>0&&tn.forEach((tn,to)=>this.url.getQuery().set(to,tn)),this}removeQueryParameter(tn){return qt(null!=tn&&""!==tn,"Invalid parameter name"),this.url.getQuery().delete(tn),this}clearQueryParameters(){return this.url.getQuery().clear(),this}setFragment(tn){return this.url.setFragment(tn),this}clearFragment(){return this.url.setFragment(""),this}build(){return this.url.clone(!0)}},(t1=tA||(tA={}))[t1.ERROR=0]="ERROR",t1[t1.WARNING=1]="WARNING",t1[t1.INFO=2]="INFO",t1[t1.DEBUG=3]="DEBUG",t1[t1.TRACE=4]="TRACE";let Gt=class Gt{static enableJsonLdContext(tn){this.enabledJsonLdContext=tn}static isEnabledJsonLdContext(){return this.enabledJsonLdContext}static setLogLevel(tn){T.setLevel(new D(tn))}static getLogLevel(){return T.getLevel().getLevel()}};Gt.enabledJsonLdContext=!1;let Zt=class Zt{constructor(tn){this.header=tn||{}}setAlgorithm(tn){return delete this.header.alg,this.header.alg=tn,this}getAlgorithm(){return this.header.alg}setKeyId(tn){return this.header.kid=tn,this}getKeyId(){return this.header.kid}setType(tn){return this.header.typ=tn,this}getType(){return this.header.typ}setContentType(tn){return this.header.cty=tn,this}getContentType(){return this.header.cty}put(tn,to){return tn!=Zt.ALG&&tn!=Zt.KID&&(this.header[tn]&&delete this.header[tn],this.header[tn]=to),this}get(tn){return this.header?this.header[tn]:null}getJWSHeaderParameters(){return this.header}getJWTHeaderParameters(){return null!=this.header.alg&&"none"!==this.header.alg?this.header:null}};Zt.JWT_TYPE="JWT",Zt.TYPE="typ",Zt.CONTENT_TYPE="cty",Zt.ALG="alg",Zt.KID="kid";let Qt=class Qt{constructor(tn){this.payload=tn||{}}put(tn,to){return this.payload[tn]&&delete this.payload[tn],this.payload[tn]=to,this}putWithObject(tn){return this.payload=Object.assign(Object.assign({},this.payload),tn),this}putWithJson(tn){let to=JSON.parse(tn);return this.putWithObject(to),this}get(tn){return this.payload[tn]}getAsObject(tn){let to=this.payload[tn];return null!=to?to:null}getAsJson(tn){let to=this.payload[tn];return null==to?null:JSON.stringify(to)}setId(tn){return this.payload.jti=tn,this}getId(){return this.payload.jti}setAudience(tn){return this.payload.aud=tn,this}getAudience(){return this.payload.aud}setExpiration(tn){return this.payload.exp=tn,this}getExpiration(){return this.payload.exp}setIssuedAt(tn){return this.payload.iat=tn,this}getIssuedAt(){return this.payload.iat}setIssuer(tn){return this.payload.iss=tn,this}getIssuer(){return this.payload.iss}setJti(tn){return this.payload.jti=tn,this}getJti(){return this.payload.jti}setNotBefore(tn){return this.payload.nbf=tn,this}getNotBefore(){return this.payload.nbf}setSubject(tn){return this.payload.sub=tn,this}getSubject(){return this.payload.sub}getJWTPayload(){return this.payload}};let $t=class $t{constructor(tn,to){this.header=null,this.payload=null,qt(null!=tn,"Invalid issuer"),this.header=new Zt,this.payload=new Qt,this.payload.setIssuer(tn.toString()),this.keyprovider=to,this.issuer=tn}static createHeader(){return new Zt}static createClaims(){return new Qt}setHeader(tn){return this.header=tn,this}setClaims(tn){return this.payload=tn,tn.getIssuer()||this.payload.setIssuer(this.issuer.toString()),this}setClaimsWithJson(tn){return this.payload=new Qt,this.payload.putWithJson(tn),this.payload.getIssuer()||this.payload.setIssuer(this.issuer.toString()),this}setClaimsWithObject(tn){return this.payload=new Qt,this.payload.putWithObject(tn),this.payload.getIssuer()||this.payload.setIssuer(this.issuer.toString()),this}addClaims(tn){return this.payload.putWithObject(tn),this}addClaimsWithJson(tn){let to=JSON.parse(tn);return this.addClaims(to),this}addHeader(tn,to){return this.header.put(tn,to),this}claims(tn,to){return this.payload.put(tn,to),this}claimsWithJson(tn,to){let ta=JSON.parse(to);return this.claims(tn,ta),this}setId(tn){return this.payload.setId(tn),this}setAudience(tn){return this.payload.setAudience(tn),this}setExpiration(tn){let to=tn instanceof Date?tn.getUTCSeconds():tn;return this.payload.setExpiration(to),this}setIssuedAt(tn){let to=tn instanceof Date?tn.getUTCSeconds():tn;return this.payload.setIssuedAt(to),this}setIssuer(tn){return this.payload.setIssuer(tn),this}setJti(tn){return this.payload.setJti(tn),this}setNotBefore(tn){let to=tn instanceof Date?tn.getUTCSeconds():tn;return this.payload.setNotBefore(to),this}setSubject(tn){return this.payload.setSubject(tn),this}sign(tn,to=null){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!=tn,"Invalid password"),this.header.setAlgorithm("ES256"),to&&this.header.setKeyId(to);let ta=new tS.N6(this.payload.getJWTPayload()).setProtectedHeader(this.header.getJWTHeaderParameters()),tu=yield this.keyprovider.getPrivateKey(to,tn);return yield ta.sign(tu)})}compact(){return this.header.setAlgorithm("none"),`${Je.fromString(JSON.stringify(this.header.getJWSHeaderParameters()))}.${Je.fromString(JSON.stringify(this.payload.getJWTPayload()))}.`}};let te=class te{constructor(tn,to){this.header=new Zt(tn),this.claims=new Qt(to)}getHeader(){return this.header}getBody(){return this.claims}};let ee=class ee{constructor(tn,to){this.keyprovider=tn,this.options=to}isSigned(tn){return"none"!=(0,tS.Ut)(tn).alg}getSignkey(tn){return(0,tS.Ut)(tn).kid}getIssuer(tn){let to=tn.split(".");if(3!=to.length)throw new At("Invalid jwt token.");let ta=JSON.parse(Je.toString(to[1])).iss;if(null==ta)throw new At("No issuer in the token.");return ta}parse(tn){return A(this,void 0,void 0,function*(){if(this.isSigned(tn)){var to;if(null==this.keyprovider){let to=Jt.from(this.getIssuer(tn));if(null==to)throw new At("No issuer in the token");let ta=yield to.resolve();if(null==ta)throw new k("No issuer doc in the chain.");this.keyprovider=ta.getKeyProvider()}let ta=yield this.keyprovider.getPublicKey(this.getSignkey(tn));try{to=yield(0,tS._f)(tn,ta,this.options)}catch(tn){throw new At(tn)}return new te(to.protectedHeader,to.payload)}{let to=tS.W9.decode(tn,this.options);return new te(to.header,to.payload)}})}};let ie=class ie{constructor(){return this.keyProvider=null,this.options={},this}static newWithKeyProvider(tn){let to=new ie;return to.keyProvider=tn,to}requireSubject(tn){return this.options.subject=tn,this}requireAudience(tn){return this.options.audience=tn,this}requireIssuer(tn){return this.options.issuer=tn,this}requireIssuedAt(tn){return this.options.maxTokenAge=tn,this}requireAlgorithms(tn){return this.options.algorithms=tn,this}requireHeaderType(tn){return this.options.typ=tn,this}setAllowedClockSkewSeconds(tn){return this.options.clockTolerance=tn,this}build(){return Object.assign({},this.options),new ee(this.keyProvider,this.options)}};let re=class re extends jt{constructor(tn=null,to=null){super(to),this.id=tn}setId(tn){this.id=tn}setTransactionId(tn){this.put(re.TXID,tn)}getTransactionId(){return this.get(re.TXID)}setPublished(tn){qt(null!=tn,"Invalid timestamp"),this.put(re.PUBLISHED,tn)}getPublished(){return this.getDate(re.PUBLISHED,null)}setRevoked(tn){this.put(re.REVOKED,tn)}isRevoked(){return this.getBoolean(re.REVOKED,!1)}clone(){try{return super.clone()}catch(tn){return re.log.error(tn),null}}save(){return A(this,void 0,void 0,function*(){if(this.attachedStore())try{yield this.getStore().storeCredentialMetadata(this.id,this)}catch(tn){throw re.log.error("INTERNAL - error store metadata for credential {}",this.id),tn}})}static parse(tn,to=null){try{return Ft.deserialize(tn,re,to)}catch(tn){throw tn instanceof Tt?tn:new Tt(tn)}}};re.TXID="txid",re.PUBLISHED="published",re.REVOKED="revoked",re.log=new T("CredentialMetadata"),(t2=tT||(tT={}))[t2.EXTERNAL=0]="EXTERNAL",t2[t2.INTERNAL=1]="INTERNAL",(t5=tx||(tx={}))[t5.ELA=0]="ELA",t5[t5.IDCHAIN=1]="IDCHAIN",(t3=tO||(tO={})).ELA_STANDARD="ELA_STANDARD",t3.ELA_MULTISIG="ELA_MULTISIG",t3.ELA_CROSSCHAIN="ELA_CROSSCHAIN",t3.ELA_IDCHAIN="ELA_IDCHAIN",t3.ELA_DESTROY="ELA_DESTROY";let ne=class ne{};ne._DEFAULT_PUBLICKEY_TYPE="secp256r1",ne.DEFAULT_PUBLICKEY_TYPE="ECDSAsecp256r1",ne.DATE_FORMAT="yyyy-MM-dd'T'HH:mm:ss'Z'",ne.DATE_FORMAT_ISO_8601="yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",ne.MAX_VALID_YEARS=5;let tR=new T("VerifiableCredential");let se=class se extends Ft{constructor(){super()}static newWithVerifiableCredential(tn,to){let ta=new se;return ta.context=tn.context,ta.id=tn.id,ta.type=tn.type,ta.issuer=tn.issuer,ta.issuanceDate=tn.issuanceDate,ta.expirationDate=tn.expirationDate,ta.subject=tn.subject,to&&(ta.proof=tn.proof),ta}checkAttachedStore(){if(!this.getMetadata().attachedStore())throw new z("Not attach with did store")}getId(){return this.id}getType(){return this.type}getIssuer(){return this.issuer}getIssuanceDate(){return this.issuanceDate}hasExpirationDate(){return null!=this.expirationDate}getExpirationDate(){return A(this,void 0,void 0,function*(){if(null!=this.expirationDate)return this.expirationDate;try{let tn=yield this.subject.getId().resolve();if(null!=tn)return tn.getExpires()}catch(tn){}return null})}getLastModified(){return this.proof.getCreated()}getSubject(){return this.subject}getProof(){return this.proof}getSerializeContextDid(){return this.getSubject().getId()}setMetadata(tn){this.metadata=tn,this.getId().setMetadata(tn)}getMetadata(){return null==this.metadata&&(this.metadata=new re(this.getId())),this.metadata}getStore(){return this.metadata.getStore()}isSelfProclaimed(){return this.issuer.equals(this.subject.getId())}isExpired(){return!(null==this.expirationDate||!tw().isAfter(tw(this.expirationDate)))}isGenuine(tn=null){return A(this,void 0,void 0,function*(){if(!this.getId().getDid().equals(this.getSubject().getId()))return null!=tn&&(tn.failed(this,"VC {}: invalid id '{}', should under the scope of '{}'",this.getId(),this.getId(),this.getSubject().getId()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1;let to=yield this.issuer.resolve();if(null==to)return null!=tn&&(tn.failed(this,"VC {}: Can not resolve the document for issuer '{}'",this.getId(),this.getIssuer()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1;if(!to.isGenuine(tn))return null!=tn&&(tn.failed(this,"VC {}: issuer '{}' is not genuine",this.getId(),this.getIssuer()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1;if(!to.isAuthenticationKey(this.proof.getVerificationMethod()))return null!=tn&&(tn.failed(this,"VC {}: key '{}' for proof is not an authencation key of '{}'",this.getId(),this.proof.getVerificationMethod(),this.proof.getVerificationMethod().getDid()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1;if(this.proof.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"VC {}: key type '{}' for proof is not supported",this.getId(),this.proof.getType()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1;let ta=se.newWithVerifiableCredential(this,!1).serialize(!0);if(!to.verify(this.proof.getVerificationMethod(),this.proof.getSignature(),th.Buffer.from(ta)))return null!=tn&&(tn.failed(this,"VC {}: proof is invalid, signature mismatch",this.getId()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1;if(!this.isSelfProclaimed()){let to=yield this.subject.getId().resolve();if(null!=to&&!to.isGenuine(tn))return null!=tn&&(tn.failed(this,"VC {}: holder's document is not genuine",this.getId()),tn.failed(this,"VC {}: is not genuine",this.getId())),!1}return null!=tn&&tn.succeeded(this,"VC {}: is genuine",this.getId()),!0})}isGenuineInternal(tn){if(function(tn,to){if(!tn)throw Error(to)}(this.isSelfProclaimed(),"The credential should be self-proclaimed"),qt(this.getSubject().getId().equals(tn.getSubject()),"Invalid owner document"),!this.getId().getDid().equals(this.getSubject().getId())||!tn.isAuthenticationKey(this.proof.getVerificationMethod())||this.proof.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return!1;let to=se.newWithVerifiableCredential(this,!1).serialize(!0);return!!tn.verify(this.proof.getVerificationMethod(),this.proof.getSignature(),th.Buffer.from(to))}isRevoked(){return A(this,void 0,void 0,function*(){if(this.getMetadata().isRevoked())return!0;let tn=yield ll.getInstance().resolveCredentialBiography(this.getId(),this.getIssuer());if(null==tn)return!1;let to=tn.getStatus().equals(qa.REVOKED);return to&&this.getMetadata().setRevoked(to),to})}isValid(tn=null){return A(this,void 0,void 0,function*(){if(yield this.isRevoked())return null!=tn&&(tn.failed(this,"VC {}: is revoked",this.getId()),tn.failed(this,"VC {}: is invalid",this.getId())),!1;if(this.isExpired())return null!=tn&&(tn.failed(this,"VC {}: is expired",this.getId()),tn.failed(this,"VC {}: is invalid",this.getId())),!1;let to=yield this.issuer.resolve();if(null==to)return null!=tn&&(tn.failed(this,"VC {}: can not resolve the document for issuer '{}'",this.getId(),this.getIssuer()),tn.failed(this,"VC {}: is invalid",this.getId())),!1;if(yield to.isDeactivated())return null!=tn&&(tn.failed(this,"VC {}: issuer '{}' is deactivated",this.getId(),this.getIssuer()),tn.failed(this,"VC {}: is invalid",this.getId())),!1;if(!to.isGenuine())return null!=tn&&(tn.failed(this,"VC {}: issuer '{}' is not genuine",this.getId(),this.getIssuer()),tn.failed(this,"VC {}: is invalid",this.getId())),!1;if(!to.isAuthenticationKey(this.proof.getVerificationMethod()))return null!=tn&&(tn.failed(this,"VC {}: key '{}' for proof is not an authencation key of '{}'",this.getId(),this.proof.getVerificationMethod(),this.proof.getVerificationMethod().getDid()),tn.failed(this,"VC {}: is invalid",this.getSubject())),!1;if(this.proof.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"VC {}: key type '{}' for proof is not supported",this.getId(),this.proof.getType()),tn.failed(this,"VC {}: is invalid",this.getId())),!1;let ta=se.newWithVerifiableCredential(this,!1).serialize(!0);return to.verify(this.proof.getVerificationMethod(),this.proof.getSignature(),th.Buffer.from(ta))?(null!=tn&&tn.succeeded(this,"VC {}: is valid",this.getId()),!0):(null!=tn&&(tn.failed(this,"VC {}: proof is invalid, signature mismatch",this.getId()),tn.failed(this,"VC {}: is invalid",this.getId())),!1)})}wasDeclared(){return A(this,void 0,void 0,function*(){let tn=yield ll.getInstance().resolveCredentialBiography(this.getId(),this.getIssuer());if(tn.getStatus()==qa.NOT_FOUND)return!1;for(let to of tn.getAllTransactions())if(to.getRequest().getOperation().equals(ja.Operation.DECLARE))return!0;return!1})}declare(tn,to,ta=null){return A(this,void 0,void 0,function*(){if(qt(null!=to&&""!==to,"Invalid storepass"),this.checkAttachedStore(),!(yield this.isGenuine()))throw tR.error("Publish failed because the credential is not genuine."),new nt(this.getId().toString()+" isn't genuine");if(yield this.isExpired())throw tR.error("Publish failed because the credential is expired."),new ot(this.getId().toString()+" is expired");if(yield this.isRevoked())throw tR.error("Publish failed because the credential is revoked."),new st(this.getId().toString()+" is revoked");if(yield this.wasDeclared())throw tR.error("Publish failed because the credential already declared."),new at(this.getId().toString()+" is already declared");let tu=yield this.getStore().loadDid(this.getSubject().getId());if(null==tu){if(null==(tu=yield this.getSubject().getId().resolve()))throw new et(this.getSubject().getId().toString()+" isn't found in the chain");tu.getMetadata().attachStore(this.getStore())}if(null==tn&&null==tu.getDefaultPublicKeyId())throw new X("Unknown sign key");if(null!=tn){if(!tu.isAuthenticationKey(tn))throw new X(tn.toString()+" isn't the authentication key")}else tn=tu.getDefaultPublicKeyId();yield ll.getInstance().declareCredential(this,tu,tn,to,ta)})}revoke(tn,to=null,ta=null,tu=null){return A(this,void 0,void 0,function*(){qt(null!=ta&&""!==ta,"Invalid storepass"),this.checkAttachedStore(),null!=to&&to.getMetadata().attachedStore()&&this.getMetadata().attachStore(to.getStore());let tc=yield this.getSubject().getId().resolve();if(null==tc)throw tR.error("Publish failed because the credential owner is not published."),new et(this.getSubject().getId().toString()+" isn't found in the chain");tc.getMetadata().attachStore(this.getStore());let th=yield this.getIssuer().resolve();if(null==th)throw tR.error("Publish failed because the credential issuer is not published."),new et(this.getIssuer().toString()+" isn't found in the chain");if(th.getMetadata().attachStore(this.getStore()),yield this.isRevoked())throw tR.error("Publish failed because the credential is revoked."),new st(this.getId().toString()+" is revoked");if("string"==typeof tn&&(tn=Xt.from(tn,this.getSubject().getId())),null==to){let ta=null!=tn&&null!=tn.getDid()?tn.getDid():this.getSubject().getId();if(null==(to=yield this.getStore().loadDid(ta))){if(null==(to=yield this.getSubject().getId().resolve()))throw new et(this.getSubject().getId().toString()+" isn't found in the chain");to.getMetadata().attachStore(this.getStore())}}if(!(to.getSubject().equals(this.getSubject().getId())||to.getSubject().equals(this.getIssuer())||tc.hasController(to.getSubject())||th.hasController(to.getSubject())))throw tR.error("Publish failed because the invalid signer or signkey."),new X("Not owner or issuer: "+to.getSubject());if(null==tn&&null==to.getDefaultPublicKeyId())throw new X("Unknown sign key");if(null!=tn){if(!to.isAuthenticationKey(tn))throw new X(tn.toString()+" isn't the authencation key")}else tn=to.getDefaultPublicKeyId();yield ll.getInstance().revokeCredential(this,to,tn,ta,tu)})}static revoke(tn,to,ta,tu,tc=null){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid credential id"),qt(null!=to,"Invalid issuer's document"),qt(tu&&null!=tu,"Invalid storepass"),!to.getMetadata().attachedStore())throw new z(to.getSubject().toString()+" not attach with did store");let th=yield ll.getInstance().resolveCredentialBiography(tn,to.getSubject());if(th.getStatus().equals(qa.REVOKED))throw tR.error("Publish failed because the credential is revoked."),new st(tn.toString()+" is revoked");if(th.getStatus().equals(qa.VALID)){let tn=th.getTransaction(0).getRequest().getCredential();if(!to.getSubject().equals(tn.getSubject().getId())&&!to.getSubject().equals(tn.getIssuer()))throw tR.error("Publish failed because the invalid signer or signkey."),new X("Not owner or issuer: "+to.getSubject())}if(null==ta&&null==to.getDefaultPublicKeyId())throw new X("Unknown sign key");if(null!=ta){if(!to.isAuthenticationKey(ta))throw new X(ta.toString()+" isn't the authencation key")}else ta=to.getDefaultPublicKeyId();yield ll.getInstance().revokeCredential(tn,to,ta,tu,tc)})}static resolve(tn,to=null,ta=!1){return A(this,void 0,void 0,function*(){if(null==tn)throw new P("No credential id");"string"==typeof tn&&(tn=Xt.from(tn)),"string"==typeof to&&(to=Jt.from(to));let tu=yield ll.getInstance().resolveCredential(tn,to,ta);return null!=tu&&tn.setMetadata(tu.getMetadata()),tu})}static resolveBiography(tn,to){return qt(null!=tn,"Invalid credential id"),ll.getInstance().resolveCredentialBiography(tn,to)}static list(tn,to=0,ta=0){return qt(null!=tn,"Invalid did"),ll.getInstance().listCredentials(tn,to,ta)}toJSON(tn=null){let to=tn?new Jt(tn):null,ta={};return null!=this.context&&this.context.length>0&&(ta["@context"]=Array.from(this.context)),ta.id=this.id.toString(to),ta.type=this.type,to&&this.issuer.equals(to)||(ta.issuer=this.issuer.toString()),this.issuanceDate&&(ta.issuanceDate=this.dateToString(this.issuanceDate)),this.expirationDate&&(ta.expirationDate=this.dateToString(this.expirationDate)),ta.credentialSubject=this.subject.toJSON(tn),this.proof&&(ta.proof=this.proof.toJSON(tn)),ta}fromJSON(tn,to=null){if(!tn.credentialSubject)throw new H("Missing property: subject");let ta=tn.credentialSubject,tu=this.getDid("credentialSubject.id",ta.id,{mandatory:!1,nullable:!1,defaultValue:to});if(!tu)throw new H("Missing property: subject.id");if(this.context=this.getContext("@context",tn["@context"],{mandatory:!1,nullable:!1,defaultValue:[]}),this.id=this.getDidUrl("id",tn.id,{mandatory:!0,nullable:!1,context:tu}),this.type=this.getStrings("type",tn.type,{mandatory:!0,nullable:!1}),this.issuer=this.getDid("issuer",tn.issuer,{mandatory:!1,nullable:!1,defaultValue:tu}),this.issuanceDate=this.getDate("issuanceDate",tn.issuanceDate,{mandatory:!0,nullable:!1}),this.expirationDate=this.getDate("expirationDate",tn.expirationDate,{mandatory:!0,nullable:!0}),this.subject=se.Subject.deserialize(ta,se.Subject,tu),!tn.proof)throw new H("Missing property: proof");let tc=tn.proof;this.proof=se.Proof.deserialize(tc,se.Proof,this.issuer)}static parse(tn,to=null){try{return Ft.deserialize(tn,se,to)}catch(tn){throw tn instanceof H?tn:new H(tn)}}};se.W3C_CREDENTIAL_CONTEXT="https://www.w3.org/2018/credentials/v1",se.ELASTOS_CREDENTIAL_CONTEXT="https://ns.elastos.org/credentials/v1",se.DEFAULT_CREDENTIAL_TYPE="VerifiableCredential",(t6=se||(se={})).Subject=class extends Ft{constructor(tn=null,to={}){super(),this.id=tn,this.properties=Mt(JSON.parse(JSON.stringify(to)))}getId(){return this.id}getProperties(){return JSON.parse(JSON.stringify(this.properties))}getPropertyCount(){return Object.keys(this.properties).length}getProperty(tn){return this.properties[tn]}getPropertiesAsString(){return JSON.stringify(this.properties)}toJSON(tn=null){tn&&new Jt(tn);let to={};return to.id=this.id.toString(),to=Object.assign(Object.assign({},to),this.properties)}fromJSON(tn,to=null){this.id=this.getDid("subject.id",tn.id,{mandatory:!1,defaultValue:to});let ta=JSON.parse(JSON.stringify(tn));delete ta.id,this.properties=Mt(ta)}},t6.Proof=class extends Ft{constructor(tn=null,to=null,ta=new Date,tu=ne.DEFAULT_PUBLICKEY_TYPE){super(),this.type=null!=tu?tu:ne.DEFAULT_PUBLICKEY_TYPE,this.created=null==ta?null:new Date(ta.getTime()/1e3*1e3),this.created&&this.created.setMilliseconds(0),this.verificationMethod=tn,this.signature=to}getType(){return this.type}getVerificationMethod(){return this.verificationMethod}getCreated(){return this.created}getSignature(){return this.signature}toJSON(tn=null){let to={};return(tn?new Jt(tn):null)&&this.type===ne.DEFAULT_PUBLICKEY_TYPE||(to.type=this.type),this.created&&(to.created=this.dateToString(this.created)),to.verificationMethod=this.verificationMethod.toJSON(tn),to.signature=this.signature,to}fromJSON(tn,to=null){this.type=this.getString("proof.type",tn.type,{mandatory:!1,defaultValue:ne.DEFAULT_PUBLICKEY_TYPE}),this.created=this.getDate("proof.created",tn.created,{mandatory:!1}),this.verificationMethod=this.getDidUrl("proof.verificationMethod",tn.verificationMethod,{mandatory:!0,nullable:!1,context:to}),this.signature=this.getString("proof.signature",tn.signature,{mandatory:!0,nullable:!1})}},t6.Builder=class{constructor(tn,to){this.issuer=tn,this.target=to,this.credential=new t6,this.credential.issuer=tn.getDid(),this.setDefaultType()}checkNotSealed(){if(null==this.credential)throw new rt(this.id.toString()+" is already sealed")}id(tn){return this.checkNotSealed(),qt(null!=tn,"Invalid id"),"string"==typeof tn&&(tn=Xt.from(tn,this.target)),qt(null==tn.getDid()||tn.getDid().equals(this.target),"Invalid id"),null==tn.getDid()&&(tn=Xt.from(tn,this.target)),this.credential.id=tn,this}setDefaultType(){this.checkNotSealed(),Gt.isEnabledJsonLdContext()&&(null==this.credential.context&&(this.credential.context=[]),this.credential.context.includes(t6.W3C_CREDENTIAL_CONTEXT)||this.credential.context.push(t6.W3C_CREDENTIAL_CONTEXT),this.credential.context.includes(t6.ELASTOS_CREDENTIAL_CONTEXT)||this.credential.context.push(t6.ELASTOS_CREDENTIAL_CONTEXT)),null==this.credential.type&&(this.credential.type=[]),this.credential.type.includes(t6.DEFAULT_CREDENTIAL_TYPE)||this.credential.type.push(t6.DEFAULT_CREDENTIAL_TYPE)}typeWithContext(tn,to){return this.checkNotSealed(),Yt(tn,"Invalid type: "+tn),Gt.isEnabledJsonLdContext()?(Yt(to,"Invalid context: "+to),null==this.credential.context&&(this.credential.context=[]),this.credential.context.includes(to)||this.credential.context.push(to)):tR.warn("JSON-LD context support not enabled"),null==this.credential.type&&(this.credential.type=[]),this.credential.type.includes(tn)||this.credential.type.push(tn),this}type(tn){if(this.checkNotSealed(),Yt(tn,"Invalid type: "+tn),0>tn.indexOf("#"))return this.typeWithContext(tn,null);{let to=tn.split("#",2);return this.typeWithContext(to[1],to[0])}}types(...tn){if(null==tn||0==tn.length)return this;for(let to of(this.checkNotSealed(),tn))this.type(to);return this}getMaxExpires(){return(null!=this.credential.getIssuanceDate()?tw(this.credential.getIssuanceDate()):tw()).add(ne.MAX_VALID_YEARS,"years").toDate()}defaultExpirationDate(){return this.checkNotSealed(),this.credential.expirationDate=this.getMaxExpires(),this.credential.expirationDate&&this.credential.expirationDate.setMilliseconds(0),this}expirationDate(tn){this.checkNotSealed(),qt(null!=tn,"Invalid expiration date");let to=tw(tn),ta=this.getMaxExpires();return to.isAfter(ta)&&(to=tw(ta)),this.credential.expirationDate=to.toDate(),this.credential.expirationDate&&this.credential.expirationDate.setMilliseconds(0),this}properties(tn){this.checkNotSealed();let to="string"==typeof tn?JSON.parse(tn):JSON.parse(JSON.stringify(tn));return delete to.id,null==tn||0==Object.keys(tn).length?this.subjectProperties={}:this.subjectProperties=to,this}property(tn,to){return this.checkNotSealed(),qt(null!=tn&&""!==tn&&"id"!==tn,"Invalid name"),this.subjectProperties||(this.subjectProperties={}),this.subjectProperties[tn]=to,this}sanitize(){if(null!=this.credential.context&&0!=this.credential.context.length||(this.credential.context=[]),null==this.credential.id)throw new H("Missing credential id");if(null==this.credential.type||0==this.credential.type.length)throw new H("Missing credential type");ae.sort(this.credential.type),this.credential.issuanceDate=new Date,this.credential.issuanceDate&&this.credential.issuanceDate.setMilliseconds(0),this.credential.hasExpirationDate()||this.defaultExpirationDate(),this.subjectProperties=Mt(this.subjectProperties),this.credential.proof=null}seal(tn){return A(this,void 0,void 0,function*(){this.checkNotSealed(),qt(null!=tn&&""!==tn,"Invalid storepass"),this.sanitize(),this.credential.subject=new t6.Subject(this.target,this.subjectProperties);let to=this.credential.serialize(!0),ta=yield this.issuer.sign(tn,th.Buffer.from(to));this.credential.proof=new t6.Proof(this.issuer.getSignKey(),ta);let tu=this.credential;return this.credential=null,tu})}};let ae=class ae{static sort(tn){tn.sort((tn,to)=>"string"==typeof tn?tn<to?-1:tn>to?1:0:tn.compareTo(to))}};let le=class le extends Map{get(tn){for(let to of this.entries())if(to[0].equals(tn))return to[1];return null}delete(tn){for(let to of this.entries())if(to[0].equals(tn))return super.delete(to[0]);return!1}has(tn){for(let to of this.entries())if(to[0].equals(tn))return!0;return!1}valuesAsSortedArray(){let tn=Array.from(this.keys());return ae.sort(tn),tn.map(tn=>this.get(tn))}};let ue=class ue{header(){throw Error("Not implemented.")}push(tn){return this.pushAny(tn,!0)}pushLast(tn){return this.pushAny(tn,!0)}pushAny(tn,to){throw Error("Not implemented.")}};let ce=class ce{static getHeaderLen(){return tm.crypto_secretstream_xchacha20poly1305_HEADERBYTES}static getEncryptExtraSize(){return tm.crypto_secretstream_xchacha20poly1305_ABYTES}pull(tn){throw Error("Not implemented.")}isComplete(){throw Error("Not implemented.")}};let he=class he{static getCurve25519KeyPair(tn){let to=tm.crypto_sign_seed_keypair(tn);if(!to)throw Error("Failed to generate ed25519 key pair.");let ta=tm.crypto_sign_ed25519_sk_to_curve25519(to.privateKey);if(!ta)throw Error("Failed to generate curve25519 private key.");let tu=tm.crypto_sign_ed25519_pk_to_curve25519(to.publicKey);if(!tu)throw Error("Failed to generate curve25519 public key.");return{ed25519Sk:to.privateKey,ed25519Pk:to.publicKey,privateKey:ta,publicKey:tu}}};let de=class de extends ue{constructor(tn){super();let to=tm.crypto_secretstream_xchacha20poly1305_init_push(tn);if(!to)throw Error("Failed to init encryption.");this.header_=to.header,this.state=to.state}header(){return this.header_}pushAny(tn,to){qt(!!tn,"Invalid clearText");let ta=tn instanceof Uint8Array?tn:new Uint8Array(tn),tu=to?tm.crypto_secretstream_xchacha20poly1305_TAG_FINAL:tm.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE,tc=tm.crypto_secretstream_xchacha20poly1305_push(this.state,ta,null,tu);if(!tc)throw Error("Failed to encrypt clearText.");return tc}};let fe=class fe extends ce{constructor(tn,to){if(super(),this.state=tm.crypto_secretstream_xchacha20poly1305_init_pull(to,tn),!this.state)throw Error("Failed to init decryption.");this.complete=!1}pull(tn){qt(!!tn,"Invalid clearText");let to=tn instanceof Uint8Array?tn:new Uint8Array(tn),ta=tm.crypto_secretstream_xchacha20poly1305_pull(this.state,to);if(!ta)throw Error("Failed to decrypt the cipherText.");return ta.tag==tm.crypto_secretstream_xchacha20poly1305_TAG_FINAL&&(this.complete=!0),ta.message}isComplete(){return this.complete}};let pe=class pe{constructor(tn){this.key=tn}setOtherSideCurve25519PublicKey(tn){throw Error("Not support yet.")}encrypt(tn,to){qt(!!tn,"Invalid data"),qt(!!to,"Invalid nonce");let ta=tm.crypto_aead_xchacha20poly1305_ietf_encrypt(new Uint8Array(tn),null,null,new Uint8Array(to),this.key);if(!ta)throw Error("Failed to encrypt data.");return th.Buffer.from(ta)}decrypt(tn,to){qt(!!tn,"Invalid data"),qt(!!to,"Invalid nonce");let ta=tm.crypto_aead_xchacha20poly1305_ietf_decrypt(null,new Uint8Array(tn),null,new Uint8Array(to),this.key);if(!ta)throw Error("Failed to decrypt data.");return th.Buffer.from(ta)}createEncryptionStream(){return new de(this.key)}createDecryptionStream(tn){return new fe(this.key,new Uint8Array(tn))}getEd25519PublicKey(){throw Error("Not support yet.")}getCurve25519PublicKey(){throw Error("Not support yet.")}};let ye=class ye{constructor(tn,to){this.keyPair=tn,this.isServer=to,this.encryptKey=null,this.sharedKeys=null}checkEncryptionKeys(){if(!this.encryptKey||!this.sharedKeys)throw Error("Please set an other side public key first.")}setOtherSideCurve25519PublicKey(tn){if(this.encryptKey=tm.crypto_box_beforenm(new Uint8Array(tn),this.keyPair.privateKey),!this.encryptKey)throw Error("Failed to generate encrypt keys.");if(this.sharedKeys=this.isServer?tm.crypto_kx_server_session_keys(this.keyPair.publicKey,this.keyPair.privateKey,new Uint8Array(tn)):tm.crypto_kx_client_session_keys(this.keyPair.publicKey,this.keyPair.privateKey,new Uint8Array(tn)),!this.sharedKeys)throw Error("Failed to generate shared keys.")}encrypt(tn,to){qt(!!tn,"Invalid data"),qt(!!to,"Invalid nonce"),this.checkEncryptionKeys();let ta=tm.crypto_box_easy_afternm(new Uint8Array(tn),new Uint8Array(to),this.encryptKey);if(!ta)throw Error("Failed to encrypt data.");return th.Buffer.from(ta)}decrypt(tn,to){qt(!!tn,"Invalid data"),qt(!!to,"Invalid nonce"),this.checkEncryptionKeys();let ta=tm.crypto_box_open_easy_afternm(new Uint8Array(tn),new Uint8Array(to),this.encryptKey);if(!ta)throw Error("Failed to decrypt data.");return th.Buffer.from(ta)}createEncryptionStream(){return this.checkEncryptionKeys(),new de(this.sharedKeys.sharedTx)}createDecryptionStream(tn){return this.checkEncryptionKeys(),new fe(this.sharedKeys.sharedRx,new Uint8Array(tn))}getEd25519PublicKey(){return th.Buffer.from(this.keyPair.ed25519Pk)}getCurve25519PublicKey(){return th.Buffer.from(this.keyPair.publicKey)}};let tk=new T("DIDDocument");let ve=class ve extends Ft{constructor(tn){super(),this.subject=tn}static clone(tn,to){let ta=new ve(tn.subject);return ta.context=tn.context,ta.controllers=tn.controllers,ta.controllerDocs=tn.controllerDocs,ta.effectiveController=tn.effectiveController,ta.multisig=tn.multisig,ta.publicKeys=tn.publicKeys,ta.authenticationKeys=tn.authenticationKeys,ta.authorizationKeys=tn.authorizationKeys,ta.defaultPublicKey=tn.defaultPublicKey,ta.credentials=tn.credentials,ta.services=tn.services,ta.expires=tn.expires,to&&(ta.proofs=tn.proofs),ta.metadata=tn.metadata,ta}getSubject(){return this.subject}canonicalId(tn){return"string"==typeof tn?Xt.from(tn,this.getSubject()):null==tn||null!=tn.getDid()?tn:Xt.from(tn,this.getSubject())}checkAttachedStore(){if(!this.getMetadata().attachedStore())throw new z("Not attach with did store")}checkIsPrimitive(){if(this.isCustomizedDid())throw new B(this.getSubject().toString()+"is a customized did")}checkIsCustomized(){if(!this.isCustomizedDid())throw new U(this.getSubject().toString()+"isn't a customized did")}checkHasEffectiveController(){if(null==this.getEffectiveController())throw new V("No effective controller of "+this.getSubject().toString())}isCustomizedDid(){return null==this.defaultPublicKey}getControllers(){return this.controllers}getControllerCount(){return this.controllers.length}getController(){return 1==this.controllers.length?this.controllers[0]:null}hasController(tn=null){return tn?void 0!==this.controllers.find(to=>to.equals(tn)):0!=this.controllers.length}getControllerDocument(tn){return this.controllerDocs.get(tn)}getEffectiveController(){return this.effectiveController}getEffectiveControllerDocument(){return null==this.effectiveController?null:this.getControllerDocument(this.effectiveController)}setEffectiveController(tn){if(this.checkIsCustomized(),null!=tn){if(!this.hasController(tn))throw new q("Not contoller for target DID");this.effectiveController=tn;let to=this.getControllerDocument(this.effectiveController);to.getMetadata().attachedStore()||to.getMetadata().attachStore(this.getMetadata().getStore())}else this.effectiveController=tn}isMultiSignature(){return null!=this.multisig}getMultiSignature(){return this.multisig}getPublicKeyCount(){let tn=this.publicKeys.size;if(this.hasController())for(let to of this.controllerDocs.values())tn+=to.getAuthenticationKeyCount();return tn}getPublicKeys(){let tn=Array.from(this.publicKeys.values());if(this.hasController())for(let to of this.controllerDocs.values())tn.push(...to.getAuthenticationKeys());return tn}selectPublicKeys(tn,to){qt(null!=tn||null!=to,"Invalid select args"),tn=this.canonicalId(tn);let ta=[];for(let tu of this.publicKeys.values())(null==tn||tu.getId().equals(tn))&&(null!=to&&tu.getType()!==to||ta.push(tu));if(this.hasController())for(let tu of this.controllerDocs.values())ta.push(...tu.selectAuthenticationKeys(tn,to));return ta}getPublicKey(tn){qt(null!=tn,"Invalid publicKey id"),tn=this.canonicalId(tn);let to=this.publicKeys.get(tn);if(null==to&&this.hasController()){let ta=this.getControllerDocument(tn.getDid());null!=ta&&(to=ta.getAuthenticationKey(tn))}return to}hasPublicKey(tn){return null!=this.getPublicKey(this.canonicalId(tn))}hasPrivateKey(tn){return A(this,void 0,void 0,function*(){return"string"==typeof tn&&(tn=this.canonicalId(tn)),qt(null!=tn,"Invalid publicKey id"),!(!this.hasPublicKey(tn)||!this.getMetadata().attachedStore())&&(yield this.getMetadata().getStore().containsPrivateKey(tn))})}getDefaultPublicKeyId(){let tn=this.getDefaultPublicKey();return null!=tn?tn.getId():null}getDefaultPublicKey(){return null!=this.defaultPublicKey?this.defaultPublicKey:null!=this.effectiveController?this.getControllerDocument(this.effectiveController).getDefaultPublicKey():null}derive(tn,to){return A(this,void 0,void 0,function*(){return qt(null!=to&&""!==to,"Invalid storepass"),this.checkAttachedStore(),this.checkIsPrimitive(),Na.deserialize((yield this.getMetadata().getStore().loadPrivateKey(this.getDefaultPublicKeyId(),to))).deriveWithIndex(tn).serializeBase58()})}mapToDerivePath(tn,to){let ta=We.encodeToBuffer(th.Buffer.from(tn,"utf-8")),tu="m/",tc=qe.wrap(ta);for(;tc.hasRemaining();){let tn=tc.readInt();tu=(tu=tn>=0?tu.concat(tn.toString()):tu.concat((2147483647&tn).toString()).concat("'")).concat("/")}return to>=0?tu.concat(to.toString()):tu.concat((2147483647&to).toString()).concat("'")}deriveFromIdentifier(tn,to,ta){return A(this,void 0,void 0,function*(){qt(tn&&null!=tn,"Invalid identifier"),this.checkAttachedStore(),this.checkIsPrimitive();let tu=Na.deserialize((yield this.getMetadata().getStore().loadPrivateKey(this.getDefaultPublicKeyId(),ta))),tc=this.mapToDerivePath(tn,to);return tu.deriveWithPath(tc).serializeBase58()})}getAuthenticationKeyCount(){let tn=this.authenticationKeys.size;if(this.hasController())for(let to of this.controllerDocs.values())tn+=to.getAuthenticationKeyCount();return tn}getAuthenticationKeys(){let tn=Array.from(this.authenticationKeys.values());if(this.hasController())for(let to of this.controllerDocs.values())tn.push(...to.getAuthenticationKeys());return tn}selectAuthenticationKeys(tn,to){qt(null!=tn||null!=to,"Invalid select args"),tn=this.canonicalId(tn);let ta=[];for(let tu of this.authenticationKeys.values())(null==tn||tu.getId().equals(tn))&&(null!=to&&tu.getType()!==to||ta.push(tu));if(this.hasController())for(let tu of this.controllerDocs.values())ta.push(...tu.selectAuthenticationKeys(tn,to));return ta}getAuthenticationKey(tn){qt(null!=tn,"Invalid publicKey id"),tn=this.canonicalId(tn);let to=this.authenticationKeys.get(tn);if(null!=to)return to;if(this.hasController()){let to=this.controllerDocs.get(tn.getDid());if(null!=to)return to.getAuthenticationKey(tn)}return null}isAuthenticationKey(tn){return null!=this.getAuthenticationKey(this.canonicalId(tn))}getAuthorizationKeyCount(){return this.authorizationKeys.size}getAuthorizationKeys(){return Array.from(this.authorizationKeys.values())}selectAuthorizationKeys(tn,to){qt(null!=tn||null!=to,"Invalid select args"),tn=this.canonicalId(tn);let ta=[];for(let tu of this.authorizationKeys.values())(null==tn||tu.getId().equals(tn))&&(null!=to&&tu.getType()!==to||ta.push(tu));return ta}getAuthorizationKey(tn){return qt(null!=tn,"Invalid publicKey id"),this.authorizationKeys.get(this.canonicalId(tn))}isAuthorizationKey(tn){return null!=this.getAuthorizationKey(tn)}getCredentialCount(){return this.credentials.size}getCredentials(){return Array.from(this.credentials.values())}selectCredentials(tn,to){qt(null!=tn||null!=to,"Invalid select args"),tn=this.canonicalId(tn);let ta=[];for(let tu of this.credentials.values())(null==tn||tu.getId().equals(tn))&&(null!=to&&0>tu.getType().indexOf(to)||ta.push(tu));return ta}getCredential(tn){return qt(null!=tn,"Invalid Credential id"),this.credentials.get(this.canonicalId(tn))}getServiceCount(){return this.services.size}getServices(){return Array.from(this.services.values())}selectServices(tn,to){qt(null!=tn||null!=to,"Invalid select args"),tn=this.canonicalId(tn);let ta=[];for(let tu of this.services.values())(null==tn||tu.getId().equals(tn))&&(null!=to&&tu.getType()!==to||ta.push(tu));return ta}getService(tn){return qt(null!=tn,"Invalid service id"),this.services.get(this.canonicalId(tn))}getExpires(){return this.expires}getLastModified(){return this.getProof().getCreated()}getSignature(){return this.getProof().getSignature()}getProof(){return this.getProofs()[0]}getProofs(){return this.proofs.valuesAsSortedArray()}getSerializeContextDid(){return this.getSubject()}toJSON(tn=null){let to=tn?new Jt(tn):null,ta={};if(this.context.length>0&&(ta["@context"]=Array.from(this.context)),ta.id=this.subject.toString(),this.controllers.length>0&&(ta.controller=1==this.controllers.length?this.controllers[0].toString():Array.from(this.controllers,tn=>tn.toString())),this.multisig&&(ta.multisig=this.multisig.toString()),this.publicKeys.size>0&&(ta.publicKey=Array.from(this.publicKeys.valuesAsSortedArray(),to=>to.toJSON(tn))),this.authenticationKeys.size>0&&(ta.authentication=Array.from(this.authenticationKeys.valuesAsSortedArray(),tn=>tn.getId().toString(to))),this.authorizationKeys.size>0&&(ta.authorization=Array.from(this.authorizationKeys.valuesAsSortedArray(),tn=>tn.getId().toString(to))),this.credentials.size>0&&(ta.verifiableCredential=Array.from(this.credentials.valuesAsSortedArray(),to=>to.toJSON(tn))),this.services.size>0&&(ta.service=Array.from(this.services.valuesAsSortedArray(),to=>to.toJSON(tn))),this.expires&&(ta.expires=this.dateToString(this.expires)),this.proofs&&this.proofs.size>0){let to=this.proofs.valuesAsSortedArray();1==to.length?ta.proof=to[0].toJSON(tn):ta.proof=Array.from(to,to=>to.toJSON(tn))}return ta}fromJSON(tn,to=null){return A(this,void 0,void 0,function*(){this.fromJSONOnly(tn,to),this.controllers.length>0&&(yield this.resolveControllers())})}resolveControllers(){return A(this,void 0,void 0,function*(){if(this.controllerDocs.size===this.controllers.length)return;let tn=[];for(let to of this.controllers){let ta=to.resolve().then(tn=>{if(null==tn)throw new K("Can not resolve controller: "+to);if(this.controllerDocs.has(to))throw new K("Duplicated controller: "+to);this.controllerDocs.set(to,tn)});tn.push(ta)}try{yield Promise.all(tn)}catch(tn){throw new K("Can not resolve the controller's DID: "+tn,tn)}})}fromJSONOnly(tn,to=null){this.context=this.getContext("@context",tn["@context"],{mandatory:!1,nullable:!1,defaultValue:[]}),this.subject=this.getDid("id",tn.id,{mandatory:!0,nullable:!1,defaultValue:null}),to=this.subject,this.controllers=this.getDids("controller",tn.controller,{mandatory:!1,nullable:!1,defaultValue:[]});let ta=this.getString("multisig",tn.multisig,{mandatory:!1,nullable:!1});if(ta&&(this.multisig=ve.MultiSignature.fromString(ta)),this.controllerDocs=new le,this.controllers.length<=1){if(this.multisig)throw new K("Invalid multisig property")}else{if(null==this.multisig)throw new K("Missing multisig property");if(this.multisig.n()!=this.controllers.length)throw new K("Invalid multisig property")}if(this.publicKeys=new le,tn.publicKey){if(!Array.isArray(tn.publicKey))throw new K("Invalid property: publicKey, type error.");for(let ta of tn.publicKey){let tn;try{tn=ve.PublicKey.deserialize(ta,ve.PublicKey,to)}catch(tn){throw new K("Invalid publicKey: "+ta.id,tn)}if(this.publicKeys.has(tn.getId()))throw new K("Duplicated publicKey: "+tn.getId());this.publicKeys.set(tn.getId(),tn)}}if(this.authenticationKeys=new le,tn.authentication){if(!Array.isArray(tn.authentication))throw new K("Invalid property: authentication, type error.");for(let ta of tn.authentication){let tn;if("string"==typeof ta){let tu=new Xt(ta,to);if(!this.publicKeys.has(tu))throw new K("Not exists publicKey reference: "+tu);tn=this.publicKeys.get(tu)}else{try{tn=ve.PublicKey.deserialize(ta,ve.PublicKey,to)}catch(tn){throw new K("Invalid publicKey: "+ta.id,tn)}if(this.publicKeys.has(tn.getId()))throw new K("Duplicated publicKey: "+tn.getId());this.publicKeys.set(tn.getId(),tn)}if(!tn.getController().equals(to))throw new K("Invalid authentication key: "+tn.getId());this.authenticationKeys.set(tn.getId(),tn)}}if(this.authorizationKeys=new le,tn.authorization){if(!Array.isArray(tn.authorization))throw new K("Invalid property: authorization, type error.");for(let ta of tn.authorization){let tn;if("string"==typeof ta){let tu=new Xt(ta,to);if(!this.publicKeys.has(tu))throw new K("Not exists publicKey reference: "+tu);tn=this.publicKeys.get(tu)}else{try{tn=ve.PublicKey.deserialize(ta,ve.PublicKey,to)}catch(tn){throw new K("Invalid publicKey: "+ta.id,tn)}if(this.publicKeys.has(tn.getId()))throw new K("Duplicated publicKey: "+tn.getId());this.publicKeys.set(tn.getId(),tn)}if(tn.getController().equals(to))throw new K("Invalid authorization key: "+tn.getId());this.authorizationKeys.set(tn.getId(),tn)}}if(this.controllers.length>0)1==this.controllers.length&&(this.effectiveController=this.controllers[0]);else{if(!this.publicKeys||0==this.publicKeys.size)throw new K("Missing publicKeys");for(let tn of this.publicKeys.values())if(tn.getController().equals(this.subject)&&Na.toAddress(tn.getPublicKeyBytes())===this.subject.getMethodSpecificId()){this.defaultPublicKey=tn,this.authenticationKeys.has(tn.getId())||this.authenticationKeys.set(tn.getId(),tn);break}if(!this.defaultPublicKey)throw new K("Missing default public key")}if(this.credentials=new le,tn.verifiableCredential){if(!Array.isArray(tn.verifiableCredential))throw new K("Invalid property: verifiableCredential, type error.");for(let ta of tn.verifiableCredential){let tn;try{tn=se.deserialize(ta,se,to)}catch(tn){throw new K("Invalid verifiableCredential: "+ta.id,tn)}if(this.credentials.has(tn.getId()))throw new K("Duplicated verifiableCredential: "+tn.getId());this.credentials.set(tn.getId(),tn)}}if(this.services=new le,tn.service){if(!Array.isArray(tn.service))throw new K("Invalid property: service, type error.");for(let ta of tn.service){let tn;try{tn=ve.Service.deserialize(ta,ve.Service,to)}catch(tn){throw new K("Invalid service: "+ta.id,tn)}if(this.services.has(tn.getId()))throw new K("Duplicated service: "+tn.getId());this.services.set(tn.getId(),tn)}}if(this.expires=this.getDate("expires",tn.expires,{mandatory:!0,nullable:!1}),!tn.proof)throw new K("Missing property: proof");if(this.proofs=new le,Array.isArray(tn.proof))for(let ta of tn.proof){let tn=ve.Proof.deserialize(ta,ve.Proof,to);if(null==tn.getCreator().getDid())throw new K("Invalid proof creater: "+tn.getCreator());if(this.proofs.has(tn.getCreator().getDid()))throw new K("Aleady exist proof from "+tn.getCreator().getDid());this.proofs.set(tn.getCreator().getDid(),tn)}else{let ta=tn.proof;this.isCustomizedDid()||ta.creator||(ta.creator=this.getDefaultPublicKeyId().toString());let tu=ve.Proof.deserialize(ta,ve.Proof,to);if(null==tu.getCreator().getDid())throw new K("Invalid proof creater: "+tu.getCreator());this.proofs.set(tu.getCreator().getDid(),tu)}}setMetadata(tn){this.metadata=tn,this.subject.setMetadata(tn)}getMetadata(){return null==this.metadata&&(this.metadata=new Kt(this.getSubject())),this.metadata}getStore(){return this.getMetadata().getStore()}isExpired(){return tw().isAfter(tw(this.expires))}isGenuine(tn=null){let to=null==this.multisig?1:this.multisig.m();if(this.proofs.size!=to)return null!=tn&&(tn.failed(this,"{}: proof size not matched with multisig, {} expected, actual is {}",this.getSubject(),this.multisig.m(),this.proofs.size),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;let ta=ve.clone(this,!1).serialize(!0),tu=He.sha256Digest(th.Buffer.from(ta,"utf-8"));if(this.isCustomizedDid()){for(let to of this.proofs.values()){if(to.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"{}: key type '{}' for proof is not supported",this.getSubject(),to.getType()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;let ta=this.getControllerDocument(to.getCreator().getDid());if(null==ta)return null!=tn&&(tn.failed(this,"{}: can not resolve the document for controller '{}' to verify the proof",this.getSubject(),to.getCreator().getDid()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;if(!ta.isGenuine(tn))return null!=tn&&(tn.failed(this,"{}: controller '{}' is not genuine, failed to verify the proof",this.getSubject(),to.getCreator().getDid()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;if(!to.getCreator().equals(ta.getDefaultPublicKeyId()))return null!=tn&&(tn.failed(this,"{}: key '{}' for proof is not default key of '{}'",this.getSubject(),to.getCreator(),to.getCreator().getDid()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;if(!ta.verifyDigest(to.getCreator(),to.getSignature(),tu))return null!=tn&&(tn.failed(this,"{}: proof '{}' is invalid, signature mismatch",this.getSubject(),to.getCreator()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1}return null!=tn&&tn.succeeded(this,"{}: is genuine",this.getSubject()),!0}{let to=this.getProof();if(to.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"{}: key type '{}' for proof is not supported",this.getSubject(),to.getType()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;if(!to.getCreator().equals(this.getDefaultPublicKeyId()))return null!=tn&&(tn.failed(this,"{}: key '{}' for proof is not default key",this.getSubject(),to.getCreator()),tn.failed(this,"{}: is not genuine",this.getSubject())),!1;let ta=this.verifyDigest(to.getCreator(),to.getSignature(),tu);return null!=tn&&(ta?tn.succeeded(this,"{}: is genuine",this.getSubject()):(tn.failed(this,"{}: can not verify the signature",this.getSubject()),tn.failed(this,"{}: is not genuine",this.getSubject()))),ta}}isDeactivated(){return A(this,void 0,void 0,function*(){if(this.getMetadata().isDeactivated())return!0;let tn=yield ll.getInstance().resolveDidBiography(this.getSubject());if(null==tn)return!1;let to=tn.getStatus()==rl.DEACTIVATED;return to&&this.getMetadata().setDeactivated(to),to})}isQualified(){return null!=this.proofs&&0!=this.proofs.size&&this.proofs.size==(null==this.multisig?1:this.multisig.m())}isValid(tn=null){return A(this,void 0,void 0,function*(){if(yield this.isDeactivated())return null!=tn&&(tn.failed(this,"{}: is deactivated",this.getSubject()),tn.failed(this,"{}: is invalid",this.getSubject())),!1;if(this.isExpired())return null!=tn&&(tn.failed(this,"{}: is expired",this.getSubject()),tn.failed(this,"{}: is invalid",this.getSubject())),!1;if(!this.isGenuine(tn))return null!=tn&&tn.failed(this,"{}: is invalid",this.getSubject()),!1;if(this.hasController())for(let to of this.controllerDocs.values()){if(yield to.isDeactivated())return null!=tn&&(tn.failed(this,"{}: controller '{}' is deactivated",this.getSubject(),to.getSubject()),tn.failed(this,"{}: is invalid",this.getSubject())),!1;if(!to.isGenuine(tn))return null!=tn&&(tn.failed(this,"{}: controller '{}' is not genuine",this.getSubject(),to.getSubject()),tn.failed(this,"{}: is invalid",this.getSubject())),!1}return null!=tn&&tn.succeeded(this,"{}: is valid",this.getSubject()),!0})}copy(){let tn=new ve(this.subject);tn.context=null==this.context?null:Array.from(this.context),tn.controllers=Array.from(this.controllers),tn.controllerDocs=new le(this.controllerDocs),null!=this.multisig&&(tn.multisig=ve.MultiSignature.newFromMultiSignature(this.multisig)),tn.effectiveController=this.effectiveController,tn.publicKeys=new le(this.publicKeys),tn.authenticationKeys=new le(this.authenticationKeys),tn.authorizationKeys=new le(this.authorizationKeys),tn.defaultPublicKey=this.defaultPublicKey,tn.credentials=new le(this.credentials),tn.services=new le(this.services),tn.expires=this.expires,tn.proofs=new le(this.proofs);let to=this.getMetadata().clone();return tn.setMetadata(to),tn}clone(){let tn=new ve(this.subject);return tn.context=this.context,tn.controllers=this.controllers,tn.controllerDocs=this.controllerDocs,tn.effectiveController=this.effectiveController,tn.multisig=this.multisig,tn.publicKeys=this.publicKeys,tn.authenticationKeys=this.authenticationKeys,tn.authorizationKeys=this.authorizationKeys,tn.defaultPublicKey=this.defaultPublicKey,tn.credentials=this.credentials,tn.services=this.services,tn.expires=this.expires,tn.proofs=this.proofs,tn.metadata=this.getMetadata().clone(),tn}signWithId(tn,to,...ta){let tu;qt(to&&null!=to,"Invalid storepass"),qt(null!=ta&&ta.length>0,"Invalid input data"),this.checkAttachedStore(),tu="string"==typeof tn?this.canonicalId(tn):tn;let tc=We.encodeToBuffer(...ta);return this.signDigest(tu,to,tc)}signWithStorePass(tn,...to){return this.signWithId(null,tn,...to)}signWithTicket(tn,to){return A(this,void 0,void 0,function*(){return qt(null!=tn,"Invalid ticket"),qt(to&&null!=to,"Invalid storepass"),this.checkAttachedStore(),yield tn.seal(this,to),tn})}signWithDocument(tn,to){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid document"),qt(to&&null!=to,"Invalid storepass"),this.checkAttachedStore(),!tn.isCustomizedDid())throw new U(tn.getSubject().toString()+"isn't a customized did");if(!tn.hasController(this.getSubject()))throw new q(this.getSubject()+" isn't the controller of "+tn.getSubject().toString());if(this.isCustomizedDid()){if(null==this.getEffectiveController())throw new V("no effective controller of "+this.getSubject().toString())}else if(!tn.hasController(this.getSubject()))throw new q(this.getSubject().toString()+" isn't the controller of "+tn.getSubject().toString());if(tn.proofs.has(this.getSubject()))throw new Y(this.getSubject().toString()+" already signed");let ta=ve.Builder.newFromDocument(tn).edit(this);try{return yield ta.seal(to)}catch(tn){throw new M(tn)}})}signDigest(tn,to,ta){qt(to&&null!=to,"Invalid storepass"),qt(null!=ta&&ta.length>0,"Invalid digest"),this.checkAttachedStore(),"string"==typeof tn&&(tn=this.canonicalId(tn));let tu=null!=tn?this.getPublicKey(tn):this.getDefaultPublicKey();if(null==tu)throw null!=tn?new X(tn.toString()+" is a invalid key"):new V("No effective controller of "+this.getSubject().toString());return this.getMetadata().getStore().sign(tu.getId(),to,ta)}verify(tn,to,...ta){qt(to&&null!=to,"Invalid signature"),qt(null!=ta&&ta.length>0,"Invalid digest");let tu=He.sha256Digest(...ta);return this.verifyDigest(tn,to,tu)}verifyDigest(tn,to,ta){qt(to&&null!=to,"Invalid signature"),qt(null!=ta&&ta.length>0,"Invalid digest"),"string"==typeof tn&&(tn=this.canonicalId(tn));let tu=null!=tn?this.getPublicKey(tn):this.getDefaultPublicKey();if(null==tu)throw new X(null!=tn?tn.toString()+"is a invalide key":"No explicit publicKey");let tc=tu.getPublicKeyBytes(),td=th.Buffer.from(Je.decode(to),"hex");return He.verify(tc,td,ta)}getDerivedPrivateKeyForCipher(tn,to,ta){return A(this,void 0,void 0,function*(){qt(!!tn,"Invalid identifier"),this.checkAttachedStore(),this.checkIsPrimitive();let tu=Na.deserialize((yield this.getMetadata().getStore().loadPrivateKey(this.getDefaultPublicKeyId(),ta))),tc=this.mapToDerivePath(tn,to);return new Uint8Array(tu.deriveWithPath(tc).getPrivateKeyBytes())})}createCipher(tn,to,ta){return A(this,void 0,void 0,function*(){let tu=yield this.getDerivedPrivateKeyForCipher(tn,to,ta);return new pe(tu)})}createCurve25519Cipher(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=yield this.getDerivedPrivateKeyForCipher(tn,to,ta),th=he.getCurve25519KeyPair(tc);return new ye(th,tu)})}getKeyProvider(){let tn=this;return new class{getPublicKey(to=null){return A(this,void 0,void 0,function*(){let ta;if(ta=null==to?tn.getDefaultPublicKeyId():tn.canonicalId(to),!tn.hasPublicKey(ta))return null;let tu=tn.getPublicKey(ta).getPublicKeyBytes(),tc=new tb.Key("oct",tu,{namedCurve:"P-256"}),th=Object.assign({},(yield tc.export("jwk")));return yield(0,tS.nO)(th,"ES256",!0)})}getPrivateKey(to=null,ta){return A(this,void 0,void 0,function*(){let tu;tu=null==to?tn.getDefaultPublicKeyId():tn.canonicalId(to);let tc=tn.getMetadata().getStore();if(!(yield tc.containsPrivateKey(tu)))return null;let th=Na.deserialize((yield tc.loadPrivateKey(tu,ta))),td=new tb.Key("oct",th.getPrivateKeyBytes(),{namedCurve:"P-256"}),tf=Object.assign({},(yield td.export("jwk")));return yield(0,tS.nO)(tf,"ES256",!0)})}}}jwtBuilder(){return new $t(this.getSubject(),this.getKeyProvider()).setIssuer(this.getSubject().toString())}jwtParserBuilder(){let tn=ie.newWithKeyProvider(this.getKeyProvider());return tn.requireIssuer(this.getSubject().toString()),tn}newCustomized(tn,to,ta){return this.newCustomizedDidWithController(tn,[],1,to,ta)}newCustomizedDidWithController(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){qt(tn&&null!=tn,"Invalid DID"),qt(tu&&null!=tu,"Invalid storepass"),this.checkAttachedStore();let th=Jt.from(tn),td=[];to&&to.length&&to.forEach(tn=>{let to=Jt.from(tn);to.equals(this.getSubject())||td.includes(tn)||td.push(to)}),qt(ta>=0&&ta<=td.length+1,"Invalid multisig"),ve.log.info("Creating new DID {} with controller {}...",th,this.getSubject());let tf=null;if(!tc&&(tf=yield th.resolve(!0)))throw new F(th.toString()+" already exist");ve.log.info("Creating new DID {} with controller {}...",th,this.getSubject());let tp=ve.Builder.newFromDID(th,this.getStore(),this);for(let tn of td)yield tp.addController(tn);tp.setMultiSignature(ta);try{return tf=yield tp.seal(tu),yield this.getStore().storeDid(tf),tf}catch(tn){throw new M(tn)}})}createTransferTicket(tn,to,ta){return A(this,void 0,void 0,function*(){qt(tn&&null!=tn,"Invalid to"),qt(to&&null!=to,"Invalid storepass");let tu=ta?yield ta.resolve(!0):this;if(ta){if(this.checkIsPrimitive(),this.checkAttachedStore(),!tu)throw new et(ta.toString()+" isn't found in the chain");if(yield tu.isDeactivated())throw new C(ta.toString()+" is deactived");if(!tu.isCustomizedDid())throw new U(ta.toString()+" isn't a customized did");if(!tu.hasController(this.getSubject()))throw new q(this.getSubject().toString()+" isn't the controller of did")}else this.checkIsCustomized(),this.checkAttachedStore(),this.checkHasEffectiveController();let tc=yield Ee.newForDIDDocument(tu,tn);return yield tc.seal(this,to),tc})}publishWithTicket(tn,to,ta,tu=null){return A(this,void 0,void 0,function*(){qt((yield tn.isValid()),"Invalid ticket"),qt(tn.getSubject().equals(this.getSubject()),"Ticket mismatch with current DID"),qt(ta&&null!=ta,"Invalid storepass"),this.checkIsCustomized(),qt(this.proofs.has(tn.getTo()),"Document not signed by: "+tn.getTo()),this.checkAttachedStore();let tc="string"==typeof to?this.canonicalId(to):to;if(null==tc&&null==this.getDefaultPublicKeyId())throw new V("no effective controller of "+this.getSubject().toString());let th=this.getSubject(),td=yield th.resolve(!0);if(null==td)throw new et(th.toString()+" isn't found in the chain");if(yield td.isDeactivated())throw new C(th.toString()+" is deactivated");if(null==tc){if(null==(tc=this.getDefaultPublicKeyId()))throw new X("No sign key.")}else if(null==this.getAuthenticationKey(tc))throw new X(tc.toString()+" is a invalid key");yield ll.getInstance().transferDid(this,tn,tc,ta,tu)})}publish(tn,to=null,ta=!1,tu=null){return A(this,void 0,void 0,function*(){qt(tn&&null!=tn,"Invalid storepass"),this.checkAttachedStore();let tc="string"==typeof to?this.canonicalId(to):to;if(null==tc&&null==this.getDefaultPublicKeyId())throw new V("No effective controller of "+this.getSubject().toString());if(ve.log.info("Publishing DID {}, force={}...",this.getSubject(),ta),!this.isGenuine())throw ve.log.error("Publish failed because document is not genuine."),new lt(this.getSubject().toString()+" isn't genuine");if(yield this.isDeactivated())throw ve.log.error("Publish failed because DID is deactivated."),new C(this.getSubject().toString()+" is deactivated");if(this.isExpired()&&!ta)throw ve.log.error("Publish failed because document is expired."),ve.log.info("You can publish the expired document using force mode."),new ut(this.getSubject().toString()+" is expired");let th=null,td=null,tf=yield this.getSubject().resolve(!0);if(null!=tf){if(yield tf.isDeactivated())throw this.getMetadata().setDeactivated(!0),ve.log.error("Publish failed because DID is deactivated."),new C(this.getSubject().toString()+" is deactivated");if(this.isCustomizedDid()){let tn=null==this.getMultiSignature()?ve.MultiSignature.ONE_OF_ONE:this.getMultiSignature(),to=null==tf.getMultiSignature()?ve.MultiSignature.ONE_OF_ONE:tf.getMultiSignature();if(!tn.equals(to))throw new Dt("Multisig is changed");let ta=tf.getControllers(),tu=this.getControllers();if(ta.length!=tu.length)throw new Dt("Controllrs count is changed");ta.sort(),tu.sort();for(let tn=0;tn<ta.length;tn++)if(!ta[tn].equals(tu[tn]))throw new Dt("Controllers are changed")}if(td=tf.getProof().getSignature(),!ta){let tn=this.getMetadata().getPreviousSignature(),to=this.getMetadata().getSignature();if(null==tn&&null==to)throw ve.log.error("Trying to publish over an existing document, but signatures information is missing. DID SDK doesn't know how to handle it, use force mode to ignore checks."),new ct(this.getSubject().toString()+" signatures information is missing");if(null==tn||null==to){if((null!=tn?tn:to)!==td)throw ve.log.error("Current copy not based on the latest on-chain copy, signature mismatch."),new ct(this.getSubject().toString()+" signature mismatch")}else if(to!==td&&tn!==td)throw ve.log.error("Current copy not based on the latest on-chain copy, signature mismatch."),new ct(this.getSubject().toString()+" signature mismatch")}th=tf.getMetadata().getTransactionId()}if(null==tc)tc=this.getDefaultPublicKeyId();else if(null==this.getAuthenticationKey(tc))throw new X(tc.toString()+" is a invalid key");th&&null!=th?(ve.log.info("Try to publish[update] {}...",this.getSubject()),yield ll.getInstance().updateDid(this,th,tc,tn,tu)):(ve.log.info("Try to publish[create] {}...",this.getSubject()),yield ll.getInstance().createDid(this,tc,tn,tu)),null!=td&&this.getMetadata().setPreviousSignature(td),this.getMetadata().setSignature(this.getProof().getSignature())})}publishUntrusted(tn,to,ta=null){return A(this,void 0,void 0,function*(){if(qt(null!=to&&""!=to,"Invalid storepass"),this.checkIsPrimitive(),this.checkAttachedStore(),null==tn&&null==this.getDefaultPublicKeyId())throw new V("No effective controller of "+this.getSubject().toString());if(ve.log.info("Publishing untrusted DID {}...",this.getSubject()),!this.isGenuine())throw ve.log.error("Publish failed because document is not genuine."),new lt(this.getSubject().toString()+" isn't genuine");if(yield this.isDeactivated())throw ve.log.error("Publish failed because DID is deactivated."),new C(this.getSubject().toString()+" is deactivated");if(this.isExpired())throw ve.log.error("Publish failed because document is expired."),new ut(this.getSubject().toString()+" is expired");let tu=null,tc=null,th=yield ll.getInstance().resolveUntrustedDid(this.getSubject(),!0);if(null!=th){if(yield th.isDeactivated())throw this.getMetadata().setDeactivated(!0),ve.log.error("Publish failed because DID is deactivated."),new C(this.getSubject().toString()+" is deactivated");tc=th.getProof().getSignature(),tu=th.getMetadata().getTransactionId()}if(null==tn)tn=this.getDefaultPublicKeyId();else if(null==this.getAuthenticationKey(tn))throw new X(tn.toString()+" is a invalid key");tu&&null!=tu?(ve.log.info("Try to publish[update] {}...",this.getSubject()),yield ll.getInstance().updateDid(this,tu,tn,to,ta)):(ve.log.info("Try to publish[create] {}...",this.getSubject()),yield ll.getInstance().createDid(this,tn,to,ta)),null!=tc&&this.getMetadata().setPreviousSignature(tc),this.getMetadata().setSignature(this.getProof().getSignature())})}deactivate(tn=null,to,ta=null){return A(this,void 0,void 0,function*(){if(qt(to&&null!=to,"Invalid storepass"),this.checkAttachedStore(),null==tn&&null==this.getDefaultPublicKeyId())throw new V("No effective controller of "+this.getSubject().toString());let tu=yield this.getSubject().resolve(!0);if(null==tu)throw new et(this.getSubject().toString()+" isn't found in the chain");if(yield tu.isDeactivated())throw new C(this.getSubject().toString()+" is deactivated");if(tu.getMetadata().attachStore(this.getStore()),tu.effectiveController=this.effectiveController,null==tn)tn=tu.getDefaultPublicKeyId();else if(tu.isCustomizedDid()){let to=this.getControllerDocument(tn.getDid());if(null==to||!tn.equals(to.getDefaultPublicKeyId()))throw new X(tn.toString()+" is a invalid key")}else if(!tn.equals(tu.getDefaultPublicKeyId())&&null==tu.getAuthorizationKey(tn))throw new X(tn.toString()+" is a invalid key");yield ll.getInstance().deactivateDid(tu,tn,to,ta)})}deactivateTargetDID(tn,to=null,ta,tu=null){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid target DID"),qt(ta&&null!=ta,"Invalid storepass"),this.checkAttachedStore(),null==to&&null==this.getDefaultPublicKeyId())throw new V("No effective controller of "+this.getSubject().toString());let tc=yield tn.resolve(!0);if(null==tc)throw new et(tn.toString()+" isn't found in the chain");if(yield tc.isDeactivated())throw new C(tn.toString()+" is deactivated");if(tc.getMetadata().attachStore(this.getStore()),tc.isCustomizedDid()){if(!tc.hasController(this.getSubject()))throw new q(this.getSubject().toString()+" isn't the controller of "+tc.getSubject().toString());if(null==to)to=this.getDefaultPublicKeyId();else if(!to.equals(this.getDefaultPublicKeyId()))throw new X(to.toString()+" isn't the default key");yield ll.getInstance().deactivateDid(tc,to,ta,tu)}else{if(0==tc.getAuthorizationKeyCount())throw new X("No authorization key from: "+tn);let th=null;if(null==to)th=this.getAuthenticationKeys();else{let tn=this.getAuthenticationKey(to);if(null==tn)throw new X(to.toString()+" isn't an authentication key");(th=[]).push(tn)}let td=null,tf=null;t:for(let tn of th)for(let to of tc.getAuthorizationKeys())if(to.getController().equals(this.getSubject())&&to.getPublicKeyBase58()===tn.getPublicKeyBase58()){td=tn.getId(),tf=to.getId();break t}if(null==td||null==tf)throw new X("No matched authorization key.");yield ll.getInstance().deactivateTargetDid(tc,tf,this,td,ta,tu)}})}static parseAsync(tn){return A(this,void 0,void 0,function*(){try{return yield Ft.deserializeAsync(tn,ve)}catch(tn){throw tn instanceof K?tn:new K(tn)}})}static _parseOnly(tn){qt(tn&&""!==tn,"Invalid JSON content");try{let to;to="string"==typeof tn?JSON.parse(tn):tn;let ta=new ve;return ta.fromJSONOnly(to),ta}catch(tn){throw tn instanceof K?tn:new K(tn)}}};ve.log=new T("DIDDocument"),ve.W3C_DID_CONTEXT="https://www.w3.org/ns/did/v1",ve.ELASTOS_DID_CONTEXT="https://ns.elastos.org/did/v1",ve.W3ID_SECURITY_CONTEXT="https://w3id.org/security/v1",function(tn){let i=class i extends Ft{constructor(tn=null,to=null,ta=null,tu=ne.DEFAULT_PUBLICKEY_TYPE){super(),this.id=tn,this.type=null!=tu?tu:ne.DEFAULT_PUBLICKEY_TYPE,this.controller=to,this.publicKeyBase58=ta}getId(){return this.id}getType(){return this.type}getController(){return this.controller}getPublicKeyBase58(){return this.publicKeyBase58}getPublicKeyBytes(){return ka.decode(this.publicKeyBase58)}equals(tn){return this==tn||this.getId().equals(tn.getId())&&this.getType()===tn.getType()&&this.getController().equals(tn.getController())&&this.getPublicKeyBase58()===tn.getPublicKeyBase58()}compareTo(tn){let to=this.id.compareTo(tn.id);return 0!=to?to:0!=(to=this.publicKeyBase58.localeCompare(tn.publicKeyBase58))?to:0!=(to=this.type.localeCompare(tn.type))?to:this.controller.compareTo(tn.controller)}toJSON(tn=null){let to=tn?new Jt(tn):null,ta={};return ta.id=this.id.toString(to),to&&this.type===ne.DEFAULT_PUBLICKEY_TYPE||(ta.type=this.type),to&&this.controller.equals(to)||(ta.controller=this.controller.toString()),ta.publicKeyBase58=this.publicKeyBase58,ta}fromJSON(tn,to=null){this.id=this.getDidUrl("publicKey.id",tn.id,{mandatory:!0,nullable:!1,context:to}),this.type=this.getString("publicKey.type",tn.type,{mandatory:!1,defaultValue:ne.DEFAULT_PUBLICKEY_TYPE}),this.controller=this.getDid("publicKey.controller",tn.controller,{mandatory:!1,nullable:!1,defaultValue:to}),this.publicKeyBase58=this.getString("publicKey.publicKeyBase58",tn.publicKeyBase58,{mandatory:!0,nullable:!1})}};tn.PublicKey=i,tn.Service=class extends Ft{constructor(tn=null,to=null,ta=null,tu){super(),this.id=tn,this.type=to,this.serviceEndpoint=ta,this.properties=tu?Mt(tu):{},Object.keys(this.properties).length>0&&(delete this.properties.id,delete this.properties.type,delete this.properties.serviceEndpoint)}getId(){return this.id}getType(){return this.type}getServiceEndpoint(){return this.serviceEndpoint}getProperties(){return Object.keys(this.properties).length>0?this.properties:null}equals(tn){return this==tn||this.getId().equals(tn.getId())&&this.getType()===tn.getType()&&this.getServiceEndpoint()===tn.getServiceEndpoint()}compareTo(tn){let to=this.id.compareTo(tn.id);return 0!=to?to:0!=(to=this.type.localeCompare(tn.type))?to:this.serviceEndpoint.localeCompare(tn.serviceEndpoint)}toJSON(tn=null){let to=tn?new Jt(tn):null,ta={};return ta.id=this.id.toString(to),ta.type=this.type,ta.serviceEndpoint=this.serviceEndpoint,Object.assign(Object.assign({},ta),this.properties)}fromJSON(tn,to=null){this.id=this.getDidUrl("service.id",tn.id,{mandatory:!0,nullable:!1,context:to}),this.type=this.getString("service.type",tn.type,{mandatory:!0,nullable:!1}),this.serviceEndpoint=this.getString("service.serviceEndpoint",tn.serviceEndpoint,{mandatory:!0,nullable:!1}),Object.keys(tn).length>3&&(this.properties=Mt(tn),delete this.properties.id,delete this.properties.type,delete this.properties.serviceEndpoint)}};let r=class r extends Ft{constructor(tn=null,to=null,ta=new Date,tu=ne.DEFAULT_PUBLICKEY_TYPE){super(),this.type=tu||ne.DEFAULT_PUBLICKEY_TYPE,this.created=void 0===ta?new Date:null!==ta?new Date(ta):null,this.created&&this.created.setMilliseconds(0),this.creator=tn,this.signature=to}equals(tn){return 0==this.compareTo(tn)}getType(){return this.type}getCreated(){return this.created}getCreator(){return this.creator}getSignature(){return this.signature}compareTo(tn){let to=this.created.getTime()-tn.created.getTime();return 0==to&&(to=this.creator.compareTo(tn.creator)),to}toJSON(tn=null){let to=tn?new Jt(tn):null,ta={};return to&&this.type===ne.DEFAULT_PUBLICKEY_TYPE||(ta.type=this.type),this.created&&(ta.created=this.dateToString(this.created)),ta.creator=this.creator.toString(to),ta.signatureValue=this.signature,ta}fromJSON(tn,to=null){this.type=this.getString("proof.type",tn.type,{mandatory:!1,defaultValue:ne.DEFAULT_PUBLICKEY_TYPE}),this.created=this.getDate("proof.created",tn.created,{mandatory:!1}),this.creator=this.getDidUrl("proof.creator",tn.creator,{mandatory:!0,nullable:!1,context:to}),this.signature=this.getString("proof.signatureValue",tn.signatureValue,{mandatory:!0,nullable:!1})}};tn.Proof=r;let n=class n{constructor(tn,to){this.apply(tn,to)}static fromString(tn){if(!tn||null==tn)throw new P("Invalid multisig spec");let to=tn.split(":");if(null==to||2!=to.length)throw new P("Invalid multisig spec");return new n(Number.parseInt(to[0]),Number.parseInt(to[1]))}static newFromMultiSignature(tn){return new n(tn.m(),tn.n())}apply(tn,to){qt(to>0,"Invalid multisig spec: n should > 0"),qt(tn>0&&tn<=to,"Invalid multisig spec: m should > 0 and <= n"),this.mv=tn,this.nv=to}m(){return this.mv}n(){return this.nv}equals(tn){return this==tn||this.mv==tn.mv&&this.nv==tn.nv}toString(){return this.mv.toString()+":"+this.nv.toString()}};n.ONE_OF_ONE=new n(1,1),tn.MultiSignature=n;let o=class o{constructor(){}static newFromDID(to,ta,tu){let tc=new o;if(tc.document=new tn(to),Gt.isEnabledJsonLdContext()&&tc.addDefaultContexts(),tc.sourceDocument=tc.document,void 0!==tu)tc.document.controllers=[],tc.document.controllerDocs=new le,tc.document.controllers.push(tu.getSubject()),tc.document.controllerDocs.set(tu.getSubject(),tu),tc.document.effectiveController=tu.getSubject(),tc.document.setMetadata(new Kt(to,ta)),tc.controllerDoc=tu;else{let tn=new Kt(to,ta);tc.document.setMetadata(tn)}return tc}static newFromDocument(tn,to){let ta=new o;return ta.sourceDocument=tn,ta.document=tn.copy(),void 0!==to&&(ta.document.effectiveController=to.getSubject(),ta.controllerDoc=to),ta}edit(tn){if(void 0!==tn){if(this.document.checkIsCustomized(),!this.document.getMetadata().attachedStore()&&!tn.getMetadata().attachedStore())throw new z("Not attach with did store");if(tn.getMetadata().attachedStore()?this.document.getMetadata().attachStore(tn.getMetadata().getStore()):tn.getMetadata().attachStore(this.document.getMetadata().getStore()),!this.sourceDocument.hasController(tn.getSubject()))throw new q(tn.getSubject().toString()+" isn't the controller of "+this.sourceDocument.getSubject().toString());return this.document.effectiveController=tn.getSubject(),this.controllerDoc=tn,this}if(this.document.isCustomizedDid()){if(null==this.sourceDocument.getEffectiveController())throw new V("Unable to edit a customized DIDDocument without effective controller");return this.edit(this.sourceDocument.getEffectiveControllerDocument())}return this.document.checkAttachedStore(),this}canonicalId(tn){return"string"==typeof tn?Xt.from(tn,this.getSubject()):null==tn||null!=tn.getDid()?tn:Xt.from(tn,this.getSubject())}invalidateProof(){null!=this.document.proofs&&0!=this.document.proofs.size&&this.document.proofs.clear()}checkNotSealed(){if(null==this.document)throw new rt(this.getSubject().toString()+" is already sealed")}checkIsCustomized(){if(!this.document.isCustomizedDid())throw new U(this.document.getSubject().toString()+"isn't a customized did")}addDefaultContexts(){return Gt.isEnabledJsonLdContext()?(null==this.document.context&&(this.document.context=[]),this.document.context.includes(tn.W3C_DID_CONTEXT)||this.document.context.push(tn.W3C_DID_CONTEXT),this.document.context.includes(tn.ELASTOS_DID_CONTEXT)||this.document.context.push(tn.ELASTOS_DID_CONTEXT),this.document.context.includes(tn.W3ID_SECURITY_CONTEXT)||this.document.context.push(tn.W3ID_SECURITY_CONTEXT)):tk.warn("JSON-LD context support not enabled"),this}addContext(tn){return Gt.isEnabledJsonLdContext()?(null==this.document.context&&(this.document.context=[]),this.document.context.includes(tn)||this.document.context.push(tn)):tk.warn("JSON-LD context support not enabled"),this}getSubject(){return this.checkNotSealed(),this.document.getSubject()}addController(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid controller"),"string"==typeof tn&&(tn=Jt.from(tn)),this.checkNotSealed(),this.checkIsCustomized(),qt(!this.document.controllers.includes(tn),"Controller already exists");let to=yield tn.resolve(!0);if(null==to)throw new et(tn.toString()+" isn't found in the chain");if(yield to.isDeactivated())throw new C(tn.toString()+" is deactivated");if(to.isExpired())throw new ut(tn.toString()+" is expired");if(!to.isGenuine())throw new lt(tn.toString()+" isn't genuine");if(to.isCustomizedDid())throw new B(tn.toString()+"is a customized did");return this.document.controllers.push(tn),this.document.controllerDocs.set(tn,to),this.document.multisig=null,this.invalidateProof(),this})}removeController(tn){if(qt(null!=tn,"Invalid controller"),"string"==typeof tn&&(tn=Jt.from(tn)),this.checkNotSealed(),this.checkIsCustomized(),tn.equals(this.controllerDoc.getSubject()))throw new pt(tn.toString());let to=this.document.controllers.findIndex(to=>to.equals(tn));return -1!=to&&(this.document.controllers.splice(to,1),this.document.controllerDocs.delete(tn),this.document.multisig=null,this.invalidateProof()),this}setMultiSignature(tn){this.checkNotSealed(),this.checkIsCustomized(),qt(tn>=1,"Invalid signature count");let to=this.document.controllers.length;qt(tn<=to,"Signature count exceeds the upper limit");let ta=null;return to>1&&(ta=new n(tn,to)),null==this.document.multisig&&null==ta||null!=this.document.multisig&&null!=ta&&this.document.multisig.equals(ta)||(this.document.multisig=new n(tn,to),this.invalidateProof()),this}addPublicKey(tn){if(null==this.document.publicKeys)this.document.publicKeys=new le,this.document.authenticationKeys=new le,this.document.authorizationKeys=new le;else for(let to of this.document.publicKeys.values()){if(to.getId().equals(tn.getId()))throw new ht("PublicKey id '"+tn.getId()+"' already exist.");if(to.getPublicKeyBase58()===tn.getPublicKeyBase58())throw new ht("PublicKey '"+tn.getPublicKeyBase58()+"' already exist.")}this.document.publicKeys.set(tn.getId(),tn),null==this.document.defaultPublicKey&&Na.toAddress(tn.getPublicKeyBytes())===this.getSubject().getMethodSpecificId()&&(this.document.defaultPublicKey=tn,this.document.authenticationKeys.set(tn.getId(),tn)),this.invalidateProof()}createAndAddPublicKey(tn,to,ta,tu="ECDSAsecp256r1"){return this.checkNotSealed(),"string"==typeof tn&&(tn=this.canonicalId(tn)),void 0===ta?ta=null:"string"==typeof ta&&(ta=Jt.from(ta)),qt(null!=tn&&(null==tn.getDid()||tn.getDid().equals(this.getSubject())),"Invalid publicKey id"),qt(to&&null!=to,"Invalid publicKey"),null==ta&&(ta=this.getSubject()),this.addPublicKey(new i(this.canonicalId(tn),ta,to,tu)),this}removePublicKey(tn,to=!1){return A(this,void 0,void 0,function*(){if(this.checkNotSealed(),qt(null!=tn,"Invalid publicKey id"),null==this.document.publicKeys||0==this.document.publicKeys.size)throw new ft(this.getSubject().toString()+" has no any publickey");tn=this.canonicalId(tn);let ta=this.document.publicKeys.get(tn);if(null==ta)throw new ft("No key "+tn.toString());if(null!=this.document.defaultPublicKey&&this.document.defaultPublicKey.getId().equals(tn))throw new yt(tn.toString()+"is default key");if(!to&&(this.document.authenticationKeys.has(ta.getId())||this.document.authorizationKeys.has(ta.getId())))throw new yt(tn.toString());if(this.document.publicKeys.delete(tn)){this.document.authenticationKeys.delete(tn),this.document.authorizationKeys.delete(tn);try{this.document.getMetadata().attachedStore()&&(yield this.document.getMetadata().getStore().deletePrivateKey(tn))}catch(tn){o.log.error("INTERNAL - Remove private key",tn)}this.invalidateProof()}return this})}addExistingAuthenticationKey(tn){if(qt(null!=tn,"Invalid publicKey id"),null==this.document.publicKeys||0==this.document.publicKeys.size)throw new ft(this.getSubject().toString()+" has no any publickey");tn=this.canonicalId(tn);let to=this.document.publicKeys.get(tn);if(null==to)throw new ft("No key "+tn.toString());if(!to.getController().equals(this.getSubject()))throw new dt(tn.toString()+" isn't the self key, so it can't to be authentaication key");return this.document.authenticationKeys.has(tn)||(this.document.authenticationKeys.set(tn,to),this.invalidateProof()),this}addAuthenticationKey(tn,to){this.checkNotSealed(),qt(null!=tn,"Invalid publicKey id"),"string"==typeof tn&&(tn=this.canonicalId(tn)),qt(null!=tn&&(null==tn.getDid()||tn.getDid().equals(this.getSubject())),"Invalid publicKey id"),qt(to&&null!=to,"Invalid publicKey");let ta=new i(this.canonicalId(tn),this.getSubject(),to);return this.addPublicKey(ta),this.document.authenticationKeys.set(tn,ta),this}removeAuthenticationKey(tn){if(this.checkNotSealed(),qt(null!=tn,"Invalid publicKey id"),null==this.document.publicKeys||0==this.document.publicKeys.size)throw new ft(this.getSubject().toString()+" has no any publickey");tn=this.canonicalId(tn);let to=this.document.publicKeys.get(tn);if(null==to||!this.document.authenticationKeys.has(to.getId()))throw new ft("No key "+tn.toString());if(null!=this.document.defaultPublicKey&&this.document.defaultPublicKey.getId().equals(tn))throw new yt("Cannot remove the default PublicKey from authentication.");if(!this.document.authenticationKeys.has(tn))throw new ft("No key "+tn.toString());return this.document.authenticationKeys.delete(tn),this.invalidateProof(),this}addExistingAuthorizationKey(tn){if(this.checkNotSealed(),qt(null!=tn,"Invalid publicKey id"),this.document.isCustomizedDid())throw new B(this.getSubject().toString()+"is a customized did");if(null==this.document.publicKeys||0==this.document.publicKeys.size)throw new ft(this.getSubject().toString()+" has no any publickey");tn=this.canonicalId(tn);let to=this.document.publicKeys.get(tn);if(null==to)throw new ft("No key "+tn.toString());if(to.getController().equals(this.getSubject()))throw new dt("Self key can't be authorization key");return this.document.authorizationKeys.has(tn)||(this.document.authorizationKeys.set(tn,to),this.invalidateProof()),this}addAuthorizationKey(tn,to,ta){if(this.checkNotSealed(),qt(null!=tn,"Invalid publicKey id"),"string"==typeof tn&&(tn=this.canonicalId(tn)),"string"==typeof to&&(to=Jt.from(to)),qt(null==tn.getDid()||tn.getDid().equals(this.getSubject()),"Invalid publicKey id"),qt(ta&&null!=ta,"Invalid publicKey"),this.document.isCustomizedDid())throw new B(this.getSubject().toString()+"is a customized did");if(to.equals(this.getSubject()))throw new dt("Key's controller is self.");let tu=new i(this.canonicalId(tn),to,ta);return this.addPublicKey(tu),this.document.authorizationKeys.set(tn,tu),this}authorizeDid(tn,to,ta){return A(this,void 0,void 0,function*(){if(this.checkNotSealed(),qt(null!=tn&&(null==tn.getDid()||tn.getDid().equals(this.getSubject())),"Invalid publicKey id"),qt(null!=to&&!to.equals(this.getSubject()),"Invalid controller"),this.document.isCustomizedDid())throw new B(this.getSubject().toString()+"is a customized did");let tu=yield to.resolve();if(null==tu)throw new et(tn.toString()+" isn't found in the chain");if(yield tu.isDeactivated())throw new C(to.toString()+" is deactivated");if(tu.isExpired())throw new ut(to.toString()+" is expired");if(!tu.isGenuine())throw new lt(to.toString()+" isn't genuine");if(tu.isCustomizedDid())throw new B(to.toString()+"is a customized did");null==ta&&(ta=tu.getDefaultPublicKeyId());let tc=tu.getAuthenticationKey(ta);if(null==tc)throw new ft("No authentication key "+ta.toString());let th=new i(this.canonicalId(tn),to,tc.getPublicKeyBase58(),tc.getType());return this.addPublicKey(th),this.document.authorizationKeys.set(tn,th),this})}removeAuthorizationKey(tn){this.checkNotSealed(),qt(null!=tn,"Invalid publicKey id");let to="string"==typeof tn?this.canonicalId(tn):tn;if(null==this.document.publicKeys||0==this.document.publicKeys.size)throw new ft(this.getSubject().toString()+" has no any publickey");if(to=this.canonicalId(to),null==this.document.publicKeys.get(to))throw new ft("No key "+to.toString());if(!this.document.authorizationKeys.has(to))throw new ft("No authorization key "+to.toString());return this.document.authorizationKeys.delete(to),this.invalidateProof(),this}addCredential(tn){return A(this,void 0,void 0,function*(){if(this.checkNotSealed(),qt(null!=tn,"Invalid credential"),!tn.getSubject().getId().equals(this.getSubject()))throw new dt("Credential "+tn.getSubject().getId().toString()+" doesn't belong to DID"+this.getSubject().toString());if(!(tn.isSelfProclaimed()?tn.isGenuineInternal(this.document):yield tn.isGenuine()))throw new H(tn.getId().toString());return this.addCredentialUncheck(tn)})}addCredentialUncheck(tn){if(null==this.document.credentials)this.document.credentials=new le;else if(this.document.credentials.has(tn.getId()))throw new ht("Credential "+tn.getId().toString()+"already exists in the document");return this.document.credentials.set(tn.getId(),tn),this.invalidateProof(),this}createAndAddCredential(tn,to,ta=null,tu=[],tc=null){return A(this,void 0,void 0,function*(){this.checkNotSealed(),qt(null!=to,"Invalid publicKey id"),"string"==typeof to&&(to=this.canonicalId(to)),qt(null!=to,"Invalid publicKey id"),qt(null==to.getDid()||to.getDid().equals(this.getSubject()),"Invalid publicKey id"),qt(tn&&null!=tn,"Invalid storepass");let th=(yield Ve.create(this.document)).issueFor(this.document.getSubject());null==tc&&(tc=this.document.getExpires());try{let td=yield th.id(this.canonicalId(to)).types(...tu).properties(ta).expirationDate(tc).seal(tn);return this.addCredentialUncheck(td)}catch(tn){throw new M(tn)}})}removeCredential(tn){if(this.checkNotSealed(),qt(null!=tn,"Invalid credential id"),null==this.document.credentials||0==this.document.credentials.size)throw new ft(this.getSubject().toString()+" has no any credential");if(!this.document.credentials.delete(this.canonicalId(tn)))throw new ft("No credential "+tn.toString());return this.invalidateProof(),this}addService(to,ta,tu,tc){this.checkNotSealed(),qt(null!=to,"Invalid publicKey id"),"string"==typeof to&&(to=this.canonicalId(to)),qt(null!=to&&(null==to.getDid()||to.getDid().equals(this.getSubject())),"Invalid publicKey id"),qt(ta&&null!=ta,"Invalid type"),qt(tu&&null!=tu,"Invalid endpoint");let th=new tn.Service(this.canonicalId(to),ta,tu,tc);if(null==this.document.services)this.document.services=new le;else if(this.document.services.has(th.getId()))throw new ht("Service '"+th.getId()+"' already exist.");return this.document.services.set(th.getId(),th),this.invalidateProof(),this}removeService(tn){if(this.checkNotSealed(),qt(null!=tn,"Invalid credential id"),"string"==typeof tn&&(tn=this.canonicalId(tn)),null==this.document.services||0==this.document.services.size)throw new ft(tn.toString()+" has no any service");if(!this.document.services.delete(this.canonicalId(tn)))throw new ft("No service "+tn.toString());return this.invalidateProof(),this}getMaxExpires(){return tw().add(ne.MAX_VALID_YEARS,"years").toDate()}setDefaultExpires(){return this.checkNotSealed(),this.document.expires=this.getMaxExpires(),this.document.expires&&this.document.expires.setMilliseconds(0),this.invalidateProof(),this}setExpires(tn){if(this.checkNotSealed(),qt(null!=tn,"Invalid expires"),tn.setMilliseconds(0),tw(tn).isAfter(this.getMaxExpires()))throw new P("Invalid expires, out of range.");return this.document.expires=tn,this.invalidateProof(),this}removeProof(tn){if(this.checkNotSealed(),qt(null!=tn,"Invalid controller"),null==this.document.proofs||0==this.document.proofs.size)return this;if(null==this.document.proofs.delete(tn))throw new ft("No proof signed by: "+tn);return this}sanitize(){if(this.document.isCustomizedDid()){if(null==this.document.controllers||0==this.document.controllers.length)throw new K("Missing controllers");if(this.document.controllers.length>1){if(null==this.document.multisig)throw new K("Missing multisig");if(this.document.multisig.n()!=this.document.controllers.length)throw new K("Invalid multisig, not matched with controllers")}else if(null!=this.document.multisig)throw new K("Invalid multisig")}null!=this.document.context&&0!=this.document.context.length||(this.document.context=[]);let tn=null==this.document.multisig?1:this.document.multisig.m();if(null!=this.document.proofs&&this.document.proofs.size==tn)throw new rt(this.getSubject().toString()+" is already sealed");null==this.document.controllers||0==this.document.controllers.length?(this.document.controllers=[],this.document.controllerDocs=new le):ae.sort(this.document.controllers),null!=this.document.publicKeys&&0!=this.document.publicKeys.size||(this.document.publicKeys=new le,this.document.authenticationKeys=new le,this.document.authorizationKeys=new le),null==this.document.credentials&&(this.document.credentials=new le),null==this.document.services&&(this.document.services=new le),null!=this.document.proofs&&0!=this.document.proofs.size||null==this.document.getExpires()&&this.setDefaultExpires(),null==this.document.proofs&&(this.document.proofs=new le)}seal(tn){return A(this,void 0,void 0,function*(){this.checkNotSealed(),qt(tn&&null!=tn,"Invalid storepass"),this.sanitize();let to=this.document.isCustomizedDid()?this.controllerDoc:this.document,ta=to.getDefaultPublicKeyId();if(this.document.proofs.has(to.getSubject()))throw new Y(to.getSubject().toString()+" already signed");let tu=this.document.proofs;this.document.proofs=null;let tc=this.document.serialize(!0);this.document.proofs=tu;let td=yield this.document.signWithId(ta,tn,th.Buffer.from(tc)),tf=new r(ta,td);this.document.proofs.set(tf.getCreator().getDid(),tf);let tp=this.document;return this.document=null,tp})}};o.log=new T("DIDDocumentBuilder"),tn.Builder=o}(ve||(ve={}));let tN=new T("RootIdentity");let we=class we{constructor(){}static newFromMnemonic(tn,to){let ta=new we;return ta.mnemonic=tn,null==to&&(to=""),ta.rootPrivateKey=Na.newWithMnemonic(tn,to),ta.preDerivedPublicKey=ta.rootPrivateKey.deriveWithPath(Na.PRE_DERIVED_PUBLICKEY_PATH),ta.index=0,ta}static newFromPrivateKey(tn){let to=new we;return to.rootPrivateKey=tn,to.preDerivedPublicKey=tn.deriveWithPath(Na.PRE_DERIVED_PUBLICKEY_PATH),to.index=0,to}static newFromPreDerivedPublicKey(tn,to){let ta=new we;return ta.preDerivedPublicKey=tn,ta.index=to,ta}static getIdFromMnemonic(tn,to){return this.newFromMnemonic(tn,to).getId()}static createFromMnemonic(tn,to,ta,tu,tc=!1){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid mnemonic"),qt(null!=ta,"Invalid DID store"),qt(null!=tu&&""!==tu,"Invalid storepass");try{qt(Fa.checkIsValid(tn),"Invalid mnemonic.")}catch(tn){throw new P(tn)}null==to&&(to="");let th=we.newFromMnemonic(tn,to);if((yield ta.containsRootIdentity(th.getId()))&&!tc)throw new L(th.getId()+" already exist");return th.setMetadata(new we.Metadata(th.getId(),ta)),yield ta.storeRootIdentity(th,tu),th.wipe(),th})}static createFromPrivateKey(tn,to,ta,tu=!1){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid extended private key"),qt(null!=to,"Invalid DID store"),qt(null!=ta&&""!==ta,"Invalid storepass");let tc=Na.deserializeBase58(tn),th=we.newFromPrivateKey(tc);if((yield to.containsRootIdentity(th.getId()))&&!tu)throw new L(th.getId()+" already exist");return th.setMetadata(new we.Metadata(th.getId(),to)),yield to.storeRootIdentity(th,ta),th.wipe(),th})}static createFromPreDerivedPublicKey(tn,to){let ta=null==tn?null:Na.deserializeBase58(tn);return we.newFromPreDerivedPublicKey(ta,to)}wipe(){this.rootPrivateKey.wipe(),this.mnemonic=null,this.rootPrivateKey=null}getStore(){return this.metadata.getStore()}setMetadata(tn){this.metadata=tn}static getId(tn){return qt(null!=tn&&tn.length>0,"Invalid key bytes"),td.createHash("md5").update(tn.toString("hex"),"hex").digest("hex")}getId(){return null==this.id&&(this.id=we.getId(this.preDerivedPublicKey.serializePublicKey())),this.id}getAlias(){return this.metadata.getAlias()}setAlias(tn){this.metadata.setAlias(tn)}setAsDefault(){return A(this,void 0,void 0,function*(){yield this.getStore().setDefaultRootIdentity(this)})}getDefaultDid(){let tn=this.metadata.getDefaultDid();return null==tn?this.getDid(0):tn}setDefaultDid(tn){tn instanceof Jt?this.metadata.setDefaultDid(tn):this.metadata.setDefaultDid(Jt.from(tn))}setDefaultDidByIndex(tn){qt(tn>=0,"Invalid index"),this.metadata.setDefaultDid(this.getDid(tn))}getMnemonic(){return this.mnemonic}getRootPrivateKey(){return this.rootPrivateKey}getPreDerivedPublicKey(){return this.preDerivedPublicKey}getIndex(){return this.index}setIndex(tn){return A(this,void 0,void 0,function*(){this.index=tn,yield this.getStore().storeRootIdentity(this)})}incrementIndex(){return A(this,void 0,void 0,function*(){let tn=++this.index;return yield this.getStore().storeRootIdentity(this),tn})}getDid(tn){qt(tn>=0,"Invalid index");let to=this.preDerivedPublicKey.deriveWithIndex(0).deriveWithIndex(tn);return new Jt(Jt.METHOD,to.getAddress())}getDidFromIdentifier(tn,to=0){let ta=this.preDerivedPublicKey.deriveWithPath(this.mapToDerivePath(tn,to,!0));return new Jt(Jt.METHOD,ta.getAddress())}static lazyCreateDidPrivateKey(tn,to,ta){return A(this,void 0,void 0,function*(){let tu=yield to.loadDid(tn.getDid());if(null==tu)throw tN.error("INTERNAL - Missing document for DID: {}",tn.getDid()),new R("Missing document for DID: "+tn.getDid());let tc=tu.getMetadata().getRootIdentityId();if(null==tc)return null;let th=yield to.derive(tc,Na.DERIVE_PATH_PREFIX+tu.getMetadata().getIndex(),ta),td=tu.getPublicKey(tn);if(null==td)throw tN.error("INTERNAL - Invalid public key: {}",tn),new R("Invalid public key: "+tn);if(th.getPublicKeyBase58()!==td.getPublicKeyBase58())throw tN.error("INTERNAL - Invalid DID metadata: {}",tn.getDid()),new R("Invalid DID metadata: "+tn.getDid());let tf=th.serialize();return yield to.storePrivateKey(tn,tf,ta),tf})}mapToDerivePath(tn,to,ta=!1){let tu,tc=We.encodeToBuffer(tD.from(tn,"utf-8")),th=qe.wrap(tc);for(tu=ta?"m/":"";th.hasRemaining();){let tn=th.readInt();tu=tu.concat((2147483647&tn).toString()).concat("/")}return tu.concat((2147483647&to).toString())}newDid(tn,to,ta=!1){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid storepass");let tu=!1;void 0===to&&(to=this.getIndex(),tu=!0),qt(to>=0,"Invalid index");let tc=this.getDid(to),th=yield this.getStore().loadDid(tc);if(null!=th){if(yield th.isDeactivated())throw new C(tc.toString()+" is deactivated");if(!ta)throw new F("DID already exists in the store.")}try{if(th=yield tc.resolve(),null!=th){if(yield th.isDeactivated())throw new C(tc.toString()+" is deactivated");if(!ta)throw new F("DID already published.")}}catch(tn){if(tn instanceof k&&!ta)throw tn}tN.debug("Creating new DID {} at index {}...",tc.toString(),to);let td=yield this.getStore().derive(this.getId(),Na.DERIVE_PATH_PREFIX+to,tn);try{let ta=Xt.from("#primary",tc);yield this.getStore().storePrivateKey(ta,td.serialize(),tn);let tf=ve.Builder.newFromDID(tc,this.getStore());return tf.addAuthenticationKey(ta,td.getPublicKeyBase58()),(th=yield tf.seal(tn)).getMetadata().setRootIdentityId(this.getId()),th.getMetadata().setIndex(to),th.getMetadata().attachStore(this.getStore()),yield this.getStore().storeDid(th),tu&&(yield this.incrementIndex()),th}catch(tn){throw new M(tn)}finally{td.wipe()}})}newDidFromIdentifier(tn,to,ta=0,tu=!1){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid storepass"),qt(null!=to&&""!==to,"Invalid identifier");let tc=Na.PRE_DERIVED_PUBLICKEY_PATH+"/"+this.mapToDerivePath(to,ta),th=yield this.getStore().derive(this.getId(),tc,tn),td=new Jt(Jt.METHOD,th.getAddress()),tf=yield this.getStore().loadDid(td);if(null!=tf){if(yield tf.isDeactivated())throw new C(td.toString()+" is deactivated");if(!tu)throw new F("DID already exists in the store.")}try{if(tf=yield td.resolve(),null!=tf){if(yield tf.isDeactivated())throw new C(td.toString()+" is deactivated");if(!tu)throw new F("DID already published.")}}catch(tn){if(tn instanceof k&&!tu)throw tn}tN.debug("Creating new DID {} with iden {}...",td.toString(),ta);try{let tu=Xt.from("#primary",td);yield this.getStore().storePrivateKey(tu,th.serialize(),tn);let tc=ve.Builder.newFromDID(td,this.getStore());return tc.addAuthenticationKey(tu,th.getPublicKeyBase58()),(tf=yield tc.seal(tn)).getMetadata().setRootIdentityId(this.getId()),tf.getMetadata().setExtra("application",to),tf.getMetadata().setExtra("securityCode",ta),tf.getMetadata().attachStore(this.getStore()),yield this.getStore().storeDid(tf),tf}catch(tn){throw new M(tn)}finally{th.wipe()}})}hasMnemonic(){return A(this,void 0,void 0,function*(){return yield this.getStore().containsRootIdentityMnemonic(this.getId())})}exportMnemonic(tn){return A(this,void 0,void 0,function*(){return qt(null!=tn&&""!==tn,"Invalid storepass"),yield this.getStore().exportRootIdentityMnemonic(this.getId(),tn)})}synchronizeIndex(tn,to=null){return A(this,void 0,void 0,function*(){qt(tn>=0,"Invalid index"),null==to&&(to=Ma.getInstance());let ta=this.getDid(tn);tN.info("Synchronize {}/{}...",ta.toString(),tn);let tu=yield ta.resolve(!0);if(null==tu)return tN.info("Synchronize {}/{}...not exists",ta.toString(),tn),!1;tN.debug("Synchronize {}/{}..exists, got the on-chain copy.",ta.toString(),tn);let tc=tu,th=yield this.getStore().loadDid(ta);if(null!=th){if(th.getMetadata().detachStore(),th.getSignature()===tu.getSignature()||null!=th.getMetadata().getSignature()&&th.getProof().getSignature()===th.getMetadata().getSignature())tc.getMetadata().merge(th.getMetadata());else{if(tN.debug("{} on-chain copy conflict with local copy.",ta.toString()),null==(tc=to.merge(tu,th))||!tc.getSubject().equals(ta))throw tN.error("Conflict handle merge the DIDDocument error."),new R("deal with local modification error.");tN.debug("Conflict handle return the final copy.")}}let td=tc.getMetadata();return td.setPublished(tu.getMetadata().getPublished()),td.setSignature(tu.getProof().getSignature()),tu.getMetadata().isDeactivated()&&td.setDeactivated(!0),td.setRootIdentityId(this.getId()),td.setIndex(tn),null!=th&&th.getMetadata().attachStore(this.getStore()),yield this.getStore().storeDid(tc),yield this.getStore().storeLazyPrivateKey(tc.getDefaultPublicKeyId()),!0})}synchronize(tn=null){return A(this,void 0,void 0,function*(){tN.info("Synchronize root identity {}...",this.getId());let to=this.getIndex()-1,ta=0,tu=0;for(;tu<to||ta<20;)(yield this.synchronizeIndex(tu,tn))?(tu>to&&(to=tu),ta=0):tu>to&&ta++,tu++;to>=this.getIndex()&&(yield this.setIndex(to+1))})}};!function(tn){let e=class e extends jt{constructor(tn=null,to=null){super(to),this.id=tn}setId(tn){this.id=tn}setDefaultDid(tn){this.put(e.DEFAULT_DID,tn.toString())}getDefaultDid(){return Jt.from(this.get(e.DEFAULT_DID))}save(){return A(this,void 0,void 0,function*(){if(this.attachedStore())try{yield this.getStore().storeRootIdentityMetadata(this.id,this)}catch(tn){throw tn instanceof R&&tN.error("INTERNAL - error store metadata for credential {}",this.id),tn}})}static parse(tn,to=null){try{return Ft.deserialize(tn,e,to)}catch(tn){throw tn instanceof Tt?tn:new Tt(tn)}}};e.DEFAULT_DID="defaultDid",tn.Metadata=e}(we||(we={}));let tF=new T("FileSystemStorage");let be=class be{constructor(tn){this.storeRoot=new La(tn),this.currentDataDir=be.DATA_DIR}init(){return A(this,void 0,void 0,function*(){this.storeRoot.exists()?this.checkStore():this.initializeStore()})}initializeStore(){try{tF.debug("Initializing DID store at {}",this.storeRoot.getAbsolutePath()),this.storeRoot.createDirectory();let tn=new Ut;this.getFile(!0,this.currentDataDir,be.METADATA).writeText(tn.serialize())}catch(tn){throw tF.error("Initialize DID store error",tn),new St('Initialize DIDStore "'+this.storeRoot.getAbsolutePath()+'" error.',tn)}}checkStore(){if(tF.debug("Checking DID store at {}",this.storeRoot.getAbsolutePath()),this.storeRoot.isFile())throw tF.error("Path {} not a directory",this.storeRoot.getAbsolutePath()),new St('Invalid DIDStore "'+this.storeRoot.getAbsolutePath()+'".');this.postOperations();let tn=this.getDir(this.currentDataDir);if(!tn.exists()){let tn=this.storeRoot.list();if(null==tn||0==tn.length)return void this.initializeStore();throw tF.error("Path {} cannot be initialized as DID Store because it's not empty",this.storeRoot.getAbsolutePath()),new St("Path cannot be initialized as DID Store because it's not empty \""+this.storeRoot.getAbsolutePath()+'".')}if(!tn.isDirectory())throw tF.error("Path {} is not a DID store, missing data directory",this.storeRoot.getAbsolutePath()),new St('Invalid DIDStore "'+this.storeRoot.getAbsolutePath()+'".');let to=this.getFile(!1,this.currentDataDir,be.METADATA);if(!to.exists()||!to.isFile())throw tF.error("Path {} not a DID store, missing store metadata",this.storeRoot.getAbsolutePath()),new St('Invalid DIDStore "'+this.storeRoot.getAbsolutePath()+'".');try{let tn=to.readText(),ta=Ut.parse(tn);if(ta.getType()!==Ut.DID_STORE_TYPE)throw new St("Unknown DIDStore type");if(ta.getVersion()!=Ut.DID_STORE_VERSION)throw new St("Unsupported DIDStore version")}catch(tn){throw tF.error("Check DID store error, failed load store metadata",tn),new St("Can not check the store metadata",tn)}}static toPath(tn){return tn.toString(tn.getDid()).replace(";","+").replace("/","~").replace("?","!")}static toDIDURL(tn,to){return to=to.replace("+",";").replace("~","/").replace("!","?"),Xt.from(to,tn)}static copyFile(tn,to){to.writeText(tn.readText())}getFile(tn,...to){let ta=null,tu=this.storeRoot.getAbsolutePath();for(let tn of to)tu+=La.SEPARATOR+tn;return ta=new La(tu),tn&&ta.getParentDirectory().createDirectory(),ta}getDir(...tn){let to=this.storeRoot.getAbsolutePath()+La.SEPARATOR+tn.join(La.SEPARATOR);return new La(to)}getLocation(){return this.storeRoot.toString()}getStoreRoot(){return this.storeRoot}storeMetadata(tn){return A(this,void 0,void 0,function*(){try{let to=this.getFile(!0,this.currentDataDir,be.METADATA);null==tn||tn.isEmpty()?to.delete():to.writeText(tn.serialize())}catch(tn){throw new St("Store DIDStore metadata error",tn)}})}loadMetadata(){return A(this,void 0,void 0,function*(){try{let tn=this.getFile(!1,this.currentDataDir,be.METADATA),to=null;return tn.exists()&&(to=Ut.parse(tn.readText())),to}catch(tn){throw new St("Load DIDStore metadata error",tn)}})}getRootIdentityFile(tn,to,ta){return this.getFile(ta,this.currentDataDir,be.ROOT_IDENTITIES_DIR,tn,to)}getRootIdentityDir(tn){return this.getDir(this.currentDataDir,be.ROOT_IDENTITIES_DIR,tn)}storeRootIdentityMetadata(tn,to){return A(this,void 0,void 0,function*(){try{let ta=this.getRootIdentityFile(tn,be.METADATA,!0);null==to||to.isEmpty()?ta.delete():ta.writeText(to.serialize())}catch(to){throw new St("Store root identity metadata error: "+tn,to)}})}loadRootIdentityMetadata(tn){return A(this,void 0,void 0,function*(){try{let to=this.getRootIdentityFile(tn,be.METADATA,!1),ta=null;return to.exists()&&(ta=we.Metadata.parse(to.readText())),ta}catch(to){throw new St("Load root identity metadata error: "+tn,to)}})}storeRootIdentity(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){try{null!=to&&this.getRootIdentityFile(tn,be.ROOT_IDENTITY_MNEMONIC_FILE,!0).writeText(to),null!=ta&&this.getRootIdentityFile(tn,be.ROOT_IDENTITY_PRIVATEKEY_FILE,!0).writeText(ta),null!=tu&&this.getRootIdentityFile(tn,be.ROOT_IDENTITY_PUBLICKEY_FILE,!0).writeText(tu),this.getRootIdentityFile(tn,be.ROOT_IDENTITY_INDEX_FILE,!0).writeText(tc.toFixed())}catch(to){throw new St("Store root identity error: "+tn,to)}})}loadRootIdentity(tn){return A(this,void 0,void 0,function*(){try{let to=this.getRootIdentityFile(tn,be.ROOT_IDENTITY_PUBLICKEY_FILE,!1);if(!to.exists())return null;let ta=to.readText();to=this.getRootIdentityFile(tn,be.ROOT_IDENTITY_INDEX_FILE,!1);let tu=Number.parseInt(to.readText());return we.createFromPreDerivedPublicKey(ta,tu)}catch(to){throw new St("Load public key for identity error: "+tn,to)}})}containsRootIdentity(tn){return A(this,void 0,void 0,function*(){return this.getRootIdentityDir(tn).exists()})}updateRootIdentityIndex(tn,to){return A(this,void 0,void 0,function*(){try{this.getRootIdentityFile(tn,be.ROOT_IDENTITY_INDEX_FILE,!1).writeText(""+to)}catch(to){throw new St("Update index for indentiy error: "+tn,to)}})}loadRootIdentityPrivateKey(tn){return A(this,void 0,void 0,function*(){try{let to=this.getRootIdentityFile(tn,be.ROOT_IDENTITY_PRIVATEKEY_FILE,!1);return to.exists()?to.readText():null}catch(to){throw new St("Load private key for identity error: "+tn,to)}})}deleteRootIdentity(tn){return A(this,void 0,void 0,function*(){let to=this.getRootIdentityDir(tn);return!!to.exists()&&(to.delete(),!0)})}listRootIdentities(){return A(this,void 0,void 0,function*(){let tn=this.getDir(this.currentDataDir,be.ROOT_IDENTITIES_DIR);if(!tn.exists())return[];let to=tn.listFiles().filter(tn=>{if(!tn.isDirectory())return!1;let to=new La(tn,be.ROOT_IDENTITY_PRIVATEKEY_FILE);return to.exists()&&to.isFile()});if(null==to||0==to.length)return[];let ta=[];for(let tn of to){let to=yield this.loadRootIdentity(tn.getName());ta.push(to)}return ta})}containsRootIdenities(){return A(this,void 0,void 0,function*(){let tn=this.getDir(this.currentDataDir,be.ROOT_IDENTITIES_DIR);if(!tn.exists())return!1;let to=tn.listFiles().filter(tn=>tn.isDirectory());return null!=to&&to.length>0})}loadRootIdentityMnemonic(tn){return A(this,void 0,void 0,function*(){try{return this.getRootIdentityFile(tn,be.ROOT_IDENTITY_MNEMONIC_FILE,!1).readText()}catch(to){throw new St("Load mnemonic for identity error: "+tn,to)}})}getDidFile(tn,to){return this.getFile(to,this.currentDataDir,be.DID_DIR,tn.getMethodSpecificId(),be.DOCUMENT_FILE)}getDidMetadataFile(tn,to){return this.getFile(to,this.currentDataDir,be.DID_DIR,tn.getMethodSpecificId(),be.METADATA)}getDidDir(tn){return this.getDir(this.currentDataDir,be.DID_DIR,tn.getMethodSpecificId())}storeDidMetadata(tn,to){return A(this,void 0,void 0,function*(){try{let ta=this.getDidMetadataFile(tn,!0);null==to||to.isEmpty()?ta.delete():ta.writeText(to.serialize())}catch(to){throw new St("Store DID metadata error: "+tn,to)}})}loadDidMetadata(tn){return A(this,void 0,void 0,function*(){try{let to=this.getDidMetadataFile(tn,!1),ta=null;return to.exists()&&(ta=Kt.parse(to.readText())),ta}catch(to){throw new St("Load DID metadata error: "+tn,to)}})}storeDid(tn){return A(this,void 0,void 0,function*(){try{this.getDidFile(tn.getSubject(),!0).writeText(tn.serialize(!0))}catch(to){throw new St("Store DID document error: "+tn.getSubject(),to)}})}loadDid(tn){return A(this,void 0,void 0,function*(){try{let to=this.getDidFile(tn,!1);return to.exists()?yield ve.parseAsync(to.readText()):null}catch(to){throw new St("Load DID document error: "+tn,to)}})}deleteDid(tn){return A(this,void 0,void 0,function*(){let to=this.getDidDir(tn);return!!to.exists()&&(to.delete(),!0)})}listDids(){return A(this,void 0,void 0,function*(){let tn=this.getDir(this.currentDataDir,be.DID_DIR);if(!tn.exists())return[];let to=tn.listFiles().filter(tn=>{if(!tn.isDirectory())return!1;let to=new La(tn,be.DOCUMENT_FILE);return to.exists()&&to.isFile()});if(null==to||0==to.length)return[];let ta=[];for(let tn of to){let to=new Jt(Jt.METHOD,tn.getName());ta.push(to)}return ta})}containsDid(tn){return A(this,void 0,void 0,function*(){return this.getDidDir(tn).exists()})}containsDids(){return A(this,void 0,void 0,function*(){let tn=this.getDir(this.currentDataDir,be.DID_DIR);if(!tn.exists())return!1;let to=tn.listFiles().filter(tn=>tn.isDirectory());return null!=to&&to.length>0})}getCredentialFile(tn,to){return this.getFile(to,this.currentDataDir,be.DID_DIR,tn.getDid().getMethodSpecificId(),be.CREDENTIALS_DIR,be.toPath(tn),be.CREDENTIAL_FILE)}getCredentialMetadataFile(tn,to){return this.getFile(to,this.currentDataDir,be.DID_DIR,tn.getDid().getMethodSpecificId(),be.CREDENTIALS_DIR,be.toPath(tn),be.METADATA)}getCredentialDir(tn){return this.getDir(this.currentDataDir,be.DID_DIR,tn.getDid().getMethodSpecificId(),be.CREDENTIALS_DIR,be.toPath(tn))}getCredentialsDir(tn){return this.getDir(this.currentDataDir,be.DID_DIR,tn.getMethodSpecificId(),be.CREDENTIALS_DIR)}storeCredentialMetadata(tn,to){return A(this,void 0,void 0,function*(){try{let ta=this.getCredentialMetadataFile(tn,!0);null==to||to.isEmpty()?ta.delete():ta.writeText(to.serialize())}catch(to){throw new St("Store credential metadata error: "+tn,to)}})}loadCredentialMetadata(tn){return A(this,void 0,void 0,function*(){try{let to=this.getCredentialMetadataFile(tn,!1);return to.exists()?re.parse(to.readText()):null}catch(to){throw new St("Load credential metadata error: "+tn,to)}})}storeCredential(tn,to,ta){return A(this,void 0,void 0,function*(){try{let tu=to;if(ta){let tn=tD.alloc(4);tn[0]=14,tn[1]=12,tn[2]=86,tn[3]=67,tu=tD.concat([tn,to])}this.getCredentialFile(tn,!0).writeText(tu)}catch(to){throw new St("Store credential error: "+tn,to)}})}loadCredential(tn){return A(this,void 0,void 0,function*(){try{let to=this.getCredentialFile(tn,!1).readText(!1);return to&&14==to[0]&&12==to[1]&&86==to[2]&&67==to[3]?[to.slice(4),!0]:[to,!1]}catch(to){throw new St("Load credential error: "+tn,to)}})}containsCredential(tn){return A(this,void 0,void 0,function*(){return this.getCredentialDir(tn).exists()})}containsCredentials(tn){return A(this,void 0,void 0,function*(){let to=this.getCredentialsDir(tn);if(!to.exists())return!1;let ta=to.listFiles().filter(tn=>tn.isDirectory());return null!=ta&&ta.length>0})}deleteCredential(tn){return A(this,void 0,void 0,function*(){let to=this.getCredentialDir(tn);return!!to.exists()&&(to.delete(),0==(to=this.getCredentialsDir(tn.getDid())).list().length&&to.delete(),!0)})}listCredentials(tn){return A(this,void 0,void 0,function*(){let to=this.getCredentialsDir(tn);if(!to.exists())return[];let ta=to.listFiles().filter(tn=>{if(!tn.isDirectory())return!1;let to=new La(tn,be.CREDENTIAL_FILE);return to.exists()&&to.isFile()});if(null==ta||0==ta.length)return[];let tu=[];for(let to of ta)tu.push(be.toDIDURL(tn,to.getName()));return tu})}getPrivateKeyFile(tn,to){return this.getFile(to,this.currentDataDir,be.DID_DIR,tn.getDid().getMethodSpecificId(),be.PRIVATEKEYS_DIR,be.toPath(tn))}getPrivateKeysDir(tn){return this.getDir(this.currentDataDir,be.DID_DIR,tn.getMethodSpecificId(),be.PRIVATEKEYS_DIR)}containsPrivateKey(tn){return A(this,void 0,void 0,function*(){return this.getPrivateKeyFile(tn,!1).exists()})}storePrivateKey(tn,to){return A(this,void 0,void 0,function*(){try{this.getPrivateKeyFile(tn,!0).writeText(to)}catch(to){throw new St("Store private key error: "+tn,to)}})}loadPrivateKey(tn){return A(this,void 0,void 0,function*(){try{let to=this.getPrivateKeyFile(tn,!1);return to.exists()?to.readText():null}catch(to){throw new St("Load private key error: "+tn,to)}})}containsPrivateKeys(tn){return A(this,void 0,void 0,function*(){let to=this.getPrivateKeysDir(tn);if(!to.exists())return!1;let ta=to.listFiles().filter(tn=>tn.isFile());return null!=ta&&ta.length>0})}deletePrivateKey(tn){return A(this,void 0,void 0,function*(){let to=this.getPrivateKeyFile(tn,!1);if(to.exists()){to.delete();let ta=this.getPrivateKeysDir(tn.getDid());return 0==ta.list().length&&ta.delete(),!0}return!1})}listPrivateKeys(tn){return A(this,void 0,void 0,function*(){let to=this.getPrivateKeysDir(tn);if(!to.exists())return[];let ta=to.listFiles().filter(tn=>tn.isFile());if(null==ta||0==ta.length)return[];let tu=[];for(let to of ta)tu.push(be.toDIDURL(tn,to.getName()));return tu})}needReencrypt(tn){let to=["(.+)\\"+La.SEPARATOR+be.DATA_DIR+"\\"+La.SEPARATOR+be.ROOT_IDENTITIES_DIR+"\\"+La.SEPARATOR+"(.+)\\"+La.SEPARATOR+be.ROOT_IDENTITY_PRIVATEKEY_FILE,"(.+)\\"+La.SEPARATOR+be.DATA_DIR+"\\"+La.SEPARATOR+be.ROOT_IDENTITIES_DIR+"\\"+La.SEPARATOR+"(.+)\\"+La.SEPARATOR+be.ROOT_IDENTITY_MNEMONIC_FILE,"(.+)\\"+La.SEPARATOR+be.DATA_DIR+"\\"+La.SEPARATOR+be.DID_DIR+"\\"+La.SEPARATOR+"(.+)\\"+La.SEPARATOR+be.PRIVATEKEYS_DIR+"\\"+La.SEPARATOR+"(.+)"],ta=tn.getAbsolutePath();for(let tn of to)if(ta.match(tn))return!0;return!1}isCredential(tn){let to=["(.+)\\"+La.SEPARATOR+be.DATA_DIR+"\\"+La.SEPARATOR+be.DID_DIR+"\\"+La.SEPARATOR+"(.+)\\"+La.SEPARATOR+be.CREDENTIALS_DIR+"\\"+La.SEPARATOR+"(.+)\\"+La.SEPARATOR+be.CREDENTIAL_FILE],ta=tn.getAbsolutePath();for(let tn of to)if(ta.match(tn))return!0;return!1}copy(tn,to,ta){if(tn.isDirectory())for(let tu of(to.exists()||to.createDirectory(),tn.list())){let tc=new La(tn,tu),th=new La(to,tu);this.copy(tc,th,ta)}else if(this.needReencrypt(tn)){let tu=tn.readText();to.writeText(ta.reEncrypt(tu))}else if(this.isCredential(tn)){let tu=tn.readText(!1);if(14==tu[0]&&12==tu[1]&&86==tu[2]&&67==tu[3]){let tn=ta.reEncrypt(tD.from(tu.slice(4)).toString()),tc=tD.from(tn,"utf-8"),th=tD.alloc(4);th[0]=14,th[1]=12,th[2]=86,th[3]=67,tc=tD.concat([th,tc]),to.writeText(tc)}else be.copyFile(tn,to)}else be.copyFile(tn,to)}postChangePassword(){let tn=this.getDir(be.DATA_DIR),to=this.getDir(be.DATA_DIR+be.JOURNAL_SUFFIX),ta=(new Date).getTime()/1e3,tu=this.getDir(be.DATA_DIR+"_"+ta),tc=this.getFile(!1,"postChangePassword");tc.exists()?(to.exists()&&(tn.exists()&&tn.rename(tu.getAbsolutePath()),to.rename(tn.getAbsolutePath())),tc.delete()):to.exists()&&to.delete()}changePassword(tn){return A(this,void 0,void 0,function*(){try{let to=this.getDir(be.DATA_DIR),ta=this.getDir(be.DATA_DIR+be.JOURNAL_SUFFIX);this.copy(to,ta,tn),this.getFile(!0,"postChangePassword").createFile()}catch(tn){if(tn instanceof x)throw tn;throw new St("Change store password failed.")}finally{this.postChangePassword()}})}postOperations(){this.getFile(!1,"postChangePassword").exists()&&this.postChangePassword()}};be.DATA_DIR="data",be.ROOT_IDENTITIES_DIR="roots",be.ROOT_IDENTITY_MNEMONIC_FILE="mnemonic",be.ROOT_IDENTITY_PRIVATEKEY_FILE="private",be.ROOT_IDENTITY_PUBLICKEY_FILE="public",be.ROOT_IDENTITY_INDEX_FILE="index",be.DID_DIR="ids",be.DOCUMENT_FILE="document",be.CREDENTIALS_DIR="credentials",be.CREDENTIAL_FILE="credential",be.PRIVATEKEYS_DIR="privatekeys",be.METADATA=".metadata",be.JOURNAL_SUFFIX=".journal";let Ee=class Ee extends Ft{constructor(tn=null,to=null,ta=null){super(),this.id=tn,this.to=to,this.txid=ta}static newForDIDDocument(tn,to){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid target DID document"),qt(null!=to,"Invalid to DID"),!tn.isCustomizedDid())throw new U(tn.getSubject().toString()+"isn't a customized did");let ta=yield tn.getSubject().resolve();tn.getMetadata().setTransactionId(ta.getMetadata().getTransactionId());let tu=new Ee(tn.getSubject(),to,tn.getMetadata().getTransactionId());return tu.doc=tn,tu})}static newWithTicket(tn,to){let ta=new Ee(tn.id,tn.to,tn.txid);return ta.doc=tn.doc,to&&(ta.proofs=tn.proofs),ta}getSubject(){return this.id}getTo(){return this.to}getTransactionId(){return this.txid}getProof(){return this.getProofs()[0]}getProofs(){return this.proofs.valuesAsSortedArray()}getDocument(){return A(this,void 0,void 0,function*(){return null==this.doc&&(this.doc=yield this.id.resolve()),this.doc})}isGenuine(tn=null){return A(this,void 0,void 0,function*(){let to=yield this.getDocument();if(null==to)return null!=tn&&(tn.failed(this,"Ticket {}: can not resolve the owner document",this.getSubject()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;if(!to.isGenuine(tn))return null!=tn&&(tn.failed(this,"Ticket {}: the owner document is not genuine",this.getSubject()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;if(to.getControllerCount()>1&&this.proofs.size!=to.getMultiSignature().m()||1>=to.getControllerCount()&&1!=this.proofs.size)return null!=tn&&(tn.failed(this,"Ticket {}: proof size not matched with multisig, {} expected, actual is {}",this.getSubject(),to.getMultiSignature().m(),to.proofs.size),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;let ta=Ee.newWithTicket(this,!1).serialize(!0),tu=He.sha256Digest(th.Buffer.from(ta,"utf-8"));for(let ta of this.proofs.values()){if(ta.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"Ticket {}: key type '{}' for proof is not supported",this.getSubject(),ta.getType()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;let tc=to.getControllerDocument(ta.getVerificationMethod().getDid());if(null==tc)return null!=tn&&(tn.failed(this,"Ticket {}: can not resolve the document for controller '{}' to verify the proof",this.getSubject(),ta.getVerificationMethod().getDid()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;if(!(yield tc.isValid(tn)))return null!=tn&&(tn.failed(this,"Ticket {}: controller '{}' is invalid, failed to verify the proof",this.getSubject(),ta.getVerificationMethod().getDid()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;if(!ta.getVerificationMethod().equals(tc.getDefaultPublicKeyId()))return null!=tn&&(tn.failed(this,"Ticket {}: key '{}' for proof is not default key of '{}'",this.getSubject(),ta.getVerificationMethod(),ta.getVerificationMethod().getDid()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1;if(!to.verifyDigest(ta.getVerificationMethod(),ta.getSignature(),tu))return null!=tn&&(tn.failed(this,"Ticket {}: proof '{}' is invalid, signature mismatch",this.getSubject(),ta.getVerificationMethod()),tn.failed(this,"Ticket {}: is not genuine",this.getSubject())),!1}return null!=tn&&tn.succeeded(this,"Ticket {}: is genuine",this.getSubject()),!0})}isValid(tn=null){return A(this,void 0,void 0,function*(){let to=yield this.getDocument();return null==to?(null!=tn&&(tn.failed(this,"Ticket {}: can not resolve the owners document",this.getSubject()),tn.failed(this,"Ticket {}: is not valid",this.getSubject())),!1):(yield to.isValid(tn))?(yield this.isGenuine(tn))?this.txid!==to.getMetadata().getTransactionId()?(null!=tn&&(tn.failed(this,"Ticket {}: the transaction id already out date",this.getSubject()),tn.failed(this,"Ticket {}: is not valid",this.getSubject())),!1):(null!=tn&&tn.succeeded(this,"Ticket {}: is valid",this.getSubject()),!0):(null!=tn&&tn.failed(this,"Ticket {}: is not valid",this.getSubject()),!1):(null!=tn&&(tn.failed(this,"Ticket {}: the owners document is not valid",this.getSubject()),tn.failed(this,"Ticket {}: is not valid",this.getSubject())),!1)})}isQualified(){return A(this,void 0,void 0,function*(){if(null==this.proofs||0==this.proofs.size)return!1;let tn=(yield this.getDocument()).getMultiSignature();return this.proofs.size==(null==tn?1:tn.m())})}toJSON(tn=null){let to={};if(to.id=this.id.toString(),to.to=this.to.toString(),to.txid=this.txid,this.proofs){let ta=this.proofs.valuesAsSortedArray();1==ta.length?to.proof=ta[0].toJSON(tn):to.proof=Array.from(ta,to=>to.toJSON(tn))}return to}fromJSON(tn,to=null){if(this.id=this.getDid("id",tn.id,{mandatory:!0,nullable:!1}),this.to=this.getDid("to",tn.to,{mandatory:!0,nullable:!1}),this.txid=this.getString("txid",tn.txid,{mandatory:!0,nullable:!1}),!tn.proof)throw new W("Missing property: proof");if(this.proofs=new le,Array.isArray(tn.proof))for(let to of tn.proof){let tn=Ee.Proof.deserialize(to,Ee.Proof,this.id);if(null==tn.getVerificationMethod().getDid())throw new W("Invalid verification method: "+tn.getVerificationMethod());if(this.proofs.has(tn.getVerificationMethod().getDid()))throw new W("Aleady exist proof from "+tn.getVerificationMethod().getDid());this.proofs.set(tn.getVerificationMethod().getDid(),tn)}else{let to=tn.proof,ta=Ee.Proof.deserialize(to,Ee.Proof,this.id);if(null==ta.getVerificationMethod().getDid())throw new W("Invalid verification method: "+ta.getVerificationMethod());this.proofs.set(ta.getVerificationMethod().getDid(),ta)}}seal(tn,to){return A(this,void 0,void 0,function*(){try{if(yield this.isQualified())return;if(tn.isCustomizedDid()){if(null==tn.getEffectiveController())throw new V("No effective controller of "+this.getSubject().toString())}else try{if(!(yield this.getDocument()).hasController(tn.getSubject()))throw new q(tn.getSubject().toString()+" isn't the controller")}catch(tn){throw new M(tn)}}catch(tn){throw new M(tn)}let ta=tn.getDefaultPublicKeyId();if(null==this.proofs)this.proofs=new le;else if(this.proofs.has(ta.getDid()))throw new Y(ta.getDid().toString()+" already signed");let tu=Ee.newWithTicket(this,!1).serialize(!0),tc=yield tn.signWithStorePass(to,th.Buffer.from(tu)),td=new Ee.Proof(ta,tc);this.proofs.set(td.getVerificationMethod().getDid(),td)})}static parse(tn){try{return Ft.deserialize(tn,Ee)}catch(tn){throw tn instanceof W?tn:new W(tn)}}};(Ee||(Ee={})).Proof=class extends Ft{constructor(tn=null,to=null,ta=new Date,tu=ne.DEFAULT_PUBLICKEY_TYPE){super(),this.type=null!=tu?tu:ne.DEFAULT_PUBLICKEY_TYPE,this.created=null==ta?new Date:ta,this.created&&this.created.setMilliseconds(0),this.verificationMethod=tn,this.signature=to}getType(){return this.type}getVerificationMethod(){return this.verificationMethod}getCreated(){return this.created}getSignature(){return this.signature}equals(tn){return 0===this.compareTo(tn)}compareTo(tn){let to=this.created.getTime()-tn.created.getTime();return 0==to&&(to=this.verificationMethod.compareTo(tn.verificationMethod)),to}toJSON(tn=null){let to=tn?new Jt(tn):null,ta={};return to&&this.type===ne.DEFAULT_PUBLICKEY_TYPE||(ta.type=this.type),this.created&&(ta.created=this.dateToString(this.created)),ta.verificationMethod=this.verificationMethod.toString(to),ta.signature=this.signature,ta}fromJSON(tn,to=null){this.type=this.getString("proof.type",tn.type,{mandatory:!1,defaultValue:ne.DEFAULT_PUBLICKEY_TYPE}),this.created=this.getDate("proof.created",tn.created,{mandatory:!1}),this.verificationMethod=this.getDidUrl("proof.verificationMethod",tn.verificationMethod,{mandatory:!0,nullable:!1,context:to}),this.signature=this.getString("proof.signature",tn.signature,{mandatory:!0,nullable:!1})}};let tC=new T("VerifiableCredential");let _e=class _e extends Ft{constructor(tn){super(),this.holder=tn,this.credentials=new le}static newFromPresentation(tn,to){let ta=new _e;return ta.context=tn.context,ta.id=tn.id,ta.type=tn.type,ta.holder=tn.holder,ta.created=tn.created,ta.credentials=tn.credentials,to&&(ta.proof=tn.proof),ta}getId(){return this.id?this.id:null}getType(){return this.type}getHolder(){return null!=this.holder?this.holder:this.proof.getVerificationMethod().getDid()}getCreated(){return null!=this.proof.getCreated()?this.proof.getCreated():this.created}getCredentialCount(){return this.credentials.size}getCredentials(){return this.credentials.valuesAsSortedArray()}getCredential(tn){return qt(null!=tn,"Invalid credential id"),("string"==typeof tn||null==tn.getDid())&&(tn=Xt.from(tn,this.getHolder())),this.credentials.get(tn)}getProof(){return this.proof}isGenuine(tn=null){return A(this,void 0,void 0,function*(){let to=yield this.getHolder().resolve();if(null==to)return null!=tn&&(tn.failed(this,"VP {}: can not resolve the holder's document",this.getId()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1;if(!to.isGenuine(tn))return null!=tn&&(tn.failed(this,"VP {}: holder's document is not genuine",this.getId()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1;if(this.proof.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"VP {}: key type '{}' for proof is not supported",this.getId(),this.proof.getType()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1;if(!to.isAuthenticationKey(this.proof.getVerificationMethod()))return null!=tn&&(tn.failed(this,"VP {}: Key '{}' for proof is not an authencation key of '{}'",this.getId(),this.proof.getVerificationMethod(),this.proof.getVerificationMethod().getDid()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1;for(let to of this.credentials.values()){if(!to.getSubject().getId().equals(this.getHolder()))return null!=tn&&(tn.failed(this,"VP {}: credential '{}' not owned by the holder '{}'",this.getId(),to.getId(),this.getHolder()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1;if(!(yield to.isGenuine(tn)))return null!=tn&&(tn.failed(this,"VP {}: credential '{}' is not genuine",this.getId(),to.getId()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1}let ta=_e.newFromPresentation(this,!1).serialize(!0),tu=to.verify(this.proof.getVerificationMethod(),this.proof.getSignature(),th.Buffer.from(ta),th.Buffer.from(this.proof.getRealm()),th.Buffer.from(this.proof.getNonce()));return null!=tn&&(tu?tn.succeeded(this,"VP {}: is genuine",this.getId()):(tn.failed(this,"VP {}: proof is invalid, signature mismatch",this.getId()),tn.failed(this,"VP {}: is not genuine",this.getId()))),tu})}isValid(tn=null){return A(this,void 0,void 0,function*(){let to=yield this.getHolder().resolve();if(null==to)return null!=tn&&(tn.failed(this,"VP {}: can not resolve the holder's document",this.getId()),tn.failed(this,"VP {}: is invalid",this.getId())),!1;if(yield to.isDeactivated())return null!=tn&&(tn.failed(this,"VP {}: holder's document is deactivate",this.getId()),tn.failed(this,"VP {}: is invalid",this.getId())),!1;if(!to.isGenuine(tn))return null!=tn&&(tn.failed(this,"VP {}: holder's document is genuine",this.getId()),tn.failed(this,"VP {}: is invalid",this.getId())),!1;if(this.proof.getType()!==ne.DEFAULT_PUBLICKEY_TYPE)return null!=tn&&(tn.failed(this,"VP {}: Key type '{}' for proof is not supported",this.getId(),this.proof.getType()),tn.failed(this,"VP {}: is invalid",this.getId())),!1;if(!to.isAuthenticationKey(this.proof.getVerificationMethod()))return null!=tn&&(tn.failed(this,"VP {}: Key '{}' for proof is not an authencation key of '{}'",this.getId(),this.proof.getVerificationMethod(),this.proof.getVerificationMethod().getDid()),tn.failed(this,"VP {}: is invalid",this.getId())),!1;let ta=_e.newFromPresentation(this,!1).serialize(!0);if(!to.verify(this.proof.getVerificationMethod(),this.proof.getSignature(),th.Buffer.from(ta),th.Buffer.from(this.proof.getRealm()),th.Buffer.from(this.proof.getNonce())))return null!=tn&&(tn.failed(this,"VP {}: proof is invalid, signature mismatch",this.getId()),tn.failed(this,"VP {}: is invalid",this.getId())),!1;for(let to of this.credentials.values()){if(!to.getSubject().getId().equals(this.getHolder()))return null!=tn&&(tn.failed(this,"VP {}: credential '{}' not owned by the holder '{}'",this.getId(),to.getId(),this.getHolder()),tn.failed(this,"VP {}: is not genuine",this.getId())),!1;if(!(yield to.isValid(tn)))return null!=tn&&(tn.failed(this,"VP {}: credential '{}' is invalid",this.getId(),to.getId()),tn.failed(this,"VP {}: is invalid",this.getId())),!1}return null!=tn&&tn.succeeded(this,"VP %s: is valid",this.getId()),!0})}toJSON(tn=null){let to={};return null!=this.context&&this.context.length>0&&(to["@context"]=Array.from(this.context)),this.id&&(to.id=this.id.toString()),to.type=1==this.type.length?this.type[0]:this.type,this.holder&&(to.holder=this.holder.toString()),this.created&&(to.created=this.dateToString(this.created)),to.verifiableCredential=Array.from(this.credentials.valuesAsSortedArray(),tn=>tn.toJSON()),this.proof&&(to.proof=this.proof.toJSON()),to}fromJSON(tn,to=null){if(this.context=this.getContext("@context",tn["@context"],{mandatory:!1,nullable:!1,defaultValue:[]}),this.holder=this.getDid("holder",tn.holder,{mandatory:!1,nullable:!1,defaultValue:null}),this.id=this.getDidUrl("id",tn.id,{mandatory:!1,nullable:!1,context:this.holder,defaultValue:null}),this.type=this.getStrings("type",tn.type,{mandatory:!0,nullable:!1,defaultValue:[_e.DEFAULT_PRESENTATION_TYPE]}),this.created=this.getDate("created",tn.created,{mandatory:!1,nullable:!0}),!tn.proof)throw new gt("Missing property: proof");let ta=tn.proof;if(this.proof=_e.Proof.deserialize(ta,_e.Proof,this.holder),null==this.created&&null==this.proof.getCreated())throw new gt("Missing presentation create timestamp");if(this.credentials=new le,tn.verifiableCredential){if(!Array.isArray(tn.verifiableCredential))throw new gt("Invalid property: verifiableCredential, type error.");for(let to of tn.verifiableCredential){let tn;try{tn=se.deserialize(to,se,this.holder)}catch(tn){throw new gt("credential invalid: "+to.id,tn)}if(this.credentials.has(tn.getId()))throw new gt("Duplicated credential id: "+tn.getId());this.credentials.set(tn.getId(),tn)}}}static parse(tn){try{return Ft.deserialize(tn,_e)}catch(tn){throw tn instanceof gt?tn:new gt(tn)}}static createFor(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid did"),qt(null!=ta,"Invalid store"),"string"==typeof tn&&(tn=Jt.from(tn)),"string"==typeof to&&(to=Xt.from(to,tn));let tu=yield ta.loadDid(tn);if(null==tu)throw new et(tn.toString()+" isn't found in the chain");if(null==to)to=tu.getDefaultPublicKeyId();else if(!tu.isAuthenticationKey(to))throw new X(to.toString()+" isn't the authencation key");if(!(yield tu.hasPrivateKey(to)))throw new X("No private key: "+to);return new _e.Builder(tu,to)})}};_e.DEFAULT_PRESENTATION_TYPE="VerifiablePresentation",function(tn){tn.Builder=class{constructor(to,ta){this.holder=to,this.signKey=ta,this.presentation=new tn(to.getSubject()),this.setDefaultType()}checkNotSealed(){if(null==this.presentation)throw new rt("Presentation "+this.id.toString()+" is already sealed")}id(tn){return this.checkNotSealed(),qt(null!=tn,"Invalid id"),"string"==typeof tn&&(tn=Xt.from(tn,this.holder.getSubject())),qt(null!=tn&&(null==tn.getDid()||tn.getDid().equals(this.holder.getSubject())),"Invalid id"),this.presentation.id=Xt.from(tn,this.holder.getSubject()),this}setDefaultType(){this.checkNotSealed(),Gt.isEnabledJsonLdContext()&&(null==this.presentation.context&&(this.presentation.context=[]),this.presentation.context.includes(se.W3C_CREDENTIAL_CONTEXT)||this.presentation.context.push(se.W3C_CREDENTIAL_CONTEXT),this.presentation.context.includes(se.ELASTOS_CREDENTIAL_CONTEXT)||this.presentation.context.push(se.ELASTOS_CREDENTIAL_CONTEXT)),null==this.presentation.type&&(this.presentation.type=[]),this.presentation.type.includes(tn.DEFAULT_PRESENTATION_TYPE)||this.presentation.type.push(tn.DEFAULT_PRESENTATION_TYPE)}typeWithContext(tn,to){return this.checkNotSealed(),Yt(tn,"Invalid type: "+tn),Gt.isEnabledJsonLdContext()?(Yt(to,"Invalid context: "+to),null==this.presentation.context&&(this.presentation.context=[]),this.presentation.context.includes(to)||this.presentation.context.push(to)):tC.warn("JSON-LD context support not enabled"),null==this.presentation.type&&(this.presentation.type=[]),this.presentation.type.includes(tn)||this.presentation.type.push(tn),this}type(tn){if(this.checkNotSealed(),Yt(tn,"Invalid type: "+tn),0>tn.indexOf("#"))return this.typeWithContext(tn,null);{let to=tn.split("#",2);return this.typeWithContext(to[1],to[0])}}types(tn){return this.checkNotSealed(),qt(null!=tn&&tn.length>0,"Invalid types"),this.presentation.type=Array.from(tn),this}credentials(...tn){for(let to of(this.checkNotSealed(),tn)){if(!to.getSubject().getId().equals(this.holder.getSubject()))throw new dt("Credential "+to.getId().toString()+" doesn't belong to the holder of presentation");if(this.presentation.credentials.has(to.getId()))throw new ht(to.getId().toString()+" already exist in the presentation");this.presentation.credentials.set(to.getId(),to)}return this}realm(tn){return this.checkNotSealed(),qt(tn&&null!=tn,"Invalid realm"),this._realm=tn,this}nonce(tn){return this.checkNotSealed(),qt(tn&&null!=tn,"Invalid nonce"),this._nonce=tn,this}seal(tn){return A(this,void 0,void 0,function*(){if(this.checkNotSealed(),qt(tn&&null!=tn,"Invalid storepass"),null==this.presentation.type||0==this.presentation.type.length)throw new gt("Missing presentation type");ae.sort(this.presentation.type),this.presentation.created=new Date,this.presentation.created&&this.presentation.created.setMilliseconds(0);let to=this.presentation.serialize(!0),ta=yield this.holder.signWithId(this.signKey,tn,th.Buffer.from(to),th.Buffer.from(this._realm),th.Buffer.from(this._nonce)),tu=new i(this.presentation.created,this.signKey,this._realm,this._nonce,ta);this.presentation.proof=tu;let tc=this.presentation;return this.presentation=null,tc})}};let i=class i extends Ft{constructor(tn=null,to=null,ta=null,tu=null,tc=null,th=ne.DEFAULT_PUBLICKEY_TYPE){super(),this.type=null!=th?th:ne.DEFAULT_PUBLICKEY_TYPE,null==tn?(this.created=new Date,this.created&&this.created.setMilliseconds(0)):this.created=tn,this.verificationMethod=to,this.realm=ta,this.nonce=tu,this.signature=tc}getType(){return this.type}getCreated(){return this.created}getVerificationMethod(){return this.verificationMethod}getRealm(){return this.realm}getNonce(){return this.nonce}getSignature(){return this.signature}toJSON(tn=null){tn&&new Jt(tn);let to={};return to.type=this.type,this.created&&(to.created=this.dateToString(this.created)),to.verificationMethod=this.verificationMethod.toString(),to.realm=this.realm,to.nonce=this.nonce,to.signature=this.signature,to}fromJSON(tn,to=null){this.type=this.getString("proof.type",tn.type,{mandatory:!1,defaultValue:ne.DEFAULT_PUBLICKEY_TYPE}),this.created=this.getDate("created",tn.created,{mandatory:!1,nullable:!0}),this.verificationMethod=this.getDidUrl("proof.verificationMethod",tn.verificationMethod,{mandatory:!0,nullable:!1,context:to}),this.realm=this.getString("proof.realm",tn.realm,{mandatory:!0,nullable:!1}),this.nonce=this.getString("proof.nonce",tn.nonce,{mandatory:!0,nullable:!1}),this.signature=this.getString("proof.signature",tn.signature,{mandatory:!0,nullable:!1})}};tn.Proof=i}(_e||(_e={}));var tL="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},tj={exports:{}};tj.exports=function(tn){var to={};function i(ta){if(to[ta])return to[ta].exports;var tu=to[ta]={exports:{},id:ta,loaded:!1};return tn[ta].call(tu.exports,tu,tu.exports,i),tu.loaded=!0,tu.exports}return i.m=tn,i.c=to,i.p="",i(0)}([function(tn,to,ta){(function(tn,tu,tc,th){Object.defineProperty(to,"__esModule",{value:!0});var td,tf,tp,ty=ta(2),tg=ta(9);(tm=tp||(tp={}))[tm.EPERM=1]="EPERM",tm[tm.ENOENT=2]="ENOENT",tm[tm.EIO=5]="EIO",tm[tm.EBADF=9]="EBADF",tm[tm.EACCES=13]="EACCES",tm[tm.EBUSY=16]="EBUSY",tm[tm.EEXIST=17]="EEXIST",tm[tm.ENOTDIR=20]="ENOTDIR",tm[tm.EISDIR=21]="EISDIR",tm[tm.EINVAL=22]="EINVAL",tm[tm.EFBIG=27]="EFBIG",tm[tm.ENOSPC=28]="ENOSPC",tm[tm.EROFS=30]="EROFS",tm[tm.ENOTEMPTY=39]="ENOTEMPTY",tm[tm.ENOTSUP=95]="ENOTSUP";var tv={};tv[tp.EPERM]="Operation not permitted.",tv[tp.ENOENT]="No such file or directory.",tv[tp.EIO]="Input/output error.",tv[tp.EBADF]="Bad file descriptor.",tv[tp.EACCES]="Permission denied.",tv[tp.EBUSY]="Resource busy or locked.",tv[tp.EEXIST]="File exists.",tv[tp.ENOTDIR]="File is not a directory.",tv[tp.EISDIR]="File is a directory.",tv[tp.EINVAL]="Invalid argument.",tv[tp.EFBIG]="File is too big.",tv[tp.ENOSPC]="No space left on disk.",tv[tp.EROFS]="Cannot modify a read-only file system.",tv[tp.ENOTEMPTY]="Directory is not empty.",tv[tp.ENOTSUP]="Operation is not supported.";var tm,tw,tS=function(to){function i(tn,ta,tu){void 0===ta&&(ta=tv[tn]),to.call(this,ta),this.syscall="",this.errno=tn,this.code=tp[tn],this.path=tu,this.stack=(new to).stack,this.message="Error: "+this.code+": "+ta+(this.path?", '"+this.path+"'":"")}return to&&(i.__proto__=to),i.prototype=Object.create(to&&to.prototype),i.prototype.constructor=i,i.fromJSON=function(tn){var to=new i(0);return to.errno=tn.errno,to.code=tn.code,to.path=tn.path,to.stack=tn.stack,to.message=tn.message,to},i.fromBuffer=function(tn,to){return void 0===to&&(to=0),i.fromJSON(JSON.parse(tn.toString("utf8",to+4,to+4+tn.readUInt32LE(to))))},i.FileError=function(tn,to){return new i(tn,tv[tn],to)},i.ENOENT=function(tn){return this.FileError(tp.ENOENT,tn)},i.EEXIST=function(tn){return this.FileError(tp.EEXIST,tn)},i.EISDIR=function(tn){return this.FileError(tp.EISDIR,tn)},i.ENOTDIR=function(tn){return this.FileError(tp.ENOTDIR,tn)},i.EPERM=function(tn){return this.FileError(tp.EPERM,tn)},i.ENOTEMPTY=function(tn){return this.FileError(tp.ENOTEMPTY,tn)},i.prototype.toString=function(){return this.message},i.prototype.toJSON=function(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}},i.prototype.writeToBuffer=function(to,ta){void 0===to&&(to=tn.alloc(this.bufferSize())),void 0===ta&&(ta=0);var tu=to.write(JSON.stringify(this.toJSON()),ta+4);return to.writeUInt32LE(tu,ta),to},i.prototype.bufferSize=function(){return 4+tn.byteLength(JSON.stringify(this.toJSON()))},i}(Error),tb=Object.freeze({get ErrorCode(){return tp},ErrorStrings:tv,ApiError:tS});(tE=tw||(tw={}))[tE.NOP=0]="NOP",tE[tE.THROW_EXCEPTION=1]="THROW_EXCEPTION",tE[tE.TRUNCATE_FILE=2]="TRUNCATE_FILE",tE[tE.CREATE_FILE=3]="CREATE_FILE";var tE,tI,p=function t(tn){if(this.flagStr=tn,0>t.validFlagStrs.indexOf(tn))throw new tS(tp.EINVAL,"Invalid flag: "+tn)};p.getFileFlag=function(tn){return p.flagCache.hasOwnProperty(tn)?p.flagCache[tn]:p.flagCache[tn]=new p(tn)},p.prototype.getFlagString=function(){return this.flagStr},p.prototype.isReadable=function(){return -1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")},p.prototype.isWriteable=function(){return -1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")},p.prototype.isTruncating=function(){return -1!==this.flagStr.indexOf("w")},p.prototype.isAppendable=function(){return -1!==this.flagStr.indexOf("a")},p.prototype.isSynchronous=function(){return -1!==this.flagStr.indexOf("s")},p.prototype.isExclusive=function(){return -1!==this.flagStr.indexOf("x")},p.prototype.pathExistsAction=function(){return this.isExclusive()?tw.THROW_EXCEPTION:this.isTruncating()?tw.TRUNCATE_FILE:tw.NOP},p.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?tw.CREATE_FILE:tw.THROW_EXCEPTION},p.flagCache={},p.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],(eu=tI||(tI={}))[eu.FILE=32768]="FILE",eu[eu.DIRECTORY=16384]="DIRECTORY",eu[eu.SYMLINK=40960]="SYMLINK";var y=function(tn,to,ta,tu,tc,th){if(void 0===tu&&(tu=new Date),void 0===tc&&(tc=new Date),void 0===th&&(th=new Date),this.size=to,this.atime=tu,this.mtime=tc,this.ctime=th,this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.birthtime=new Date(0),this.fileData=null,ta)this.mode=ta;else switch(tn){case tI.FILE:this.mode=420;break;case tI.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(to/512),this.mode<4096&&(this.mode|=tn)};y.fromBuffer=function(tn){var to=tn.readUInt32LE(0),ta=tn.readUInt32LE(4),tu=tn.readDoubleLE(8),tc=tn.readDoubleLE(16),th=tn.readDoubleLE(24);return new y(61440&ta,to,4095&ta,new Date(tu),new Date(tc),new Date(th))},y.prototype.toBuffer=function(){var to=tn.alloc(32);return to.writeUInt32LE(this.size,0),to.writeUInt32LE(this.mode,4),to.writeDoubleLE(this.atime.getTime(),8),to.writeDoubleLE(this.mtime.getTime(),16),to.writeDoubleLE(this.ctime.getTime(),24),to},y.prototype.clone=function(){return new y(61440&this.mode,this.size,4095&this.mode,this.atime,this.mtime,this.ctime)},y.prototype.isFile=function(){return(61440&this.mode)===tI.FILE},y.prototype.isDirectory=function(){return(61440&this.mode)===tI.DIRECTORY},y.prototype.isSymbolicLink=function(){return(61440&this.mode)===tI.SYMLINK},y.prototype.chmod=function(tn){this.mode=61440&this.mode|tn},y.prototype.isSocket=function(){return!1},y.prototype.isBlockDevice=function(){return!1},y.prototype.isCharacterDevice=function(){return!1},y.prototype.isFIFO=function(){return!1};var g=function(tn,to){return tn};function v(tn){if(tn)return tn;throw new tS(tp.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function m(tn,to){switch(typeof tn){case"number":return tn;case"string":var ta=parseInt(tn,8);return isNaN(ta)?to:ta;default:return to}}function w(tn){if(tn instanceof Date)return tn;if("number"==typeof tn)return new Date(1e3*tn);throw new tS(tp.EINVAL,"Invalid time.")}function S(tn){if(tn.indexOf("\x00")>=0)throw new tS(tp.EINVAL,"Path must be a string without null bytes.");if(""===tn)throw new tS(tp.EINVAL,"Path must not be empty.");return tg.resolve(tn)}function b(tn,to,ta,tu){switch(typeof tn){case"object":return{encoding:void 0!==tn.encoding?tn.encoding:to,flag:void 0!==tn.flag?tn.flag:ta,mode:m(tn.mode,tu)};case"string":return{encoding:tn,flag:ta,mode:tu};default:return{encoding:to,flag:ta,mode:tu}}}function E(){}var I=function(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100};I.prototype.initialize=function(tn){if(!tn.constructor.isAvailable())throw new tS(tp.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=tn},I.prototype._toUnixTimestamp=function(tn){if("number"==typeof tn)return tn;if(tn instanceof Date)return tn.getTime()/1e3;throw Error("Cannot parse time: "+tn)},I.prototype.getRootFS=function(){return this.root?this.root:null},I.prototype.rename=function(tn,to,ta){void 0===ta&&(ta=E);var tu=g(ta,1);try{v(this.root).rename(S(tn),S(to),tu)}catch(tn){tu(tn)}},I.prototype.renameSync=function(tn,to){v(this.root).renameSync(S(tn),S(to))},I.prototype.exists=function(tn,to){void 0===to&&(to=E);var ta=g(to,1);try{return v(this.root).exists(S(tn),ta)}catch(tn){return ta(!1)}},I.prototype.existsSync=function(tn){try{return v(this.root).existsSync(S(tn))}catch(tn){return!1}},I.prototype.stat=function(tn,to){void 0===to&&(to=E);var ta=g(to,2);try{return v(this.root).stat(S(tn),!1,ta)}catch(tn){return ta(tn)}},I.prototype.statSync=function(tn){return v(this.root).statSync(S(tn),!1)},I.prototype.lstat=function(tn,to){void 0===to&&(to=E);var ta=g(to,2);try{return v(this.root).stat(S(tn),!0,ta)}catch(tn){return ta(tn)}},I.prototype.lstatSync=function(tn){return v(this.root).statSync(S(tn),!0)},I.prototype.truncate=function(tn,to,ta){void 0===to&&(to=0),void 0===ta&&(ta=E);var tu=0;"function"==typeof to?ta=to:"number"==typeof to&&(tu=to);var tc=g(ta,1);try{if(tu<0)throw new tS(tp.EINVAL);return v(this.root).truncate(S(tn),tu,tc)}catch(tn){return tc(tn)}},I.prototype.truncateSync=function(tn,to){if(void 0===to&&(to=0),to<0)throw new tS(tp.EINVAL);return v(this.root).truncateSync(S(tn),to)},I.prototype.unlink=function(tn,to){void 0===to&&(to=E);var ta=g(to,1);try{return v(this.root).unlink(S(tn),ta)}catch(tn){return ta(tn)}},I.prototype.unlinkSync=function(tn){return v(this.root).unlinkSync(S(tn))},I.prototype.open=function(tn,to,ta,tu){var tc=this;void 0===tu&&(tu=E);var th=m(ta,420),td=g(tu="function"==typeof ta?ta:tu,2);try{v(this.root).open(S(tn),p.getFileFlag(to),th,function(tn,to){to?td(tn,tc.getFdForFile(to)):td(tn)})}catch(tn){td(tn)}},I.prototype.openSync=function(tn,to,ta){return void 0===ta&&(ta=420),this.getFdForFile(v(this.root).openSync(S(tn),p.getFileFlag(to),m(ta,420)))},I.prototype.readFile=function(tn,to,ta){void 0===to&&(to={}),void 0===ta&&(ta=E);var tu=b(to,null,"r",null),tc=g(ta="function"==typeof to?to:ta,2);try{var th=p.getFileFlag(tu.flag);return th.isReadable()?v(this.root).readFile(S(tn),tu.encoding,th,tc):tc(new tS(tp.EINVAL,"Flag passed to readFile must allow for reading."))}catch(tn){return tc(tn)}},I.prototype.readFileSync=function(tn,to){void 0===to&&(to={});var ta=b(to,null,"r",null),tu=p.getFileFlag(ta.flag);if(!tu.isReadable())throw new tS(tp.EINVAL,"Flag passed to readFile must allow for reading.");return v(this.root).readFileSync(S(tn),ta.encoding,tu)},I.prototype.writeFile=function(tn,to,ta,tu){void 0===ta&&(ta={}),void 0===tu&&(tu=E);var tc=b(ta,"utf8","w",420),th=g(tu="function"==typeof ta?ta:tu,1);try{var td=p.getFileFlag(tc.flag);return td.isWriteable()?v(this.root).writeFile(S(tn),to,tc.encoding,td,tc.mode,th):th(new tS(tp.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(tn){return th(tn)}},I.prototype.writeFileSync=function(tn,to,ta){var tu=b(ta,"utf8","w",420),tc=p.getFileFlag(tu.flag);if(!tc.isWriteable())throw new tS(tp.EINVAL,"Flag passed to writeFile must allow for writing.");return v(this.root).writeFileSync(S(tn),to,tu.encoding,tc,tu.mode)},I.prototype.appendFile=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc=b(ta,"utf8","a",420),th=g(tu="function"==typeof ta?ta:tu,1);try{var td=p.getFileFlag(tc.flag);if(!td.isAppendable())return th(new tS(tp.EINVAL,"Flag passed to appendFile must allow for appending."));v(this.root).appendFile(S(tn),to,tc.encoding,td,tc.mode,th)}catch(tn){th(tn)}},I.prototype.appendFileSync=function(tn,to,ta){var tu=b(ta,"utf8","a",420),tc=p.getFileFlag(tu.flag);if(!tc.isAppendable())throw new tS(tp.EINVAL,"Flag passed to appendFile must allow for appending.");return v(this.root).appendFileSync(S(tn),to,tu.encoding,tc,tu.mode)},I.prototype.fstat=function(tn,to){void 0===to&&(to=E);var ta=g(to,2);try{this.fd2file(tn).stat(ta)}catch(tn){ta(tn)}},I.prototype.fstatSync=function(tn){return this.fd2file(tn).statSync()},I.prototype.close=function(tn,to){var ta=this;void 0===to&&(to=E);var tu=g(to,1);try{this.fd2file(tn).close(function(to){to||ta.closeFd(tn),tu(to)})}catch(tn){tu(tn)}},I.prototype.closeSync=function(tn){this.fd2file(tn).closeSync(),this.closeFd(tn)},I.prototype.ftruncate=function(tn,to,ta){void 0===ta&&(ta=E);var tu="number"==typeof to?to:0,tc=g(ta="function"==typeof to?to:ta,1);try{var th=this.fd2file(tn);if(tu<0)throw new tS(tp.EINVAL);th.truncate(tu,tc)}catch(tn){tc(tn)}},I.prototype.ftruncateSync=function(tn,to){void 0===to&&(to=0);var ta=this.fd2file(tn);if(to<0)throw new tS(tp.EINVAL);ta.truncateSync(to)},I.prototype.fsync=function(tn,to){void 0===to&&(to=E);var ta=g(to,1);try{this.fd2file(tn).sync(ta)}catch(tn){ta(tn)}},I.prototype.fsyncSync=function(tn){this.fd2file(tn).syncSync()},I.prototype.fdatasync=function(tn,to){void 0===to&&(to=E);var ta=g(to,1);try{this.fd2file(tn).datasync(ta)}catch(tn){ta(tn)}},I.prototype.fdatasyncSync=function(tn){this.fd2file(tn).datasyncSync()},I.prototype.write=function(to,ta,tu,tc,th,td){void 0===td&&(td=E);var tf,ty,tg,tv=null;if("string"==typeof ta){var tm="utf8";switch(typeof tu){case"function":td=tu;break;case"number":tv=tu,tm="string"==typeof tc?tc:"utf8",td="function"==typeof th?th:td;break;default:return(td="function"==typeof tc?tc:"function"==typeof th?th:td)(new tS(tp.EINVAL,"Invalid arguments."))}ty=0,tg=(tf=tn.from(ta,tm)).length}else tf=ta,ty=tu,tg=tc,tv="number"==typeof th?th:null,td="function"==typeof th?th:td;var tw=g(td,3);try{var tb=this.fd2file(to);null==tv&&(tv=tb.getPos()),tb.write(tf,ty,tg,tv,tw)}catch(tn){tw(tn)}},I.prototype.writeSync=function(to,ta,tu,tc,th){var td,tf,tp,ty=0;if("string"==typeof ta){tp="number"==typeof tu?tu:null;var tg="string"==typeof tc?tc:"utf8";ty=0,tf=(td=tn.from(ta,tg)).length}else td=ta,ty=tu,tf=tc,tp="number"==typeof th?th:null;var tv=this.fd2file(to);return null==tp&&(tp=tv.getPos()),tv.writeSync(td,ty,tf,tp)},I.prototype.read=function(to,ta,tu,tc,th,td){var tf,tp,ty,tg,tv;(void 0===td&&(td=E),"number"==typeof ta)?(ty=ta,tf=tu,td="function"==typeof th?th:td,tp=0,tg=tn.alloc(ty),tv=g(function(tn,to,ta){if(tn)return td(tn);td(tn,ta.toString(tc),to)},3)):(tg=ta,tp=tu,ty=tc,tf=th,tv=g(td,3));try{var tm=this.fd2file(to);null==tf&&(tf=tm.getPos()),tm.read(tg,tp,ty,tf,tv)}catch(tn){tv(tn)}},I.prototype.readSync=function(to,ta,tu,tc,th){var td,tf,tp,ty,tg=!1,tv="utf8";"number"==typeof ta?(tp=ta,ty=tu,tv=tc,tf=0,td=tn.alloc(tp),tg=!0):(td=ta,tf=tu,tp=tc,ty=th);var tm=this.fd2file(to);null==ty&&(ty=tm.getPos());var tw=tm.readSync(td,tf,tp,ty);return tg?[td.toString(tv),tw]:tw},I.prototype.fchown=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc=g(tu,1);try{this.fd2file(tn).chown(to,ta,tc)}catch(tn){tc(tn)}},I.prototype.fchownSync=function(tn,to,ta){this.fd2file(tn).chownSync(to,ta)},I.prototype.fchmod=function(tn,to,ta){var tu=g(ta,1);try{var tc="string"==typeof to?parseInt(to,8):to;this.fd2file(tn).chmod(tc,tu)}catch(tn){tu(tn)}},I.prototype.fchmodSync=function(tn,to){var ta="string"==typeof to?parseInt(to,8):to;this.fd2file(tn).chmodSync(ta)},I.prototype.futimes=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc=g(tu,1);try{var th=this.fd2file(tn);"number"==typeof to&&(to=new Date(1e3*to)),"number"==typeof ta&&(ta=new Date(1e3*ta)),th.utimes(to,ta,tc)}catch(tn){tc(tn)}},I.prototype.futimesSync=function(tn,to,ta){this.fd2file(tn).utimesSync(w(to),w(ta))},I.prototype.rmdir=function(tn,to){void 0===to&&(to=E);var ta=g(to,1);try{tn=S(tn),v(this.root).rmdir(tn,ta)}catch(tn){ta(tn)}},I.prototype.rmdirSync=function(tn){return tn=S(tn),v(this.root).rmdirSync(tn)},I.prototype.mkdir=function(tn,to,ta){void 0===ta&&(ta=E),"function"==typeof to&&(ta=to,to=511);var tu=g(ta,1);try{tn=S(tn),v(this.root).mkdir(tn,to,tu)}catch(tn){tu(tn)}},I.prototype.mkdirSync=function(tn,to){v(this.root).mkdirSync(S(tn),m(to,511))},I.prototype.readdir=function(tn,to){void 0===to&&(to=E);var ta=g(to,2);try{tn=S(tn),v(this.root).readdir(tn,ta)}catch(tn){ta(tn)}},I.prototype.readdirSync=function(tn){return tn=S(tn),v(this.root).readdirSync(tn)},I.prototype.link=function(tn,to,ta){void 0===ta&&(ta=E);var tu=g(ta,1);try{tn=S(tn),to=S(to),v(this.root).link(tn,to,tu)}catch(tn){tu(tn)}},I.prototype.linkSync=function(tn,to){return tn=S(tn),to=S(to),v(this.root).linkSync(tn,to)},I.prototype.symlink=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc="string"==typeof ta?ta:"file",th=g(tu="function"==typeof ta?ta:tu,1);try{if("file"!==tc&&"dir"!==tc)return th(new tS(tp.EINVAL,"Invalid type: "+tc));tn=S(tn),to=S(to),v(this.root).symlink(tn,to,tc,th)}catch(tn){th(tn)}},I.prototype.symlinkSync=function(tn,to,ta){if(ta){if("file"!==ta&&"dir"!==ta)throw new tS(tp.EINVAL,"Invalid type: "+ta)}else ta="file";return tn=S(tn),to=S(to),v(this.root).symlinkSync(tn,to,ta)},I.prototype.readlink=function(tn,to){void 0===to&&(to=E);var ta=g(to,2);try{tn=S(tn),v(this.root).readlink(tn,ta)}catch(tn){ta(tn)}},I.prototype.readlinkSync=function(tn){return tn=S(tn),v(this.root).readlinkSync(tn)},I.prototype.chown=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc=g(tu,1);try{tn=S(tn),v(this.root).chown(tn,!1,to,ta,tc)}catch(tn){tc(tn)}},I.prototype.chownSync=function(tn,to,ta){tn=S(tn),v(this.root).chownSync(tn,!1,to,ta)},I.prototype.lchown=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc=g(tu,1);try{tn=S(tn),v(this.root).chown(tn,!0,to,ta,tc)}catch(tn){tc(tn)}},I.prototype.lchownSync=function(tn,to,ta){tn=S(tn),v(this.root).chownSync(tn,!0,to,ta)},I.prototype.chmod=function(tn,to,ta){void 0===ta&&(ta=E);var tu=g(ta,1);try{var tc=m(to,-1);if(tc<0)throw new tS(tp.EINVAL,"Invalid mode.");v(this.root).chmod(S(tn),!1,tc,tu)}catch(tn){tu(tn)}},I.prototype.chmodSync=function(tn,to){var ta=m(to,-1);if(ta<0)throw new tS(tp.EINVAL,"Invalid mode.");tn=S(tn),v(this.root).chmodSync(tn,!1,ta)},I.prototype.lchmod=function(tn,to,ta){void 0===ta&&(ta=E);var tu=g(ta,1);try{var tc=m(to,-1);if(tc<0)throw new tS(tp.EINVAL,"Invalid mode.");v(this.root).chmod(S(tn),!0,tc,tu)}catch(tn){tu(tn)}},I.prototype.lchmodSync=function(tn,to){var ta=m(to,-1);if(ta<1)throw new tS(tp.EINVAL,"Invalid mode.");v(this.root).chmodSync(S(tn),!0,ta)},I.prototype.utimes=function(tn,to,ta,tu){void 0===tu&&(tu=E);var tc=g(tu,1);try{v(this.root).utimes(S(tn),w(to),w(ta),tc)}catch(tn){tc(tn)}},I.prototype.utimesSync=function(tn,to,ta){v(this.root).utimesSync(S(tn),w(to),w(ta))},I.prototype.realpath=function(tn,to,ta){void 0===ta&&(ta=E);var tu="object"==typeof to?to:{},tc=g(ta="function"==typeof to?to:E,2);try{tn=S(tn),v(this.root).realpath(tn,tu,tc)}catch(tn){tc(tn)}},I.prototype.realpathSync=function(tn,to){return void 0===to&&(to={}),tn=S(tn),v(this.root).realpathSync(tn,to)},I.prototype.watchFile=function(tn,to,ta){throw new tS(tp.ENOTSUP)},I.prototype.unwatchFile=function(tn,to){throw new tS(tp.ENOTSUP)},I.prototype.watch=function(tn,to,ta){throw new tS(tp.ENOTSUP)},I.prototype.access=function(tn,to,ta){throw new tS(tp.ENOTSUP)},I.prototype.accessSync=function(tn,to){throw new tS(tp.ENOTSUP)},I.prototype.createReadStream=function(tn,to){throw new tS(tp.ENOTSUP)},I.prototype.createWriteStream=function(tn,to){throw new tS(tp.ENOTSUP)},I.prototype.wrapCallbacks=function(tn){g=tn},I.prototype.getFdForFile=function(tn){var to=this.nextFd++;return this.fdMap[to]=tn,to},I.prototype.fd2file=function(tn){var to=this.fdMap[tn];if(to)return to;throw new tS(tp.EBADF,"Invalid file descriptor.")},I.prototype.closeFd=function(tn){delete this.fdMap[tn]},I.Stats=y;var t_=new I,tD={};function A(tn,to,ta,tu,tc){return tn<to||ta<to?tn>ta?ta+1:tn+1:tu===tc?to:to+1}function P(tn,to,ta){tn&&console.warn("["+to+"] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '"+to+".Create("+JSON.stringify(ta)+", callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.")}Object.keys(I.prototype).forEach(function(tn){"function"==typeof t_[tn]?tD[tn]=function(){return t_[tn].apply(t_,arguments)}:tD[tn]=t_[tn]}),tD.changeFSModule=function(tn){t_=tn},tD.getFSModule=function(){return t_},tD.FS=I;var tA="undefined"!=typeof navigator&&!(!/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&-1===navigator.userAgent.indexOf("Trident")),tT="undefined"==typeof window;function k(){throw Error("BFS has reached an impossible code path; please file a bug.")}function N(tn,to,ta){ta.existsSync(tn)||(N(tg.dirname(tn),to,ta),ta.mkdirSync(tn,to))}function C(tn){var to=F(tn),ta=to.byteOffset,tu=to.byteLength;return 0===ta&&tu===to.buffer.byteLength?to.buffer:to.buffer.slice(ta,ta+tu)}function F(tn){return tn instanceof Uint8Array?tn:new Uint8Array(tn)}function L(to){return to instanceof tn?to:to instanceof Uint8Array?M(to):tn.from(to)}function M(to){return to instanceof tn?to:0===to.byteOffset&&to.byteLength===to.buffer.byteLength?j(to.buffer):tn.from(to.buffer,to.byteOffset,to.byteLength)}function j(to){return tn.from(to)}function K(tn,to,ta){if(void 0===to&&(to=0),void 0===ta&&(ta=tn.length),to<0||ta<0||ta>tn.length||to>ta)throw TypeError("Invalid slice bounds on buffer of length "+tn.length+": ["+to+", "+ta+"]");if(0===tn.length)return z();var tu=F(tn),tc=tn[0],th=(tc+1)%255;return tn[0]=th,tu[0]===th?(tu[0]=tc,M(tu.slice(to,ta))):(tn[0]=tc,M(tu.subarray(to,ta)))}var tx=null;function z(){return tx||(tx=tn.alloc(0))}function B(to,ta){tn.isBuffer(to)?ta():ta(new tS(tp.EINVAL,"option must be a Buffer."))}function V(tn,to,ta){var tu=tn.Options,tc=tn.Name,th=0,td=!1,tf=!1;function u(tn){td||(tn&&(td=!0,ta(tn)),0==--th&&tf&&ta())}var c=function(tn){if(tu.hasOwnProperty(tn)){var tf=tu[tn],ty=to[tn];if(null==ty){if(!tf.optional){var tg=Object.keys(to).filter(function(tn){return!(tn in tu)}).map(function(to){return{str:to,distance:function(tn,to){if(tn===to)return 0;if(tn.length>to.length){var ta=tn;tn=to,to=ta}for(var tu=tn.length,tc=to.length;tu>0&&tn.charCodeAt(tu-1)===to.charCodeAt(tc-1);)tu--,tc--;for(var th=0;th<tu&&tn.charCodeAt(th)===to.charCodeAt(th);)th++;if(tc-=th,0==(tu-=th)||1===tc)return tc;for(var td,tf,tp,ty,tg,tv=Array(tu<<1),tm=0;tm<tu;)tv[tu+tm]=tn.charCodeAt(th+tm),tv[tm]=++tm;for(td=0;td+3<tc;)for(var tw=to.charCodeAt(th+(tf=td)),tS=to.charCodeAt(th+(tp=td+1)),tb=to.charCodeAt(th+(ty=td+2)),tE=to.charCodeAt(th+(tg=td+3)),tI=td+=4,t_=0;t_<tu;){var tD=tv[tu+t_],tA=tv[t_];tf=A(tA,tf,tp,tw,tD),tp=A(tf,tp,ty,tS,tD),ty=A(tp,ty,tg,tb,tD),tI=A(ty,tg,tI,tE,tD),tv[t_++]=tI,tg=ty,ty=tp,tp=tf,tf=tA}for(var tT=0;td<tc;){var tx=to.charCodeAt(th+(tf=td));tT=++td;for(var tO=0;tO<tu;tO++){var tP=tv[tO];tv[tO]=tT=tP<tf||tT<tf?tP>tT?tT+1:tP+1:tx===tv[tu+tO]?tf:tf+1,tf=tP}}return tT}(tn,to)}}).filter(function(tn){return tn.distance<5}).sort(function(tn,to){return tn.distance-to.distance});return td?{}:(td=!0,{v:ta(new tS(tp.EINVAL,"["+tc+"] Required option '"+tn+"' not provided."+(tg.length>0?" You provided unrecognized option '"+tg[0].str+"'; perhaps you meant to type '"+tn+"'.":"")+"\nOption description: "+tf.description))})}}else{if(!(Array.isArray(tf.type)?-1!==tf.type.indexOf(typeof ty):typeof ty===tf.type))return td?{}:(td=!0,{v:ta(new tS(tp.EINVAL,"["+tc+"] Value provided for option "+tn+" is not the proper type. Expected "+(Array.isArray(tf.type)?"one of {"+tf.type.join(", ")+"}":tf.type)+", but received "+typeof ty+"\nOption description: "+tf.description))});tf.validator&&(th++,tf.validator(ty,u))}}};for(var ty in tu){var tg=c(ty);if(tg)return tg.v}tf=!0,0!==th||td||ta()}var tO=Object.freeze({deprecationMessage:P,isIE:tA,isWebWorker:tT,fail:k,mkdirpSync:N,buffer2ArrayBuffer:C,buffer2Uint8array:F,arrayish2Buffer:L,uint8Array2Buffer:M,arrayBuffer2Buffer:j,copyingSlice:K,emptyBuffer:z,bufferValidator:B,checkOptions:V}),Y=function(tn){this.fs=tn,this.nodefs=tn.getNodeFS(),this.FS=tn.getFS(),this.PATH=tn.getPATH(),this.ERRNO_CODES=tn.getERRNO_CODES()};Y.prototype.open=function(tn){var to=this.fs.realPath(tn.node),ta=this.FS;try{ta.isFile(tn.node.mode)&&(tn.nfd=this.nodefs.openSync(to,this.fs.flagsToPermissionString(tn.flags)))}catch(tn){if(!tn.code)throw tn;throw new ta.ErrnoError(this.ERRNO_CODES[tn.code])}},Y.prototype.close=function(tn){var to=this.FS;try{to.isFile(tn.node.mode)&&tn.nfd&&this.nodefs.closeSync(tn.nfd)}catch(tn){if(!tn.code)throw tn;throw new to.ErrnoError(this.ERRNO_CODES[tn.code])}},Y.prototype.read=function(tn,to,ta,tu,tc){try{return this.nodefs.readSync(tn.nfd,M(to),ta,tu,tc)}catch(tn){throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},Y.prototype.write=function(tn,to,ta,tu,tc){try{return this.nodefs.writeSync(tn.nfd,M(to),ta,tu,tc)}catch(tn){throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},Y.prototype.llseek=function(tn,to,ta){var tu=to;if(1===ta)tu+=tn.position;else if(2===ta&&this.FS.isFile(tn.node.mode))try{tu+=this.nodefs.fstatSync(tn.nfd).size}catch(tn){throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}if(tu<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return tn.position=tu,tu};var W=function(tn){this.fs=tn,this.nodefs=tn.getNodeFS(),this.FS=tn.getFS(),this.PATH=tn.getPATH(),this.ERRNO_CODES=tn.getERRNO_CODES()};W.prototype.getattr=function(tn){var to,ta=this.fs.realPath(tn);try{to=this.nodefs.lstatSync(ta)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}return{dev:to.dev,ino:to.ino,mode:to.mode,nlink:to.nlink,uid:to.uid,gid:to.gid,rdev:to.rdev,size:to.size,atime:to.atime,mtime:to.mtime,ctime:to.ctime,blksize:to.blksize,blocks:to.blocks}},W.prototype.setattr=function(tn,to){var ta=this.fs.realPath(tn);try{if(void 0!==to.mode&&(this.nodefs.chmodSync(ta,to.mode),tn.mode=to.mode),void 0!==to.timestamp){var tu=new Date(to.timestamp);this.nodefs.utimesSync(ta,tu,tu)}}catch(tn){if(!tn.code)throw tn;if("ENOTSUP"!==tn.code)throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}if(void 0!==to.size)try{this.nodefs.truncateSync(ta,to.size)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},W.prototype.lookup=function(tn,to){var ta=this.PATH.join2(this.fs.realPath(tn),to),tu=this.fs.getMode(ta);return this.fs.createNode(tn,to,tu)},W.prototype.mknod=function(tn,to,ta,tu){var tc=this.fs.createNode(tn,to,ta,tu),th=this.fs.realPath(tc);try{this.FS.isDir(tc.mode)?this.nodefs.mkdirSync(th,tc.mode):this.nodefs.writeFileSync(th,"",{mode:tc.mode})}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}return tc},W.prototype.rename=function(tn,to,ta){var tu=this.fs.realPath(tn),tc=this.PATH.join2(this.fs.realPath(to),ta);try{this.nodefs.renameSync(tu,tc),tn.name=ta,tn.parent=to}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},W.prototype.unlink=function(tn,to){var ta=this.PATH.join2(this.fs.realPath(tn),to);try{this.nodefs.unlinkSync(ta)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},W.prototype.rmdir=function(tn,to){var ta=this.PATH.join2(this.fs.realPath(tn),to);try{this.nodefs.rmdirSync(ta)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},W.prototype.readdir=function(tn){var to=this.fs.realPath(tn);try{var ta=this.nodefs.readdirSync(to);return ta.push(".",".."),ta}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},W.prototype.symlink=function(tn,to,ta){var tu=this.PATH.join2(this.fs.realPath(tn),to);try{this.nodefs.symlinkSync(ta,tu)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}},W.prototype.readlink=function(tn){var to=this.fs.realPath(tn);try{return this.nodefs.readlinkSync(to)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}};var H=function(tn,to,ta,tu){void 0===tn&&(tn=self.FS),void 0===to&&(to=self.PATH),void 0===ta&&(ta=self.ERRNO_CODES),void 0===tu&&(tu=tD),this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=tu,this.FS=tn,this.PATH=to,this.ERRNO_CODES=ta,this.node_ops=new W(this),this.stream_ops=new Y(this)};H.prototype.mount=function(tn){return this.createNode(null,"/",this.getMode(tn.opts.root),0)},H.prototype.createNode=function(tn,to,ta,tu){var tc=this.FS;if(!tc.isDir(ta)&&!tc.isFile(ta)&&!tc.isLink(ta))throw new tc.ErrnoError(this.ERRNO_CODES.EINVAL);var th=tc.createNode(tn,to,ta);return th.node_ops=this.node_ops,th.stream_ops=this.stream_ops,th},H.prototype.getMode=function(tn){var to;try{to=this.nodefs.lstatSync(tn)}catch(tn){if(!tn.code)throw tn;throw new this.FS.ErrnoError(this.ERRNO_CODES[tn.code])}return to.mode},H.prototype.realPath=function(tn){for(var to=[];tn.parent!==tn;)to.push(tn.name),tn=tn.parent;return to.push(tn.mount.opts.root),to.reverse(),this.PATH.join.apply(null,to)},H.prototype.flagsToPermissionString=function(tn){var to="string"==typeof tn?parseInt(tn,10):tn;return(to&=8191)in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[to]:tn},H.prototype.getNodeFS=function(){return this.nodefs},H.prototype.getFS=function(){return this.FS},H.prototype.getPATH=function(){return this.PATH},H.prototype.getERRNO_CODES=function(){return this.ERRNO_CODES};var J=function(){};J.prototype.supportsLinks=function(){return!1},J.prototype.diskSpace=function(tn,to){to(0,0)},J.prototype.openFile=function(tn,to,ta){throw new tS(tp.ENOTSUP)},J.prototype.createFile=function(tn,to,ta,tu){throw new tS(tp.ENOTSUP)},J.prototype.open=function(tn,to,ta,tu){var tc=this;this.stat(tn,!1,function(th,td){if(th)switch(to.pathNotExistsAction()){case tw.CREATE_FILE:return tc.stat(tg.dirname(tn),!1,function(th,td){th?tu(th):td&&!td.isDirectory()?tu(tS.ENOTDIR(tg.dirname(tn))):tc.createFile(tn,to,ta,tu)});case tw.THROW_EXCEPTION:return tu(tS.ENOENT(tn));default:return tu(new tS(tp.EINVAL,"Invalid FileFlag object."))}else{if(td&&td.isDirectory())return tu(tS.EISDIR(tn));switch(to.pathExistsAction()){case tw.THROW_EXCEPTION:return tu(tS.EEXIST(tn));case tw.TRUNCATE_FILE:return tc.openFile(tn,to,function(tn,to){tn?tu(tn):to?to.truncate(0,function(){to.sync(function(){tu(null,to)})}):k()});case tw.NOP:return tc.openFile(tn,to,tu);default:return tu(new tS(tp.EINVAL,"Invalid FileFlag object."))}}})},J.prototype.rename=function(tn,to,ta){ta(new tS(tp.ENOTSUP))},J.prototype.renameSync=function(tn,to){throw new tS(tp.ENOTSUP)},J.prototype.stat=function(tn,to,ta){ta(new tS(tp.ENOTSUP))},J.prototype.statSync=function(tn,to){throw new tS(tp.ENOTSUP)},J.prototype.openFileSync=function(tn,to,ta){throw new tS(tp.ENOTSUP)},J.prototype.createFileSync=function(tn,to,ta){throw new tS(tp.ENOTSUP)},J.prototype.openSync=function(tn,to,ta){var tu;try{tu=this.statSync(tn,!1)}catch(tu){switch(to.pathNotExistsAction()){case tw.CREATE_FILE:if(!this.statSync(tg.dirname(tn),!1).isDirectory())throw tS.ENOTDIR(tg.dirname(tn));return this.createFileSync(tn,to,ta);case tw.THROW_EXCEPTION:throw tS.ENOENT(tn);default:throw new tS(tp.EINVAL,"Invalid FileFlag object.")}}if(tu.isDirectory())throw tS.EISDIR(tn);switch(to.pathExistsAction()){case tw.THROW_EXCEPTION:throw tS.EEXIST(tn);case tw.TRUNCATE_FILE:return this.unlinkSync(tn),this.createFileSync(tn,to,tu.mode);case tw.NOP:return this.openFileSync(tn,to,ta);default:throw new tS(tp.EINVAL,"Invalid FileFlag object.")}},J.prototype.unlink=function(tn,to){to(new tS(tp.ENOTSUP))},J.prototype.unlinkSync=function(tn){throw new tS(tp.ENOTSUP)},J.prototype.rmdir=function(tn,to){to(new tS(tp.ENOTSUP))},J.prototype.rmdirSync=function(tn){throw new tS(tp.ENOTSUP)},J.prototype.mkdir=function(tn,to,ta){ta(new tS(tp.ENOTSUP))},J.prototype.mkdirSync=function(tn,to){throw new tS(tp.ENOTSUP)},J.prototype.readdir=function(tn,to){to(new tS(tp.ENOTSUP))},J.prototype.readdirSync=function(tn){throw new tS(tp.ENOTSUP)},J.prototype.exists=function(tn,to){this.stat(tn,null,function(tn){to(!tn)})},J.prototype.existsSync=function(tn){try{return this.statSync(tn,!0),!0}catch(tn){return!1}},J.prototype.realpath=function(tn,to,ta){if(this.supportsLinks())for(var tu=tn.split(tg.sep),tc=0;tc<tu.length;tc++){var th=tu.slice(0,tc+1);tu[tc]=tg.join.apply(null,th)}else this.exists(tn,function(to){to?ta(null,tn):ta(tS.ENOENT(tn))})},J.prototype.realpathSync=function(tn,to){if(this.supportsLinks()){for(var ta=tn.split(tg.sep),tu=0;tu<ta.length;tu++){var tc=ta.slice(0,tu+1);ta[tu]=tg.join.apply(tg,tc)}return ta.join(tg.sep)}if(this.existsSync(tn))return tn;throw tS.ENOENT(tn)},J.prototype.truncate=function(tn,to,ta){this.open(tn,p.getFileFlag("r+"),420,function(tn,tu){if(tn)return ta(tn);tu.truncate(to,function(tn){tu.close(function(to){ta(tn||to)})})})},J.prototype.truncateSync=function(tn,to){var ta=this.openSync(tn,p.getFileFlag("r+"),420);try{ta.truncateSync(to)}catch(tn){throw tn}finally{ta.closeSync()}},J.prototype.readFile=function(to,ta,tu,tc){var th=tc;this.open(to,tu,420,function(to,tu){if(to)return tc(to);tc=function(tn,to){tu.close(function(ta){return tn||(tn=ta),th(tn,to)})},tu.stat(function(to,th){if(to)return tc(to);var td=tn.alloc(th.size);tu.read(td,0,th.size,0,function(tn){if(tn)return tc(tn);if(null===ta)return tc(tn,td);try{tc(null,td.toString(ta))}catch(tn){tc(tn)}})})})},J.prototype.readFileSync=function(to,ta,tu){var tc=this.openSync(to,tu,420);try{var th=tc.statSync(),td=tn.alloc(th.size);return tc.readSync(td,0,th.size,0),tc.closeSync(),null===ta?td:td.toString(ta)}finally{tc.closeSync()}},J.prototype.writeFile=function(to,ta,tu,tc,th,td){var tf=td;this.open(to,tc,420,function(to,tc){if(to)return td(to);td=function(tn){tc.close(function(to){tf(tn||to)})};try{"string"==typeof ta&&(ta=tn.from(ta,tu))}catch(tn){return td(tn)}tc.write(ta,0,ta.length,0,td)})},J.prototype.writeFileSync=function(to,ta,tu,tc,th){var td=this.openSync(to,tc,th);try{"string"==typeof ta&&(ta=tn.from(ta,tu)),td.writeSync(ta,0,ta.length,0)}finally{td.closeSync()}},J.prototype.appendFile=function(to,ta,tu,tc,th,td){var tf=td;this.open(to,tc,th,function(to,tc){if(to)return td(to);td=function(tn){tc.close(function(to){tf(tn||to)})},"string"==typeof ta&&(ta=tn.from(ta,tu)),tc.write(ta,0,ta.length,null,td)})},J.prototype.appendFileSync=function(to,ta,tu,tc,th){var td=this.openSync(to,tc,th);try{"string"==typeof ta&&(ta=tn.from(ta,tu)),td.writeSync(ta,0,ta.length,null)}finally{td.closeSync()}},J.prototype.chmod=function(tn,to,ta,tu){tu(new tS(tp.ENOTSUP))},J.prototype.chmodSync=function(tn,to,ta){throw new tS(tp.ENOTSUP)},J.prototype.chown=function(tn,to,ta,tu,tc){tc(new tS(tp.ENOTSUP))},J.prototype.chownSync=function(tn,to,ta,tu){throw new tS(tp.ENOTSUP)},J.prototype.utimes=function(tn,to,ta,tu){tu(new tS(tp.ENOTSUP))},J.prototype.utimesSync=function(tn,to,ta){throw new tS(tp.ENOTSUP)},J.prototype.link=function(tn,to,ta){ta(new tS(tp.ENOTSUP))},J.prototype.linkSync=function(tn,to){throw new tS(tp.ENOTSUP)},J.prototype.symlink=function(tn,to,ta,tu){tu(new tS(tp.ENOTSUP))},J.prototype.symlinkSync=function(tn,to,ta){throw new tS(tp.ENOTSUP)},J.prototype.readlink=function(tn,to){to(new tS(tp.ENOTSUP))},J.prototype.readlinkSync=function(tn){throw new tS(tp.ENOTSUP)};var tP=function(tn){function e(){tn.apply(this,arguments)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.supportsSynch=function(){return!0},e.prototype.rename=function(tn,to,ta){try{this.renameSync(tn,to),ta()}catch(tn){ta(tn)}},e.prototype.stat=function(tn,to,ta){try{ta(null,this.statSync(tn,to))}catch(tn){ta(tn)}},e.prototype.open=function(tn,to,ta,tu){try{tu(null,this.openSync(tn,to,ta))}catch(tn){tu(tn)}},e.prototype.unlink=function(tn,to){try{this.unlinkSync(tn),to()}catch(tn){to(tn)}},e.prototype.rmdir=function(tn,to){try{this.rmdirSync(tn),to()}catch(tn){to(tn)}},e.prototype.mkdir=function(tn,to,ta){try{this.mkdirSync(tn,to),ta()}catch(tn){ta(tn)}},e.prototype.readdir=function(tn,to){try{to(null,this.readdirSync(tn))}catch(tn){to(tn)}},e.prototype.chmod=function(tn,to,ta,tu){try{this.chmodSync(tn,to,ta),tu()}catch(tn){tu(tn)}},e.prototype.chown=function(tn,to,ta,tu,tc){try{this.chownSync(tn,to,ta,tu),tc()}catch(tn){tc(tn)}},e.prototype.utimes=function(tn,to,ta,tu){try{this.utimesSync(tn,to,ta),tu()}catch(tn){tu(tn)}},e.prototype.link=function(tn,to,ta){try{this.linkSync(tn,to),ta()}catch(tn){ta(tn)}},e.prototype.symlink=function(tn,to,ta,tu){try{this.symlinkSync(tn,to,ta),tu()}catch(tn){tu(tn)}},e.prototype.readlink=function(tn,to){try{to(null,this.readlinkSync(tn))}catch(tn){to(tn)}},e}(J),G=function(){};G.prototype.sync=function(tn){tn(new tS(tp.ENOTSUP))},G.prototype.syncSync=function(){throw new tS(tp.ENOTSUP)},G.prototype.datasync=function(tn){this.sync(tn)},G.prototype.datasyncSync=function(){return this.syncSync()},G.prototype.chown=function(tn,to,ta){ta(new tS(tp.ENOTSUP))},G.prototype.chownSync=function(tn,to){throw new tS(tp.ENOTSUP)},G.prototype.chmod=function(tn,to){to(new tS(tp.ENOTSUP))},G.prototype.chmodSync=function(tn){throw new tS(tp.ENOTSUP)},G.prototype.utimes=function(tn,to,ta){ta(new tS(tp.ENOTSUP))},G.prototype.utimesSync=function(tn,to){throw new tS(tp.ENOTSUP)};var tR=function(to){function i(tn,ta,tu,tc,th){if(to.call(this),this._pos=0,this._dirty=!1,this._fs=tn,this._path=ta,this._flag=tu,this._stat=tc,this._buffer=th||z(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return to&&(i.__proto__=to),i.prototype=Object.create(to&&to.prototype),i.prototype.constructor=i,i.prototype.getBuffer=function(){return this._buffer},i.prototype.getStats=function(){return this._stat},i.prototype.getFlag=function(){return this._flag},i.prototype.getPath=function(){return this._path},i.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},i.prototype.advancePos=function(tn){return this._pos+=tn},i.prototype.setPos=function(tn){return this._pos=tn},i.prototype.sync=function(tn){try{this.syncSync(),tn()}catch(to){tn(to)}},i.prototype.syncSync=function(){throw new tS(tp.ENOTSUP)},i.prototype.close=function(tn){try{this.closeSync(),tn()}catch(to){tn(to)}},i.prototype.closeSync=function(){throw new tS(tp.ENOTSUP)},i.prototype.stat=function(tn){try{tn(null,this._stat.clone())}catch(to){tn(to)}},i.prototype.statSync=function(){return this._stat.clone()},i.prototype.truncate=function(tn,to){try{this.truncateSync(tn),this._flag.isSynchronous()&&!tD.getRootFS().supportsSynch()&&this.sync(to),to()}catch(tn){return to(tn)}},i.prototype.truncateSync=function(to){if(this._dirty=!0,!this._flag.isWriteable())throw new tS(tp.EPERM,"File not opened with a writeable mode.");if(this._stat.mtime=new Date,to>this._buffer.length){var ta=tn.alloc(to-this._buffer.length,0);return this.writeSync(ta,0,ta.length,this._buffer.length),void(this._flag.isSynchronous()&&tD.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=to;var tu=tn.alloc(to);this._buffer.copy(tu,0,0,to),this._buffer=tu,this._flag.isSynchronous()&&tD.getRootFS().supportsSynch()&&this.syncSync()},i.prototype.write=function(tn,to,ta,tu,tc){try{tc(null,this.writeSync(tn,to,ta,tu),tn)}catch(tn){tc(tn)}},i.prototype.writeSync=function(to,ta,tu,tc){if(this._dirty=!0,null==tc&&(tc=this.getPos()),!this._flag.isWriteable())throw new tS(tp.EPERM,"File not opened with a writeable mode.");var th=tc+tu;if(th>this._stat.size&&(this._stat.size=th,th>this._buffer.length)){var td=tn.alloc(th);this._buffer.copy(td),this._buffer=td}var tf=to.copy(this._buffer,tc,ta,ta+tu);return this._stat.mtime=new Date,this._flag.isSynchronous()?this.syncSync():this.setPos(tc+tf),tf},i.prototype.read=function(tn,to,ta,tu,tc){try{tc(null,this.readSync(tn,to,ta,tu),tn)}catch(tn){tc(tn)}},i.prototype.readSync=function(tn,to,ta,tu){if(!this._flag.isReadable())throw new tS(tp.EPERM,"File not opened with a readable mode.");null==tu&&(tu=this.getPos()),tu+ta>this._stat.size&&(ta=this._stat.size-tu);var tc=this._buffer.copy(tn,to,tu,tu+ta);return this._stat.atime=new Date,this._pos=tu+ta,tc},i.prototype.chmod=function(tn,to){try{this.chmodSync(tn),to()}catch(tn){to(tn)}},i.prototype.chmodSync=function(tn){if(!this._fs.supportsProps())throw new tS(tp.ENOTSUP);this._dirty=!0,this._stat.chmod(tn),this.syncSync()},i.prototype.isDirty=function(){return this._dirty},i.prototype.resetDirty=function(){this._dirty=!1},i}(G),tk=function(tn){function e(to,ta,tu,tc,th){tn.call(this,to,ta,tu,tc,th)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.sync=function(tn){tn()},e.prototype.syncSync=function(){},e.prototype.close=function(tn){tn()},e.prototype.closeSync=function(){},e}(tR),tN=function(tn){function e(to,ta,tu,tc,th){tn.call(this,to,ta,tu,tc,th)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(tR),tF=function(tn){function e(to,ta,tu){if(void 0===tu&&(tu=!0),tn.call(this),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=to,this._async=ta,!to.supportsSynch())throw Error("The first argument to AsyncMirror needs to be a synchronous file system.");P(tu,e.Name,{sync:"sync file system instance",async:"async file system instance"})}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){try{var ta=new e(tn.sync,tn.async,!1);ta.initialize(function(tn){tn?to(tn):to(null,ta)},!1)}catch(tn){to(tn)}},e.isAvailable=function(){return!0},e.prototype.getName=function(){return e.Name},e.prototype._syncSync=function(tn){this._sync.writeFileSync(tn.getPath(),tn.getBuffer(),null,p.getFileFlag("w"),tn.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[tn.getPath(),tn.getBuffer(),null,tn.getFlag(),tn.getStats().mode]})},e.prototype.initialize=function(tn,to){var ta=this;void 0===to&&(to=!0),to&&console.warn("[AsyncMirror] AsyncMirror.initialize() is deprecated and will be removed in the next major version. Please use 'AsyncMirror.Create({ sync: (sync file system instance), async: (async file system instance)}, cb)' to create and initialize AsyncMirror instances.");var tu=this._initializeCallbacks;if(this._isInitialized)tn();else if(1===tu.push(tn)){var n=function(tn,to,tu){"/"!==tn&&ta._sync.mkdirSync(tn,to),ta._async.readdir(tn,function(to,ta){var tc=0;to?tu(to):function e(to){to?tu(to):tc<ta.length?(o(tg.join(tn,ta[tc]),e),tc++):tu()}()})},o=function(tn,to){ta._async.stat(tn,!1,function(tu,tc){var th;tu?to(tu):tc.isDirectory()?n(tn,tc.mode,to):(th=tc.mode,ta._async.readFile(tn,null,p.getFileFlag("r"),function(tu,tc){if(tu)to(tu);else try{ta._sync.writeFileSync(tn,tc,null,p.getFileFlag("w"),th)}catch(tn){tu=tn}finally{to(tu)}}))})};n("/",0,function(tn){ta._isInitialized=!tn,ta._initializeCallbacks=[],tu.forEach(function(to){return to(tn)})})}},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._sync.supportsProps()&&this._async.supportsProps()},e.prototype.renameSync=function(tn,to){this.checkInitialized(),this._sync.renameSync(tn,to),this.enqueueOp({apiMethod:"rename",arguments:[tn,to]})},e.prototype.statSync=function(tn,to){return this.checkInitialized(),this._sync.statSync(tn,to)},e.prototype.openSync=function(tn,to,ta){return this.checkInitialized(),this._sync.openSync(tn,to,ta).closeSync(),new tN(this,tn,to,this._sync.statSync(tn,!1),this._sync.readFileSync(tn,null,p.getFileFlag("r")))},e.prototype.unlinkSync=function(tn){this.checkInitialized(),this._sync.unlinkSync(tn),this.enqueueOp({apiMethod:"unlink",arguments:[tn]})},e.prototype.rmdirSync=function(tn){this.checkInitialized(),this._sync.rmdirSync(tn),this.enqueueOp({apiMethod:"rmdir",arguments:[tn]})},e.prototype.mkdirSync=function(tn,to){this.checkInitialized(),this._sync.mkdirSync(tn,to),this.enqueueOp({apiMethod:"mkdir",arguments:[tn,to]})},e.prototype.readdirSync=function(tn){return this.checkInitialized(),this._sync.readdirSync(tn)},e.prototype.existsSync=function(tn){return this.checkInitialized(),this._sync.existsSync(tn)},e.prototype.chmodSync=function(tn,to,ta){this.checkInitialized(),this._sync.chmodSync(tn,to,ta),this.enqueueOp({apiMethod:"chmod",arguments:[tn,to,ta]})},e.prototype.chownSync=function(tn,to,ta,tu){this.checkInitialized(),this._sync.chownSync(tn,to,ta,tu),this.enqueueOp({apiMethod:"chown",arguments:[tn,to,ta,tu]})},e.prototype.utimesSync=function(tn,to,ta){this.checkInitialized(),this._sync.utimesSync(tn,to,ta),this.enqueueOp({apiMethod:"utimes",arguments:[tn,to,ta]})},e.prototype.checkInitialized=function(){if(!this._isInitialized)throw new tS(tp.EPERM,"AsyncMirrorFS is not initialized. Please initialize AsyncMirrorFS using its initialize() method before using it.")},e.prototype.enqueueOp=function(tn){var to=this;if(this._queue.push(tn),!this._queueRunning){this._queueRunning=!0;var i=function(tn){if(tn&&console.error("WARNING: File system has desynchronized. Received following error: "+tn+"\n$"),to._queue.length>0){var ta=to._queue.shift(),tu=ta.arguments;tu.push(i),to._async[ta.apiMethod].apply(to._async,tu)}else to._queueRunning=!1};i()}},e}(tP);tF.Name="AsyncMirror",tF.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to."},async:{type:"object",description:"The asynchronous file system to mirror."}};var tC="object"==typeof tu&&tu&&tu.Object===Object&&tu,tL="object"==typeof self&&self&&self.Object===Object&&self,tj=tC||tL||Function("return this")(),tM=tj.Symbol,tK=Object.prototype,tB=tK.hasOwnProperty,tU=tK.toString,tq=tM?tM.toStringTag:void 0,tz=Object.prototype.toString,tV=tM?tM.toStringTag:void 0;function ft(tn){return null==tn?void 0===tn?"[object Undefined]":"[object Null]":tV&&tV in Object(tn)?function(tn){var to=tB.call(tn,tq),ta=tn[tq];try{tn[tq]=void 0;var tu=!0}catch(tn){}var tc=tU.call(tn);return tu&&(to?tn[tq]=ta:delete tn[tq]),tc}(tn):tz.call(tn)}function wt(tn){return"number"==typeof tn&&tn>-1&&tn%1==0&&tn<=9007199254740991}function St(tn){return null!=tn&&wt(tn.length)&&!function(tn){if(to=typeof tn,null==tn||"object"!=to&&"function"!=to)return!1;var to,ta=ft(tn);return"[object Function]"==ta||"[object GeneratorFunction]"==ta||"[object AsyncFunction]"==ta||"[object Proxy]"==ta}(tn)}var tJ={};function Et(){}function It(tn){return function(){if(null!==tn){var to=tn;tn=null,to.apply(this,arguments)}}}var tW="function"==typeof Symbol&&Symbol.iterator;function Tt(tn){return null!=tn&&"object"==typeof tn}function At(tn){return Tt(tn)&&"[object Arguments]"==ft(tn)}var tY=Object.prototype,tH=tY.hasOwnProperty,tX=tY.propertyIsEnumerable,tG=At(function(){return arguments}())?At:function(tn){return Tt(tn)&&tH.call(tn,"callee")&&!tX.call(tn,"callee")},tZ=Array.isArray,tQ="object"==typeof to&&to&&!to.nodeType&&to,t$=tQ&&"object"==typeof tc&&tc&&!tc.nodeType&&tc,t0=t$&&t$.exports===tQ?tj.Buffer:void 0,t1=(t0?t0.isBuffer:void 0)||function(){return!1},t2=/^(?:0|[1-9]\d*)$/,t5={};t5["[object Float32Array]"]=t5["[object Float64Array]"]=t5["[object Int8Array]"]=t5["[object Int16Array]"]=t5["[object Int32Array]"]=t5["[object Uint8Array]"]=t5["[object Uint8ClampedArray]"]=t5["[object Uint16Array]"]=t5["[object Uint32Array]"]=!0,t5["[object Arguments]"]=t5["[object Array]"]=t5["[object ArrayBuffer]"]=t5["[object Boolean]"]=t5["[object DataView]"]=t5["[object Date]"]=t5["[object Error]"]=t5["[object Function]"]=t5["[object Map]"]=t5["[object Number]"]=t5["[object Object]"]=t5["[object RegExp]"]=t5["[object Set]"]=t5["[object String]"]=t5["[object WeakMap]"]=!1;var t3="object"==typeof to&&to&&!to.nodeType&&to,t6=t3&&"object"==typeof tc&&tc&&!tc.nodeType&&tc,t8=t6&&t6.exports===t3&&tC.process,t4=function(){try{return t8&&t8.binding&&t8.binding("util")}catch(tn){}}(),t7=t4&&t4.isTypedArray,t9=t7?function(tn){return t7(tn)}:function(tn){return Tt(tn)&&wt(tn.length)&&!!t5[ft(tn)]},ei=Object.prototype.hasOwnProperty,en=Object.prototype,eo=(ec=Object.keys,eh=Object,function(tn){return ec(eh(tn))}),ea=Object.prototype.hasOwnProperty;function ee(tn){return function(){if(null===tn)throw Error("Callback was already called.");var to=tn;tn=null,to.apply(this,arguments)}}var eu,ec,eh,ed,ef,ep,ey=(ed=function(tn,to,ta,tu){(function(tn,ta,tu){if(tu=It(tu||Et),to<=0||!tn)return tu(null);var tc=function(tn){if(St(tn))return to=-1,ta=tn.length,function(){return++to<ta?{value:tn[to],key:to}:null};var to,ta,tu,tc,th,td,tf=tW&&tn[tW]&&tn[tW]();return tf?(tu=-1,function(){var tn=tf.next();return tn.done?null:(tu++,{value:tn.value,key:tu})}):(tc=St(tn)?function(tn,to){var ta,tu=tZ(tn),tc=!tu&&tG(tn),th=!tu&&!tc&&t1(tn),td=!tu&&!tc&&!th&&t9(tn),tf=tu||tc||th||td,tp=tf?function(tn,to){for(var ta=-1,tu=Array(tn);++ta<tn;)tu[ta]=to(ta);return tu}(tn.length,String):[],ty=tp.length;for(var tg in tn)!ei.call(tn,tg)||tf&&("length"==tg||th&&("offset"==tg||"parent"==tg)||td&&("buffer"==tg||"byteLength"==tg||"byteOffset"==tg)||(ta=null==(ta=ty)?9007199254740991:ta)&&("number"==typeof tg||t2.test(tg))&&tg>-1&&tg%1==0&&tg<ta)||tp.push(tg);return tp}(tn):function(tn){if(to=tn&&tn.constructor,tn!==("function"==typeof to&&to.prototype||en))return eo(tn);var to,ta=[];for(var tu in Object(tn))ea.call(tn,tu)&&"constructor"!=tu&&ta.push(tu);return ta}(tn),th=-1,td=tc.length,function(){var to=tc[++th];return th<td?{value:tn[to],key:to}:null})}(tn),th=!1,td=0;function a(tn,to){if(td-=1,tn)th=!0,tu(tn);else{if(to===tJ||th&&td<=0)return th=!0,tu(null);l()}}function l(){for(;td<to&&!th;){var tn=tc();if(null===tn)return th=!0,void(td<=0&&tu(null));td+=1,ta(tn.value,tn.key,ee(a))}}l()})(tn,ta,tu)},ef=1/0,function(tn,to,ta){return ed(tn,ef,to,ta)}),eg="function"==typeof setImmediate&&setImmediate,ev="object"==typeof th&&"function"==typeof th.nextTick;function ce(tn,to,ta){!function(tn,to,ta){(St(tn)?function(tn,to,ta){ta=It(ta||Et);var tu=0,tc=0,th=tn.length;function s(tn,to){tn?ta(tn):++tc!==th&&to!==tJ||ta(null)}for(0===th&&ta(null);tu<th;tu++)to(tn[tu],tu,ee(s))}:ey)(tn,to,ta)}(tn,function(tn,ta,tu){return to(tn,tu)},ta)}eg&&setImmediate,ev||eg&&setImmediate;var he=function(tn){this._cache={},this._client=tn};he.prototype.readdir=function(tn,to){var ta=this,tu=this.getCachedDirInfo(tn);this._wrap(function(to){null!==tu&&tu.contents?ta._client.readdir(tn,{contentHash:tu.stat.contentHash},to):ta._client.readdir(tn,to)},function(tc,th,td,tf){tc?tc.status===Dropbox.ApiError.NO_CONTENT&&null!==tu?to(null,tu.contents.slice(0)):to(tc):(ta.updateCachedDirInfo(tn,td,th.slice(0)),tf.forEach(function(to){ta.updateCachedInfo(tg.join(tn,to.name),to)}),to(null,th))})},he.prototype.remove=function(tn,to){var ta=this;this._wrap(function(to){ta._client.remove(tn,to)},function(tu,tc){tu||ta.updateCachedInfo(tn,tc),to(tu)})},he.prototype.move=function(tn,to,ta){var tu=this;this._wrap(function(ta){tu._client.move(tn,to,ta)},function(tc,th){tc||(tu.deleteCachedInfo(tn),tu.updateCachedInfo(to,th)),ta(tc)})},he.prototype.stat=function(tn,to){var ta=this;this._wrap(function(to){ta._client.stat(tn,to)},function(tu,tc){tu||ta.updateCachedInfo(tn,tc),to(tu,tc)})},he.prototype.readFile=function(tn,to){var ta=this,tu=this.getCachedFileInfo(tn);null!==tu&&null!==tu.contents?this.stat(tn,function(tc,th){tc?to(tc):th.contentHash===tu.stat.contentHash?to(tc,tu.contents.slice(0),tu.stat):ta.readFile(tn,to)}):this._wrap(function(to){ta._client.readFile(tn,{arrayBuffer:!0},to)},function(tu,tc,th){tu||ta.updateCachedInfo(tn,th,tc.slice(0)),to(tu,tc,th)})},he.prototype.writeFile=function(tn,to,ta){var tu=this;this._wrap(function(ta){tu._client.writeFile(tn,to,ta)},function(tc,th){tc||tu.updateCachedInfo(tn,th,to.slice(0)),ta(tc,th)})},he.prototype.mkdir=function(tn,to){var ta=this;this._wrap(function(to){ta._client.mkdir(tn,to)},function(tu,tc){tu||ta.updateCachedInfo(tn,tc,[]),to(tu)})},he.prototype._wrap=function(tn,to){var ta=0,r=function(tu){if(tu&&3>++ta)switch(tu.status){case Dropbox.ApiError.SERVER_ERROR:case Dropbox.ApiError.NETWORK_ERROR:case Dropbox.ApiError.RATE_LIMITED:setTimeout(function(){tn(r)},2e3);break;default:to.apply(null,arguments)}else to.apply(null,arguments)};tn(r)},he.prototype.getCachedInfo=function(tn){return this._cache[tn.toLowerCase()]},he.prototype.putCachedInfo=function(tn,to){this._cache[tn.toLowerCase()]=to},he.prototype.deleteCachedInfo=function(tn){delete this._cache[tn.toLowerCase()]},he.prototype.getCachedDirInfo=function(tn){var to=this.getCachedInfo(tn);return to&&to.stat.isFolder?to:null},he.prototype.getCachedFileInfo=function(tn){var to=this.getCachedInfo(tn);return to&&to.stat.isFile?to:null},he.prototype.updateCachedDirInfo=function(tn,to,ta){void 0===ta&&(ta=null);var tu=this.getCachedInfo(tn);null===to.contentHash||void 0!==tu&&tu.stat.contentHash===to.contentHash||this.putCachedInfo(tn,{stat:to,contents:ta})},he.prototype.updateCachedFileInfo=function(tn,to,ta){void 0===ta&&(ta=null);var tu=this.getCachedInfo(tn);null===to.versionTag||void 0!==tu&&tu.stat.versionTag===to.versionTag||this.putCachedInfo(tn,{stat:to,contents:ta})},he.prototype.updateCachedInfo=function(tn,to,ta){var tu;void 0===ta&&(ta=null),to.isFile&&(null==(tu=ta)||"object"==typeof tu&&"number"==typeof tu.byteLength)?this.updateCachedFileInfo(tn,to,ta):to.isFolder&&Array.isArray(ta)&&this.updateCachedDirInfo(tn,to,ta)};var em=function(tn){function e(to,ta,tu,tc,th){tn.call(this,to,ta,tu,tc,th)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.sync=function(tn){var to=this;if(this.isDirty()){var ta=C(this.getBuffer());this._fs._writeFileStrict(this.getPath(),ta,function(ta){ta||to.resetDirty(),tn(ta)})}else tn()},e.prototype.close=function(tn){this.sync(tn)},e}(tR),ew=function(tn){function e(to,ta){void 0===ta&&(ta=!0),tn.call(this),this._client=new he(to),P(ta,e.Name,{client:"authenticated dropbox client instance"}),ep||((ep={})[Dropbox.ApiError.NETWORK_ERROR]=tp.EIO,ep[Dropbox.ApiError.INVALID_PARAM]=tp.EINVAL,ep[Dropbox.ApiError.INVALID_TOKEN]=tp.EPERM,ep[Dropbox.ApiError.OAUTH_ERROR]=tp.EPERM,ep[Dropbox.ApiError.NOT_FOUND]=tp.ENOENT,ep[Dropbox.ApiError.INVALID_METHOD]=tp.EINVAL,ep[Dropbox.ApiError.NOT_ACCEPTABLE]=tp.EINVAL,ep[Dropbox.ApiError.CONFLICT]=tp.EINVAL,ep[Dropbox.ApiError.RATE_LIMITED]=tp.EBUSY,ep[Dropbox.ApiError.SERVER_ERROR]=tp.EBUSY,ep[Dropbox.ApiError.OVER_QUOTA]=tp.ENOSPC)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){to(null,new e(tn.client,!1))},e.isAvailable=function(){return"undefined"!=typeof Dropbox},e.prototype.getName=function(){return e.Name},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!1},e.prototype.empty=function(tn){var to=this;this._client.readdir("/",function(ta,tu){ta?tn(to.convert(ta,"/")):ce(tu,function(tn,ta){var tu=tg.join("/",tn);to._client.remove(tu,function(tn){ta(tn?to.convert(tn,tu):null)})},function(to){to?tn(to):tn()})})},e.prototype.rename=function(tn,to,ta){var tu=this;this._client.move(tn,to,function(tc){tc?tu._client.stat(to,function(th,td){if(th||td.isFolder){var tf=tc.response.error.indexOf(tn)>-1?tn:to;ta(tu.convert(tc,tf))}else tu._client.remove(to,function(tc){tc?ta(tu.convert(tc,to)):tu.rename(tn,to,ta)})}):ta()})},e.prototype.stat=function(tn,to,ta){var tu=this;this._client.stat(tn,function(to,tc){if(to)ta(tu.convert(to,tn));else{if(!tc||!tc.isRemoved)return ta(null,new y(tu._statType(tc),tc.size));ta(tS.FileError(tp.ENOENT,tn))}})},e.prototype.open=function(tn,to,ta,tu){var tc=this;this._client.readFile(tn,function(ta,th,td){if(!ta){var tf;return tf=null===th?z():j(th),tu(null,tc._makeFile(tn,to,td,tf))}if(!to.isReadable()){if(ta.status===Dropbox.ApiError.NOT_FOUND){var tp=new ArrayBuffer(0);return tc._writeFileStrict(tn,tp,function(ta,th){ta?tu(ta):tu(null,tc._makeFile(tn,to,th,j(tp)))})}return tu(tc.convert(ta,tn))}tu(tc.convert(ta,tn))})},e.prototype._writeFileStrict=function(tn,to,ta){var tu=this,tc=tg.dirname(tn);this.stat(tc,!1,function(th,td){th?ta(tS.FileError(tp.ENOENT,tc)):tu._client.writeFile(tn,to,function(to,tc){to?ta(tu.convert(to,tn)):ta(null,tc)})})},e.prototype._statType=function(tn){return tn.isFile?tI.FILE:tI.DIRECTORY},e.prototype._makeFile=function(tn,to,ta,tu){var tc=this._statType(ta),th=new y(tc,ta.size);return new em(this,tn,to,th,tu)},e.prototype._remove=function(tn,to,ta){var tu=this;this._client.stat(tn,function(tc,th){tc?to(tu.convert(tc,tn)):th.isFile&&!ta?to(tS.FileError(tp.ENOTDIR,tn)):!th.isFile&&ta?to(tS.FileError(tp.EISDIR,tn)):tu._client.remove(tn,function(ta){to(ta?tu.convert(ta,tn):null)})})},e.prototype.unlink=function(tn,to){this._remove(tn,to,!0)},e.prototype.rmdir=function(tn,to){this._remove(tn,to,!1)},e.prototype.mkdir=function(tn,to,ta){var tu=this,tc=tg.dirname(tn);this._client.stat(tc,function(to,th){to?ta(tu.convert(to,tc)):tu._client.mkdir(tn,function(to){ta(to?tS.FileError(tp.EEXIST,tn):null)})})},e.prototype.readdir=function(tn,to){var ta=this;this._client.readdir(tn,function(tn,tu){return tn?to(ta.convert(tn)):to(null,tu)})},e.prototype.convert=function(tn,to){void 0===to&&(to=null);var ta=ep[tn.status];return void 0===ta&&(ta=tp.EIO),to?tS.FileError(ta,to):new tS(ta)},e}(J);function pe(tn,to){void 0===to&&(to="");for(var ta=tn.errno,tu=tn.node,tc=[];tu&&(tc.unshift(tu.name),tu!==tu.parent);)tu=tu.parent;return new tS(ta,tv[ta],tc.length>0?"/"+tc.join("/"):to)}ew.Name="Dropbox",ew.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 0.10 JS SDK.",validator:function(tn,to){tn.isAuthenticated&&tn.isAuthenticated()?to():to(new tS(tp.EINVAL,"'client' option must be an authenticated Dropbox client from the v0.10 JS SDK."))}}};var eS=function(tn){function e(to,ta,tu,tc){tn.call(this),this._fs=to,this._FS=ta,this._path=tu,this._stream=tc}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.getPos=function(){},e.prototype.close=function(tn){var to=null;try{this.closeSync()}catch(tn){to=tn}finally{tn(to)}},e.prototype.closeSync=function(){try{this._FS.close(this._stream)}catch(tn){throw pe(tn,this._path)}},e.prototype.stat=function(tn){try{tn(null,this.statSync())}catch(to){tn(to)}},e.prototype.statSync=function(){try{return this._fs.statSync(this._path,!1)}catch(tn){throw pe(tn,this._path)}},e.prototype.truncate=function(tn,to){var ta=null;try{this.truncateSync(tn)}catch(tn){ta=tn}finally{to(ta)}},e.prototype.truncateSync=function(tn){try{this._FS.ftruncate(this._stream.fd,tn)}catch(tn){throw pe(tn,this._path)}},e.prototype.write=function(tn,to,ta,tu,tc){try{tc(null,this.writeSync(tn,to,ta,tu),tn)}catch(tn){tc(tn)}},e.prototype.writeSync=function(tn,to,ta,tu){try{var tc=F(tn),th=null===tu?void 0:tu;return this._FS.write(this._stream,tc,to,ta,th)}catch(tn){throw pe(tn,this._path)}},e.prototype.read=function(tn,to,ta,tu,tc){try{tc(null,this.readSync(tn,to,ta,tu),tn)}catch(tn){tc(tn)}},e.prototype.readSync=function(tn,to,ta,tu){try{var tc=F(tn),th=null===tu?void 0:tu;return this._FS.read(this._stream,tc,to,ta,th)}catch(tn){throw pe(tn,this._path)}},e.prototype.sync=function(tn){tn()},e.prototype.syncSync=function(){},e.prototype.chown=function(tn,to,ta){var tu=null;try{this.chownSync(tn,to)}catch(tn){tu=tn}finally{ta(tu)}},e.prototype.chownSync=function(tn,to){try{this._FS.fchown(this._stream.fd,tn,to)}catch(tn){throw pe(tn,this._path)}},e.prototype.chmod=function(tn,to){var ta=null;try{this.chmodSync(tn)}catch(tn){ta=tn}finally{to(ta)}},e.prototype.chmodSync=function(tn){try{this._FS.fchmod(this._stream.fd,tn)}catch(tn){throw pe(tn,this._path)}},e.prototype.utimes=function(tn,to,ta){var tu=null;try{this.utimesSync(tn,to)}catch(tn){tu=tn}finally{ta(tu)}},e.prototype.utimesSync=function(tn,to){this._fs.utimesSync(this._path,tn,to)},e}(G),eb=function(to){function i(tn){to.call(this),this._FS=tn}return to&&(i.__proto__=to),i.prototype=Object.create(to&&to.prototype),i.prototype.constructor=i,i.Create=function(tn,to){to(null,new i(tn.FS))},i.isAvailable=function(){return!0},i.prototype.getName=function(){return this._FS.DB_NAME()},i.prototype.isReadOnly=function(){return!1},i.prototype.supportsLinks=function(){return!0},i.prototype.supportsProps=function(){return!0},i.prototype.supportsSynch=function(){return!0},i.prototype.renameSync=function(tn,to){try{this._FS.rename(tn,to)}catch(ta){throw ta.errno===tp.ENOENT?pe(ta,this.existsSync(tn)?to:tn):pe(ta)}},i.prototype.statSync=function(tn,to){try{var ta=to?this._FS.lstat(tn):this._FS.stat(tn),tu=this.modeToFileType(ta.mode);return new y(tu,ta.size,ta.mode,ta.atime,ta.mtime,ta.ctime)}catch(to){throw pe(to,tn)}},i.prototype.openSync=function(tn,to,ta){try{var tu=this._FS.open(tn,to.getFlagString(),ta);if(this._FS.isDir(tu.node.mode))throw this._FS.close(tu),tS.EISDIR(tn);return new eS(this,this._FS,tn,tu)}catch(to){throw pe(to,tn)}},i.prototype.unlinkSync=function(tn){try{this._FS.unlink(tn)}catch(to){throw pe(to,tn)}},i.prototype.rmdirSync=function(tn){try{this._FS.rmdir(tn)}catch(to){throw pe(to,tn)}},i.prototype.mkdirSync=function(tn,to){try{this._FS.mkdir(tn,to)}catch(to){throw pe(to,tn)}},i.prototype.readdirSync=function(tn){try{return this._FS.readdir(tn).filter(function(tn){return"."!==tn&&".."!==tn})}catch(to){throw pe(to,tn)}},i.prototype.truncateSync=function(tn,to){try{this._FS.truncate(tn,to)}catch(to){throw pe(to,tn)}},i.prototype.readFileSync=function(tn,to,ta){try{var tu=M(this._FS.readFile(tn,{flags:ta.getFlagString()}));return to?tu.toString(to):tu}catch(to){throw pe(to,tn)}},i.prototype.writeFileSync=function(to,ta,tu,tc,th){try{tu&&(ta=tn.from(ta,tu));var td=F(ta);this._FS.writeFile(to,td,{flags:tc.getFlagString(),encoding:"binary"}),this._FS.chmod(to,th)}catch(tn){throw pe(tn,to)}},i.prototype.chmodSync=function(tn,to,ta){try{to?this._FS.lchmod(tn,ta):this._FS.chmod(tn,ta)}catch(to){throw pe(to,tn)}},i.prototype.chownSync=function(tn,to,ta,tu){try{to?this._FS.lchown(tn,ta,tu):this._FS.chown(tn,ta,tu)}catch(to){throw pe(to,tn)}},i.prototype.symlinkSync=function(tn,to,ta){try{this._FS.symlink(tn,to)}catch(tn){throw pe(tn)}},i.prototype.readlinkSync=function(tn){try{return this._FS.readlink(tn)}catch(to){throw pe(to,tn)}},i.prototype.utimesSync=function(tn,to,ta){try{this._FS.utime(tn,to.getTime(),ta.getTime())}catch(to){throw pe(to,tn)}},i.prototype.modeToFileType=function(tn){if(this._FS.isDir(tn))return tI.DIRECTORY;if(this._FS.isFile(tn))return tI.FILE;if(this._FS.isLink(tn))return tI.SYMLINK;throw tS.EPERM("Invalid mode: "+tn)},i}(tP);eb.Name="EmscriptenFileSystem",eb.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}};var eE=function(tn){function e(to,ta){tn.call(this),this._folder=to,this._wrapped=ta}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){to(null,new e(tn.folder,tn.wrapped))},e.isAvailable=function(){return!0},e.prototype.initialize=function(tn){var to=this;this._wrapped.exists(this._folder,function(ta){ta?tn():to._wrapped.isReadOnly()?tn(tS.ENOENT(to._folder)):to._wrapped.mkdir(to._folder,511,tn)})},e.prototype.getName=function(){return this._wrapped.getName()},e.prototype.isReadOnly=function(){return this._wrapped.isReadOnly()},e.prototype.supportsProps=function(){return this._wrapped.supportsProps()},e.prototype.supportsSynch=function(){return this._wrapped.supportsSynch()},e.prototype.supportsLinks=function(){return!1},e}(J);function me(tn,to){if(null!==to&&"object"==typeof to){var ta=to.path;ta&&(ta="/"+tg.relative(tn,ta),to.message=to.message.replace(to.path,ta),to.path=ta)}return to}function we(tn,to,ta){return"Sync"!==tn.slice(tn.length-4)?function(){var tu,tc;return arguments.length>0&&(to&&(arguments[0]=tg.join(this._folder,arguments[0])),ta&&(arguments[1]=tg.join(this._folder,arguments[1])),arguments[arguments.length-1]=(tu=this._folder,"function"==typeof(tc=arguments[arguments.length-1])?function(tn){arguments.length>0&&(arguments[0]=me(tu,tn)),tc.apply(null,arguments)}:tc)),this._wrapped[tn].apply(this._wrapped,arguments)}:function(){try{return to&&(arguments[0]=tg.join(this._folder,arguments[0])),ta&&(arguments[1]=tg.join(this._folder,arguments[1])),this._wrapped[tn].apply(this._wrapped,arguments)}catch(tn){throw me(this._folder,tn)}}}eE.Name="FolderAdapter",eE.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}},["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach(function(tn){eE.prototype[tn]=we(tn,!0,!1)}),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach(function(tn){eE.prototype[tn]=we(tn,!0,!0)});var eI="undefined"!=typeof window?window:"undefined"!=typeof self?self:tu,e_=eI.webkitRequestFileSystem||eI.requestFileSystem||null;function Ee(tn,to,ta){switch(tn.name){case"PathExistsError":return tS.EEXIST(to);case"QuotaExceededError":return tS.FileError(tp.ENOSPC,to);case"NotFoundError":return tS.ENOENT(to);case"SecurityError":return tS.FileError(tp.EACCES,to);case"InvalidModificationError":return tS.FileError(tp.EPERM,to);case"TypeMismatchError":return tS.FileError(ta?tp.ENOTDIR:tp.EISDIR,to);default:return tS.FileError(tp.EINVAL,to)}}var eD=function(tn){function e(to,ta,tu,tc,th,td){tn.call(this,to,tu,tc,th,td),this._entry=ta}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.sync=function(tn){var to=this;if(!this.isDirty())return tn();this._entry.createWriter(function(ta){var tu=to.getBuffer(),tc=new Blob([C(tu)]),th=tc.size;ta.onwriteend=function(tu){ta.onwriteend=null,ta.onerror=null,ta.truncate(th),to.resetDirty(),tn()},ta.onerror=function(ta){tn(Ee(ta,to.getPath(),!1))},ta.write(tc)})},e.prototype.close=function(tn){this.sync(tn)},e}(tR),eA=function(tn){function e(to,ta,tu){void 0===to&&(to=5),void 0===ta&&(ta=eI.PERSISTENT),void 0===tu&&(tu=!0),tn.call(this),this.size=1048576*to,this.type=ta,P(tu,e.Name,{size:to,type:ta})}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){var ta=new e(tn.size,tn.type,!1);ta.allocate(function(tn){return tn?to(tn):to(null,ta)},!1)},e.isAvailable=function(){return!!e_},e.prototype.getName=function(){return e.Name},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!1},e.prototype.allocate=function(tn,to){var ta=this;void 0===tn&&(tn=function(){}),void 0===to&&(to=!0),to&&console.warn("[HTML5FS] HTML5FS.allocate() is deprecated and will be removed in the next major release. Please use 'HTML5FS.Create({type: "+this.type+", size: "+this.size+"}, cb)' to create and allocate HTML5FS instances.");var r=function(to){ta.fs=to,tn()},n=function(to){tn(Ee(to,"/",!0))};this.type===eI.PERSISTENT?function(tn,to,ta,tu){if(void 0!==navigator.webkitPersistentStorage)switch(tn){case eI.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(to,ta,tu);break;case eI.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(to,ta,tu);break;default:tu(TypeError("Invalid storage type: "+tn))}else eI.webkitStorageInfo.requestQuota(tn,to,ta,tu)}(this.type,this.size,function(tn){e_(ta.type,tn,r,n)},n):e_(this.type,this.size,r,n)},e.prototype.empty=function(tn){this._readdir("/",function(to,ta){to?(console.error("Failed to empty FS"),tn(to)):ce(ta,function(tn,to){var i=function(){to()},r=function(ta){to(Ee(ta,tn.fullPath,!tn.isDirectory))};tn.isDirectory?tn.removeRecursively(i,r):tn.remove(i,r)},function(ta){to?(console.error("Failed to empty FS"),tn(to)):tn()})})},e.prototype.rename=function(tn,to,ta){var tu=this,tc=2,th=0,td=this.fs.root,tf=tn,c=function(tn){--tc<=0&&ta(Ee(tn,tf,!1))},d=function(tc){return 2==++th?ta(new tS(tp.EINVAL,"Something was identified as both a file and a directory. This should never happen.")):tn===to?ta():(tf=tg.dirname(to),void td.getDirectory(tf,{},function(th){tf=tg.basename(to),tc.moveTo(th,tf,function(tn){ta()},function(th){tc.isDirectory?(tf=to,tu.unlink(to,function(tc){tc?c(th):tu.rename(tn,to,ta)})):c(th)})},c))};td.getFile(tn,{},d,c),td.getDirectory(tn,{},d,c)},e.prototype.stat=function(tn,to,ta){var tu=this,tc={create:!1},o=function(tn){ta(null,new y(tI.DIRECTORY,4096))},s=function(to){ta(Ee(to,tn,!1))};this.fs.root.getFile(tn,tc,function(tn){tn.file(function(tn){ta(null,new y(tI.FILE,tn.size))},s)},function(){tu.fs.root.getDirectory(tn,tc,o,s)})},e.prototype.open=function(tn,to,ta,tu){var tc=this,o=function(ta){"InvalidModificationError"===ta.name&&to.isExclusive()?tu(tS.EEXIST(tn)):tu(Ee(ta,tn,!1))};this.fs.root.getFile(tn,{create:to.pathNotExistsAction()===tw.CREATE_FILE,exclusive:to.isExclusive()},function(ta){ta.file(function(th){var td=new FileReader;td.onloadend=function(tf){tu(null,tc._makeFile(tn,ta,to,th,td.result))},td.onerror=function(tn){o(td.error)},td.readAsArrayBuffer(th)},o)},o)},e.prototype.unlink=function(tn,to){this._remove(tn,to,!0)},e.prototype.rmdir=function(tn,to){var ta=this;this.readdir(tn,function(tu,tc){tu?to(tu):tc.length>0?to(tS.ENOTEMPTY(tn)):ta._remove(tn,to,!1)})},e.prototype.mkdir=function(tn,to,ta){this.fs.root.getDirectory(tn,{create:!0,exclusive:!0},function(tn){ta()},function(to){ta(Ee(to,tn,!0))})},e.prototype.readdir=function(tn,to){this._readdir(tn,function(tn,ta){if(!ta)return to(tn);for(var tu=[],tc=0;tc<ta.length;tc+=1){var th=ta[tc];tu.push(th.name)}to(null,tu)})},e.prototype._makeFile=function(tn,to,ta,tu,tc){void 0===tc&&(tc=new ArrayBuffer(0));var th=new y(tI.FILE,tu.size),td=j(tc);return new eD(this,to,tn,ta,th,td)},e.prototype._readdir=function(tn,to){var i=function(ta){to(Ee(ta,tn,!0))};this.fs.root.getDirectory(tn,{create:!1},function(tn){var ta=tn.createReader(),tu=[],o=function(){ta.readEntries(function(tn){tn.length?(tu=tu.concat(Array.prototype.slice.call(tn||[],0)),o()):to(null,tu)},i)};o()},i)},e.prototype._remove=function(tn,to,ta){var r=function(tu){tu.remove(function(){to()},function(tu){to(Ee(tu,tn,!ta))})},n=function(tu){to(Ee(tu,tn,!ta))},tu={create:!1};ta?this.fs.root.getFile(tn,tu,r,n):this.fs.root.getDirectory(tn,tu,r,n)},e}(J);eA.Name="HTML5FS",eA.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}};var De=function(tn,to,ta,tu,tc,th){this.id=tn,this.size=to,this.mode=ta,this.atime=tu,this.mtime=tc,this.ctime=th};De.fromBuffer=function(tn){if(void 0===tn)throw Error("NO");return new De(tn.toString("ascii",30),tn.readUInt32LE(0),tn.readUInt16LE(4),tn.readDoubleLE(6),tn.readDoubleLE(14),tn.readDoubleLE(22))},De.prototype.toStats=function(){return new y((61440&this.mode)===tI.DIRECTORY?tI.DIRECTORY:tI.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))},De.prototype.getSize=function(){return 30+this.id.length},De.prototype.toBuffer=function(to){return void 0===to&&(to=tn.alloc(this.getSize())),to.writeUInt32LE(this.size,0),to.writeUInt16LE(this.mode,4),to.writeDoubleLE(this.atime,6),to.writeDoubleLE(this.mtime,14),to.writeDoubleLE(this.ctime,22),to.write(this.id,30,this.id.length,"ascii"),to},De.prototype.update=function(tn){var to=!1;this.size!==tn.size&&(this.size=tn.size,to=!0),this.mode!==tn.mode&&(this.mode=tn.mode,to=!0);var ta=tn.atime.getTime();this.atime!==ta&&(this.atime=ta,to=!0);var tu=tn.mtime.getTime();this.mtime!==tu&&(this.mtime=tu,to=!0);var tc=tn.ctime.getTime();return this.ctime!==tc&&(this.ctime=tc,to=!0),to},De.prototype.isFile=function(){return(61440&this.mode)===tI.FILE},De.prototype.isDirectory=function(){return(61440&this.mode)===tI.DIRECTORY};var eT=null;function Oe(){return eT||(eT=tn.from("{}"))}function Pe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(tn){var to=16*Math.random()|0;return("x"===tn?to:3&to|8).toString(16)})}function xe(tn,to){return!tn||(to(tn),!1)}function Re(tn,to,ta){return!tn||(to.abort(function(){ta(tn)}),!1)}var ke=function(tn){this.store=tn,this.originalData={},this.modifiedKeys=[]};ke.prototype.get=function(tn){var to=this.store.get(tn);return this.stashOldValue(tn,to),to},ke.prototype.put=function(tn,to,ta){return this.markModified(tn),this.store.put(tn,to,ta)},ke.prototype.del=function(tn){this.markModified(tn),this.store.del(tn)},ke.prototype.commit=function(){},ke.prototype.abort=function(){for(var tn=0,to=this.modifiedKeys;tn<to.length;tn+=1){var ta=to[tn],tu=this.originalData[ta];tu?this.store.put(ta,tu,!0):this.store.del(ta)}},ke.prototype.stashOldValue=function(tn,to){this.originalData.hasOwnProperty(tn)||(this.originalData[tn]=to)},ke.prototype.markModified=function(tn){-1===this.modifiedKeys.indexOf(tn)&&(this.modifiedKeys.push(tn),this.originalData.hasOwnProperty(tn)||(this.originalData[tn]=this.store.get(tn)))};var ex=function(tn){function e(to,ta,tu,tc,th){tn.call(this,to,ta,tu,tc,th)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(tR),eO=function(to){function i(tn){to.call(this),this.store=tn.store,this.makeRootDirectory()}return to&&(i.__proto__=to),i.prototype=Object.create(to&&to.prototype),i.prototype.constructor=i,i.isAvailable=function(){return!0},i.prototype.getName=function(){return this.store.name()},i.prototype.isReadOnly=function(){return!1},i.prototype.supportsSymlinks=function(){return!1},i.prototype.supportsProps=function(){return!1},i.prototype.supportsSynch=function(){return!0},i.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},i.prototype.renameSync=function(to,ta){var tu=this.store.beginTransaction("readwrite"),tc=tg.dirname(to),th=tg.basename(to),td=tg.dirname(ta),tf=tg.basename(ta),ty=this.findINode(tu,tc),tv=this.getDirListing(tu,tc,ty);if(!tv[th])throw tS.ENOENT(to);var tm,tw,tb=tv[th];if(delete tv[th],0===(td+"/").indexOf(to+"/"))throw new tS(tp.EBUSY,tc);if(td===tc?(tm=ty,tw=tv):(tm=this.findINode(tu,td),tw=this.getDirListing(tu,td,tm)),tw[tf]){var tE=this.getINode(tu,ta,tw[tf]);if(!tE.isFile())throw tS.EPERM(ta);try{tu.del(tE.id),tu.del(tw[tf])}catch(tn){throw tu.abort(),tn}}tw[tf]=tb;try{tu.put(ty.id,tn.from(JSON.stringify(tv)),!0),tu.put(tm.id,tn.from(JSON.stringify(tw)),!0)}catch(tn){throw tu.abort(),tn}tu.commit()},i.prototype.statSync=function(tn,to){return this.findINode(this.store.beginTransaction("readonly"),tn).toStats()},i.prototype.createFileSync=function(tn,to,ta){var tu=this.store.beginTransaction("readwrite"),tc=z(),th=this.commitNewFile(tu,tn,tI.FILE,ta,tc);return new ex(this,tn,to,th.toStats(),tc)},i.prototype.openFileSync=function(tn,to){var ta=this.store.beginTransaction("readonly"),tu=this.findINode(ta,tn),tc=ta.get(tu.id);if(void 0===tc)throw tS.ENOENT(tn);return new ex(this,tn,to,tu.toStats(),tc)},i.prototype.unlinkSync=function(tn){this.removeEntry(tn,!1)},i.prototype.rmdirSync=function(tn){if(this.readdirSync(tn).length>0)throw tS.ENOTEMPTY(tn);this.removeEntry(tn,!0)},i.prototype.mkdirSync=function(to,ta){var tu=this.store.beginTransaction("readwrite"),tc=tn.from("{}");this.commitNewFile(tu,to,tI.DIRECTORY,ta,tc)},i.prototype.readdirSync=function(tn){var to=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(to,tn,this.findINode(to,tn)))},i.prototype._syncSync=function(tn,to,ta){var tu=this.store.beginTransaction("readwrite"),tc=this._findINode(tu,tg.dirname(tn),tg.basename(tn)),th=this.getINode(tu,tn,tc),td=th.update(ta);try{tu.put(th.id,to,!0),td&&tu.put(tc,th.toBuffer(),!0)}catch(tn){throw tu.abort(),tn}tu.commit()},i.prototype.makeRootDirectory=function(){var tn=this.store.beginTransaction("readwrite");if(void 0===tn.get("/")){var to=(new Date).getTime(),ta=new De(Pe(),4096,511|tI.DIRECTORY,to,to,to);tn.put(ta.id,Oe(),!1),tn.put("/",ta.toBuffer(),!1),tn.commit()}},i.prototype._findINode=function(tn,to,ta){var tu=this,n=function(tc){var th=tu.getDirListing(tn,to,tc);if(th[ta])return th[ta];throw tS.ENOENT(tg.resolve(to,ta))};return"/"===to?""===ta?"/":n(this.getINode(tn,to,"/")):n(this.getINode(tn,to+tg.sep+ta,this._findINode(tn,tg.dirname(to),tg.basename(to))))},i.prototype.findINode=function(tn,to){return this.getINode(tn,to,this._findINode(tn,tg.dirname(to),tg.basename(to)))},i.prototype.getINode=function(tn,to,ta){var tu=tn.get(ta);if(void 0===tu)throw tS.ENOENT(to);return De.fromBuffer(tu)},i.prototype.getDirListing=function(tn,to,ta){if(!ta.isDirectory())throw tS.ENOTDIR(to);var tu=tn.get(ta.id);if(void 0===tu)throw tS.ENOENT(to);return JSON.parse(tu.toString())},i.prototype.addNewNode=function(tn,to){for(var ta;;)try{return ta=Pe(),tn.put(ta,to,!1),ta}catch(tn){}throw new tS(tp.EIO,"Unable to commit data to key-value store.")},i.prototype.commitNewFile=function(to,ta,tu,tc,th){var td,tf=tg.dirname(ta),tp=tg.basename(ta),ty=this.findINode(to,tf),tv=this.getDirListing(to,tf,ty),tm=(new Date).getTime();if("/"===ta||tv[tp])throw tS.EEXIST(ta);try{var tw=this.addNewNode(to,th);td=new De(tw,th.length,tc|tu,tm,tm,tm);var tb=this.addNewNode(to,td.toBuffer());tv[tp]=tb,to.put(ty.id,tn.from(JSON.stringify(tv)),!0)}catch(tn){throw to.abort(),tn}return to.commit(),td},i.prototype.removeEntry=function(to,ta){var tu=this.store.beginTransaction("readwrite"),tc=tg.dirname(to),th=this.findINode(tu,tc),td=this.getDirListing(tu,tc,th),tf=tg.basename(to);if(!td[tf])throw tS.ENOENT(to);var tp=td[tf];delete td[tf];var ty=this.getINode(tu,to,tp);if(!ta&&ty.isDirectory())throw tS.EISDIR(to);if(ta&&!ty.isDirectory())throw tS.ENOTDIR(to);try{tu.del(ty.id),tu.del(tp),tu.put(th.id,tn.from(JSON.stringify(td)),!0)}catch(tn){throw tu.abort(),tn}tu.commit()},i}(tP),eP=function(tn){function e(to,ta,tu,tc,th){tn.call(this,to,ta,tu,tc,th)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.sync=function(tn){var to=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),function(ta){ta||to.resetDirty(),tn(ta)}):tn()},e.prototype.close=function(tn){this.sync(tn)},e}(tR),eR=function(to){function i(){to.apply(this,arguments)}return to&&(i.__proto__=to),i.prototype=Object.create(to&&to.prototype),i.prototype.constructor=i,i.isAvailable=function(){return!0},i.prototype.init=function(tn,to){this.store=tn,this.makeRootDirectory(to)},i.prototype.getName=function(){return this.store.name()},i.prototype.isReadOnly=function(){return!1},i.prototype.supportsSymlinks=function(){return!1},i.prototype.supportsProps=function(){return!1},i.prototype.supportsSynch=function(){return!1},i.prototype.empty=function(tn){var to=this;this.store.clear(function(ta){xe(ta,tn)&&to.makeRootDirectory(tn)})},i.prototype.rename=function(to,ta,tu){var tc=this,th=this.store.beginTransaction("readwrite"),td=tg.dirname(to),tf=tg.basename(to),ty=tg.dirname(ta),tv=tg.basename(ta),tm={},tw={},tb=!1;if(0===(ty+"/").indexOf(to+"/"))return tu(new tS(tp.EBUSY,td));var g=function(tp){tc.findINodeAndDirListing(th,tp,function(tg,tE,tI){tg?tb||(tb=!0,th.abort(function(){tu(tg)})):(tm[tp]=tE,tw[tp]=tI,function(){if(!tb&&tw.hasOwnProperty(td)&&tw.hasOwnProperty(ty)){var tp=tw[td],tg=tm[td],tE=tw[ty],tI=tm[ty];if(tp[tf]){var t_=tp[tf];delete tp[tf];var w=function(){tE[tv]=t_,th.put(tg.id,tn.from(JSON.stringify(tp)),!0,function(to){Re(to,th,tu)&&(td===ty?th.commit(tu):th.put(tI.id,tn.from(JSON.stringify(tE)),!0,function(tn){Re(tn,th,tu)&&th.commit(tu)}))})};tE[tv]?tc.getINode(th,ta,tE[tv],function(tn,to){Re(tn,th,tu)&&(to.isFile()?th.del(to.id,function(tn){Re(tn,th,tu)&&th.del(tE[tv],function(tn){Re(tn,th,tu)&&w()})}):th.abort(function(tn){tu(tS.EPERM(ta))}))}):w()}else tu(tS.ENOENT(to))}}())})};g(td),td!==ty&&g(ty)},i.prototype.stat=function(tn,to,ta){var tu=this.store.beginTransaction("readonly");this.findINode(tu,tn,function(tn,to){xe(tn,ta)&&ta(null,to.toStats())})},i.prototype.createFile=function(tn,to,ta,tu){var tc=this,th=this.store.beginTransaction("readwrite"),td=z();this.commitNewFile(th,tn,tI.FILE,ta,td,function(ta,th){xe(ta,tu)&&tu(null,new eP(tc,tn,to,th.toStats(),td))})},i.prototype.openFile=function(tn,to,ta){var tu=this,tc=this.store.beginTransaction("readonly");this.findINode(tc,tn,function(th,td){xe(th,ta)&&tc.get(td.id,function(tc,th){xe(tc,ta)&&(void 0===th?ta(tS.ENOENT(tn)):ta(null,new eP(tu,tn,to,td.toStats(),th)))})})},i.prototype.unlink=function(tn,to){this.removeEntry(tn,!1,to)},i.prototype.rmdir=function(tn,to){var ta=this;this.readdir(tn,function(tu,tc){tu?to(tu):tc.length>0?to(tS.ENOTEMPTY(tn)):ta.removeEntry(tn,!0,to)})},i.prototype.mkdir=function(to,ta,tu){var tc=this.store.beginTransaction("readwrite"),th=tn.from("{}");this.commitNewFile(tc,to,tI.DIRECTORY,ta,th,tu)},i.prototype.readdir=function(tn,to){var ta=this,tu=this.store.beginTransaction("readonly");this.findINode(tu,tn,function(tc,th){xe(tc,to)&&ta.getDirListing(tu,tn,th,function(tn,ta){xe(tn,to)&&to(null,Object.keys(ta))})})},i.prototype._sync=function(tn,to,ta,tu){var tc=this,th=this.store.beginTransaction("readwrite");this._findINode(th,tg.dirname(tn),tg.basename(tn),function(td,tf){Re(td,th,tu)&&tc.getINode(th,tn,tf,function(tn,tc){if(Re(tn,th,tu)){var td=tc.update(ta);th.put(tc.id,to,!0,function(tn){Re(tn,th,tu)&&(td?th.put(tf,tc.toBuffer(),!0,function(tn){Re(tn,th,tu)&&th.commit(tu)}):th.commit(tu))})}})})},i.prototype.makeRootDirectory=function(tn){var to=this.store.beginTransaction("readwrite");to.get("/",function(ta,tu){if(ta||void 0===tu){var tc=(new Date).getTime(),th=new De(Pe(),4096,511|tI.DIRECTORY,tc,tc,tc);to.put(th.id,Oe(),!1,function(ta){Re(ta,to,tn)&&to.put("/",th.toBuffer(),!1,function(ta){ta?to.abort(function(){tn(ta)}):to.commit(tn)})})}else to.commit(tn)})},i.prototype._findINode=function(tn,to,ta,tu){var tc=this,o=function(tn,tc,th){tn?tu(tn):th[ta]?tu(null,th[ta]):tu(tS.ENOENT(tg.resolve(to,ta)))};"/"===to?""===ta?tu(null,"/"):this.getINode(tn,to,"/",function(ta,th){xe(ta,tu)&&tc.getDirListing(tn,to,th,function(tn,to){o(tn,0,to)})}):this.findINodeAndDirListing(tn,to,o)},i.prototype.findINode=function(tn,to,ta){var tu=this;this._findINode(tn,tg.dirname(to),tg.basename(to),function(tc,th){xe(tc,ta)&&tu.getINode(tn,to,th,ta)})},i.prototype.getINode=function(tn,to,ta,tu){tn.get(ta,function(tn,ta){xe(tn,tu)&&(void 0===ta?tu(tS.ENOENT(to)):tu(null,De.fromBuffer(ta)))})},i.prototype.getDirListing=function(tn,to,ta,tu){ta.isDirectory()?tn.get(ta.id,function(tn,ta){if(xe(tn,tu))try{tu(null,JSON.parse(ta.toString()))}catch(tn){tu(tS.ENOENT(to))}}):tu(tS.ENOTDIR(to))},i.prototype.findINodeAndDirListing=function(tn,to,ta){var tu=this;this.findINode(tn,to,function(tc,th){xe(tc,ta)&&tu.getDirListing(tn,to,th,function(tn,to){xe(tn,ta)&&ta(null,th,to)})})},i.prototype.addNewNode=function(tn,to,ta){var tu,tc=0,o=function(){5==++tc?ta(new tS(tp.EIO,"Unable to commit data to key-value store.")):(tu=Pe(),tn.put(tu,to,!1,function(tn,to){tn||!to?o():ta(null,tu)}))};o()},i.prototype.commitNewFile=function(to,ta,tu,tc,th,td){var tf=this,tp=tg.dirname(ta),ty=tg.basename(ta),tv=(new Date).getTime();if("/"===ta)return td(tS.EEXIST(ta));this.findINodeAndDirListing(to,tp,function(tp,tg,tm){Re(tp,to,td)&&(tm[ty]?to.abort(function(){td(tS.EEXIST(ta))}):tf.addNewNode(to,th,function(ta,tp){if(Re(ta,to,td)){var tw=new De(tp,th.length,tc|tu,tv,tv,tv);tf.addNewNode(to,tw.toBuffer(),function(ta,tu){Re(ta,to,td)&&(tm[ty]=tu,to.put(tg.id,tn.from(JSON.stringify(tm)),!0,function(tn){Re(tn,to,td)&&to.commit(function(tn){Re(tn,to,td)&&td(null,tw)})}))})}}))})},i.prototype.removeEntry=function(to,ta,tu){var tc=this,th=this.store.beginTransaction("readwrite"),td=tg.dirname(to),tf=tg.basename(to);this.findINodeAndDirListing(th,td,function(td,tp,ty){if(Re(td,th,tu)){if(ty[tf]){var tg=ty[tf];delete ty[tf],tc.getINode(th,to,tg,function(tc,td){Re(tc,th,tu)&&(!ta&&td.isDirectory()?th.abort(function(){tu(tS.EISDIR(to))}):ta&&!td.isDirectory()?th.abort(function(){tu(tS.ENOTDIR(to))}):th.del(td.id,function(to){Re(to,th,tu)&&th.del(tg,function(to){Re(to,th,tu)&&th.put(tp.id,tn.from(JSON.stringify(ty)),!0,function(tn){Re(tn,th,tu)&&th.commit(tu)})})}))})}else th.abort(function(){tu(tS.ENOENT(to))})}})},i}(J),Me=function(){this.store={}};Me.prototype.name=function(){return ek.Name},Me.prototype.clear=function(){this.store={}},Me.prototype.beginTransaction=function(tn){return new ke(this)},Me.prototype.get=function(tn){return this.store[tn]},Me.prototype.put=function(tn,to,ta){return!(!ta&&this.store.hasOwnProperty(tn)||(this.store[tn]=to,0))},Me.prototype.del=function(tn){delete this.store[tn]};var ek=function(tn){function e(){tn.call(this,{store:new Me})}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){to(null,new e)},e}(eO);ek.Name="InMemory",ek.Options={};var eN=eI.indexedDB||eI.mozIndexedDB||eI.webkitIndexedDB||eI.msIndexedDB;function Ue(tn,to){switch(void 0===to&&(to=tn.toString()),tn.name){case"NotFoundError":return new tS(tp.ENOENT,to);case"QuotaExceededError":return new tS(tp.ENOSPC,to);default:return new tS(tp.EIO,to)}}function ze(tn,to,ta){return void 0===to&&(to=tp.EIO),void 0===ta&&(ta=null),function(tu){tu.preventDefault(),tn(new tS(to,null!==ta?ta:void 0))}}var Be=function(tn,to){this.tx=tn,this.store=to};Be.prototype.get=function(tn,to){try{var ta=this.store.get(tn);ta.onerror=ze(to),ta.onsuccess=function(tn){var ta=tn.target.result;to(null,void 0===ta?ta:j(ta))}}catch(tn){to(Ue(tn))}};var eF=function(tn){function e(to,ta){tn.call(this,to,ta)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.put=function(tn,to,ta,tu){try{var tc,th=C(to);(tc=ta?this.store.put(th,tn):this.store.add(th,tn)).onerror=ze(tu),tc.onsuccess=function(tn){tu(null,!0)}}catch(tn){tu(Ue(tn))}},e.prototype.del=function(tn,to){try{var ta=this.store.delete(tn);ta.onerror=ze(to),ta.onsuccess=function(tn){to()}}catch(tn){to(Ue(tn))}},e.prototype.commit=function(tn){setTimeout(tn,0)},e.prototype.abort=function(tn){var to=null;try{this.tx.abort()}catch(tn){to=Ue(tn)}finally{tn(to)}},e}(Be),qe=function(tn,to){var ta=this;void 0===to&&(to="browserfs"),this.storeName=to;var tu=eN.open(this.storeName,1);tu.onupgradeneeded=function(tn){var to=tn.target.result;to.objectStoreNames.contains(ta.storeName)&&to.deleteObjectStore(ta.storeName),to.createObjectStore(ta.storeName)},tu.onsuccess=function(to){ta.db=to.target.result,tn(null,ta)},tu.onerror=ze(tn,tp.EACCES)};qe.prototype.name=function(){return eC.Name+" - "+this.storeName},qe.prototype.clear=function(tn){try{var to=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();to.onsuccess=function(to){setTimeout(tn,0)},to.onerror=ze(tn)}catch(to){tn(Ue(to))}},qe.prototype.beginTransaction=function(tn){void 0===tn&&(tn="readonly");var to=this.db.transaction(this.storeName,tn),ta=to.objectStore(this.storeName);if("readwrite"===tn)return new eF(to,ta);if("readonly"===tn)return new Be(to,ta);throw new tS(tp.EINVAL,"Invalid transaction type.")};var eC=function(tn){function e(to,ta,tu){var tc=this;void 0===tu&&(tu=!0),tn.call(this),this.store=new qe(function(tn){tn?to(tn):tc.init(tc.store,function(tn){to(tn,tc)})},ta),P(tu,e.Name,{storeName:ta})}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){new e(to,tn.storeName,!1)},e.isAvailable=function(){try{return void 0!==eN&&null!==eN.open("__browserfs_test__")}catch(tn){return!1}},e}(eR);eC.Name="IndexedDB",eC.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."}};var eL,ej=!1;try{eI.localStorage.setItem("__test__",String.fromCharCode(55296)),ej=eI.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(tn){ej=!1}eL=ej?"binary_string":"binary_string_ie",tn.isEncoding(eL)||(eL="base64");var Je=function(){};Je.prototype.name=function(){return eM.Name},Je.prototype.clear=function(){eI.localStorage.clear()},Je.prototype.beginTransaction=function(tn){return new ke(this)},Je.prototype.get=function(to){try{var ta=eI.localStorage.getItem(to);if(null!==ta)return tn.from(ta,eL)}catch(tn){}},Je.prototype.put=function(tn,to,ta){try{return!(!ta&&null!==eI.localStorage.getItem(tn)||(eI.localStorage.setItem(tn,to.toString(eL)),0))}catch(tn){throw new tS(tp.ENOSPC,"LocalStorage is full.")}},Je.prototype.del=function(tn){try{eI.localStorage.removeItem(tn)}catch(to){throw new tS(tp.EIO,"Unable to delete key "+tn+": "+to)}};var eM=function(tn){function e(){tn.call(this,{store:new Je})}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){to(null,new e)},e.isAvailable=function(){return void 0!==eI.localStorage},e}(eO);eM.Name="LocalStorage",eM.Options={};var eK=function(tn){function e(){tn.call(this),this.mountList=[],this.mntMap={},this.rootFs=new ek}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){var ta=new e;Object.keys(tn).forEach(function(to){ta.mount(to,tn[to])}),to(null,ta)},e.isAvailable=function(){return!0},e.prototype.mount=function(tn,to){if("/"!==tn[0]&&(tn="/"+tn),tn=tg.resolve(tn),this.mntMap[tn])throw new tS(tp.EINVAL,"Mount point "+tn+" is already taken.");N(tn,511,this.rootFs),this.mntMap[tn]=to,this.mountList.push(tn),this.mountList=this.mountList.sort(function(tn,to){return to.length-tn.length})},e.prototype.umount=function(tn){if("/"!==tn[0]&&(tn="/"+tn),tn=tg.resolve(tn),!this.mntMap[tn])throw new tS(tp.EINVAL,"Mount point "+tn+" is already unmounted.");for(delete this.mntMap[tn],this.mountList.splice(this.mountList.indexOf(tn),1);"/"!==tn&&0===this.rootFs.readdirSync(tn).length;)this.rootFs.rmdirSync(tn),tn=tg.dirname(tn)},e.prototype._getFs=function(tn){for(var to=this.mountList,ta=to.length,tu=0;tu<ta;tu++){var tc=to[tu];if(tc.length<=tn.length&&0===tn.indexOf(tc))return""===(tn=tn.substr(tc.length>1?tc.length:0))&&(tn="/"),{fs:this.mntMap[tc],path:tn}}return{fs:this.rootFs,path:tn}},e.prototype.getName=function(){return e.Name},e.prototype.diskSpace=function(tn,to){to(0,0)},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.standardizeError=function(tn,to,ta){var tu=tn.message.indexOf(to);return -1!==tu&&(tn.message=tn.message.substr(0,tu)+ta+tn.message.substr(tu+to.length),tn.path=ta),tn},e.prototype.rename=function(tn,to,ta){var tu=this,tc=this._getFs(tn),th=this._getFs(to);return tc.fs===th.fs?tc.fs.rename(tc.path,th.path,function(td){td&&tu.standardizeError(tu.standardizeError(td,tc.path,tn),th.path,to),ta(td)}):tD.readFile(tn,function(tu,tc){if(tu)return ta(tu);tD.writeFile(to,tc,function(to){if(to)return ta(to);tD.unlink(tn,ta)})})},e.prototype.renameSync=function(tn,to){var ta=this._getFs(tn),tu=this._getFs(to);if(ta.fs===tu.fs)try{return ta.fs.renameSync(ta.path,tu.path)}catch(tc){throw this.standardizeError(this.standardizeError(tc,ta.path,tn),tu.path,to),tc}var tc=tD.readFileSync(tn);return tD.writeFileSync(to,tc),tD.unlinkSync(tn)},e.prototype.readdirSync=function(tn){var to=this._getFs(tn),ta=null;if(to.fs!==this.rootFs)try{ta=this.rootFs.readdirSync(tn)}catch(tn){}try{var tu=to.fs.readdirSync(to.path);return null===ta?tu:tu.concat(ta.filter(function(tn){return -1===tu.indexOf(tn)}))}catch(tu){if(null===ta)throw this.standardizeError(tu,to.path,tn);return ta}},e.prototype.readdir=function(tn,to){var ta=this,tu=this._getFs(tn);tu.fs.readdir(tu.path,function(tc,th){if(tu.fs!==ta.rootFs)try{var td=ta.rootFs.readdirSync(tn);th=th?th.concat(td.filter(function(tn){return -1===th.indexOf(tn)})):td}catch(th){if(tc)return to(ta.standardizeError(tc,tu.path,tn))}else if(tc)return to(ta.standardizeError(tc,tu.path,tn));to(null,th)})},e.prototype.rmdirSync=function(tn){var to=this._getFs(tn);if(this._containsMountPt(tn))throw tS.ENOTEMPTY(tn);try{to.fs.rmdirSync(to.path)}catch(ta){throw this.standardizeError(ta,to.path,tn)}},e.prototype.rmdir=function(tn,to){var ta=this,tu=this._getFs(tn);this._containsMountPt(tn)?to(tS.ENOTEMPTY(tn)):tu.fs.rmdir(tu.path,function(tc){to(tc?ta.standardizeError(tc,tu.path,tn):null)})},e.prototype._containsMountPt=function(tn){for(var to=this.mountList,ta=to.length,tu=0;tu<ta;tu++){var tc=to[tu];if(tc.length>=tn.length&&tc.slice(0,tn.length)===tn)return!0}return!1},e}(J);function Ze(tn,to,ta){return to?function(){for(var to=[],ta=arguments.length;ta--;)to[ta]=arguments[ta];var tu=to[0],tc=this._getFs(tu);to[0]=tc.path;try{return tc.fs[tn].apply(tc.fs,to)}catch(tn){throw this.standardizeError(tn,tc.path,tu),tn}}:function(){for(var to=this,ta=[],tu=arguments.length;tu--;)ta[tu]=arguments[tu];var tc=ta[0],th=this._getFs(tc);if(ta[0]=th.path,"function"==typeof ta[ta.length-1]){var td=ta[ta.length-1];ta[ta.length-1]=function(){for(var tn=[],ta=arguments.length;ta--;)tn[ta]=arguments[ta];tn.length>0&&tn[0]instanceof tS&&to.standardizeError(tn[0],th.path,tc),td.apply(null,tn)}}return th.fs[tn].apply(th.fs,ta)}}eK.Name="MountableFileSystem",eK.Options={};for(var eB,eU=[["exists","unlink","readlink"],["stat","mkdir","realpath","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]],eq=0;eq<eU.length;eq++)for(var ez=0,eV=eU[eq];ez<eV.length;ez+=1){var eJ=eV[ez];eK.prototype[eJ]=Ze(eJ,!1),eK.prototype[eJ+"Sync"]=Ze(eJ+"Sync",!0)}if("undefined"!=typeof setImmediate)eB=setImmediate;else{var eW=[],eY="zero-timeout-message";if(function(){if(void 0!==eI.importScripts||!eI.postMessage)return!1;var tn=!0,to=eI.onmessage;return eI.onmessage=function(){tn=!1},eI.postMessage("","*"),eI.onmessage=to,tn}()){eB=function(tn){eW.push(tn),eI.postMessage(eY,"*")};var ai=function(tn){if(tn.source===self&&tn.data===eY&&(tn.stopPropagation?tn.stopPropagation():tn.cancelBubble=!0,eW.length>0))return eW.shift()()};eI.addEventListener?eI.addEventListener("message",ai,!0):eI.attachEvent("onmessage",ai)}else if(eI.MessageChannel){var eH=new eI.MessageChannel;eH.port1.onmessage=function(tn){if(eW.length>0)return eW.shift()()},eB=function(tn){eW.push(tn),eH.port2.postMessage("")}}else eB=function(tn){return setTimeout(tn,0)}}var eX=eB,ci=function(){this._locked=!1,this._waiters=[]};ci.prototype.lock=function(tn){this._locked?this._waiters.push(tn):(this._locked=!0,tn())},ci.prototype.unlock=function(){if(!this._locked)throw Error("unlock of a non-locked mutex");var tn=this._waiters.shift();tn?eX(tn):this._locked=!1},ci.prototype.tryLock=function(){return!this._locked&&(this._locked=!0,!0)},ci.prototype.isLocked=function(){return this._locked};var hi=function(tn){this._fs=tn,this._mu=new ci};hi.prototype.getName=function(){return"LockedFS<"+this._fs.getName()+">"},hi.prototype.getFSUnlocked=function(){return this._fs},hi.prototype.initialize=function(tn){this._fs.initialize(tn)},hi.prototype.diskSpace=function(tn,to){this._fs.diskSpace(tn,to)},hi.prototype.isReadOnly=function(){return this._fs.isReadOnly()},hi.prototype.supportsLinks=function(){return this._fs.supportsLinks()},hi.prototype.supportsProps=function(){return this._fs.supportsProps()},hi.prototype.supportsSynch=function(){return this._fs.supportsSynch()},hi.prototype.rename=function(tn,to,ta){var tu=this;this._mu.lock(function(){tu._fs.rename(tn,to,function(tn){tu._mu.unlock(),ta(tn)})})},hi.prototype.renameSync=function(tn,to){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.renameSync(tn,to)},hi.prototype.stat=function(tn,to,ta){var tu=this;this._mu.lock(function(){tu._fs.stat(tn,to,function(tn,to){tu._mu.unlock(),ta(tn,to)})})},hi.prototype.statSync=function(tn,to){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.statSync(tn,to)},hi.prototype.open=function(tn,to,ta,tu){var tc=this;this._mu.lock(function(){tc._fs.open(tn,to,ta,function(tn,to){tc._mu.unlock(),tu(tn,to)})})},hi.prototype.openSync=function(tn,to,ta){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.openSync(tn,to,ta)},hi.prototype.unlink=function(tn,to){var ta=this;this._mu.lock(function(){ta._fs.unlink(tn,function(tn){ta._mu.unlock(),to(tn)})})},hi.prototype.unlinkSync=function(tn){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.unlinkSync(tn)},hi.prototype.rmdir=function(tn,to){var ta=this;this._mu.lock(function(){ta._fs.rmdir(tn,function(tn){ta._mu.unlock(),to(tn)})})},hi.prototype.rmdirSync=function(tn){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.rmdirSync(tn)},hi.prototype.mkdir=function(tn,to,ta){var tu=this;this._mu.lock(function(){tu._fs.mkdir(tn,to,function(tn){tu._mu.unlock(),ta(tn)})})},hi.prototype.mkdirSync=function(tn,to){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.mkdirSync(tn,to)},hi.prototype.readdir=function(tn,to){var ta=this;this._mu.lock(function(){ta._fs.readdir(tn,function(tn,tu){ta._mu.unlock(),to(tn,tu)})})},hi.prototype.readdirSync=function(tn){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.readdirSync(tn)},hi.prototype.exists=function(tn,to){var ta=this;this._mu.lock(function(){ta._fs.exists(tn,function(tn){ta._mu.unlock(),to(tn)})})},hi.prototype.existsSync=function(tn){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.existsSync(tn)},hi.prototype.realpath=function(tn,to,ta){var tu=this;this._mu.lock(function(){tu._fs.realpath(tn,to,function(tn,to){tu._mu.unlock(),ta(tn,to)})})},hi.prototype.realpathSync=function(tn,to){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.realpathSync(tn,to)},hi.prototype.truncate=function(tn,to,ta){var tu=this;this._mu.lock(function(){tu._fs.truncate(tn,to,function(tn){tu._mu.unlock(),ta(tn)})})},hi.prototype.truncateSync=function(tn,to){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.truncateSync(tn,to)},hi.prototype.readFile=function(tn,to,ta,tu){var tc=this;this._mu.lock(function(){tc._fs.readFile(tn,to,ta,function(tn,to){tc._mu.unlock(),tu(tn,to)})})},hi.prototype.readFileSync=function(tn,to,ta){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.readFileSync(tn,to,ta)},hi.prototype.writeFile=function(tn,to,ta,tu,tc,th){var td=this;this._mu.lock(function(){td._fs.writeFile(tn,to,ta,tu,tc,function(tn){td._mu.unlock(),th(tn)})})},hi.prototype.writeFileSync=function(tn,to,ta,tu,tc){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.writeFileSync(tn,to,ta,tu,tc)},hi.prototype.appendFile=function(tn,to,ta,tu,tc,th){var td=this;this._mu.lock(function(){td._fs.appendFile(tn,to,ta,tu,tc,function(tn){td._mu.unlock(),th(tn)})})},hi.prototype.appendFileSync=function(tn,to,ta,tu,tc){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.appendFileSync(tn,to,ta,tu,tc)},hi.prototype.chmod=function(tn,to,ta,tu){var tc=this;this._mu.lock(function(){tc._fs.chmod(tn,to,ta,function(tn){tc._mu.unlock(),tu(tn)})})},hi.prototype.chmodSync=function(tn,to,ta){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.chmodSync(tn,to,ta)},hi.prototype.chown=function(tn,to,ta,tu,tc){var th=this;this._mu.lock(function(){th._fs.chown(tn,to,ta,tu,function(tn){th._mu.unlock(),tc(tn)})})},hi.prototype.chownSync=function(tn,to,ta,tu){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.chownSync(tn,to,ta,tu)},hi.prototype.utimes=function(tn,to,ta,tu){var tc=this;this._mu.lock(function(){tc._fs.utimes(tn,to,ta,function(tn){tc._mu.unlock(),tu(tn)})})},hi.prototype.utimesSync=function(tn,to,ta){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.utimesSync(tn,to,ta)},hi.prototype.link=function(tn,to,ta){var tu=this;this._mu.lock(function(){tu._fs.link(tn,to,function(tn){tu._mu.unlock(),ta(tn)})})},hi.prototype.linkSync=function(tn,to){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.linkSync(tn,to)},hi.prototype.symlink=function(tn,to,ta,tu){var tc=this;this._mu.lock(function(){tc._fs.symlink(tn,to,ta,function(tn){tc._mu.unlock(),tu(tn)})})},hi.prototype.symlinkSync=function(tn,to,ta){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.symlinkSync(tn,to,ta)},hi.prototype.readlink=function(tn,to){var ta=this;this._mu.lock(function(){ta._fs.readlink(tn,function(tn,tu){ta._mu.unlock(),to(tn,tu)})})},hi.prototype.readlinkSync=function(tn){if(this._mu.isLocked())throw Error("invalid sync call");return this._fs.readlinkSync(tn)};var eG="/.deletedFiles.log";function pi(tn){return p.getFileFlag(tn)}var eZ,eQ=function(tn){function e(to,ta,tu,tc,th){tn.call(this,to,ta,tu,tc,th)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.sync=function(tn){var to=this;this.isDirty()?this._fs._syncAsync(this,function(ta){to.resetDirty(),tn(ta)}):tn(null)},e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.close=function(tn){this.sync(tn)},e.prototype.closeSync=function(){this.syncSync()},e}(tR),e$=function(tn){function e(to,ta){if(tn.call(this),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=to,this._readable=ta,this._writable.isReadOnly())throw new tS(tp.EINVAL,"Writable file system must be writable.")}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.isAvailable=function(){return!0},e.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},e.prototype._syncAsync=function(tn,to){var ta=this;this.createParentDirectoriesAsync(tn.getPath(),function(tu){if(tu)return to(tu);ta._writable.writeFile(tn.getPath(),tn.getBuffer(),null,pi("w"),tn.getStats().mode,to)})},e.prototype._syncSync=function(tn){this.createParentDirectories(tn.getPath()),this._writable.writeFileSync(tn.getPath(),tn.getBuffer(),null,pi("w"),tn.getStats().mode)},e.prototype.getName=function(){return e0.Name},e.prototype.initialize=function(tn){var to=this,ta=this._initializeCallbacks,r=function(tn){to._isInitialized=!tn,to._initializeCallbacks=[],ta.forEach(function(to){return to(tn)})};if(this._isInitialized)return tn();ta.push(tn),1===ta.length&&this._writable.readFile(eG,"utf8",pi("r"),function(tn,ta){if(tn){if(tn.errno!==tp.ENOENT)return r(tn)}else to._deleteLog=ta;to._reparseDeletionLog(),r()})},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return this._readable.supportsSynch()&&this._writable.supportsSynch()},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},e.prototype.getDeletionLog=function(){return this._deleteLog},e.prototype.restoreDeletionLog=function(tn){this._deleteLog=tn,this._reparseDeletionLog(),this.updateLog("")},e.prototype.rename=function(tn,to,ta){var tu=this;if(this.checkInitAsync(ta)&&!this.checkPathAsync(tn,ta)&&!this.checkPathAsync(to,ta))return tn===eG||to===eG?ta(tS.EPERM("Cannot rename deletion log.")):tn===to?ta():void this.stat(tn,!1,function(tc,th){return tc?ta(tc):tu.stat(to,!1,function(tc,td){function c(tc){var th=tc.shift();if(!th)return ta();var td=tg.resolve(tn,th),tf=tg.resolve(to,th);tu.rename(td,tf,function(tn){if(tn)return ta(tn);c(tc)})}var tf=511;if(th.isDirectory()){if(tc)return tc.errno!==tp.ENOENT?ta(tc):tu._writable.exists(tn,function(tc){if(tc)return tu._writable.rename(tn,to,ta);tu._writable.mkdir(to,tf,function(to){if(to)return ta(to);tu._readable.readdir(tn,function(tn,to){if(tn)return ta();c(to)})})});if(tf=td.mode,!td.isDirectory())return ta(tS.ENOTDIR(to));tu.readdir(to,function(tc,th){if(th&&th.length)return ta(tS.ENOTEMPTY(to));tu._readable.readdir(tn,function(tn,to){if(tn)return ta();c(to)})})}if(td&&td.isDirectory())return ta(tS.EISDIR(to));tu.readFile(tn,null,pi("r"),function(tc,td){return tc?ta(tc):tu.writeFile(to,td,null,pi("w"),th.mode,function(to){return to?ta(to):tu.unlink(tn,ta)})})})})},e.prototype.renameSync=function(tn,to){var ta=this;if(this.checkInitialized(),this.checkPath(tn),this.checkPath(to),tn===eG||to===eG)throw tS.EPERM("Cannot rename deletion log.");var tu=this.statSync(tn,!1);if(tu.isDirectory()){if(tn===to)return;var tc=511;if(this.existsSync(to)){var th=this.statSync(to,!1);if(tc=th.mode,!th.isDirectory())throw tS.ENOTDIR(to);if(this.readdirSync(to).length>0)throw tS.ENOTEMPTY(to)}this._writable.existsSync(tn)?this._writable.renameSync(tn,to):this._writable.existsSync(to)||this._writable.mkdirSync(to,tc),this._readable.existsSync(tn)&&this._readable.readdirSync(tn).forEach(function(tu){ta.renameSync(tg.resolve(tn,tu),tg.resolve(to,tu))})}else{if(this.existsSync(to)&&this.statSync(to,!1).isDirectory())throw tS.EISDIR(to);this.writeFileSync(to,this.readFileSync(tn,null,pi("r")),null,pi("w"),tu.mode)}tn!==to&&this.existsSync(tn)&&this.unlinkSync(tn)},e.prototype.stat=function(tn,to,ta){var tu=this;this.checkInitAsync(ta)&&this._writable.stat(tn,to,function(tc,th){tc&&tc.errno===tp.ENOENT?(tu._deletedFiles[tn]&&ta(tS.ENOENT(tn)),tu._readable.stat(tn,to,function(tn,to){to&&((to=to.clone()).mode=146|to.mode),ta(tn,to)})):ta(tc,th)})},e.prototype.statSync=function(tn,to){this.checkInitialized();try{return this._writable.statSync(tn,to)}catch(tu){if(this._deletedFiles[tn])throw tS.ENOENT(tn);var ta=this._readable.statSync(tn,to).clone();return ta.mode=146|ta.mode,ta}},e.prototype.open=function(tn,to,ta,tu){var tc=this;this.checkInitAsync(tu)&&!this.checkPathAsync(tn,tu)&&this.stat(tn,!1,function(th,td){if(!td)return to.pathNotExistsAction()===tw.CREATE_FILE?tc.createParentDirectoriesAsync(tn,function(th){return th?tu(th):tc._writable.open(tn,to,ta,tu)}):tu(tS.ENOENT(tn));switch(to.pathExistsAction()){case tw.TRUNCATE_FILE:return tc.createParentDirectoriesAsync(tn,function(th){if(th)return tu(th);tc._writable.open(tn,to,ta,tu)});case tw.NOP:return tc._writable.exists(tn,function(th){th?tc._writable.open(tn,to,ta,tu):((td=td.clone()).mode=ta,tc._readable.readFile(tn,null,pi("r"),function(ta,th){if(ta)return tu(ta);-1===td.size&&(td.size=th.length),tu(null,new eQ(tc,tn,to,td,th))}))});default:return tu(tS.EEXIST(tn))}})},e.prototype.openSync=function(tn,to,ta){if(this.checkInitialized(),this.checkPath(tn),tn===eG)throw tS.EPERM("Cannot open deletion log.");if(!this.existsSync(tn)){if(to.pathNotExistsAction()===tw.CREATE_FILE)return this.createParentDirectories(tn),this._writable.openSync(tn,to,ta);throw tS.ENOENT(tn)}switch(to.pathExistsAction()){case tw.TRUNCATE_FILE:return this.createParentDirectories(tn),this._writable.openSync(tn,to,ta);case tw.NOP:if(this._writable.existsSync(tn))return this._writable.openSync(tn,to,ta);var tu=this._readable.readFileSync(tn,null,pi("r")),tc=this._readable.statSync(tn,!1).clone();return tc.mode=ta,new eQ(this,tn,to,tc,tu);default:throw tS.EEXIST(tn)}},e.prototype.unlink=function(tn,to){var ta=this;this.checkInitAsync(to)&&!this.checkPathAsync(tn,to)&&this.exists(tn,function(tu){if(!tu)return to(tS.ENOENT(tn));ta._writable.exists(tn,function(tu){if(tu)return ta._writable.unlink(tn,function(tu){if(tu)return to(tu);ta.exists(tn,function(tu){tu&&ta.deletePath(tn),to(null)})});ta.deletePath(tn),to(null)})})},e.prototype.unlinkSync=function(tn){if(this.checkInitialized(),this.checkPath(tn),!this.existsSync(tn))throw tS.ENOENT(tn);this._writable.existsSync(tn)&&this._writable.unlinkSync(tn),this.existsSync(tn)&&this.deletePath(tn)},e.prototype.rmdir=function(tn,to){var ta=this;if(this.checkInitAsync(to)){var r=function(){ta.readdir(tn,function(tu,tc){return tu?to(tu):tc.length?to(tS.ENOTEMPTY(tn)):(ta.deletePath(tn),void to(null))})};this.exists(tn,function(tu){if(!tu)return to(tS.ENOENT(tn));ta._writable.exists(tn,function(tu){tu?ta._writable.rmdir(tn,function(tu){if(tu)return to(tu);ta._readable.exists(tn,function(tn){tn?r():to()})}):r()})})}},e.prototype.rmdirSync=function(tn){if(this.checkInitialized(),!this.existsSync(tn))throw tS.ENOENT(tn);if(this._writable.existsSync(tn)&&this._writable.rmdirSync(tn),this.existsSync(tn)){if(this.readdirSync(tn).length>0)throw tS.ENOTEMPTY(tn);this.deletePath(tn)}},e.prototype.mkdir=function(tn,to,ta){var tu=this;this.checkInitAsync(ta)&&this.exists(tn,function(tc){if(tc)return ta(tS.EEXIST(tn));tu.createParentDirectoriesAsync(tn,function(tc){if(tc)return ta(tc);tu._writable.mkdir(tn,to,ta)})})},e.prototype.mkdirSync=function(tn,to){if(this.checkInitialized(),this.existsSync(tn))throw tS.EEXIST(tn);this.createParentDirectories(tn),this._writable.mkdirSync(tn,to)},e.prototype.readdir=function(tn,to){var ta=this;this.checkInitAsync(to)&&this.stat(tn,!1,function(tu,tc){return tu?to(tu):tc.isDirectory()?void ta._writable.readdir(tn,function(tu,tc){if(tu&&"ENOENT"!==tu.code)return to(tu);!tu&&tc||(tc=[]),ta._readable.readdir(tn,function(tu,th){!tu&&th||(th=[]);var td={};to(null,tc.concat(th.filter(function(to){return!ta._deletedFiles[tn+"/"+to]})).filter(function(tn){var to=!td[tn];return td[tn]=!0,to}))})}):to(tS.ENOTDIR(tn))})},e.prototype.readdirSync=function(tn){var to=this;if(this.checkInitialized(),!this.statSync(tn,!1).isDirectory())throw tS.ENOTDIR(tn);var ta=[];try{ta=ta.concat(this._writable.readdirSync(tn))}catch(tn){}try{ta=ta.concat(this._readable.readdirSync(tn).filter(function(ta){return!to._deletedFiles[tn+"/"+ta]}))}catch(tn){}var tu={};return ta.filter(function(tn){var to=!tu[tn];return tu[tn]=!0,to})},e.prototype.exists=function(tn,to){var ta=this;this.checkInitialized(),this._writable.exists(tn,function(tu){if(tu)return to(!0);ta._readable.exists(tn,function(tu){to(tu&&!0!==ta._deletedFiles[tn])})})},e.prototype.existsSync=function(tn){return this.checkInitialized(),this._writable.existsSync(tn)||this._readable.existsSync(tn)&&!0!==this._deletedFiles[tn]},e.prototype.chmod=function(tn,to,ta,tu){var tc=this;this.checkInitAsync(tu)&&this.operateOnWritableAsync(tn,function(th){if(th)return tu(th);tc._writable.chmod(tn,to,ta,tu)})},e.prototype.chmodSync=function(tn,to,ta){var tu=this;this.checkInitialized(),this.operateOnWritable(tn,function(){tu._writable.chmodSync(tn,to,ta)})},e.prototype.chown=function(tn,to,ta,tu,tc){var th=this;this.checkInitAsync(tc)&&this.operateOnWritableAsync(tn,function(td){if(td)return tc(td);th._writable.chown(tn,to,ta,tu,tc)})},e.prototype.chownSync=function(tn,to,ta,tu){var tc=this;this.checkInitialized(),this.operateOnWritable(tn,function(){tc._writable.chownSync(tn,to,ta,tu)})},e.prototype.utimes=function(tn,to,ta,tu){var tc=this;this.checkInitAsync(tu)&&this.operateOnWritableAsync(tn,function(th){if(th)return tu(th);tc._writable.utimes(tn,to,ta,tu)})},e.prototype.utimesSync=function(tn,to,ta){var tu=this;this.checkInitialized(),this.operateOnWritable(tn,function(){tu._writable.utimesSync(tn,to,ta)})},e.prototype.deletePath=function(tn){this._deletedFiles[tn]=!0,this.updateLog("d"+tn+"\n")},e.prototype.updateLog=function(tn){var to=this;this._deleteLog+=tn,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(eG,this._deleteLog,"utf8",p.getFileFlag("w"),420,function(tn){to._deleteLogUpdatePending=!1,tn?to._deleteLogError=tn:to._deleteLogUpdateNeeded&&(to._deleteLogUpdateNeeded=!1,to.updateLog(""))}))},e.prototype._reparseDeletionLog=function(){var tn=this;this._deletedFiles={},this._deleteLog.split("\n").forEach(function(to){tn._deletedFiles[to.slice(1)]="d"===to.slice(0,1)})},e.prototype.checkInitialized=function(){if(!this._isInitialized)throw new tS(tp.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.");if(null!==this._deleteLogError){var tn=this._deleteLogError;throw this._deleteLogError=null,tn}},e.prototype.checkInitAsync=function(tn){if(!this._isInitialized)return tn(new tS(tp.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;if(null!==this._deleteLogError){var to=this._deleteLogError;return this._deleteLogError=null,tn(to),!1}return!0},e.prototype.checkPath=function(tn){if(tn===eG)throw tS.EPERM(tn)},e.prototype.checkPathAsync=function(tn,to){return tn===eG&&(to(tS.EPERM(tn)),!0)},e.prototype.createParentDirectoriesAsync=function(tn,to){var ta=tg.dirname(tn),tu=[],tc=this;this._writable.stat(ta,!1,function t(tn,th){tn?(tu.push(ta),ta=tg.dirname(ta),tc._writable.stat(ta,!1,t)):function o(){if(!tu.length)return to();var tn=tu.pop();tc._readable.stat(tn,!1,function(ta,tu){if(!tu)return to();tc._writable.mkdir(tn,tu.mode,function(tn){if(tn)return to(tn);o()})})}()})},e.prototype.createParentDirectories=function(tn){for(var to=this,ta=tg.dirname(tn),tu=[];!this._writable.existsSync(ta);)tu.push(ta),ta=tg.dirname(ta);(tu=tu.reverse()).forEach(function(tn){to._writable.mkdirSync(tn,to.statSync(tn,!1).mode)})},e.prototype.operateOnWritable=function(tn,to){if(!this.existsSync(tn))throw tS.ENOENT(tn);this._writable.existsSync(tn)||this.copyToWritable(tn),to()},e.prototype.operateOnWritableAsync=function(tn,to){var ta=this;this.exists(tn,function(tu){if(!tu)return to(tS.ENOENT(tn));ta._writable.exists(tn,function(tu){if(!tu)return ta.copyToWritableAsync(tn,to);to()})})},e.prototype.copyToWritable=function(tn){var to=this.statSync(tn,!1);to.isDirectory()?this._writable.mkdirSync(tn,to.mode):this.writeFileSync(tn,this._readable.readFileSync(tn,null,pi("r")),null,pi("w"),this.statSync(tn,!1).mode)},e.prototype.copyToWritableAsync=function(tn,to){var ta=this;this.stat(tn,!1,function(tu,tc){return tu?to(tu):tc.isDirectory()?ta._writable.mkdir(tn,tc.mode,to):void ta._readable.readFile(tn,null,pi("r"),function(tu,th){if(tu)return to(tu);ta.writeFile(tn,th,null,pi("w"),tc.mode,to)})})},e}(J),e0=function(tn){function e(to,ta,tu){void 0===tu&&(tu=!0),tn.call(this,new e$(to,ta)),P(tu,e.Name,{readable:"readable file system",writable:"writable file system"})}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){try{var ta=new e(tn.writable,tn.readable,!1);ta.initialize(function(tn){to(tn,ta)},!1)}catch(tn){to(tn)}},e.isAvailable=function(){return e$.isAvailable()},e.prototype.initialize=function(to,ta){void 0===ta&&(ta=!0),ta&&console.warn("[OverlayFS] OverlayFS.initialize() is deprecated and will be removed in the next major release. Please use 'OverlayFS.Create({readable: readable file system instance, writable: writable file system instance}, cb)' to create and initialize OverlayFS instances."),tn.prototype.initialize.call(this,to)},e.prototype.getOverlayedFileSystems=function(){return tn.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()},e.prototype.unwrap=function(){return tn.prototype.getFSUnlocked.call(this)},e}(hi);e0.Name="OverlayFS",e0.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}},(e6=eZ||(eZ={}))[e6.CB=0]="CB",e6[e6.FD=1]="FD",e6[e6.API_ERROR=2]="API_ERROR",e6[e6.STATS=3]="STATS",e6[e6.PROBE=4]="PROBE",e6[e6.FILEFLAG=5]="FILEFLAG",e6[e6.BUFFER=6]="BUFFER",e6[e6.ERROR=7]="ERROR";var wi=function(){this._callbacks={},this._nextId=0};wi.prototype.toRemoteArg=function(tn){var to=this._nextId++;return this._callbacks[to]=tn,{type:eZ.CB,id:to}},wi.prototype.toLocalArg=function(tn){var to=this._callbacks[tn];return delete this._callbacks[tn],to};var Si=function(){this._fileDescriptors={},this._nextId=0};function bi(tn){var to;return{type:eZ.API_ERROR,errorData:C(tn.writeToBuffer())}}function Ei(tn){var to;return tS.fromBuffer(j(tn.errorData))}function Ii(tn){return{type:eZ.ERROR,name:tn.name,message:tn.message,stack:tn.stack}}function _i(tn){var to=eI[tn.name];"function"!=typeof to&&(to=Error);var ta=new to(tn.message);return ta.stack=tn.stack,ta}function Di(tn){var to;return{type:eZ.STATS,statsData:C(tn.toBuffer())}}function Ti(tn){var to;return y.fromBuffer(j(tn.statsData))}function Ai(tn){return{type:eZ.FILEFLAG,flagStr:tn.getFlagString()}}function Oi(tn){return p.getFileFlag(tn.flagStr)}function Ri(tn){return{type:eZ.BUFFER,data:C(tn)}}Si.prototype.toRemoteArg=function(to,ta,tu,tc){var th,td,tf=this._nextId++;this._fileDescriptors[tf]=to,to.stat(function(tp,ty){tp?tc(tp):(td=C(ty.toBuffer()),tu.isReadable()?to.read(tn.alloc(ty.size),0,ty.size,0,function(tn,to,tp){tn?tc(tn):(th=C(tp),tc(null,{type:eZ.FD,id:tf,data:th,stat:td,path:ta,flag:tu.getFlagString()}))}):tc(null,{type:eZ.FD,id:tf,data:new ArrayBuffer(0),stat:td,path:ta,flag:tu.getFlagString()}))})},Si.prototype.applyFdAPIRequest=function(tn,to){var ta=this,tu=tn.args[0];this._applyFdChanges(tu,function(tc,th){tc?to(tc):th[tn.method](function(tc){"close"===tn.method&&delete ta._fileDescriptors[tu.id],to(tc)})})},Si.prototype._applyFdChanges=function(tn,to){var ta=this._fileDescriptors[tn.id],tu=j(tn.data),tc=y.fromBuffer(j(tn.stat)),th=p.getFileFlag(tn.flag);th.isWriteable()?ta.write(tu,0,tu.length,th.isAppendable()?ta.getPos():0,function(tn){function s(){ta.stat(function(tn,tu){tn?to(tn):tu.mode!==tc.mode?ta.chmod(tc.mode,function(tn){to(tn,ta)}):to(tn,ta)})}tn?to(tn):th.isAppendable()?s():ta.truncate(tu.length,function(){s()})}):to(null,ta)};var e1=function(tn){function e(to,ta,tu,tc,th,td){tn.call(this,to,ta,tu,tc,td),this._remoteFdId=th}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.getRemoteFdId=function(){return this._remoteFdId},e.prototype.toRemoteArg=function(){return{type:eZ.FD,id:this._remoteFdId,data:C(this.getBuffer()),stat:C(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}},e.prototype.sync=function(tn){this._syncClose("sync",tn)},e.prototype.close=function(tn){this._syncClose("close",tn)},e.prototype._syncClose=function(tn,to){var ta=this;this.isDirty()?this._fs.syncClose(tn,this,function(tn){tn||ta.resetDirty(),to(tn)}):to()},e}(tR),e2=function(to){function i(tn,ta){var tu=this;void 0===ta&&(ta=!0),to.call(this),this._callbackConverter=new wi,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=tn,P(ta,i.Name,{worker:"Web Worker instance"}),this._worker.addEventListener("message",function(tn){var to=tn.data;if(to&&"object"==typeof to&&to.hasOwnProperty("browserfsMessage")&&to.browserfsMessage){var ta,tc=to.args,th=Array(tc.length);for(ta=0;ta<th.length;ta++)th[ta]=tu._argRemote2Local(tc[ta]);tu._callbackConverter.toLocalArg(to.cbId).apply(null,th)}})}return to&&(i.__proto__=to),i.prototype=Object.create(to&&to.prototype),i.prototype.constructor=i,i.Create=function(tn,to){var ta=new i(tn.worker,!1);ta.initialize(function(){to(null,ta)})},i.isAvailable=function(){return"undefined"!=typeof importScripts||"undefined"!=typeof Worker},i.attachRemoteListener=function(to){var ta=new Si;to.addEventListener("message",function(tu){var tc,th=tu.data;if(th&&"object"==typeof th&&th.hasOwnProperty("browserfsMessage")&&th.browserfsMessage){var td,tf,tp,ty,tg=th.args,tv=Array(tg.length);switch(th.method){case"close":case"sync":tc=tg[1],ta.applyFdAPIRequest(th,function(tn){var ta={browserfsMessage:!0,cbId:tc.id,args:tn?[bi(tn)]:[]};to.postMessage(ta)});break;case"probe":td=tD.getRootFS(),tf=tg[1],tp={type:eZ.PROBE,isReadOnly:td.isReadOnly(),supportsLinks:td.supportsLinks(),supportsProps:td.supportsProps()},ty={browserfsMessage:!0,cbId:tf.id,args:[tp]},to.postMessage(ty);break;default:for(var tm=0;tm<tg.length;tm++)tv[tm]=function(tu,tc){if(!tu)return tu;if("object"==typeof tu){if("number"!=typeof tu.type)return tu;switch(tu.type){case eZ.CB:var th=tu.id;return function(){var tu,td,tf=arguments,tp=Array(arguments.length),ty=arguments.length;for(tu=0;tu<arguments.length;tu++)!function(tu,tf){var tg;(tg=function(tn,ta){tp[tu]=ta,tn?ty>0&&(ty=-1,td={browserfsMessage:!0,cbId:th,args:[bi(tn)]},to.postMessage(td)):0==--ty&&(td={browserfsMessage:!0,cbId:th,args:tp},to.postMessage(td))})(null,"object"==typeof tf?tf instanceof y?Di(tf):tf instanceof tS?bi(tf):tf instanceof G?ta.toRemoteArg(tf,tc[0],tc[1],tg):tf instanceof p?Ai(tf):tf instanceof tn?Ri(tf):tf instanceof Error?Ii(tf):tf:tf)}(tu,tf[tu]);0==arguments.length&&(td={browserfsMessage:!0,cbId:th,args:tp},to.postMessage(td))};case eZ.API_ERROR:return Ei(tu);case eZ.STATS:return Ti(tu);case eZ.FILEFLAG:return Oi(tu);case eZ.BUFFER:return j(tu.data);case eZ.ERROR:return _i(tu)}}return tu}(tg[tm],tv);var tw=tD.getRootFS();tw[th.method].apply(tw,tv)}}})},i.prototype.getName=function(){return i.Name},i.prototype.initialize=function(tn){var to=this;if(this._isInitialized)tn();else{var ta={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(z()),this._callbackConverter.toRemoteArg(function(ta){to._isInitialized=!0,to._isReadOnly=ta.isReadOnly,to._supportLinks=ta.supportsLinks,to._supportProps=ta.supportsProps,tn()})]};this._worker.postMessage(ta)}},i.prototype.isReadOnly=function(){return this._isReadOnly},i.prototype.supportsSynch=function(){return!1},i.prototype.supportsLinks=function(){return this._supportLinks},i.prototype.supportsProps=function(){return this._supportProps},i.prototype.rename=function(tn,to,ta){this._rpc("rename",arguments)},i.prototype.stat=function(tn,to,ta){this._rpc("stat",arguments)},i.prototype.open=function(tn,to,ta,tu){this._rpc("open",arguments)},i.prototype.unlink=function(tn,to){this._rpc("unlink",arguments)},i.prototype.rmdir=function(tn,to){this._rpc("rmdir",arguments)},i.prototype.mkdir=function(tn,to,ta){this._rpc("mkdir",arguments)},i.prototype.readdir=function(tn,to){this._rpc("readdir",arguments)},i.prototype.exists=function(tn,to){this._rpc("exists",arguments)},i.prototype.realpath=function(tn,to,ta){this._rpc("realpath",arguments)},i.prototype.truncate=function(tn,to,ta){this._rpc("truncate",arguments)},i.prototype.readFile=function(tn,to,ta,tu){this._rpc("readFile",arguments)},i.prototype.writeFile=function(tn,to,ta,tu,tc,th){this._rpc("writeFile",arguments)},i.prototype.appendFile=function(tn,to,ta,tu,tc,th){this._rpc("appendFile",arguments)},i.prototype.chmod=function(tn,to,ta,tu){this._rpc("chmod",arguments)},i.prototype.chown=function(tn,to,ta,tu,tc){this._rpc("chown",arguments)},i.prototype.utimes=function(tn,to,ta,tu){this._rpc("utimes",arguments)},i.prototype.link=function(tn,to,ta){this._rpc("link",arguments)},i.prototype.symlink=function(tn,to,ta,tu){this._rpc("symlink",arguments)},i.prototype.readlink=function(tn,to){this._rpc("readlink",arguments)},i.prototype.syncClose=function(tn,to,ta){this._worker.postMessage({browserfsMessage:!0,method:tn,args:[to.toRemoteArg(),this._callbackConverter.toRemoteArg(ta)]})},i.prototype._argRemote2Local=function(tn){if(!tn)return tn;if("object"==typeof tn){if("number"!=typeof tn.type)return tn;switch(tn.type){case eZ.API_ERROR:return Ei(tn);case eZ.FD:return new e1(this,tn.path,p.getFileFlag(tn.flag),y.fromBuffer(j(tn.stat)),tn.id,j(tn.data));case eZ.STATS:return Ti(tn);case eZ.FILEFLAG:return Oi(tn);case eZ.BUFFER:return j(tn.data);case eZ.ERROR:return _i(tn)}}return tn},i.prototype._rpc=function(tn,to){for(var ta=Array(to.length),tu=0;tu<to.length;tu++)ta[tu]=this._argLocal2Remote(to[tu]);this._worker.postMessage({browserfsMessage:!0,method:tn,args:ta})},i.prototype._argLocal2Remote=function(to){if(!to)return to;switch(typeof to){case"object":return to instanceof y?Di(to):to instanceof tS?bi(to):to instanceof e1?to.toRemoteArg():to instanceof p?Ai(to):to instanceof tn?Ri(to):to instanceof Error?Ii(to):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(to);default:return to}},i}(J);function Fi(tn,to,ta){var tu=new XMLHttpRequest;tu.open("HEAD",to,tn),tu.onreadystatechange=function(tn){if(4===tu.readyState){if(200!==tu.status)return ta(new tS(tu.status,"XHR HEAD error."));try{return ta(null,parseInt(tu.getResponseHeader("Content-Length")||"-1",10))}catch(tn){return ta(new tS(tp.EIO,"XHR HEAD error: Could not read content-length."))}}},tu.send()}e2.Name="WorkerFS",e2.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(tn,to){tn.postMessage?to():to(new tS(tp.EINVAL,"option must be a Web Worker instance."))}}};var Li=function(to,ta,tu){var tc=new XMLHttpRequest;tc.open("GET",to,!0);var th=!0;switch(ta){case"buffer":tc.responseType="arraybuffer";break;case"json":try{tc.responseType="json",th="json"===tc.responseType}catch(tn){th=!1}break;default:return tu(new tS(tp.EINVAL,"Invalid download type: "+ta))}tc.onreadystatechange=function(to){if(4===tc.readyState){if(200!==tc.status)return tu(new tS(tc.status,"XHR error."));switch(ta){case"buffer":return tu(null,tc.response?tn.from(tc.response):z());case"json":return tu(null,th?tc.response:JSON.parse(tc.responseText))}}},tc.send()},e5=tA&&"undefined"!=typeof Blob?function(to,ta){var tu,tc,th=new XMLHttpRequest;switch(th.open("GET",to,!1),ta){case"buffer":th.responseType="arraybuffer";break;case"json":break;default:throw new tS(tp.EINVAL,"Invalid download type: "+ta)}if(th.onreadystatechange=function(to){if(4===th.readyState){if(200===th.status)switch(ta){case"buffer":tu=tn.from(th.response);break;case"json":tu=JSON.parse(th.response)}else tc=new tS(th.status,"XHR error.")}},th.send(),tc)throw tc;return tu}:function(to,ta){var tu=new XMLHttpRequest;tu.open("GET",to,!1);var tc=null,th=null;if(tu.overrideMimeType("text/plain; charset=x-user-defined"),tu.onreadystatechange=function(to){if(4===tu.readyState){if(200!==tu.status)return void(th=new tS(tu.status,"XHR error."));switch(ta){case"buffer":var td=tu.responseText;tc=tn.alloc(td.length);for(var tf=0;tf<td.length;tf++)tc[tf]=td.charCodeAt(tf);return;case"json":return void(tc=JSON.parse(tu.responseText))}}},tu.send(),th)throw th;return tc},ji=function(){this._index={},this.addPath("/",new Ui)};ji.fromListing=function(tn){var to=new ji,ta=new Ui;to._index["/"]=ta;for(var tu=[["",tn,ta]];tu.length>0;){var tc=void 0,th=tu.pop(),td=th[0],tf=th[1],tp=th[2];for(var ty in tf)if(tf.hasOwnProperty(ty)){var tg=tf[ty],tv=td+"/"+ty;tg?(to._index[tv]=tc=new Ui,tu.push([tv,tg,tc])):tc=new Ki(new y(tI.FILE,-1,365)),tp&&(tp._ls[ty]=tc)}}return to},ji.prototype.fileIterator=function(tn){for(var to in this._index)if(this._index.hasOwnProperty(to))for(var ta=this._index[to],tu=0,tc=ta.getListing();tu<tc.length;tu+=1){var th=tc[tu],td=ta.getItem(th);zi(td)&&tn(td.getData())}},ji.prototype.addPath=function(tn,to){if(!to)throw Error("Inode must be specified");if("/"!==tn[0])throw Error("Path must be absolute, got: "+tn);if(this._index.hasOwnProperty(tn))return this._index[tn]===to;var ta=this._split_path(tn),tu=ta[0],tc=ta[1],th=this._index[tu];return!(void 0===th&&"/"!==tn&&(th=new Ui,!this.addPath(tu,th))||"/"!==tn&&!th.addItem(tc,to)||(Bi(to)&&(this._index[tn]=to),0))},ji.prototype.addPathFast=function(tn,to){var ta=tn.lastIndexOf("/"),tu=0===ta?"/":tn.substring(0,ta),tc=tn.substring(ta+1),th=this._index[tu];return void 0===th&&(th=new Ui,this.addPathFast(tu,th)),!!th.addItem(tc,to)&&(to.isDir()&&(this._index[tn]=to),!0)},ji.prototype.removePath=function(tn){var to=this._split_path(tn),ta=to[0],tu=to[1],tc=this._index[ta];if(void 0===tc)return null;var th=tc.remItem(tu);if(null===th)return null;if(Bi(th)){for(var td=0,tf=th.getListing();td<tf.length;td+=1){var tp=tf[td];this.removePath(tn+"/"+tp)}"/"!==tn&&delete this._index[tn]}return th},ji.prototype.ls=function(tn){var to=this._index[tn];return void 0===to?null:to.getListing()},ji.prototype.getInode=function(tn){var to=this._split_path(tn),ta=to[0],tu=to[1],tc=this._index[ta];return void 0===tc?null:ta===tn?tc:tc.getItem(tu)},ji.prototype._split_path=function(tn){var to=tg.dirname(tn);return[to,tn.substr(to.length+("/"===to?0:1))]};var Ki=function(tn){this.data=tn};Ki.prototype.isFile=function(){return!0},Ki.prototype.isDir=function(){return!1},Ki.prototype.getData=function(){return this.data},Ki.prototype.setData=function(tn){this.data=tn};var Ui=function(tn){void 0===tn&&(tn=null),this.data=tn,this._ls={}};function zi(tn){return!!tn&&tn.isFile()}function Bi(tn){return!!tn&&tn.isDir()}Ui.prototype.isFile=function(){return!1},Ui.prototype.isDir=function(){return!0},Ui.prototype.getData=function(){return this.data},Ui.prototype.getStats=function(){return new y(tI.DIRECTORY,4096,365)},Ui.prototype.getListing=function(){return Object.keys(this._ls)},Ui.prototype.getItem=function(tn){return this._ls[tn]||null},Ui.prototype.addItem=function(tn,to){return!(tn in this._ls)&&(this._ls[tn]=to,!0)},Ui.prototype.remItem=function(tn){var to=this._ls[tn];return void 0===to?null:(delete this._ls[tn],to)};var e3=function(tn){function e(to,ta,tu){void 0===ta&&(ta=""),void 0===tu&&(tu=!0),tn.call(this),to||(to="index.json"),ta.length>0&&"/"!==ta.charAt(ta.length-1)&&(ta+="/"),this.prefixUrl=ta;var tc=null;if("string"==typeof to){if(!(tc=this._requestFileSync(to,"json")))throw Error("Unable to find listing at URL: ${listingUrlOrObj}")}else tc=to;P(tu,e.Name,{index:"string"==typeof to?to:"file index as an object",baseUrl:ta}),this._index=ji.fromListing(tc)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){void 0===tn.index&&(tn.index="index.json"),"string"==typeof tn.index?e.FromURL(tn.index,to,tn.baseUrl,!1):to(null,new e(tn.index,tn.baseUrl,!1))},e.isAvailable=function(){return"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest},e.FromURL=function(tn,to,ta,tu){void 0===ta&&(ta=tn.slice(0,tn.lastIndexOf("/")+1)),void 0===tu&&(tu=!0),tu&&console.warn("[XmlHttpRequest] XmlHttpRequest.FromURL() is deprecated and will be removed in the next major release. Please use 'XmlHttpRequest.Create({ index: \""+tn+'", baseUrl: "'+ta+"\" }, cb)' instead."),Li(tn,"json",function(tn,tu){tn?to(tn):to(null,new e(tu,ta,!1))})},e.prototype.empty=function(){this._index.fileIterator(function(tn){tn.fileData=null})},e.prototype.getName=function(){return e.Name},e.prototype.diskSpace=function(tn,to){to(0,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.preloadFile=function(tn,to){var ta=this._index.getInode(tn);if(!zi(ta))throw tS.EISDIR(tn);if(null===ta)throw tS.ENOENT(tn);var tu=ta.getData();tu.size=to.length,tu.fileData=to},e.prototype.stat=function(tn,to,ta){var tu,tc=this._index.getInode(tn);if(null===tc)return ta(tS.ENOENT(tn));zi(tc)?(tu=tc.getData()).size<0?this._requestFileSizeAsync(tn,function(tn,to){if(tn)return ta(tn);tu.size=to,ta(null,tu.clone())}):ta(null,tu.clone()):Bi(tc)?ta(null,tu=tc.getStats()):ta(tS.FileError(tp.EINVAL,tn))},e.prototype.statSync=function(tn,to){var ta,tu=this._index.getInode(tn);if(null===tu)throw tS.ENOENT(tn);if(zi(tu))(ta=tu.getData()).size<0&&(ta.size=this._requestFileSizeSync(tn));else{if(!Bi(tu))throw tS.FileError(tp.EINVAL,tn);ta=tu.getStats()}return ta},e.prototype.open=function(tn,to,ta,tu){if(to.isWriteable())return tu(new tS(tp.EPERM,tn));var tc=this,th=this._index.getInode(tn);if(null===th)return tu(tS.ENOENT(tn));if(!zi(th))return tu(tS.EISDIR(tn));var td=th.getData();switch(to.pathExistsAction()){case tw.THROW_EXCEPTION:case tw.TRUNCATE_FILE:return tu(tS.EEXIST(tn));case tw.NOP:if(td.fileData)return tu(null,new tk(tc,tn,to,td.clone(),td.fileData));this._requestFileAsync(tn,"buffer",function(ta,th){return ta?tu(ta):(td.size=th.length,td.fileData=th,tu(null,new tk(tc,tn,to,td.clone(),th)))});break;default:return tu(new tS(tp.EINVAL,"Invalid FileMode object."))}},e.prototype.openSync=function(tn,to,ta){if(to.isWriteable())throw new tS(tp.EPERM,tn);var tu=this._index.getInode(tn);if(null===tu)throw tS.ENOENT(tn);if(!zi(tu))throw tS.EISDIR(tn);var tc=tu.getData();switch(to.pathExistsAction()){case tw.THROW_EXCEPTION:case tw.TRUNCATE_FILE:throw tS.EEXIST(tn);case tw.NOP:if(tc.fileData)return new tk(this,tn,to,tc.clone(),tc.fileData);var th=this._requestFileSync(tn,"buffer");return tc.size=th.length,tc.fileData=th,new tk(this,tn,to,tc.clone(),th);default:throw new tS(tp.EINVAL,"Invalid FileMode object.")}},e.prototype.readdir=function(tn,to){try{to(null,this.readdirSync(tn))}catch(tn){to(tn)}},e.prototype.readdirSync=function(tn){var to=this._index.getInode(tn);if(null===to)throw tS.ENOENT(tn);if(Bi(to))return to.getListing();throw tS.ENOTDIR(tn)},e.prototype.readFile=function(tn,to,ta,tu){var tc=tu;this.open(tn,ta,420,function(tn,ta){if(tn)return tu(tn);tu=function(tn,to){ta.close(function(ta){return tn||(tn=ta),tc(tn,to)})};var th=ta.getBuffer();null===to?tu(tn,K(th)):function(tn,to,ta){try{ta(null,tn.toString(to))}catch(tn){ta(tn)}}(th,to,tu)})},e.prototype.readFileSync=function(tn,to,ta){var tu=this.openSync(tn,ta,420);try{var tc=tu.getBuffer();return null===to?K(tc):tc.toString(to)}finally{tu.closeSync()}},e.prototype.getXhrPath=function(tn){return"/"===tn.charAt(0)&&(tn=tn.slice(1)),this.prefixUrl+tn},e.prototype._requestFileAsync=function(tn,to,ta){Li(this.getXhrPath(tn),to,ta)},e.prototype._requestFileSync=function(tn,to){return e5(this.getXhrPath(tn),to)},e.prototype._requestFileSizeAsync=function(tn,to){Fi(!0,this.getXhrPath(tn),to)},e.prototype._requestFileSizeSync=function(tn){var to,ta;return to=this.getXhrPath(tn),ta=-1,Fi(!1,to,function(tn,to){if(tn)throw tn;ta=to}),ta},e}(J);e3.Name="XmlHttpRequest",e3.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_xhrfs_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var qi=function(){};qi.str2byte=function(tn,to){for(var ta=tn.length>to.length?to.length:tn.length,tu=0;tu<ta;tu++){var tc=tn.charCodeAt(tu);if(tc>127){var th=qi.extendedChars.indexOf(tn.charAt(tu));th>-1&&(tc=th+128)}to[tc]=tu}return ta},qi.byte2str=function(tn){for(var to=Array(tn.length),ta=0;ta<tn.length;ta++){var tu=tn[ta];to[ta]=tu>127?qi.extendedChars[tu-128]:String.fromCharCode(tu)}return to.join("")},qi.byteLength=function(tn){return tn.length},qi.extendedChars=["\xc7","\xfc","\xe9","\xe2","\xe4","\xe0","\xe5","\xe7","\xea","\xeb","\xe8","\xef","\xee","\xec","\xc4","\xc5","\xc9","\xe6","\xc6","\xf4","\xf6","\xf2","\xfb","\xf9","\xff","\xd6","\xdc","\xf8","\xa3","\xd8","\xd7","ƒ","\xe1","\xed","\xf3","\xfa","\xf1","\xd1","\xaa","\xba","\xbf","\xae","\xac","\xbd","\xbc","\xa1","\xab","\xbb","_","_","_","\xa6","\xa6","\xc1","\xc2","\xc0","\xa9","\xa6","\xa6","+","+","\xa2","\xa5","+","+","-","-","+","-","+","\xe3","\xc3","+","+","-","-","\xa6","-","+","\xa4","\xf0","\xd0","\xca","\xcb","\xc8","i","\xcd","\xce","\xcf","+","+","_","_","\xa6","\xcc","_","\xd3","\xdf","\xd4","\xd2","\xf5","\xd5","\xb5","\xfe","\xde","\xda","\xdb","\xd9","\xfd","\xdd","\xaf","\xb4","\xad","\xb1","_","\xbe","\xb6","\xa7","\xf7","\xb8","\xb0","\xa8","\xb7","\xb9","\xb3","\xb2","_"," "];var e6,e8,e4,e7=ta(31).inflateRaw,e9={};function Xi(tn,to){return new Date(1980+(to>>9),(to>>5&15)-1,31&to,tn>>11,tn>>5&63,31&tn)}function Gi(tn,to,ta,tu){return 0===tu?"":to?tn.toString("utf8",ta,ta+tu):qi.byte2str(tn.slice(ta,ta+tu))}(td=e8||(e8={}))[td.MSDOS=0]="MSDOS",td[td.AMIGA=1]="AMIGA",td[td.OPENVMS=2]="OPENVMS",td[td.UNIX=3]="UNIX",td[td.VM_CMS=4]="VM_CMS",td[td.ATARI_ST=5]="ATARI_ST",td[td.OS2_HPFS=6]="OS2_HPFS",td[td.MAC=7]="MAC",td[td.Z_SYSTEM=8]="Z_SYSTEM",td[td.CP_M=9]="CP_M",td[td.NTFS=10]="NTFS",td[td.MVS=11]="MVS",td[td.VSE=12]="VSE",td[td.ACORN_RISC=13]="ACORN_RISC",td[td.VFAT=14]="VFAT",td[td.ALT_MVS=15]="ALT_MVS",td[td.BEOS=16]="BEOS",td[td.TANDEM=17]="TANDEM",td[td.OS_400=18]="OS_400",td[td.OSX=19]="OSX",(tf=e4||(e4={}))[tf.STORED=0]="STORED",tf[tf.SHRUNK=1]="SHRUNK",tf[tf.REDUCED_1=2]="REDUCED_1",tf[tf.REDUCED_2=3]="REDUCED_2",tf[tf.REDUCED_3=4]="REDUCED_3",tf[tf.REDUCED_4=5]="REDUCED_4",tf[tf.IMPLODE=6]="IMPLODE",tf[tf.DEFLATE=8]="DEFLATE",tf[tf.DEFLATE64=9]="DEFLATE64",tf[tf.TERSE_OLD=10]="TERSE_OLD",tf[tf.BZIP2=12]="BZIP2",tf[tf.LZMA=14]="LZMA",tf[tf.TERSE_NEW=18]="TERSE_NEW",tf[tf.LZ77=19]="LZ77",tf[tf.WAVPACK=97]="WAVPACK",tf[tf.PPMD=98]="PPMD";var Zi=function(tn){if(this.data=tn,67324752!==tn.readUInt32LE(0))throw new tS(tp.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))};Zi.prototype.versionNeeded=function(){return this.data.readUInt16LE(4)},Zi.prototype.flags=function(){return this.data.readUInt16LE(6)},Zi.prototype.compressionMethod=function(){return this.data.readUInt16LE(8)},Zi.prototype.lastModFileTime=function(){return Xi(this.data.readUInt16LE(10),this.data.readUInt16LE(12))},Zi.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(10)},Zi.prototype.crc32=function(){return this.data.readUInt32LE(14)},Zi.prototype.fileNameLength=function(){return this.data.readUInt16LE(26)},Zi.prototype.extraFieldLength=function(){return this.data.readUInt16LE(28)},Zi.prototype.fileName=function(){return Gi(this.data,this.useUTF8(),30,this.fileNameLength())},Zi.prototype.extraField=function(){var tn=30+this.fileNameLength();return this.data.slice(tn,tn+this.extraFieldLength())},Zi.prototype.totalSize=function(){return 30+this.fileNameLength()+this.extraFieldLength()},Zi.prototype.useUTF8=function(){return 2048==(2048&this.flags())};var Qi=function(tn,to,ta){this.header=tn,this.record=to,this.data=ta};Qi.prototype.decompress=function(){var tn=this.header.compressionMethod(),to=e9[tn];if(to)return to(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());var ta=e4[tn];throw ta||(ta="Unknown: "+tn),new tS(tp.EINVAL,"Invalid compression method on file '"+this.header.fileName()+"': "+ta)},Qi.prototype.getHeader=function(){return this.header},Qi.prototype.getRecord=function(){return this.record},Qi.prototype.getRawData=function(){return this.data};var $i=function(tn,to){if(this.zipData=tn,this.data=to,33639248!==this.data.readUInt32LE(0))throw new tS(tp.EINVAL,"Invalid Zip file: Central directory record has invalid signature: "+this.data.readUInt32LE(0));this._filename=this.produceFilename()};$i.prototype.versionMadeBy=function(){return this.data.readUInt16LE(4)},$i.prototype.versionNeeded=function(){return this.data.readUInt16LE(6)},$i.prototype.flag=function(){return this.data.readUInt16LE(8)},$i.prototype.compressionMethod=function(){return this.data.readUInt16LE(10)},$i.prototype.lastModFileTime=function(){return Xi(this.data.readUInt16LE(12),this.data.readUInt16LE(14))},$i.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(12)},$i.prototype.crc32=function(){return this.data.readUInt32LE(16)},$i.prototype.compressedSize=function(){return this.data.readUInt32LE(20)},$i.prototype.uncompressedSize=function(){return this.data.readUInt32LE(24)},$i.prototype.fileNameLength=function(){return this.data.readUInt16LE(28)},$i.prototype.extraFieldLength=function(){return this.data.readUInt16LE(30)},$i.prototype.fileCommentLength=function(){return this.data.readUInt16LE(32)},$i.prototype.diskNumberStart=function(){return this.data.readUInt16LE(34)},$i.prototype.internalAttributes=function(){return this.data.readUInt16LE(36)},$i.prototype.externalAttributes=function(){return this.data.readUInt32LE(38)},$i.prototype.headerRelativeOffset=function(){return this.data.readUInt32LE(42)},$i.prototype.produceFilename=function(){return Gi(this.data,this.useUTF8(),46,this.fileNameLength()).replace(/\\/g,"/")},$i.prototype.fileName=function(){return this._filename},$i.prototype.rawFileName=function(){return this.data.slice(46,46+this.fileNameLength())},$i.prototype.extraField=function(){var tn=44+this.fileNameLength();return this.data.slice(tn,tn+this.extraFieldLength())},$i.prototype.fileComment=function(){var tn=46+this.fileNameLength()+this.extraFieldLength();return Gi(this.data,this.useUTF8(),tn,this.fileCommentLength())},$i.prototype.rawFileComment=function(){var tn=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(tn,tn+this.fileCommentLength())},$i.prototype.totalSize=function(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()},$i.prototype.isDirectory=function(){var tn=this.fileName();return!!(16&this.externalAttributes())||"/"===tn.charAt(tn.length-1)},$i.prototype.isFile=function(){return!this.isDirectory()},$i.prototype.useUTF8=function(){return 2048==(2048&this.flag())},$i.prototype.isEncrypted=function(){return 1==(1&this.flag())},$i.prototype.getFileData=function(){var tn=this.headerRelativeOffset(),to=new Zi(this.zipData.slice(tn));return new Qi(to,this,this.zipData.slice(tn+to.totalSize()))},$i.prototype.getData=function(){return this.getFileData().decompress()},$i.prototype.getRawData=function(){return this.getFileData().getRawData()},$i.prototype.getStats=function(){return new y(tI.FILE,this.uncompressedSize(),365,new Date,this.lastModFileTime())};var tr=function(tn){if(this.data=tn,101010256!==this.data.readUInt32LE(0))throw new tS(tp.EINVAL,"Invalid Zip file: End of central directory record has invalid signature: "+this.data.readUInt32LE(0))};tr.prototype.diskNumber=function(){return this.data.readUInt16LE(4)},tr.prototype.cdDiskNumber=function(){return this.data.readUInt16LE(6)},tr.prototype.cdDiskEntryCount=function(){return this.data.readUInt16LE(8)},tr.prototype.cdTotalEntryCount=function(){return this.data.readUInt16LE(10)},tr.prototype.cdSize=function(){return this.data.readUInt32LE(12)},tr.prototype.cdOffset=function(){return this.data.readUInt32LE(16)},tr.prototype.cdZipCommentLength=function(){return this.data.readUInt16LE(20)},tr.prototype.cdZipComment=function(){return Gi(this.data,!0,22,this.cdZipCommentLength())},tr.prototype.rawCdZipComment=function(){return this.data.slice(22,22+this.cdZipCommentLength())};var er=function(tn,to,ta,tu){this.index=tn,this.directoryEntries=to,this.eocd=ta,this.data=tu},ii=function(tn){function e(to,ta,tu){void 0===ta&&(ta=""),void 0===tu&&(tu=!0),tn.call(this),this.name=ta,this._index=new ji,this._directoryEntries=[],this._eocd=null,P(tu,e.Name,{zipData:"zip data as a Buffer",name:ta}),to instanceof er?(this._index=to.index,this._directoryEntries=to.directoryEntries,this._eocd=to.eocd,this.data=to.data):(this.data=to,this.populateIndex())}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){try{e.computeIndex(tn.zipData,function(ta){var tu=new e(ta,tn.name,!1);to(null,tu)},!1)}catch(tn){to(tn)}},e.isAvailable=function(){return!0},e.RegisterDecompressionMethod=function(tn,to){e9[tn]=to},e.computeIndex=function(tn,to,ta){void 0===ta&&(ta=!0),ta&&console.warn("[ZipFS] ZipFS.computeIndex is now deprecated, and will be removed in the next major release. Please update your code to use 'ZipFS.Create({ zipData: zip file as a Buffer}, cb)' instead.");var tu=new ji,tc=e.getEOCD(tn);if(tc.diskNumber()!==tc.cdDiskNumber())throw new tS(tp.EINVAL,"ZipFS does not support spanned zip files.");var th=tc.cdOffset();if(4294967295===th)throw new tS(tp.EINVAL,"ZipFS does not support Zip64.");var td=th+tc.cdSize();e.computeIndexResponsive(tn,tu,th,td,to,[],tc)},e.getEOCD=function(tn){for(var to=Math.min(65557,tn.length-1),ta=22;ta<to;ta++)if(101010256===tn.readUInt32LE(tn.length-ta))return new tr(tn.slice(tn.length-ta));throw new tS(tp.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")},e.addToIndex=function(tn,to){var ta=tn.fileName();if("/"===ta.charAt(0))throw Error("WHY IS THIS ABSOLUTE");"/"===ta.charAt(ta.length-1)&&(ta=ta.substr(0,ta.length-1)),tn.isDirectory()?to.addPathFast("/"+ta,new Ui(tn)):to.addPathFast("/"+ta,new Ki(tn))},e.computeIndexResponsive=function(tn,to,ta,tu,tc,th,td){if(ta<tu){for(var tf=0;tf++<200&&ta<tu;){var tp=new $i(tn,tn.slice(ta));e.addToIndex(tp,to),ta+=tp.totalSize(),th.push(tp)}eX(function(){e.computeIndexResponsive(tn,to,ta,tu,tc,th,td)})}else tc(new er(to,th,td,tn))},e.prototype.getName=function(){return e.Name+(""!==this.name?" "+this.name:"")},e.prototype.getCentralDirectoryEntry=function(tn){var to=this._index.getInode(tn);if(null===to)throw tS.ENOENT(tn);if(zi(to)||Bi(to))return to.getData();throw tS.EPERM("Invalid inode: "+to)},e.prototype.getCentralDirectoryEntryAt=function(tn){var to=this._directoryEntries[tn];if(!to)throw RangeError("Invalid directory index: "+tn+".");return to},e.prototype.getNumberOfCentralDirectoryEntries=function(){return this._directoryEntries.length},e.prototype.getEndOfCentralDirectory=function(){return this._eocd},e.prototype.diskSpace=function(tn,to){to(this.data.length,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.statSync=function(tn,to){var ta,tu=this._index.getInode(tn);if(null===tu)throw tS.ENOENT(tn);if(zi(tu))ta=tu.getData().getStats();else{if(!Bi(tu))throw new tS(tp.EINVAL,"Invalid inode.");ta=tu.getStats()}return ta},e.prototype.openSync=function(tn,to,ta){if(to.isWriteable())throw new tS(tp.EPERM,tn);var tu=this._index.getInode(tn);if(!tu)throw tS.ENOENT(tn);if(!zi(tu))throw tS.EISDIR(tn);var tc=tu.getData(),th=tc.getStats();switch(to.pathExistsAction()){case tw.THROW_EXCEPTION:case tw.TRUNCATE_FILE:throw tS.EEXIST(tn);case tw.NOP:return new tk(this,tn,to,th,tc.getData());default:throw new tS(tp.EINVAL,"Invalid FileMode object.")}},e.prototype.readdirSync=function(tn){var to=this._index.getInode(tn);if(to){if(Bi(to))return to.getListing();throw tS.ENOTDIR(tn)}throw tS.ENOENT(tn)},e.prototype.readFileSync=function(tn,to,ta){var tu=this.openSync(tn,ta,420);try{var tc=tu.getBuffer();return null===to?K(tc):tc.toString(to)}finally{tu.closeSync()}},e.prototype.populateIndex=function(){var tn=this._eocd=e.getEOCD(this.data);if(tn.diskNumber()!==tn.cdDiskNumber())throw new tS(tp.EINVAL,"ZipFS does not support spanned zip files.");var to=tn.cdOffset();if(4294967295===to)throw new tS(tp.EINVAL,"ZipFS does not support Zip64.");for(var ta=to+tn.cdSize();to<ta;){var tu=new $i(this.data,this.data.slice(to));to+=tu.totalSize(),e.addToIndex(tu,this._index),this._directoryEntries.push(tu)}},e}(tP);function rr(tn,to,ta){return tn.toString("ascii",to,to+ta).trim()}function nr(tn,to,ta){if(1===ta)return String.fromCharCode(tn[to]);for(var tu=Math.floor(ta/2),tc=Array(tu),th=0;th<tu;th++){var td=to+(th<<1);tc[th]=String.fromCharCode(tn[td+1]|tn[td]<<8)}return tc.join("")}function or(tn,to){var ta=parseInt(rr(tn,to,4),10),tu=parseInt(rr(tn,to+4,2),10),tc=parseInt(rr(tn,to+6,2),10),th=parseInt(rr(tn,to+8,2),10),td=parseInt(rr(tn,to+10,2),10),tf=parseInt(rr(tn,to+12,2),10),tp=parseInt(rr(tn,to+14,2),10);return new Date(ta,tu,tc,th,td,tf,100*tp)}function sr(tn,to){var ta=tn[to],tu=tn[to+1],tc=tn[to+2],th=tn[to+3],td=tn[to+4],tf=tn[to+5];return new Date(ta,tu-1,tc,th,td,tf)}function lr(tn,to,ta,tu){ta-=4;for(var tc=[];to<ta;){var th=function(tn,to){var ta=tn.slice(to),tu=new gr(ta);switch(tu.signatureWord()){case 17221:return new ih(ta);case 20548:return new id(ta);case 21328:return new ip(ta);case 21332:return new iy(ta);case 17746:return new ig(ta);case 17747:return new iv(ta);case 20568:return new iw(ta);case 20558:return new iS(ta);case 21324:return new ib(ta);case 20045:return new iE(ta);case 17228:return new iI(ta);case 20556:return new i_(ta);case 21061:return new iD(ta);case 21574:return new iA(ta);case 21318:return new iT(ta);case 21074:return new im(ta);default:return tu}}(tn,to),td=th.length();if(0===td||(to+=td,th instanceof iy))break;th instanceof ih?tc=tc.concat(th.getEntries(tu)):tc.push(th)}return tc}ii.Name="ZipFS",ii.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:B},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},ii.CompressionMethod=e4,ii.RegisterDecompressionMethod(e4.DEFLATE,function(tn,to,ta){return L(e7(tn.slice(0,to),{chunkSize:ta}))}),ii.RegisterDecompressionMethod(e4.STORED,function(tn,to,ta){return K(tn,0,ta)});var ur=function(tn){this._data=tn};ur.prototype.type=function(){return this._data[0]},ur.prototype.standardIdentifier=function(){return rr(this._data,1,5)},ur.prototype.version=function(){return this._data[6]},ur.prototype.data=function(){return this._data.slice(7,2048)};var ir=function(tn){function e(to){tn.call(this,to),this._root=null}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.systemIdentifier=function(){return this._getString32(8)},e.prototype.volumeIdentifier=function(){return this._getString32(40)},e.prototype.volumeSpaceSize=function(){return this._data.readUInt32LE(80)},e.prototype.volumeSetSize=function(){return this._data.readUInt16LE(120)},e.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(124)},e.prototype.logicalBlockSize=function(){return this._data.readUInt16LE(128)},e.prototype.pathTableSize=function(){return this._data.readUInt32LE(132)},e.prototype.locationOfTypeLPathTable=function(){return this._data.readUInt32LE(140)},e.prototype.locationOfOptionalTypeLPathTable=function(){return this._data.readUInt32LE(144)},e.prototype.locationOfTypeMPathTable=function(){return this._data.readUInt32BE(148)},e.prototype.locationOfOptionalTypeMPathTable=function(){return this._data.readUInt32BE(152)},e.prototype.rootDirectoryEntry=function(tn){return null===this._root&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(tn)),this._root},e.prototype.volumeSetIdentifier=function(){return this._getString(190,128)},e.prototype.publisherIdentifier=function(){return this._getString(318,128)},e.prototype.dataPreparerIdentifier=function(){return this._getString(446,128)},e.prototype.applicationIdentifier=function(){return this._getString(574,128)},e.prototype.copyrightFileIdentifier=function(){return this._getString(702,38)},e.prototype.abstractFileIdentifier=function(){return this._getString(740,36)},e.prototype.bibliographicFileIdentifier=function(){return this._getString(776,37)},e.prototype.volumeCreationDate=function(){return or(this._data,813)},e.prototype.volumeModificationDate=function(){return or(this._data,830)},e.prototype.volumeExpirationDate=function(){return or(this._data,847)},e.prototype.volumeEffectiveDate=function(){return or(this._data,864)},e.prototype.fileStructureVersion=function(){return this._data[881]},e.prototype.applicationUsed=function(){return this._data.slice(883,1395)},e.prototype.reserved=function(){return this._data.slice(1395,2048)},e.prototype._getString32=function(tn){return this._getString(tn,32)},e}(ur),is=function(tn){function e(to){if(tn.call(this,to),1!==this.type())throw new tS(tp.EIO,"Invalid primary volume descriptor.")}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.name=function(){return"ISO9660"},e.prototype._constructRootDirectoryRecord=function(tn){return new iu(tn,-1)},e.prototype._getString=function(tn,to){return this._getString(tn,to)},e}(ir),ia=function(tn){function e(to){if(tn.call(this,to),2!==this.type())throw new tS(tp.EIO,"Invalid supplementary volume descriptor.");var ta=this.escapeSequence(),tu=ta[2];if(37!==ta[0]||47!==ta[1]||64!==tu&&67!==tu&&69!==tu)throw new tS(tp.EIO,"Unrecognized escape sequence for SupplementaryVolumeDescriptor: "+ta.toString())}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.name=function(){return"Joliet"},e.prototype.escapeSequence=function(){return this._data.slice(88,120)},e.prototype._constructRootDirectoryRecord=function(tn){return new ic(tn,-1)},e.prototype._getString=function(tn,to){return nr(this._data,tn,to)},e}(ir),fr=function(tn,to){this._suEntries=null,this._fileOrDir=null,this._data=tn,this._rockRidgeOffset=to};fr.prototype.hasRockRidge=function(){return this._rockRidgeOffset>-1},fr.prototype.getRockRidgeOffset=function(){return this._rockRidgeOffset},fr.prototype.rootCheckForRockRidge=function(tn){var to=this.getDirectory(tn);this._rockRidgeOffset=to.getDotEntry(tn)._getRockRidgeOffset(tn),this._rockRidgeOffset>-1&&(this._fileOrDir=null)},fr.prototype.length=function(){return this._data[0]},fr.prototype.extendedAttributeRecordLength=function(){return this._data[1]},fr.prototype.lba=function(){return 2048*this._data.readUInt32LE(2)},fr.prototype.dataLength=function(){return this._data.readUInt32LE(10)},fr.prototype.recordingDate=function(){return sr(this._data,18)},fr.prototype.fileFlags=function(){return this._data[25]},fr.prototype.fileUnitSize=function(){return this._data[26]},fr.prototype.interleaveGapSize=function(){return this._data[27]},fr.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(28)},fr.prototype.identifier=function(){return this._getString(33,this._data[32])},fr.prototype.fileName=function(tn){if(this.hasRockRidge()){var to=this._rockRidgeFilename(tn);if(null!==to)return to}var ta=this.identifier();if(this.isDirectory(tn))return ta;var tu=ta.indexOf(";");return -1===tu?ta:"."===ta[tu-1]?ta.slice(0,tu-1):ta.slice(0,tu)},fr.prototype.isDirectory=function(tn){var to=!!(2&this.fileFlags());return!to&&this.hasRockRidge()&&(to=this.getSUEntries(tn).filter(function(tn){return tn instanceof iI}).length>0),to},fr.prototype.isSymlink=function(tn){return this.hasRockRidge()&&this.getSUEntries(tn).filter(function(tn){return tn instanceof ib}).length>0},fr.prototype.getSymlinkPath=function(tn){for(var to="",ta=this.getSUEntries(tn),tu=this._getGetString(),tc=0;tc<ta.length;tc+=1){var th=ta[tc];if(th instanceof ib){for(var td=0,tf=th.componentRecords();td<tf.length;td+=1){var tp=tf[td],ty=tp.flags();2&ty?to+="./":4&ty?to+="../":8&ty?to+="/":(to+=tp.content(tu),1&ty||(to+="/"))}if(!th.continueFlag())break}}return to.length>1&&"/"===to[to.length-1]?to.slice(0,to.length-1):to},fr.prototype.getFile=function(tn){if(this.isDirectory(tn))throw Error("Tried to get a File from a directory.");return null===this._fileOrDir&&(this._fileOrDir=tn.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir},fr.prototype.getDirectory=function(tn){if(!this.isDirectory(tn))throw Error("Tried to get a Directory from a file.");return null===this._fileOrDir&&(this._fileOrDir=this._constructDirectory(tn)),this._fileOrDir},fr.prototype.getSUEntries=function(tn){return this._suEntries||this._constructSUEntries(tn),this._suEntries},fr.prototype._rockRidgeFilename=function(tn){var to=this.getSUEntries(tn).filter(function(tn){return tn instanceof iE});if(0===to.length||6&to[0].flags())return null;for(var ta="",tu=this._getGetString(),tc=0;tc<to.length;tc+=1){var th=to[tc];if(ta+=th.name(tu),!(1&th.flags()))break}return ta},fr.prototype._constructSUEntries=function(tn){var to=33+this._data[32];to%2==1&&to++,to+=this._rockRidgeOffset,this._suEntries=lr(this._data,to,this.length(),tn)},fr.prototype._getRockRidgeOffset=function(tn){this._rockRidgeOffset=0;var to=this.getSUEntries(tn);if(to.length>0){var ta=to[0];if(ta instanceof ip&&ta.checkBytesPass())for(var tu=1;tu<to.length;tu++){var tc=to[tu];if(tc instanceof im||tc instanceof ig&&"IEEE_P1282"===tc.extensionIdentifier())return ta.bytesSkipped()}}return this._rockRidgeOffset=-1,-1};var iu=function(tn){function e(to,ta){tn.call(this,to,ta)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype._getString=function(tn,to){return rr(this._data,tn,to)},e.prototype._constructDirectory=function(tn){return new ix(this,tn)},e.prototype._getGetString=function(){return rr},e}(fr),ic=function(tn){function e(to,ta){tn.call(this,to,ta)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype._getString=function(tn,to){return nr(this._data,tn,to)},e.prototype._constructDirectory=function(tn){return new iO(this,tn)},e.prototype._getGetString=function(){return nr},e}(fr),gr=function(tn){this._data=tn};gr.prototype.signatureWord=function(){return this._data.readUInt16BE(0)},gr.prototype.signatureWordString=function(){return rr(this._data,0,2)},gr.prototype.length=function(){return this._data[2]},gr.prototype.suVersion=function(){return this._data[3]};var ih=function(tn){function e(to){tn.call(this,to),this._entries=null}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.continuationLba=function(){return this._data.readUInt32LE(4)},e.prototype.continuationLbaOffset=function(){return this._data.readUInt32LE(12)},e.prototype.continuationLength=function(){return this._data.readUInt32LE(20)},e.prototype.getEntries=function(tn){if(!this._entries){var to=2048*this.continuationLba()+this.continuationLbaOffset();this._entries=lr(tn,to,this.continuationLength(),tn)}return this._entries},e}(gr),id=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e}(gr),ip=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.checkBytesPass=function(){return 190===this._data[4]&&239===this._data[5]},e.prototype.bytesSkipped=function(){return this._data[6]},e}(gr),iy=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e}(gr),ig=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.identifierLength=function(){return this._data[4]},e.prototype.descriptorLength=function(){return this._data[5]},e.prototype.sourceLength=function(){return this._data[6]},e.prototype.extensionVersion=function(){return this._data[7]},e.prototype.extensionIdentifier=function(){return rr(this._data,8,this.identifierLength())},e.prototype.extensionDescriptor=function(){return rr(this._data,8+this.identifierLength(),this.descriptorLength())},e.prototype.extensionSource=function(){return rr(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())},e}(gr),iv=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.extensionSequence=function(){return this._data[4]},e}(gr),im=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e}(gr),iw=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.mode=function(){return this._data.readUInt32LE(4)},e.prototype.fileLinks=function(){return this._data.readUInt32LE(12)},e.prototype.uid=function(){return this._data.readUInt32LE(20)},e.prototype.gid=function(){return this._data.readUInt32LE(28)},e.prototype.inode=function(){return this._data.readUInt32LE(36)},e}(gr),iS=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.devTHigh=function(){return this._data.readUInt32LE(4)},e.prototype.devTLow=function(){return this._data.readUInt32LE(12)},e}(gr),ib=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.flags=function(){return this._data[4]},e.prototype.continueFlag=function(){return 1&this.flags()},e.prototype.componentRecords=function(){for(var tn=[],to=5;to<this.length();){var ta=new Ar(this._data.slice(to));tn.push(ta),to+=ta.length()}return tn},e}(gr),Ar=function(tn){this._data=tn};Ar.prototype.flags=function(){return this._data[0]},Ar.prototype.length=function(){return 2+this.componentLength()},Ar.prototype.componentLength=function(){return this._data[1]},Ar.prototype.content=function(tn){return tn(this._data,2,this.componentLength())};var iE=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.flags=function(){return this._data[4]},e.prototype.name=function(tn){return tn(this._data,5,this.length()-5)},e}(gr),iI=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.childDirectoryLba=function(){return this._data.readUInt32LE(4)},e}(gr),i_=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.parentDirectoryLba=function(){return this._data.readUInt32LE(4)},e}(gr),iD=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e}(gr),iA=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.flags=function(){return this._data[4]},e.prototype.creation=function(){return 1&this.flags()?this._longFormDates()?or(this._data,5):sr(this._data,5):null},e.prototype.modify=function(){if(2&this.flags()){var tn=1&this.flags()?1:0;return this._longFormDates?or(this._data,5+17*tn):sr(this._data,5+7*tn)}return null},e.prototype.access=function(){if(4&this.flags()){var tn=1&this.flags()?1:0;return tn+=2&this.flags()?1:0,this._longFormDates?or(this._data,5+17*tn):sr(this._data,5+7*tn)}return null},e.prototype.backup=function(){if(16&this.flags()){var tn=1&this.flags()?1:0;return tn+=(2&this.flags()?1:0)+(4&this.flags()?1:0),this._longFormDates?or(this._data,5+17*tn):sr(this._data,5+7*tn)}return null},e.prototype.expiration=function(){if(32&this.flags()){var tn=1&this.flags()?1:0;return tn+=(2&this.flags()?1:0)+(4&this.flags()?1:0)+(16&this.flags()?1:0),this._longFormDates?or(this._data,5+17*tn):sr(this._data,5+7*tn)}return null},e.prototype.effective=function(){if(64&this.flags()){var tn=1&this.flags()?1:0;return tn+=(2&this.flags()?1:0)+(4&this.flags()?1:0)+(16&this.flags()?1:0)+(32&this.flags()?1:0),this._longFormDates?or(this._data,5+17*tn):sr(this._data,5+7*tn)}return null},e.prototype._longFormDates=function(){return!!this.flags()},e}(gr),iT=function(tn){function e(to){tn.call(this,to)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype.virtualSizeHigh=function(){return this._data.readUInt32LE(4)},e.prototype.virtualSizeLow=function(){return this._data.readUInt32LE(12)},e.prototype.tableDepth=function(){return this._data[20]},e}(gr),Cr=function(tn,to){this._fileList=[],this._fileMap={},this._record=tn;var ta=tn.lba(),tu=ta+tn.dataLength();for(2&tn.fileFlags()||(ta=2048*tn.getSUEntries(to).filter(function(tn){return tn instanceof iI})[0].childDirectoryLba(),tu=1/0);ta<tu;)if(0!==to[ta]){var tc=this._constructDirectoryRecord(to.slice(ta)),th=tc.fileName(to);"\x00"!==th&&"\x01"!==th?tc.hasRockRidge()&&0!==tc.getSUEntries(to).filter(function(tn){return tn instanceof iD}).length||(this._fileMap[th]=tc,this._fileList.push(th)):tu===1/0&&(tu=ta+tc.dataLength()),ta+=tc.length()}else ta++};Cr.prototype.getRecord=function(tn){return this._fileMap[tn]},Cr.prototype.getFileList=function(){return this._fileList},Cr.prototype.getDotEntry=function(tn){return this._constructDirectoryRecord(tn.slice(this._record.lba()))};var ix=function(tn){function e(to,ta){tn.call(this,to,ta)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype._constructDirectoryRecord=function(tn){return new iu(tn,this._record.getRockRidgeOffset())},e}(Cr),iO=function(tn){function e(to,ta){tn.call(this,to,ta)}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.prototype._constructDirectoryRecord=function(tn){return new ic(tn,this._record.getRockRidgeOffset())},e}(Cr),iP=function(tn){function e(to,ta,tu){var tc=this;void 0===ta&&(ta=""),void 0===tu&&(tu=!0),tn.call(this),this._data=to,P(tu,e.Name,{data:"ISO data as a Buffer",name:ta});for(var th=!1,td=32768,tf=[];!th;){var ty=to.slice(td);switch(new ur(ty).type()){case 1:tf.push(new is(ty));break;case 2:tf.push(new ia(ty));break;case 255:th=!0}td+=2048}if(0===tf.length)throw new tS(tp.EIO,"Unable to find a suitable volume descriptor.");tf.forEach(function(tn){tc._pvd&&2===tc._pvd.type()||(tc._pvd=tn)}),this._root=this._pvd.rootDirectoryEntry(to),this._name=ta}return tn&&(e.__proto__=tn),e.prototype=Object.create(tn&&tn.prototype),e.prototype.constructor=e,e.Create=function(tn,to){var ta;try{ta=new e(tn.data,tn.name,!1)}catch(tn){}finally{to(void 0,ta)}},e.isAvailable=function(){return!0},e.prototype.getName=function(){var tn="IsoFS"+this._name+(this._pvd?"-"+this._pvd.name():"");return this._root&&this._root.hasRockRidge()&&(tn+="-RockRidge"),tn},e.prototype.diskSpace=function(tn,to){to(this._data.length,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.statSync=function(tn,to){var ta=this._getDirectoryRecord(tn);if(null===ta)throw tS.ENOENT(tn);return this._getStats(tn,ta)},e.prototype.openSync=function(tn,to,ta){if(to.isWriteable())throw new tS(tp.EPERM,tn);var tu=this._getDirectoryRecord(tn);if(!tu)throw tS.ENOENT(tn);if(tu.isSymlink(this._data))return this.openSync(tg.resolve(tn,tu.getSymlinkPath(this._data)),to,ta);if(tu.isDirectory(this._data))throw tS.EISDIR(tn);var tc=tu.getFile(this._data),th=this._getStats(tn,tu);switch(to.pathExistsAction()){case tw.THROW_EXCEPTION:case tw.TRUNCATE_FILE:throw tS.EEXIST(tn);case tw.NOP:return new tk(this,tn,to,th,tc);default:throw new tS(tp.EINVAL,"Invalid FileMode object.")}},e.prototype.readdirSync=function(tn){var to=this._getDirectoryRecord(tn);if(to){if(to.isDirectory(this._data))return to.getDirectory(this._data).getFileList().slice(0);throw tS.ENOTDIR(tn)}throw tS.ENOENT(tn)},e.prototype.readFileSync=function(tn,to,ta){var tu=this.openSync(tn,ta,420);try{var tc=tu.getBuffer();return null===to?K(tc):tc.toString(to)}finally{tu.closeSync()}},e.prototype._getDirectoryRecord=function(tn){if("/"===tn)return this._root;for(var to=tn.split("/").slice(1),ta=this._root,tu=0;tu<to.length;tu+=1){var tc=to[tu];if(!ta.isDirectory(this._data)||!(ta=ta.getDirectory(this._data).getRecord(tc)))return null}return ta},e.prototype._getStats=function(tn,to){if(to.isSymlink(this._data)){var ta=tg.resolve(tn,to.getSymlinkPath(this._data)),tu=this._getDirectoryRecord(ta);return tu?this._getStats(ta,tu):null}var tc=to.dataLength(),th=365,td=to.recordingDate(),tf=td,tp=td,ty=td;if(to.hasRockRidge())for(var tv=0,tm=to.getSUEntries(this._data);tv<tm.length;tv+=1){var tw=tm[tv];if(tw instanceof iw)th=tw.mode();else if(tw instanceof iA){var tS=tw.flags();4&tS&&(tf=tw.access()),2&tS&&(tp=tw.modify()),1&tS&&(ty=tw.creation())}}return th&=365,new y(to.isDirectory(this._data)?tI.DIRECTORY:tI.FILE,tc,th,tf,tp,ty)},e}(tP);iP.Name="IsoFS",iP.Options={data:{type:"object",description:"The ISO file in a buffer",validator:B}},[tF,ew,eb,eE,eA,ek,eC,iP,eM,eK,e0,e2,e3,ii].forEach(function(tn){var to=tn.Create;tn.Create=function(ta,tu){var tc="function"==typeof ta,th=tc?ta:tu,td=tc?{}:ta;V(tn,td,function(ta){ta?th(ta):to.call(tn,td,th)})}});var iR={AsyncMirror:tF,Dropbox:ew,Emscripten:eb,FolderAdapter:eE,HTML5FS:eA,InMemory:ek,IndexedDB:eC,IsoFS:iP,LocalStorage:eM,MountableFileSystem:eK,OverlayFS:e0,WorkerFS:e2,XmlHttpRequest:e3,ZipFS:ii};function Ur(tn){switch(tn){case"fs":return tD;case"path":return tg;case"buffer":return ty;case"process":return th;case"bfs_utils":return tO;default:return iR[tn]}}function zr(tn){return tD.initialize(tn)}function Br(tn,to){var ta=tn.fs;if(!ta)return to(new tS(tp.EPERM,'Missing "fs" property on configuration object.'));var tu=tn.options,tc=0,th=!1;function a(){if(!th){th=!0;var tn=iR[ta];tn?tn.Create(tu,to):to(new tS(tp.EPERM,"File system "+ta+" is not available in BrowserFS."))}}if(null!==tu&&"object"==typeof tu){var td=!1;Object.keys(tu).filter(function(tn){return"fs"!==tn}).forEach(function(tn){var ta=tu[tn];null!==ta&&"object"==typeof ta&&ta.fs&&(tc++,Br(ta,function(ta,tf){(tc--,ta)?th||(th=!0,to(ta)):(tu[tn]=tf,0===tc&&td&&a())}))}),td=!0}0===tc&&a()}th.initializeTTYs&&th.initializeTTYs(),"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&(Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(tn,to){return void 0===tn&&(tn=0),void 0===to&&(to=this.length),tn<0&&(tn=this.length+tn)<0&&(tn=0),to<0&&(to=this.length+to)<0&&(to=0),to<tn&&(to=tn),new Uint8Array(this.buffer,this.byteOffset+tn,to-tn)})),to.install=function(to){to.Buffer=tn,to.process=th;var ta=to.require?to.require:null;to.require=function(tn){return Ur(tn)||ta.apply(null,Array.prototype.slice.call(arguments,0))}},to.registerFileSystem=function(tn,to){iR[tn]=to},to.BFSRequire=Ur,to.initialize=zr,to.configure=function(tn,to){Br(tn,function(tn,ta){ta?(zr(ta),to()):to(tn)})},to.getFileSystem=Br,to.EmscriptenFS=H,to.FileSystem=iR,to.Errors=tb,to.setImmediate=eX}).call(to,ta(1),function(){return this}(),ta(5)(tn),ta(6))},function(tn,to,ta){tn.exports=ta(2).Buffer},function(tn,to,ta){(function(t){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */var tn=ta(3),tu=ta(4);function s(tn){if(tn>2147483647)throw RangeError("Invalid typed array length");var to=new Uint8Array(tn);return to.__proto__=t.prototype,to}function t(tn,to,ta){if("number"==typeof tn){if("string"==typeof to)throw Error("If encoding is specified then the first argument must be a string");return u(tn)}return a(tn,to,ta)}function a(tn,to,ta){if("number"==typeof tn)throw TypeError('"value" argument must not be a number');return K(tn)?function(tn,to,ta){var tu;if(to<0||tn.byteLength<to)throw RangeError("'offset' is out of bounds");if(tn.byteLength<to+(ta||0))throw RangeError("'length' is out of bounds");return(tu=void 0===to&&void 0===ta?new Uint8Array(tn):void 0===ta?new Uint8Array(tn,to):new Uint8Array(tn,to,ta)).__proto__=t.prototype,tu}(tn,to,ta):"string"==typeof tn?function(tn,to){if("string"==typeof to&&""!==to||(to="utf8"),!t.isEncoding(to))throw TypeError('"encoding" must be a valid string encoding');var ta=0|d(tn,to),tu=s(ta),tc=tu.write(tn,to);return tc!==ta&&(tu=tu.slice(0,tc)),tu}(tn,to):function(tn){if(t.isBuffer(tn)){var to,ta=0|h(tn.length),tu=s(ta);return 0===tu.length||tn.copy(tu,0,0,ta),tu}if(tn){if(U(tn)||"length"in tn)return"number"!=typeof tn.length||(to=tn.length)!=to?s(0):c(tn);if("Buffer"===tn.type&&Array.isArray(tn.data))return c(tn.data)}throw TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(tn)}function l(tn){if("number"!=typeof tn)throw TypeError('"size" argument must be a number');if(tn<0)throw RangeError('"size" argument must not be negative')}function u(tn){return l(tn),s(tn<0?0:0|h(tn))}function c(tn){for(var to=tn.length<0?0:0|h(tn.length),ta=s(to),tu=0;tu<to;tu+=1)ta[tu]=255&tn[tu];return ta}function h(tn){if(tn>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|tn}function d(tn,to){if(t.isBuffer(tn))return tn.length;if(U(tn)||K(tn))return tn.byteLength;"string"!=typeof tn&&(tn=""+tn);var ta=tn.length;if(0===ta)return 0;for(var tu=!1;;)switch(to){case"ascii":case"latin1":case"binary":return ta;case"utf8":case"utf-8":case void 0:return L(tn).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ta;case"hex":return ta>>>1;case"base64":return M(tn).length;default:if(tu)return L(tn).length;to=(""+to).toLowerCase(),tu=!0}}function f(to,ta,tu){var tc,th,td=!1;if((void 0===ta||ta<0)&&(ta=0),ta>this.length||((void 0===tu||tu>this.length)&&(tu=this.length),tu<=0)||(tu>>>=0)<=(ta>>>=0))return"";for(to||(to="utf8");;)switch(to){case"hex":return function(tn,to,ta){var tu,tc=tn.length;(!to||to<0)&&(to=0),(!ta||ta<0||ta>tc)&&(ta=tc);for(var th="",td=to;td<ta;++td)th+=(tu=tn[td])<16?"0"+tu.toString(16):tu.toString(16);return th}(this,ta,tu);case"utf8":case"utf-8":return _(this,ta,tu);case"ascii":return function(tn,to,ta){var tu="";ta=Math.min(tn.length,ta);for(var tc=to;tc<ta;++tc)tu+=String.fromCharCode(127&tn[tc]);return tu}(this,ta,tu);case"latin1":case"binary":return function(tn,to,ta){var tu="";ta=Math.min(tn.length,ta);for(var tc=to;tc<ta;++tc)tu+=String.fromCharCode(tn[tc]);return tu}(this,ta,tu);case"base64":return tc=ta,th=tu,0===tc&&th===this.length?tn.fromByteArray(this):tn.fromByteArray(this.slice(tc,th));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(tn,to,ta){for(var tu=tn.slice(to,ta),tc="",th=0;th<tu.length;th+=2)tc+=String.fromCharCode(tu[th]+256*tu[th+1]);return tc}(this,ta,tu);default:if(td)throw TypeError("Unknown encoding: "+to);to=(to+"").toLowerCase(),td=!0}}function p(tn,to,ta){var tu=tn[to];tn[to]=tn[ta],tn[ta]=tu}function y(tn,to,ta,tu,tc){var th;if(0===tn.length)return -1;if("string"==typeof ta?(tu=ta,ta=0):ta>2147483647?ta=2147483647:ta<-2147483648&&(ta=-2147483648),(th=ta=+ta)!=th&&(ta=tc?0:tn.length-1),ta<0&&(ta=tn.length+ta),ta>=tn.length){if(tc)return -1;ta=tn.length-1}else if(ta<0){if(!tc)return -1;ta=0}if("string"==typeof to&&(to=t.from(to,tu)),t.isBuffer(to))return 0===to.length?-1:g(tn,to,ta,tu,tc);if("number"==typeof to)return to&=255,"function"==typeof Uint8Array.prototype.indexOf?tc?Uint8Array.prototype.indexOf.call(tn,to,ta):Uint8Array.prototype.lastIndexOf.call(tn,to,ta):g(tn,[to],ta,tu,tc);throw TypeError("val must be string, number or Buffer")}function g(tn,to,ta,tu,tc){var th,td=1,tf=tn.length,tp=to.length;if(void 0!==tu&&("ucs2"===(tu=String(tu).toLowerCase())||"ucs-2"===tu||"utf16le"===tu||"utf-16le"===tu)){if(tn.length<2||to.length<2)return -1;td=2,tf/=2,tp/=2,ta/=2}function u(tn,to){return 1===td?tn[to]:tn.readUInt16BE(to*td)}if(tc){var ty=-1;for(th=ta;th<tf;th++)if(u(tn,th)===u(to,-1===ty?0:th-ty)){if(-1===ty&&(ty=th),th-ty+1===tp)return ty*td}else -1!==ty&&(th-=th-ty),ty=-1}else for(ta+tp>tf&&(ta=tf-tp),th=ta;th>=0;th--){for(var tg=!0,tv=0;tv<tp;tv++)if(u(tn,th+tv)!==u(to,tv)){tg=!1;break}if(tg)return th}return -1}function _(tn,to,ta){ta=Math.min(tn.length,ta);for(var tu=[],th=to;th<ta;){var td,tf,tp,ty,tg=tn[th],tv=null,tm=tg>239?4:tg>223?3:tg>191?2:1;if(th+tm<=ta)switch(tm){case 1:tg<128&&(tv=tg);break;case 2:128==(192&(td=tn[th+1]))&&(ty=(31&tg)<<6|63&td)>127&&(tv=ty);break;case 3:td=tn[th+1],tf=tn[th+2],128==(192&td)&&128==(192&tf)&&(ty=(15&tg)<<12|(63&td)<<6|63&tf)>2047&&(ty<55296||ty>57343)&&(tv=ty);break;case 4:td=tn[th+1],tf=tn[th+2],tp=tn[th+3],128==(192&td)&&128==(192&tf)&&128==(192&tp)&&(ty=(15&tg)<<18|(63&td)<<12|(63&tf)<<6|63&tp)>65535&&ty<1114112&&(tv=ty)}null===tv?(tv=65533,tm=1):tv>65535&&(tv-=65536,tu.push(tv>>>10&1023|55296),tv=56320|1023&tv),tu.push(tv),th+=tm}return function(tn){var to=tn.length;if(to<=tc)return String.fromCharCode.apply(String,tn);for(var ta="",tu=0;tu<to;)ta+=String.fromCharCode.apply(String,tn.slice(tu,tu+=tc));return ta}(tu)}to.Buffer=t,to.SlowBuffer=function(tn){return+tn!=tn&&(tn=0),t.alloc(+tn)},to.INSPECT_MAX_BYTES=50,to.kMaxLength=2147483647,t.TYPED_ARRAY_SUPPORT=function(){try{var tn=new Uint8Array(1);return tn.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===tn.foo()}catch(tn){return!1}}(),t.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(tn,to,ta){return a(tn,to,ta)},t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,t.alloc=function(tn,to,ta){return l(tn),tn<=0?s(tn):void 0!==to?"string"==typeof ta?s(tn).fill(to,ta):s(tn).fill(to):s(tn)},t.allocUnsafe=function(tn){return u(tn)},t.allocUnsafeSlow=function(tn){return u(tn)},t.isBuffer=function(tn){return null!=tn&&!0===tn._isBuffer},t.compare=function(tn,to){if(!t.isBuffer(tn)||!t.isBuffer(to))throw TypeError("Arguments must be Buffers");if(tn===to)return 0;for(var ta=tn.length,tu=to.length,tc=0,th=Math.min(ta,tu);tc<th;++tc)if(tn[tc]!==to[tc]){ta=tn[tc],tu=to[tc];break}return ta<tu?-1:tu<ta?1:0},t.isEncoding=function(tn){switch(String(tn).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(tn,to){if(!Array.isArray(tn))throw TypeError('"list" argument must be an Array of Buffers');if(0===tn.length)return t.alloc(0);if(void 0===to)for(to=0,ta=0;ta<tn.length;++ta)to+=tn[ta].length;var ta,tu=t.allocUnsafe(to),tc=0;for(ta=0;ta<tn.length;++ta){var th=tn[ta];if(!t.isBuffer(th))throw TypeError('"list" argument must be an Array of Buffers');th.copy(tu,tc),tc+=th.length}return tu},t.byteLength=d,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var tn=this.length;if(tn%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var to=0;to<tn;to+=2)p(this,to,to+1);return this},t.prototype.swap32=function(){var tn=this.length;if(tn%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var to=0;to<tn;to+=4)p(this,to,to+3),p(this,to+1,to+2);return this},t.prototype.swap64=function(){var tn=this.length;if(tn%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var to=0;to<tn;to+=8)p(this,to,to+7),p(this,to+1,to+6),p(this,to+2,to+5),p(this,to+3,to+4);return this},t.prototype.toString=function(){var tn=this.length;return 0===tn?"":0==arguments.length?_(this,0,tn):f.apply(this,arguments)},t.prototype.equals=function(tn){if(!t.isBuffer(tn))throw TypeError("Argument must be a Buffer");return this===tn||0===t.compare(this,tn)},t.prototype.inspect=function(){var tn="",ta=to.INSPECT_MAX_BYTES;return this.length>0&&(tn=this.toString("hex",0,ta).match(/.{2}/g).join(" "),this.length>ta&&(tn+=" ... ")),"<Buffer "+tn+">"},t.prototype.compare=function(tn,to,ta,tu,tc){if(!t.isBuffer(tn))throw TypeError("Argument must be a Buffer");if(void 0===to&&(to=0),void 0===ta&&(ta=tn?tn.length:0),void 0===tu&&(tu=0),void 0===tc&&(tc=this.length),to<0||ta>tn.length||tu<0||tc>this.length)throw RangeError("out of range index");if(tu>=tc&&to>=ta)return 0;if(tu>=tc)return -1;if(to>=ta)return 1;if(this===tn)return 0;for(var th=(tc>>>=0)-(tu>>>=0),td=(ta>>>=0)-(to>>>=0),tf=Math.min(th,td),tp=this.slice(tu,tc),ty=tn.slice(to,ta),tg=0;tg<tf;++tg)if(tp[tg]!==ty[tg]){th=tp[tg],td=ty[tg];break}return th<td?-1:td<th?1:0},t.prototype.includes=function(tn,to,ta){return -1!==this.indexOf(tn,to,ta)},t.prototype.indexOf=function(tn,to,ta){return y(this,tn,to,ta,!0)},t.prototype.lastIndexOf=function(tn,to,ta){return y(this,tn,to,ta,!1)},t.prototype.write=function(tn,to,ta,tu){if(void 0===to)tu="utf8",ta=this.length,to=0;else if(void 0===ta&&"string"==typeof to)tu=to,ta=this.length,to=0;else{if(!isFinite(to))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");to>>>=0,isFinite(ta)?(ta>>>=0,void 0===tu&&(tu="utf8")):(tu=ta,ta=void 0)}var tc,th,td,tf,tp,ty,tg,tv,tm,tw,tS=this.length-to;if((void 0===ta||ta>tS)&&(ta=tS),tn.length>0&&(ta<0||to<0)||to>this.length)throw RangeError("Attempt to write outside buffer bounds");tu||(tu="utf8");for(var tb=!1;;)switch(tu){case"hex":return function(tn,to,ta,tu){ta=Number(ta)||0;var tc=tn.length-ta;tu?(tu=Number(tu))>tc&&(tu=tc):tu=tc;var th=to.length;if(th%2!=0)throw TypeError("Invalid hex string");tu>th/2&&(tu=th/2);for(var td=0;td<tu;++td){var tf=parseInt(to.substr(2*td,2),16);if(tf!=tf)break;tn[ta+td]=tf}return td}(this,tn,to,ta);case"utf8":case"utf-8":return tp=to,ty=ta,j(L(tn,this.length-tp),this,tp,ty);case"ascii":case"latin1":case"binary":return tc=this,th=tn,td=to,tf=ta,j(function(tn){for(var to=[],ta=0;ta<tn.length;++ta)to.push(255&tn.charCodeAt(ta));return to}(th),tc,td,tf);case"base64":return tg=to,tv=ta,j(M(tn),this,tg,tv);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return tm=to,tw=ta,j(function(tn,to){for(var ta,tu,tc=[],th=0;th<tn.length&&!((to-=2)<0);++th)tu=(ta=tn.charCodeAt(th))>>8,tc.push(ta%256),tc.push(tu);return tc}(tn,this.length-tm),this,tm,tw);default:if(tb)throw TypeError("Unknown encoding: "+tu);tu=(""+tu).toLowerCase(),tb=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tc=4096;function x(tn,to,ta){if(tn%1!=0||tn<0)throw RangeError("offset is not uint");if(tn+to>ta)throw RangeError("Trying to access beyond buffer length")}function R(tn,to,ta,tu,tc,th){if(!t.isBuffer(tn))throw TypeError('"buffer" argument must be a Buffer instance');if(to>tc||to<th)throw RangeError('"value" argument is out of bounds');if(ta+tu>tn.length)throw RangeError("Index out of range")}function k(tn,to,ta,tu,tc,th){if(ta+tu>tn.length||ta<0)throw RangeError("Index out of range")}function N(tn,to,ta,tc,th){return to=+to,ta>>>=0,th||k(tn,0,ta,4),tu.write(tn,to,ta,tc,23,4),ta+4}function C(tn,to,ta,tc,th){return to=+to,ta>>>=0,th||k(tn,0,ta,8),tu.write(tn,to,ta,tc,52,8),ta+8}t.prototype.slice=function(tn,to){var ta=this.length;(tn=~~tn)<0?(tn+=ta)<0&&(tn=0):tn>ta&&(tn=ta),(to=void 0===to?ta:~~to)<0?(to+=ta)<0&&(to=0):to>ta&&(to=ta),to<tn&&(to=tn);var tu=this.subarray(tn,to);return tu.__proto__=t.prototype,tu},t.prototype.readUIntLE=function(tn,to,ta){tn>>>=0,to>>>=0,ta||x(tn,to,this.length);for(var tu=this[tn],tc=1,th=0;++th<to&&(tc*=256);)tu+=this[tn+th]*tc;return tu},t.prototype.readUIntBE=function(tn,to,ta){tn>>>=0,to>>>=0,ta||x(tn,to,this.length);for(var tu=this[tn+--to],tc=1;to>0&&(tc*=256);)tu+=this[tn+--to]*tc;return tu},t.prototype.readUInt8=function(tn,to){return tn>>>=0,to||x(tn,1,this.length),this[tn]},t.prototype.readUInt16LE=function(tn,to){return tn>>>=0,to||x(tn,2,this.length),this[tn]|this[tn+1]<<8},t.prototype.readUInt16BE=function(tn,to){return tn>>>=0,to||x(tn,2,this.length),this[tn]<<8|this[tn+1]},t.prototype.readUInt32LE=function(tn,to){return tn>>>=0,to||x(tn,4,this.length),(this[tn]|this[tn+1]<<8|this[tn+2]<<16)+16777216*this[tn+3]},t.prototype.readUInt32BE=function(tn,to){return tn>>>=0,to||x(tn,4,this.length),16777216*this[tn]+(this[tn+1]<<16|this[tn+2]<<8|this[tn+3])},t.prototype.readIntLE=function(tn,to,ta){tn>>>=0,to>>>=0,ta||x(tn,to,this.length);for(var tu=this[tn],tc=1,th=0;++th<to&&(tc*=256);)tu+=this[tn+th]*tc;return tu>=(tc*=128)&&(tu-=Math.pow(2,8*to)),tu},t.prototype.readIntBE=function(tn,to,ta){tn>>>=0,to>>>=0,ta||x(tn,to,this.length);for(var tu=to,tc=1,th=this[tn+--tu];tu>0&&(tc*=256);)th+=this[tn+--tu]*tc;return th>=(tc*=128)&&(th-=Math.pow(2,8*to)),th},t.prototype.readInt8=function(tn,to){return tn>>>=0,to||x(tn,1,this.length),128&this[tn]?-1*(255-this[tn]+1):this[tn]},t.prototype.readInt16LE=function(tn,to){tn>>>=0,to||x(tn,2,this.length);var ta=this[tn]|this[tn+1]<<8;return 32768&ta?4294901760|ta:ta},t.prototype.readInt16BE=function(tn,to){tn>>>=0,to||x(tn,2,this.length);var ta=this[tn+1]|this[tn]<<8;return 32768&ta?4294901760|ta:ta},t.prototype.readInt32LE=function(tn,to){return tn>>>=0,to||x(tn,4,this.length),this[tn]|this[tn+1]<<8|this[tn+2]<<16|this[tn+3]<<24},t.prototype.readInt32BE=function(tn,to){return tn>>>=0,to||x(tn,4,this.length),this[tn]<<24|this[tn+1]<<16|this[tn+2]<<8|this[tn+3]},t.prototype.readFloatLE=function(tn,to){return tn>>>=0,to||x(tn,4,this.length),tu.read(this,tn,!0,23,4)},t.prototype.readFloatBE=function(tn,to){return tn>>>=0,to||x(tn,4,this.length),tu.read(this,tn,!1,23,4)},t.prototype.readDoubleLE=function(tn,to){return tn>>>=0,to||x(tn,8,this.length),tu.read(this,tn,!0,52,8)},t.prototype.readDoubleBE=function(tn,to){return tn>>>=0,to||x(tn,8,this.length),tu.read(this,tn,!1,52,8)},t.prototype.writeUIntLE=function(tn,to,ta,tu){tn=+tn,to>>>=0,ta>>>=0,tu||R(this,tn,to,ta,Math.pow(2,8*ta)-1,0);var tc=1,th=0;for(this[to]=255&tn;++th<ta&&(tc*=256);)this[to+th]=tn/tc&255;return to+ta},t.prototype.writeUIntBE=function(tn,to,ta,tu){tn=+tn,to>>>=0,ta>>>=0,tu||R(this,tn,to,ta,Math.pow(2,8*ta)-1,0);var tc=ta-1,th=1;for(this[to+tc]=255&tn;--tc>=0&&(th*=256);)this[to+tc]=tn/th&255;return to+ta},t.prototype.writeUInt8=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,1,255,0),this[to]=255&tn,to+1},t.prototype.writeUInt16LE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,2,65535,0),this[to]=255&tn,this[to+1]=tn>>>8,to+2},t.prototype.writeUInt16BE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,2,65535,0),this[to]=tn>>>8,this[to+1]=255&tn,to+2},t.prototype.writeUInt32LE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,4,4294967295,0),this[to+3]=tn>>>24,this[to+2]=tn>>>16,this[to+1]=tn>>>8,this[to]=255&tn,to+4},t.prototype.writeUInt32BE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,4,4294967295,0),this[to]=tn>>>24,this[to+1]=tn>>>16,this[to+2]=tn>>>8,this[to+3]=255&tn,to+4},t.prototype.writeIntLE=function(tn,to,ta,tu){if(tn=+tn,to>>>=0,!tu){var tc=Math.pow(2,8*ta-1);R(this,tn,to,ta,tc-1,-tc)}var th=0,td=1,tf=0;for(this[to]=255&tn;++th<ta&&(td*=256);)tn<0&&0===tf&&0!==this[to+th-1]&&(tf=1),this[to+th]=(tn/td>>0)-tf&255;return to+ta},t.prototype.writeIntBE=function(tn,to,ta,tu){if(tn=+tn,to>>>=0,!tu){var tc=Math.pow(2,8*ta-1);R(this,tn,to,ta,tc-1,-tc)}var th=ta-1,td=1,tf=0;for(this[to+th]=255&tn;--th>=0&&(td*=256);)tn<0&&0===tf&&0!==this[to+th+1]&&(tf=1),this[to+th]=(tn/td>>0)-tf&255;return to+ta},t.prototype.writeInt8=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,1,127,-128),tn<0&&(tn=255+tn+1),this[to]=255&tn,to+1},t.prototype.writeInt16LE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,2,32767,-32768),this[to]=255&tn,this[to+1]=tn>>>8,to+2},t.prototype.writeInt16BE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,2,32767,-32768),this[to]=tn>>>8,this[to+1]=255&tn,to+2},t.prototype.writeInt32LE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,4,2147483647,-2147483648),this[to]=255&tn,this[to+1]=tn>>>8,this[to+2]=tn>>>16,this[to+3]=tn>>>24,to+4},t.prototype.writeInt32BE=function(tn,to,ta){return tn=+tn,to>>>=0,ta||R(this,tn,to,4,2147483647,-2147483648),tn<0&&(tn=4294967295+tn+1),this[to]=tn>>>24,this[to+1]=tn>>>16,this[to+2]=tn>>>8,this[to+3]=255&tn,to+4},t.prototype.writeFloatLE=function(tn,to,ta){return N(this,tn,to,!0,ta)},t.prototype.writeFloatBE=function(tn,to,ta){return N(this,tn,to,!1,ta)},t.prototype.writeDoubleLE=function(tn,to,ta){return C(this,tn,to,!0,ta)},t.prototype.writeDoubleBE=function(tn,to,ta){return C(this,tn,to,!1,ta)},t.prototype.copy=function(tn,to,ta,tu){if(ta||(ta=0),tu||0===tu||(tu=this.length),to>=tn.length&&(to=tn.length),to||(to=0),tu>0&&tu<ta&&(tu=ta),tu===ta||0===tn.length||0===this.length)return 0;if(to<0)throw RangeError("targetStart out of bounds");if(ta<0||ta>=this.length)throw RangeError("sourceStart out of bounds");if(tu<0)throw RangeError("sourceEnd out of bounds");tu>this.length&&(tu=this.length),tn.length-to<tu-ta&&(tu=tn.length-to+ta);var tc,th=tu-ta;if(this===tn&&ta<to&&to<tu)for(tc=th-1;tc>=0;--tc)tn[tc+to]=this[tc+ta];else if(th<1e3)for(tc=0;tc<th;++tc)tn[tc+to]=this[tc+ta];else Uint8Array.prototype.set.call(tn,this.subarray(ta,ta+th),to);return th},t.prototype.fill=function(tn,to,ta,tu){if("string"==typeof tn){if("string"==typeof to?(tu=to,to=0,ta=this.length):"string"==typeof ta&&(tu=ta,ta=this.length),1===tn.length){var tc,th=tn.charCodeAt(0);th<256&&(tn=th)}if(void 0!==tu&&"string"!=typeof tu)throw TypeError("encoding must be a string");if("string"==typeof tu&&!t.isEncoding(tu))throw TypeError("Unknown encoding: "+tu)}else"number"==typeof tn&&(tn&=255);if(to<0||this.length<to||this.length<ta)throw RangeError("Out of range index");if(ta<=to)return this;if(to>>>=0,ta=void 0===ta?this.length:ta>>>0,tn||(tn=0),"number"==typeof tn)for(tc=to;tc<ta;++tc)this[tc]=tn;else{var td=t.isBuffer(tn)?tn:new t(tn,tu),tf=td.length;for(tc=0;tc<ta-to;++tc)this[tc+to]=td[tc%tf]}return this};var th=/[^+/0-9A-Za-z-_]/g;function L(tn,to){var ta;to=to||1/0;for(var tu=tn.length,tc=null,th=[],td=0;td<tu;++td){if((ta=tn.charCodeAt(td))>55295&&ta<57344){if(!tc){if(ta>56319||td+1===tu){(to-=3)>-1&&th.push(239,191,189);continue}tc=ta;continue}if(ta<56320){(to-=3)>-1&&th.push(239,191,189),tc=ta;continue}ta=65536+(tc-55296<<10|ta-56320)}else tc&&(to-=3)>-1&&th.push(239,191,189);if(tc=null,ta<128){if((to-=1)<0)break;th.push(ta)}else if(ta<2048){if((to-=2)<0)break;th.push(ta>>6|192,63&ta|128)}else if(ta<65536){if((to-=3)<0)break;th.push(ta>>12|224,ta>>6&63|128,63&ta|128)}else{if(!(ta<1114112))throw Error("Invalid code point");if((to-=4)<0)break;th.push(ta>>18|240,ta>>12&63|128,ta>>6&63|128,63&ta|128)}}return th}function M(to){return tn.toByteArray(function(tn){if((tn=tn.trim().replace(th,"")).length<2)return"";for(;tn.length%4!=0;)tn+="=";return tn}(to))}function j(tn,to,ta,tu){for(var tc=0;tc<tu&&!(tc+ta>=to.length||tc>=tn.length);++tc)to[tc+ta]=tn[tc];return tc}function K(tn){return tn instanceof ArrayBuffer||null!=tn&&null!=tn.constructor&&"ArrayBuffer"===tn.constructor.name&&"number"==typeof tn.byteLength}function U(tn){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(tn)}}).call(to,ta(1))},function(tn,to){to.byteLength=function(tn){return 3*tn.length/4-a(tn)},to.toByteArray=function(tn){var to,ta,th,td,tf,tp,ty=tn.length;tf=a(tn),tp=new tc(3*ty/4-tf),th=tf>0?ty-4:ty;var tg=0;for(to=0,ta=0;to<th;to+=4,ta+=3)td=tu[tn.charCodeAt(to)]<<18|tu[tn.charCodeAt(to+1)]<<12|tu[tn.charCodeAt(to+2)]<<6|tu[tn.charCodeAt(to+3)],tp[tg++]=td>>16&255,tp[tg++]=td>>8&255,tp[tg++]=255&td;return 2===tf?(td=tu[tn.charCodeAt(to)]<<2|tu[tn.charCodeAt(to+1)]>>4,tp[tg++]=255&td):1===tf&&(td=tu[tn.charCodeAt(to)]<<10|tu[tn.charCodeAt(to+1)]<<4|tu[tn.charCodeAt(to+2)]>>2,tp[tg++]=td>>8&255,tp[tg++]=255&td),tp},to.fromByteArray=function(tn){for(var to,tu=tn.length,tc=tu%3,th="",td=[],tf=0,tp=tu-tc;tf<tp;tf+=16383)td.push(function(tn,to,tu){for(var tc,th=[],td=to;td<tu;td+=3)th.push(ta[(tc=(tn[td]<<16)+(tn[td+1]<<8)+tn[td+2])>>18&63]+ta[tc>>12&63]+ta[tc>>6&63]+ta[63&tc]);return th.join("")}(tn,tf,tf+16383>tp?tp:tf+16383));return 1===tc?th+=ta[(to=tn[tu-1])>>2]+ta[to<<4&63]+"==":2===tc&&(th+=ta[(to=(tn[tu-2]<<8)+tn[tu-1])>>10]+ta[to>>4&63]+ta[to<<2&63]+"="),td.push(th),td.join("")};for(var ta=[],tu=[],tc="undefined"!=typeof Uint8Array?Uint8Array:Array,th="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",td=0;td<64;++td)ta[td]=th[td],tu[th.charCodeAt(td)]=td;function a(tn){var to=tn.length;if(to%4>0)throw Error("Invalid string. Length must be a multiple of 4");return"="===tn[to-2]?2:"="===tn[to-1]?1:0}tu["-".charCodeAt(0)]=62,tu["_".charCodeAt(0)]=63},function(tn,to){to.read=function(tn,to,ta,tu,tc){var th,td,tf=8*tc-tu-1,tp=(1<<tf)-1,ty=tp>>1,tg=-7,tv=ta?tc-1:0,tm=ta?-1:1,tw=tn[to+tv];for(tv+=tm,th=tw&(1<<-tg)-1,tw>>=-tg,tg+=tf;tg>0;th=256*th+tn[to+tv],tv+=tm,tg-=8);for(td=th&(1<<-tg)-1,th>>=-tg,tg+=tu;tg>0;td=256*td+tn[to+tv],tv+=tm,tg-=8);if(0===th)th=1-ty;else{if(th===tp)return td?NaN:1/0*(tw?-1:1);td+=Math.pow(2,tu),th-=ty}return(tw?-1:1)*td*Math.pow(2,th-tu)},to.write=function(tn,to,ta,tu,tc,th){var td,tf,tp,ty=8*th-tc-1,tg=(1<<ty)-1,tv=tg>>1,tm=23===tc?5960464477539062e-23:0,tw=tu?0:th-1,tS=tu?1:-1,tb=to<0||0===to&&1/to<0?1:0;for(isNaN(to=Math.abs(to))||to===1/0?(tf=isNaN(to)?1:0,td=tg):(td=Math.floor(Math.log(to)/Math.LN2),to*(tp=Math.pow(2,-td))<1&&(td--,tp*=2),(to+=td+tv>=1?tm/tp:tm*Math.pow(2,1-tv))*tp>=2&&(td++,tp/=2),td+tv>=tg?(tf=0,td=tg):td+tv>=1?(tf=(to*tp-1)*Math.pow(2,tc),td+=tv):(tf=to*Math.pow(2,tv-1)*Math.pow(2,tc),td=0));tc>=8;tn[ta+tw]=255&tf,tw+=tS,tf/=256,tc-=8);for(td=td<<tc|tf,ty+=tc;ty>0;tn[ta+tw]=255&td,tw+=tS,td/=256,ty-=8);tn[ta+tw-tS]|=128*tb}},function(tn,to){tn.exports=function(tn){return tn.webpackPolyfill||(tn.deprecate=function(){},tn.paths=[],tn.children=[],tn.webpackPolyfill=1),tn}},function(tn,to,ta){var tu=new(ta(7)),tc={};for(var th in tu)!function(tn){tc[tn]||("function"==typeof tu[tn]?tc[tn]=function(){return tu[tn].apply(tu,arguments)}:tc[tn]=tu[tn])}(th);tc.initializeTTYs=function(){null===tu.stdin&&(tu.initializeTTYs(),tc.stdin=tu.stdin,tc.stdout=tu.stdout,tc.stderr=tu.stderr)},tu.nextTick(function(){tc.initializeTTYs()}),tn.exports=tc},function(tn,to,ta){(function(to){var tu=this&&this.__extends||function(tn,to){for(var ta in to)to.hasOwnProperty(ta)&&(tn[ta]=to[ta]);function r(){this.constructor=tn}tn.prototype=null===to?Object.create(to):(r.prototype=to.prototype,new r)},tc=ta(8),th=null,td=function(){function t(tn,to){this.fun=tn,this.array=to}return t.prototype.run=function(){this.fun.apply(null,this.array)},t}(),tf=function(){function t(){this._queue=[],this._draining=!1,this._currentQueue=null,this._queueIndex=-1}return t.prototype.push=function(tn){var to=this;1!==this._queue.push(tn)||this._draining||setTimeout(function(){return to._drainQueue()},0)},t.prototype._cleanUpNextTick=function(){this._draining=!1,this._currentQueue&&this._currentQueue.length?this._queue=this._currentQueue.concat(this._queue):this._queueIndex=-1,this._queue.length&&this._drainQueue()},t.prototype._drainQueue=function(){var tn=this;if(!this._draining){var to=setTimeout(function(){return tn._cleanUpNextTick()});this._draining=!0;for(var ta=this._queue.length;ta;){for(this._currentQueue=this._queue,this._queue=[];++this._queueIndex<ta;)this._currentQueue&&this._currentQueue[this._queueIndex].run();this._queueIndex=-1,ta=this._queue.length}this._currentQueue=null,this._draining=!1,clearTimeout(to)}},t}(),tp=function(tn){function n(){tn.apply(this,arguments),this.startTime=Date.now(),this._cwd="/",this.platform="browser",this.argv=[],this.execArgv=[],this.stdout=null,this.stderr=null,this.stdin=null,this.domain=null,this._queue=new tf,this.execPath=to,this.env={},this.exitCode=0,this._gid=1,this._uid=1,this.version="v5.0",this.versions={http_parser:"0.0",node:"5.0",v8:"0.0",uv:"0.0",zlib:"0.0",ares:"0.0",icu:"0.0",modules:"0",openssl:"0.0"},this.config={target_defaults:{cflags:[],default_configuration:"Release",defines:[],include_dirs:[],libraries:[]},variables:{clang:0,host_arch:"x32",node_install_npm:!1,node_install_waf:!1,node_prefix:"",node_shared_cares:!1,node_shared_http_parser:!1,node_shared_libuv:!1,node_shared_zlib:!1,node_shared_v8:!1,node_use_dtrace:!1,node_use_etw:!1,node_use_openssl:!1,node_shared_openssl:!1,strict_aliasing:!1,target_arch:"x32",v8_use_snapshot:!1,v8_no_strict_aliasing:0,visibility:""}},this.pid=1e3*Math.random()|0,this.title="node",this.arch="x32",this._mask=18,this.connected=void 0}return tu(n,tn),n.prototype.chdir=function(tn){null===th&&(th=ta(9)),this._cwd=th.resolve(tn)},n.prototype.cwd=function(){return this._cwd},n.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0},n.prototype.nextTick=function(tn){for(var to=[],ta=1;ta<arguments.length;ta++)to[ta-1]=arguments[ta];this._queue.push(new td(tn,to))},n.prototype.abort=function(){this.emit("abort")},n.prototype.exit=function(tn){this.exitCode=tn,this.emit("exit",[tn])},n.prototype.getgid=function(){return this._gid},n.prototype.setgid=function(tn){this._gid="number"==typeof tn?tn:1},n.prototype.getuid=function(){return this._uid},n.prototype.setuid=function(tn){this._uid="number"==typeof tn?tn:1},n.prototype.kill=function(tn,to){this.emit("kill",[tn,to])},n.prototype.memoryUsage=function(){return{rss:0,heapTotal:0,heapUsed:0}},n.prototype.umask=function(tn){void 0===tn&&(tn=this._mask);var to=this._mask;return this._mask=tn,this.emit("umask",[tn]),to},n.prototype.hrtime=function(){var tn,to=(tn="undefined"!=typeof performance?performance.now():Date.now?Date.now():(new Date).getTime())/1e3|0;return[to,tn=1e6*(tn-=1e3*to)|0]},n.prototype.initializeTTYs=function(){if(null===this.stdout){var tn=ta(10);this.stdout=new tn,this.stderr=new tn,this.stdin=new tn}},n.prototype.disconnect=function(){},n}(tc.EventEmitter);tn.exports=tp}).call(to,"/")},function(tn,to){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(tn){return"function"==typeof tn}function n(tn){return"object"==typeof tn&&null!==tn}tn.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(tn){if("number"!=typeof tn||tn<0||isNaN(tn))throw TypeError("n must be a positive number");return this._maxListeners=tn,this},i.prototype.emit=function(tn){var to,ta,tu,tc,th,td;if(this._events||(this._events={}),"error"===tn&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((to=arguments[1])instanceof Error)throw to;var tf=Error('Uncaught, unspecified "error" event. ('+to+")");throw tf.context=to,tf}if(void 0===(ta=this._events[tn]))return!1;if(r(ta))switch(arguments.length){case 1:ta.call(this);break;case 2:ta.call(this,arguments[1]);break;case 3:ta.call(this,arguments[1],arguments[2]);break;default:tc=Array.prototype.slice.call(arguments,1),ta.apply(this,tc)}else if(n(ta))for(tc=Array.prototype.slice.call(arguments,1),tu=(td=ta.slice()).length,th=0;th<tu;th++)td[th].apply(this,tc);return!0},i.prototype.addListener=function(tn,to){var ta;if(!r(to))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",tn,r(to.listener)?to.listener:to),this._events[tn]?n(this._events[tn])?this._events[tn].push(to):this._events[tn]=[this._events[tn],to]:this._events[tn]=to,n(this._events[tn])&&!this._events[tn].warned&&(ta=void 0===this._maxListeners?i.defaultMaxListeners:this._maxListeners)&&ta>0&&this._events[tn].length>ta&&(this._events[tn].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[tn].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(tn,to){if(!r(to))throw TypeError("listener must be a function");var ta=!1;function n(){this.removeListener(tn,n),ta||(ta=!0,to.apply(this,arguments))}return n.listener=to,this.on(tn,n),this},i.prototype.removeListener=function(tn,to){var ta,tu,tc,th;if(!r(to))throw TypeError("listener must be a function");if(!this._events||!this._events[tn])return this;if(tc=(ta=this._events[tn]).length,tu=-1,ta===to||r(ta.listener)&&ta.listener===to)delete this._events[tn],this._events.removeListener&&this.emit("removeListener",tn,to);else if(n(ta)){for(th=tc;th-- >0;)if(ta[th]===to||ta[th].listener&&ta[th].listener===to){tu=th;break}if(tu<0)return this;1===ta.length?(ta.length=0,delete this._events[tn]):ta.splice(tu,1),this._events.removeListener&&this.emit("removeListener",tn,to)}return this},i.prototype.removeAllListeners=function(tn){var to,ta;if(!this._events)return this;if(!this._events.removeListener)return 0==arguments.length?this._events={}:this._events[tn]&&delete this._events[tn],this;if(0==arguments.length){for(to in this._events)"removeListener"!==to&&this.removeAllListeners(to);return this.removeAllListeners("removeListener"),this._events={},this}if(r(ta=this._events[tn]))this.removeListener(tn,ta);else if(ta)for(;ta.length;)this.removeListener(tn,ta[ta.length-1]);return delete this._events[tn],this},i.prototype.listeners=function(tn){return this._events&&this._events[tn]?r(this._events[tn])?[this._events[tn]]:this._events[tn].slice():[]},i.prototype.listenerCount=function(tn){if(this._events){var to=this._events[tn];if(r(to))return 1;if(to)return to.length}return 0},i.listenerCount=function(tn,to){return tn.listenerCount(to)}},function(tn,to,ta){(function(to){var ta=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,tu=function(){function t(){}return t.normalize=function(tn){""===tn&&(tn=".");for(var to=tn.charAt(0)===t.sep,ta=(tn=t._removeDuplicateSeps(tn)).split(t.sep),tu=[],tc=0;tc<ta.length;tc++){var th=ta[tc];"."!==th&&(".."===th&&(to||!to&&tu.length>0&&".."!==tu[0])?tu.pop():tu.push(th))}return!to&&tu.length<2&&(1===tu.length?""===tu[0]&&tu.unshift("."):tu.push(".")),tn=tu.join(t.sep),to&&tn.charAt(0)!==t.sep&&(tn=t.sep+tn),tn},t.join=function(){for(var tn=[],to=0;to<arguments.length;to++)tn[to-0]=arguments[to];for(var ta=[],tu=0;tu<tn.length;tu++){var tc=tn[tu];if("string"!=typeof tc)throw TypeError("Invalid argument type to path.join: "+typeof tc);""!==tc&&ta.push(tc)}return t.normalize(ta.join(t.sep))},t.resolve=function(){for(var tn=[],ta=0;ta<arguments.length;ta++)tn[ta-0]=arguments[ta];for(var tu=[],tc=0;tc<tn.length;tc++){var th=tn[tc];if("string"!=typeof th)throw TypeError("Invalid argument type to path.join: "+typeof th);""!==th&&(th.charAt(0)===t.sep&&(tu=[]),tu.push(th))}var td=t.normalize(tu.join(t.sep));if(td.length>1&&td.charAt(td.length-1)===t.sep)return td.substr(0,td.length-1);if(td.charAt(0)!==t.sep){"."!==td.charAt(0)||1!==td.length&&td.charAt(1)!==t.sep||(td=1===td.length?"":td.substr(2));var tf=to.cwd();td=""!==td?this.normalize(tf+("/"!==tf?t.sep:"")+td):tf}return td},t.relative=function(tn,to){tn=t.resolve(tn),to=t.resolve(to);var ta,tu=tn.split(t.sep),tc=to.split(t.sep);tc.shift(),tu.shift();var th=0,td=[];for(ta=0;ta<tu.length;ta++)if(tu[ta]!==tc[ta]){th=tu.length-ta;break}td=tc.slice(ta),1===tu.length&&""===tu[0]&&(th=0),th>tu.length&&(th=tu.length);var tf="";for(ta=0;ta<th;ta++)tf+="../";return(tf+=td.join(t.sep)).length>1&&tf.charAt(tf.length-1)===t.sep&&(tf=tf.substr(0,tf.length-1)),tf},t.dirname=function(tn){var to=(tn=t._removeDuplicateSeps(tn)).charAt(0)===t.sep,ta=tn.split(t.sep);return""===ta.pop()&&ta.length>0&&ta.pop(),ta.length>1||1===ta.length&&!to?ta.join(t.sep):to?t.sep:"."},t.basename=function(tn,to){if(void 0===to&&(to=""),""===tn)return tn;var ta=(tn=t.normalize(tn)).split(t.sep),tu=ta[ta.length-1];return""===tu&&ta.length>1?ta[ta.length-2]:to.length>0&&tu.substr(tu.length-to.length)===to?tu.substr(0,tu.length-to.length):tu},t.extname=function(tn){var to=(tn=t.normalize(tn)).split(t.sep);if(""===(tn=to.pop())&&to.length>0&&(tn=to.pop()),".."===tn)return"";var ta=tn.lastIndexOf(".");return -1===ta||0===ta?"":tn.substr(ta)},t.isAbsolute=function(tn){return tn.length>0&&tn.charAt(0)===t.sep},t._makeLong=function(tn){return tn},t.parse=function(tn){var to,tu=((to=ta.exec(tn)).shift(),to);return{root:tu[0],dir:tu[0]+tu[1].slice(0,-1),base:tu[2],ext:tu[3],name:tu[2].slice(0,tu[2].length-tu[3].length)}},t.format=function(tn){if(null===tn||"object"!=typeof tn)throw TypeError("Parameter 'pathObject' must be an object, not "+typeof tn);if("string"!=typeof(tn.root||""))throw TypeError("'pathObject.root' must be a string or undefined, not "+typeof tn.root);return(tn.dir?tn.dir+t.sep:"")+(tn.base||"")},t._removeDuplicateSeps=function(tn){return tn=tn.replace(this._replaceRegex,this.sep)},t.sep="/",t._replaceRegex=RegExp("//+","g"),t.delimiter=":",t.posix=t,t.win32=t,t}();tn.exports=tu}).call(to,ta(6))},function(tn,to,ta){(function(to){var tu=this&&this.__extends||function(tn,to){for(var ta in to)to.hasOwnProperty(ta)&&(tn[ta]=to[ta]);function r(){this.constructor=tn}tn.prototype=null===to?Object.create(to):(r.prototype=to.prototype,new r)},tc=function(tn){function i(){tn.call(this),this.isRaw=!1,this.columns=80,this.rows=120,this.isTTY=!0,this._bufferedWrites=[],this._waitingForWrites=!1}return tu(i,tn),i.prototype.setRawMode=function(tn){this.isRaw!==tn&&(this.isRaw=tn,this.emit("modeChange"))},i.prototype.changeColumns=function(tn){tn!==this.columns&&(this.columns=tn,this.emit("resize"))},i.prototype.changeRows=function(tn){tn!==this.rows&&(this.rows=tn,this.emit("resize"))},i.isatty=function(tn){return tn&&tn instanceof i},i.prototype._write=function(tn,ta,tu){var tc,th;try{th="string"==typeof tn?new to(tn,ta):tn,this._bufferedWrites.push(th),this._waitingForWrites&&this._read(1024)}catch(tn){tc=tn}finally{tu(tc)}},i.prototype._read=function(tn){if(0===this._bufferedWrites.length)this._waitingForWrites=!0;else for(;this._bufferedWrites.length>0&&(this._waitingForWrites=this.push(this._bufferedWrites.shift()),this._waitingForWrites););},i}(ta(11).Duplex);tn.exports=tc}).call(to,ta(1))},function(tn,to,ta){tn.exports=n;var tu=ta(8).EventEmitter;function n(){tu.call(this)}ta(12)(n,tu),n.Readable=ta(13),n.Writable=ta(27),n.Duplex=ta(28),n.Transform=ta(29),n.PassThrough=ta(30),n.Stream=n,n.prototype.pipe=function(tn,to){var ta=this;function n(to){tn.writable&&!1===tn.write(to)&&ta.pause&&ta.pause()}function o(){ta.readable&&ta.resume&&ta.resume()}ta.on("data",n),tn.on("drain",o),tn._isStdio||to&&!1===to.end||(ta.on("end",a),ta.on("close",l));var tc=!1;function a(){tc||(tc=!0,tn.end())}function l(){tc||(tc=!0,"function"==typeof tn.destroy&&tn.destroy())}function u(tn){if(c(),0===tu.listenerCount(this,"error"))throw tn}function c(){ta.removeListener("data",n),tn.removeListener("drain",o),ta.removeListener("end",a),ta.removeListener("close",l),ta.removeListener("error",u),tn.removeListener("error",u),ta.removeListener("end",c),ta.removeListener("close",c),tn.removeListener("close",c)}return ta.on("error",u),tn.on("error",u),ta.on("end",c),ta.on("close",c),tn.on("close",c),tn.emit("pipe",ta),tn}},function(tn,to){"function"==typeof Object.create?tn.exports=function(tn,to){tn.super_=to,tn.prototype=Object.create(to.prototype,{constructor:{value:tn,enumerable:!1,writable:!0,configurable:!0}})}:tn.exports=function(tn,to){tn.super_=to;var i=function(){};i.prototype=to.prototype,tn.prototype=new i,tn.prototype.constructor=tn}},function(tn,to,ta){(function(tu){var tc=function(){try{return ta(11)}catch(tn){}}();(to=tn.exports=ta(14)).Stream=tc||to,to.Readable=to,to.Writable=ta(22),to.Duplex=ta(21),to.Transform=ta(25),to.PassThrough=ta(26),!tu.browser&&"disable"===tu.env.READABLE_STREAM&&tc&&(tn.exports=tc)}).call(to,ta(6))},function(tn,to,ta){(function(to){tn.exports=g;var tu,tc=ta(15),th=ta(16);g.ReadableState=y,ta(8).EventEmitter;var td,a=function(tn,to){return tn.listeners(to).length};!function(){try{td=ta(11)}catch(tn){}finally{td||(td=ta(8).EventEmitter)}}();var tf=ta(2).Buffer,tp=ta(17),ty=ta(18);ty.inherits=ta(12);var tg=ta(19),tv=void 0;tv=tg&&tg.debuglog?tg.debuglog("stream"):function(){};var tm,tw=ta(20);function y(tn,to){tu=tu||ta(21),tn=tn||{},this.objectMode=!!tn.objectMode,to instanceof tu&&(this.objectMode=this.objectMode||!!tn.readableObjectMode);var tc=tn.highWaterMark,th=this.objectMode?16:16384;this.highWaterMark=tc||0===tc?tc:th,this.highWaterMark=~~this.highWaterMark,this.buffer=new tw,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=tn.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,tn.encoding&&(tm||(tm=ta(24).StringDecoder),this.decoder=new tm(tn.encoding),this.encoding=tn.encoding)}function g(tn){if(tu=tu||ta(21),!(this instanceof g))return new g(tn);this._readableState=new y(tn,this),this.readable=!0,tn&&"function"==typeof tn.read&&(this._read=tn.read),td.call(this)}function v(tn,to,ta,tu,th){var td,tp,ty,tg=(td=ta,tp=null,tf.isBuffer(td)||"string"==typeof td||null==td||to.objectMode||(tp=TypeError("Invalid non-string/buffer chunk")),tp);if(tg)tn.emit("error",tg);else if(null===ta)to.reading=!1,function(tn,to){if(!to.ended){if(to.decoder){var ta=to.decoder.end();ta&&ta.length&&(to.buffer.push(ta),to.length+=to.objectMode?1:ta.length)}to.ended=!0,S(tn)}}(tn,to);else if(to.objectMode||ta&&ta.length>0){if(to.ended&&!th){var tv=Error("stream.push() after EOF");tn.emit("error",tv)}else if(to.endEmitted&&th){var tm=Error("stream.unshift() after end event");tn.emit("error",tm)}else!to.decoder||th||tu||(ta=to.decoder.write(ta),ty=!to.objectMode&&0===ta.length),th||(to.reading=!1),ty||(to.flowing&&0===to.length&&!to.sync?(tn.emit("data",ta),tn.read(0)):(to.length+=to.objectMode?1:ta.length,th?to.buffer.unshift(ta):to.buffer.push(ta),to.needReadable&&S(tn))),to.readingMore||(to.readingMore=!0,tc(E,tn,to))}else th||(to.reading=!1);return!to.ended&&(to.needReadable||to.length<to.highWaterMark||0===to.length)}function w(tn,to){var ta;return tn<=0||0===to.length&&to.ended?0:to.objectMode?1:tn!=tn?to.flowing&&to.length?to.buffer.head.data.length:to.length:(tn>to.highWaterMark&&(to.highWaterMark=((ta=tn)>=8388608?ta=8388608:(ta--,ta|=ta>>>1,ta|=ta>>>2,ta|=ta>>>4,ta|=ta>>>8,ta|=ta>>>16,ta++),ta)),tn<=to.length?tn:to.ended?to.length:(to.needReadable=!0,0))}function S(tn){var to=tn._readableState;to.needReadable=!1,to.emittedReadable||(tv("emitReadable",to.flowing),to.emittedReadable=!0,to.sync?tc(b,tn):b(tn))}function b(tn){tv("emit readable"),tn.emit("readable"),D(tn)}function E(tn,to){for(var ta=to.length;!to.reading&&!to.flowing&&!to.ended&&to.length<to.highWaterMark&&(tv("maybeReadMore read 0"),tn.read(0),ta!==to.length);)ta=to.length;to.readingMore=!1}function I(tn){tv("readable nexttick read 0"),tn.read(0)}function _(tn,to){to.reading||(tv("resume read 0"),tn.read(0)),to.resumeScheduled=!1,to.awaitDrain=0,tn.emit("resume"),D(tn),to.flowing&&!to.reading&&tn.read(0)}function D(tn){var to=tn._readableState;for(tv("flow",to.flowing);to.flowing&&null!==tn.read(););}function T(tn,to){var ta,tu,tc,th;return 0===to.length?null:(to.objectMode?ta=to.buffer.shift():!tn||tn>=to.length?(ta=to.decoder?to.buffer.join(""):1===to.buffer.length?to.buffer.head.data:to.buffer.concat(to.length),to.buffer.clear()):(tu=to.buffer,tc=to.decoder,tn<tu.head.data.length?(th=tu.head.data.slice(0,tn),tu.head.data=tu.head.data.slice(tn)):th=tn===tu.head.data.length?tu.shift():tc?function(tn,to){var ta=to.head,tu=1,tc=ta.data;for(tn-=tc.length;ta=ta.next;){var th=ta.data,td=tn>th.length?th.length:tn;if(td===th.length?tc+=th:tc+=th.slice(0,tn),0==(tn-=td)){td===th.length?(++tu,ta.next?to.head=ta.next:to.head=to.tail=null):(to.head=ta,ta.data=th.slice(td));break}++tu}return to.length-=tu,tc}(tn,tu):function(tn,to){var ta=tp.allocUnsafe(tn),tu=to.head,tc=1;for(tu.data.copy(ta),tn-=tu.data.length;tu=tu.next;){var th=tu.data,td=tn>th.length?th.length:tn;if(th.copy(ta,ta.length-tn,0,td),0==(tn-=td)){td===th.length?(++tc,tu.next?to.head=tu.next:to.head=to.tail=null):(to.head=tu,tu.data=th.slice(td));break}++tc}return to.length-=tc,ta}(tn,tu),ta=th),ta)}function A(tn){var to=tn._readableState;if(to.length>0)throw Error('"endReadable()" called on non-empty stream');to.endEmitted||(to.ended=!0,tc(O,to,tn))}function O(tn,to){tn.endEmitted||0!==tn.length||(tn.endEmitted=!0,to.readable=!1,to.emit("end"))}function P(tn,to){for(var ta=0,tu=tn.length;ta<tu;ta++)if(tn[ta]===to)return ta;return -1}ty.inherits(g,td),g.prototype.push=function(tn,to){var ta=this._readableState;return ta.objectMode||"string"!=typeof tn||(to=to||ta.defaultEncoding)!==ta.encoding&&(tn=tp.from(tn,to),to=""),v(this,ta,tn,to,!1)},g.prototype.unshift=function(tn){return v(this,this._readableState,tn,"",!0)},g.prototype.isPaused=function(){return!1===this._readableState.flowing},g.prototype.setEncoding=function(tn){return tm||(tm=ta(24).StringDecoder),this._readableState.decoder=new tm(tn),this._readableState.encoding=tn,this},g.prototype.read=function(tn){tv("read",tn),tn=parseInt(tn,10);var to=this._readableState,ta=tn;if(0!==tn&&(to.emittedReadable=!1),0===tn&&to.needReadable&&(to.length>=to.highWaterMark||to.ended))return tv("read: emitReadable",to.length,to.ended),0===to.length&&to.ended?A(this):S(this),null;if(0===(tn=w(tn,to))&&to.ended)return 0===to.length&&A(this),null;var tu,tc=to.needReadable;return tv("need readable",tc),(0===to.length||to.length-tn<to.highWaterMark)&&tv("length less than watermark",tc=!0),to.ended||to.reading?tv("reading or ended",tc=!1):tc&&(tv("do read"),to.reading=!0,to.sync=!0,0===to.length&&(to.needReadable=!0),this._read(to.highWaterMark),to.sync=!1,to.reading||(tn=w(ta,to))),null===(tu=tn>0?T(tn,to):null)?(to.needReadable=!0,tn=0):to.length-=tn,0===to.length&&(to.ended||(to.needReadable=!0),ta!==tn&&to.ended&&A(this)),null!==tu&&this.emit("data",tu),tu},g.prototype._read=function(tn){this.emit("error",Error("_read() is not implemented"))},g.prototype.pipe=function(tn,ta){var tu=this,td=this._readableState;switch(td.pipesCount){case 0:td.pipes=tn;break;case 1:td.pipes=[td.pipes,tn];break;default:td.pipes.push(tn)}td.pipesCount+=1,tv("pipe count=%d opts=%j",td.pipesCount,ta);var tf=ta&&!1===ta.end||tn===to.stdout||tn===to.stderr?p:c;function u(tn){tv("onunpipe"),tn===tu&&p()}function c(){tv("onend"),tn.end()}td.endEmitted?tc(tf):tu.once("end",tf),tn.on("unpipe",u);var h=function(){var tn=tu._readableState;tv("pipeOnDrain",tn.awaitDrain),tn.awaitDrain&&tn.awaitDrain--,0===tn.awaitDrain&&a(tu,"data")&&(tn.flowing=!0,D(tu))};tn.on("drain",h);var tp=!1;function p(){tv("cleanup"),tn.removeListener("close",m),tn.removeListener("finish",w),tn.removeListener("drain",h),tn.removeListener("error",v),tn.removeListener("unpipe",u),tu.removeListener("end",c),tu.removeListener("end",p),tu.removeListener("data",g),tp=!0,td.awaitDrain&&(!tn._writableState||tn._writableState.needDrain)&&h()}var ty=!1;function g(to){tv("ondata"),ty=!1,!1!==tn.write(to)||ty||((1===td.pipesCount&&td.pipes===tn||td.pipesCount>1&&-1!==P(td.pipes,tn))&&!tp&&(tv("false write response, pause",tu._readableState.awaitDrain),tu._readableState.awaitDrain++,ty=!0),tu.pause())}function v(to){tv("onerror",to),S(),tn.removeListener("error",v),0===a(tn,"error")&&tn.emit("error",to)}function m(){tn.removeListener("finish",w),S()}function w(){tv("onfinish"),tn.removeListener("close",m),S()}function S(){tv("unpipe"),tu.unpipe(tn)}return tu.on("data",g),function(tn,to,ta){if("function"==typeof tn.prependListener)return tn.prependListener(to,ta);tn._events&&tn._events[to]?th(tn._events[to])?tn._events[to].unshift(ta):tn._events[to]=[ta,tn._events[to]]:tn.on(to,ta)}(tn,"error",v),tn.once("close",m),tn.once("finish",w),tn.emit("pipe",tu),td.flowing||(tv("pipe resume"),tu.resume()),tn},g.prototype.unpipe=function(tn){var to=this._readableState;if(0===to.pipesCount)return this;if(1===to.pipesCount)return tn&&tn!==to.pipes||(tn||(tn=to.pipes),to.pipes=null,to.pipesCount=0,to.flowing=!1,tn&&tn.emit("unpipe",this)),this;if(!tn){var ta=to.pipes,tu=to.pipesCount;to.pipes=null,to.pipesCount=0,to.flowing=!1;for(var tc=0;tc<tu;tc++)ta[tc].emit("unpipe",this);return this}var th=P(to.pipes,tn);return -1===th||(to.pipes.splice(th,1),to.pipesCount-=1,1===to.pipesCount&&(to.pipes=to.pipes[0]),tn.emit("unpipe",this)),this},g.prototype.on=function(tn,to){var ta=td.prototype.on.call(this,tn,to);if("data"===tn)!1!==this._readableState.flowing&&this.resume();else if("readable"===tn){var tu=this._readableState;tu.endEmitted||tu.readableListening||(tu.readableListening=tu.needReadable=!0,tu.emittedReadable=!1,tu.reading?tu.length&&S(this):tc(I,this))}return ta},g.prototype.addListener=g.prototype.on,g.prototype.resume=function(){var tn=this._readableState;return tn.flowing||(tv("resume"),tn.flowing=!0,tn.resumeScheduled||(tn.resumeScheduled=!0,tc(_,this,tn))),this},g.prototype.pause=function(){return tv("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(tv("pause"),this._readableState.flowing=!1,this.emit("pause")),this},g.prototype.wrap=function(tn){var to=this._readableState,ta=!1,tu=this;for(var tc in tn.on("end",function(){if(tv("wrapped end"),to.decoder&&!to.ended){var tn=to.decoder.end();tn&&tn.length&&tu.push(tn)}tu.push(null)}),tn.on("data",function(tc){tv("wrapped data"),to.decoder&&(tc=to.decoder.write(tc)),to.objectMode&&null==tc||(to.objectMode||tc&&tc.length)&&(tu.push(tc)||(ta=!0,tn.pause()))}),tn)void 0===this[tc]&&"function"==typeof tn[tc]&&(this[tc]=function(to){return function(){return tn[to].apply(tn,arguments)}}(tc));return function(tn,to){for(var ta=0,tu=tn.length;ta<tu;ta++)to(tn[ta],ta)}(["error","close","destroy","pause","resume"],function(to){tn.on(to,tu.emit.bind(tu,to))}),tu._read=function(to){tv("wrapped _read",to),ta&&(ta=!1,tn.resume())},tu},g._fromList=T}).call(to,ta(6))},function(tn,to,ta){(function(to){to.version&&0!==to.version.indexOf("v0.")&&(0!==to.version.indexOf("v1.")||0===to.version.indexOf("v1.8."))?tn.exports=to.nextTick:tn.exports=function(tn,ta,tu,tc){if("function"!=typeof tn)throw TypeError('"callback" argument must be a function');var th,td,tf=arguments.length;switch(tf){case 0:case 1:return to.nextTick(tn);case 2:return to.nextTick(function(){tn.call(null,ta)});case 3:return to.nextTick(function(){tn.call(null,ta,tu)});case 4:return to.nextTick(function(){tn.call(null,ta,tu,tc)});default:for(th=Array(tf-1),td=0;td<th.length;)th[td++]=arguments[td];return to.nextTick(function(){tn.apply(null,th)})}}}).call(to,ta(6))},function(tn,to){var ta={}.toString;tn.exports=Array.isArray||function(tn){return"[object Array]"==ta.call(tn)}},function(tn,to,ta){(function(tn){var tu=ta(2),tc=tu.Buffer,th=tu.SlowBuffer,td=tu.kMaxLength||2147483647;to.alloc=function(tn,to,ta){if("function"==typeof tc.alloc)return tc.alloc(tn,to,ta);if("number"==typeof ta)throw TypeError("encoding must not be number");if("number"!=typeof tn)throw TypeError("size must be a number");if(tn>td)throw RangeError("size is too large");var tu=ta,th=to;void 0===th&&(tu=void 0,th=0);var tf=new tc(tn);if("string"==typeof th)for(var tp=new tc(th,tu),ty=tp.length,tg=-1;++tg<tn;)tf[tg]=tp[tg%ty];else tf.fill(th);return tf},to.allocUnsafe=function(tn){if("function"==typeof tc.allocUnsafe)return tc.allocUnsafe(tn);if("number"!=typeof tn)throw TypeError("size must be a number");if(tn>td)throw RangeError("size is too large");return new tc(tn)},to.from=function(to,ta,tu){if("function"==typeof tc.from&&(!tn.Uint8Array||Uint8Array.from!==tc.from))return tc.from(to,ta,tu);if("number"==typeof to)throw TypeError('"value" argument must not be a number');if("string"==typeof to)return new tc(to,ta);if("undefined"!=typeof ArrayBuffer&&to instanceof ArrayBuffer){var th=ta;if(1==arguments.length)return new tc(to);void 0===th&&(th=0);var td=tu;if(void 0===td&&(td=to.byteLength-th),th>=to.byteLength)throw RangeError("'offset' is out of bounds");if(td>to.byteLength-th)throw RangeError("'length' is out of bounds");return new tc(to.slice(th,th+td))}if(tc.isBuffer(to)){var tf=new tc(to.length);return to.copy(tf,0,0,to.length),tf}if(to){if(Array.isArray(to)||"undefined"!=typeof ArrayBuffer&&to.buffer instanceof ArrayBuffer||"length"in to)return new tc(to);if("Buffer"===to.type&&Array.isArray(to.data))return new tc(to.data)}throw TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},to.allocUnsafeSlow=function(tn){if("function"==typeof tc.allocUnsafeSlow)return tc.allocUnsafeSlow(tn);if("number"!=typeof tn)throw TypeError("size must be a number");if(tn>=td)throw RangeError("size is too large");return new th(tn)}}).call(to,function(){return this}())},function(tn,to,ta){(function(tn){function i(tn){return Object.prototype.toString.call(tn)}to.isArray=function(tn){return Array.isArray?Array.isArray(tn):"[object Array]"===i(tn)},to.isBoolean=function(tn){return"boolean"==typeof tn},to.isNull=function(tn){return null===tn},to.isNullOrUndefined=function(tn){return null==tn},to.isNumber=function(tn){return"number"==typeof tn},to.isString=function(tn){return"string"==typeof tn},to.isSymbol=function(tn){return"symbol"==typeof tn},to.isUndefined=function(tn){return void 0===tn},to.isRegExp=function(tn){return"[object RegExp]"===i(tn)},to.isObject=function(tn){return"object"==typeof tn&&null!==tn},to.isDate=function(tn){return"[object Date]"===i(tn)},to.isError=function(tn){return"[object Error]"===i(tn)||tn instanceof Error},to.isFunction=function(tn){return"function"==typeof tn},to.isPrimitive=function(tn){return null===tn||"boolean"==typeof tn||"number"==typeof tn||"string"==typeof tn||"symbol"==typeof tn||void 0===tn},to.isBuffer=tn.isBuffer}).call(to,ta(1))},function(tn,to){},function(tn,to,ta){ta(2).Buffer;var tu=ta(17);function n(){this.head=null,this.tail=null,this.length=0}tn.exports=n,n.prototype.push=function(tn){var to={data:tn,next:null};this.length>0?this.tail.next=to:this.head=to,this.tail=to,++this.length},n.prototype.unshift=function(tn){var to={data:tn,next:this.head};0===this.length&&(this.tail=to),this.head=to,++this.length},n.prototype.shift=function(){if(0!==this.length){var tn=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,tn}},n.prototype.clear=function(){this.head=this.tail=null,this.length=0},n.prototype.join=function(tn){if(0===this.length)return"";for(var to=this.head,ta=""+to.data;to=to.next;)ta+=tn+to.data;return ta},n.prototype.concat=function(tn){if(0===this.length)return tu.alloc(0);if(1===this.length)return this.head.data;for(var to=tu.allocUnsafe(tn>>>0),ta=this.head,tc=0;ta;)ta.data.copy(to,tc),tc+=ta.data.length,ta=ta.next;return to}},function(tn,to,ta){var tu=Object.keys||function(tn){var to=[];for(var ta in tn)to.push(ta);return to};tn.exports=h;var tc=ta(15),th=ta(18);th.inherits=ta(12);var td=ta(14),tf=ta(22);th.inherits(h,td);for(var tp=tu(tf.prototype),ty=0;ty<tp.length;ty++){var tg=tp[ty];h.prototype[tg]||(h.prototype[tg]=tf.prototype[tg])}function h(tn){if(!(this instanceof h))return new h(tn);td.call(this,tn),tf.call(this,tn),tn&&!1===tn.readable&&(this.readable=!1),tn&&!1===tn.writable&&(this.writable=!1),this.allowHalfOpen=!0,tn&&!1===tn.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||tc(f,this)}function f(tn){tn.end()}},function(tn,to,ta){(function(to){tn.exports=y;var tu,tc=ta(15),th=!to.browser&&["v0.10","v0.9."].indexOf(to.version.slice(0,5))>-1?setImmediate:tc;y.WritableState=p;var td=ta(18);td.inherits=ta(12);var tf,tp={deprecate:ta(23)};!function(){try{tf=ta(11)}catch(tn){}finally{tf||(tf=ta(8).EventEmitter)}}();var ty,tg=ta(2).Buffer,tv=ta(17);function d(){}function f(tn,to,ta){this.chunk=tn,this.encoding=to,this.callback=ta,this.next=null}function p(tn,to){tu=tu||ta(21),tn=tn||{},this.objectMode=!!tn.objectMode,to instanceof tu&&(this.objectMode=this.objectMode||!!tn.writableObjectMode);var td=tn.highWaterMark,tf=this.objectMode?16:16384;this.highWaterMark=td||0===td?td:tf,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var tp=!1===tn.decodeStrings;this.decodeStrings=!tp,this.defaultEncoding=tn.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(tn){!function(tn,to){var ta=tn._writableState,tu=ta.sync,td=ta.writecb;if(ta.writing=!1,ta.writecb=null,ta.length-=ta.writelen,ta.writelen=0,to)--ta.pendingcb,tu?tc(td,to):td(to),tn._writableState.errorEmitted=!0,tn.emit("error",to);else{var tf=w(ta);tf||ta.corked||ta.bufferProcessing||!ta.bufferedRequest||m(tn,ta),tu?th(v,tn,ta,tf,td):v(tn,ta,tf,td)}}(to,tn)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new E(this)}function y(tn){if(tu=tu||ta(21),!(ty.call(y,this)||this instanceof tu))return new y(tn);this._writableState=new p(tn,this),this.writable=!0,tn&&("function"==typeof tn.write&&(this._write=tn.write),"function"==typeof tn.writev&&(this._writev=tn.writev)),tf.call(this)}function g(tn,to,ta,tu,tc,th,td){to.writelen=tu,to.writecb=td,to.writing=!0,to.sync=!0,ta?tn._writev(tc,to.onwrite):tn._write(tc,th,to.onwrite),to.sync=!1}function v(tn,to,ta,tu){ta||0===to.length&&to.needDrain&&(to.needDrain=!1,tn.emit("drain")),to.pendingcb--,tu(),b(tn,to)}function m(tn,to){to.bufferProcessing=!0;var ta=to.bufferedRequest;if(tn._writev&&ta&&ta.next){var tu=Array(to.bufferedRequestCount),tc=to.corkedRequestsFree;tc.entry=ta;for(var th=0;ta;)tu[th]=ta,ta=ta.next,th+=1;g(tn,to,!0,to.length,tu,"",tc.finish),to.pendingcb++,to.lastBufferedRequest=null,tc.next?(to.corkedRequestsFree=tc.next,tc.next=null):to.corkedRequestsFree=new E(to)}else{for(;ta;){var td=ta.chunk,tf=ta.encoding,tp=ta.callback;if(g(tn,to,!1,to.objectMode?1:td.length,td,tf,tp),ta=ta.next,to.writing)break}null===ta&&(to.lastBufferedRequest=null)}to.bufferedRequestCount=0,to.bufferedRequest=ta,to.bufferProcessing=!1}function w(tn){return tn.ending&&0===tn.length&&null===tn.bufferedRequest&&!tn.finished&&!tn.writing}function S(tn,to){to.prefinished||(to.prefinished=!0,tn.emit("prefinish"))}function b(tn,to){var ta=w(to);return ta&&(0===to.pendingcb?(S(tn,to),to.finished=!0,tn.emit("finish")):S(tn,to)),ta}function E(tn){var to=this;this.next=null,this.entry=null,this.finish=function(ta){var tu=to.entry;for(to.entry=null;tu;){var tc=tu.callback;tn.pendingcb--,tc(ta),tu=tu.next}tn.corkedRequestsFree?tn.corkedRequestsFree.next=to:tn.corkedRequestsFree=to}}td.inherits(y,tf),p.prototype.getBuffer=function(){for(var tn=this.bufferedRequest,to=[];tn;)to.push(tn),tn=tn.next;return to},function(){try{Object.defineProperty(p.prototype,"buffer",{get:tp.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(tn){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(ty=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(tn){return!!ty.call(this,tn)||tn&&tn._writableState instanceof p}})):ty=function(tn){return tn instanceof this},y.prototype.pipe=function(){this.emit("error",Error("Cannot pipe, not readable"))},y.prototype.write=function(tn,to,ta){var tu,th,td,tf,tp,ty=this._writableState,tm=!1,tw=tg.isBuffer(tn);return"function"==typeof to&&(ta=to,to=null),tw?to="buffer":to||(to=ty.defaultEncoding),"function"!=typeof ta&&(ta=d),ty.ended?(tu=ta,th=Error("write after end"),this.emit("error",th),tc(tu,th)):(tw||(td=ta,tf=!0,tp=!1,null===tn?tp=TypeError("May not write null values to stream"):"string"==typeof tn||void 0===tn||ty.objectMode||(tp=TypeError("Invalid non-string/buffer chunk")),tp&&(this.emit("error",tp),tc(td,tp),tf=!1),tf))&&(ty.pendingcb++,tm=function(tn,to,ta,tu,tc,th){ta||(td=tu,tf=tc,to.objectMode||!1===to.decodeStrings||"string"!=typeof td||(td=tv.from(td,tf)),tu=td,tg.isBuffer(tu)&&(tc="buffer"));var td,tf,tp=to.objectMode?1:tu.length;to.length+=tp;var ty=to.length<to.highWaterMark;if(ty||(to.needDrain=!0),to.writing||to.corked){var tm=to.lastBufferedRequest;to.lastBufferedRequest=new f(tu,tc,th),tm?tm.next=to.lastBufferedRequest:to.bufferedRequest=to.lastBufferedRequest,to.bufferedRequestCount+=1}else g(tn,to,!1,tp,tu,tc,th);return ty}(this,ty,tw,tn,to,ta)),tm},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var tn=this._writableState;tn.corked&&(tn.corked--,tn.writing||tn.corked||tn.finished||tn.bufferProcessing||!tn.bufferedRequest||m(this,tn))},y.prototype.setDefaultEncoding=function(tn){if("string"==typeof tn&&(tn=tn.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((tn+"").toLowerCase())>-1))throw TypeError("Unknown encoding: "+tn);return this._writableState.defaultEncoding=tn,this},y.prototype._write=function(tn,to,ta){ta(Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(tn,to,ta){var tu,th=this._writableState;"function"==typeof tn?(ta=tn,tn=null,to=null):"function"==typeof to&&(ta=to,to=null),null!=tn&&this.write(tn,to),th.corked&&(th.corked=1,this.uncork()),th.ending||th.finished||(tu=ta,th.ending=!0,b(this,th),tu&&(th.finished?tc(tu):this.once("finish",tu)),th.ended=!0,this.writable=!1)}}).call(to,ta(6))},function(tn,to){(function(to){function i(tn){try{if(!to.localStorage)return!1}catch(tn){return!1}var ta=to.localStorage[tn];return null!=ta&&"true"===String(ta).toLowerCase()}tn.exports=function(tn,to){if(i("noDeprecation"))return tn;var ta=!1;return function(){if(!ta){if(i("throwDeprecation"))throw Error(to);i("traceDeprecation")?console.trace(to):console.warn(to),ta=!0}return tn.apply(this,arguments)}}}).call(to,function(){return this}())},function(tn,to,ta){var tu=ta(2).Buffer,tc=tu.isEncoding||function(tn){switch(tn&&tn.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},th=to.StringDecoder=function(tn){switch(this.encoding=(tn||"utf8").toLowerCase().replace(/[-_]/,""),function(tn){if(tn&&!tc(tn))throw Error("Unknown encoding: "+tn)}(tn),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=s)}this.charBuffer=new tu(6),this.charReceived=0,this.charLength=0};function s(tn){return tn.toString(this.encoding)}function a(tn){this.charReceived=tn.length%2,this.charLength=this.charReceived?2:0}function l(tn){this.charReceived=tn.length%3,this.charLength=this.charReceived?3:0}th.prototype.write=function(tn){for(var to="";this.charLength;){var ta=tn.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:tn.length;if(tn.copy(this.charBuffer,this.charReceived,0,ta),this.charReceived+=ta,this.charReceived<this.charLength)return"";if(tn=tn.slice(ta,tn.length),!((tu=(to=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(to.length-1))>=55296&&tu<=56319)){if(this.charReceived=this.charLength=0,0===tn.length)return to;break}this.charLength+=this.surrogateSize,to=""}this.detectIncompleteChar(tn);var tu,tc=tn.length;if(this.charLength&&(tn.copy(this.charBuffer,0,tn.length-this.charReceived,tc),tc-=this.charReceived),tc=(to+=tn.toString(this.encoding,0,tc)).length-1,(tu=to.charCodeAt(tc))>=55296&&tu<=56319){var th=this.surrogateSize;return this.charLength+=th,this.charReceived+=th,this.charBuffer.copy(this.charBuffer,th,0,th),tn.copy(this.charBuffer,0,0,th),to.substring(0,tc)}return to},th.prototype.detectIncompleteChar=function(tn){for(var to=tn.length>=3?3:tn.length;to>0;to--){var ta=tn[tn.length-to];if(1==to&&ta>>5==6){this.charLength=2;break}if(to<=2&&ta>>4==14){this.charLength=3;break}if(to<=3&&ta>>3==30){this.charLength=4;break}}this.charReceived=to},th.prototype.end=function(tn){var to="";if(tn&&tn.length&&(to=this.write(tn)),this.charReceived){var ta=this.charReceived,tu=this.charBuffer,tc=this.encoding;to+=tu.slice(0,ta).toString(tc)}return to}},function(tn,to,ta){tn.exports=s;var tu=ta(21),tc=ta(18);function o(tn){this.afterTransform=function(to,ta){return function(tn,to,ta){var tu=tn._transformState;tu.transforming=!1;var tc=tu.writecb;if(!tc)return tn.emit("error",Error("no writecb in Transform class"));tu.writechunk=null,tu.writecb=null,null!=ta&&tn.push(ta),tc(to);var th=tn._readableState;th.reading=!1,(th.needReadable||th.length<th.highWaterMark)&&tn._read(th.highWaterMark)}(tn,to,ta)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function s(tn){if(!(this instanceof s))return new s(tn);tu.call(this,tn),this._transformState=new o(this);var to=this;this._readableState.needReadable=!0,this._readableState.sync=!1,tn&&("function"==typeof tn.transform&&(this._transform=tn.transform),"function"==typeof tn.flush&&(this._flush=tn.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(tn,ta){a(to,tn,ta)}):a(to)})}function a(tn,to,ta){if(to)return tn.emit("error",to);null!=ta&&tn.push(ta);var tu=tn._writableState,tc=tn._transformState;if(tu.length)throw Error("Calling transform done when ws.length != 0");if(tc.transforming)throw Error("Calling transform done when still transforming");return tn.push(null)}tc.inherits=ta(12),tc.inherits(s,tu),s.prototype.push=function(tn,to){return this._transformState.needTransform=!1,tu.prototype.push.call(this,tn,to)},s.prototype._transform=function(tn,to,ta){throw Error("_transform() is not implemented")},s.prototype._write=function(tn,to,ta){var tu=this._transformState;if(tu.writecb=ta,tu.writechunk=tn,tu.writeencoding=to,!tu.transforming){var tc=this._readableState;(tu.needTransform||tc.needReadable||tc.length<tc.highWaterMark)&&this._read(tc.highWaterMark)}},s.prototype._read=function(tn){var to=this._transformState;null!==to.writechunk&&to.writecb&&!to.transforming?(to.transforming=!0,this._transform(to.writechunk,to.writeencoding,to.afterTransform)):to.needTransform=!0}},function(tn,to,ta){tn.exports=o;var tu=ta(25),tc=ta(18);function o(tn){if(!(this instanceof o))return new o(tn);tu.call(this,tn)}tc.inherits=ta(12),tc.inherits(o,tu),o.prototype._transform=function(tn,to,ta){ta(null,tn)}},function(tn,to,ta){tn.exports=ta(22)},function(tn,to,ta){tn.exports=ta(21)},function(tn,to,ta){tn.exports=ta(25)},function(tn,to,ta){tn.exports=ta(26)},function(tn,to,ta){var tu=ta(32),tc=ta(33),th=ta(38),td=ta(39),tf=ta(40),tp=ta(41),ty=ta(42),tg=Object.prototype.toString;function h(tn){if(!(this instanceof h))return new h(tn);this.options=tc.assign({chunkSize:16384,windowBits:0,to:""},tn||{});var to=this.options;to.raw&&to.windowBits>=0&&to.windowBits<16&&(to.windowBits=-to.windowBits,0===to.windowBits&&(to.windowBits=-15)),!(to.windowBits>=0&&to.windowBits<16)||tn&&tn.windowBits||(to.windowBits+=32),to.windowBits>15&&to.windowBits<48&&0==(15&to.windowBits)&&(to.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tp,this.strm.avail_out=0;var ta=tu.inflateInit2(this.strm,to.windowBits);if(ta!==td.Z_OK)throw Error(tf[ta]);this.header=new ty,tu.inflateGetHeader(this.strm,this.header)}function d(tn,to){var ta=new h(to);if(ta.push(tn,!0),ta.err)throw ta.msg||tf[ta.err];return ta.result}h.prototype.push=function(tn,to){var ta,tf,tp,ty,tv,tm,tw=this.strm,tS=this.options.chunkSize,tb=this.options.dictionary,tE=!1;if(this.ended)return!1;tf=to===~~to?to:!0===to?td.Z_FINISH:td.Z_NO_FLUSH,"string"==typeof tn?tw.input=th.binstring2buf(tn):"[object ArrayBuffer]"===tg.call(tn)?tw.input=new Uint8Array(tn):tw.input=tn,tw.next_in=0,tw.avail_in=tw.input.length;do{if(0===tw.avail_out&&(tw.output=new tc.Buf8(tS),tw.next_out=0,tw.avail_out=tS),(ta=tu.inflate(tw,td.Z_NO_FLUSH))===td.Z_NEED_DICT&&tb&&(tm="string"==typeof tb?th.string2buf(tb):"[object ArrayBuffer]"===tg.call(tb)?new Uint8Array(tb):tb,ta=tu.inflateSetDictionary(this.strm,tm)),ta===td.Z_BUF_ERROR&&!0===tE&&(ta=td.Z_OK,tE=!1),ta!==td.Z_STREAM_END&&ta!==td.Z_OK)return this.onEnd(ta),this.ended=!0,!1;tw.next_out&&(0!==tw.avail_out&&ta!==td.Z_STREAM_END&&(0!==tw.avail_in||tf!==td.Z_FINISH&&tf!==td.Z_SYNC_FLUSH)||("string"===this.options.to?(tp=th.utf8border(tw.output,tw.next_out),ty=tw.next_out-tp,tv=th.buf2string(tw.output,tp),tw.next_out=ty,tw.avail_out=tS-ty,ty&&tc.arraySet(tw.output,tw.output,tp,ty,0),this.onData(tv)):this.onData(tc.shrinkBuf(tw.output,tw.next_out)))),0===tw.avail_in&&0===tw.avail_out&&(tE=!0)}while((tw.avail_in>0||0===tw.avail_out)&&ta!==td.Z_STREAM_END);return ta===td.Z_STREAM_END&&(tf=td.Z_FINISH),tf===td.Z_FINISH?(ta=tu.inflateEnd(this.strm),this.onEnd(ta),this.ended=!0,ta===td.Z_OK):tf!==td.Z_SYNC_FLUSH||(this.onEnd(td.Z_OK),tw.avail_out=0,!0)},h.prototype.onData=function(tn){this.chunks.push(tn)},h.prototype.onEnd=function(tn){tn===td.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=tc.flattenChunks(this.chunks)),this.chunks=[],this.err=tn,this.msg=this.strm.msg},to.Inflate=h,to.inflate=d,to.inflateRaw=function(tn,to){return(to=to||{}).raw=!0,d(tn,to)},to.ungzip=d},function(tn,to,ta){var tu=ta(33),tc=ta(34),th=ta(35),td=ta(36),tf=ta(37);function v(tn){return(tn>>>24&255)+(tn>>>8&65280)+((65280&tn)<<8)+((255&tn)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new tu.Buf16(320),this.work=new tu.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(tn){var to;return tn&&tn.state?(to=tn.state,tn.total_in=tn.total_out=to.total=0,tn.msg="",to.wrap&&(tn.adler=1&to.wrap),to.mode=1,to.last=0,to.havedict=0,to.dmax=32768,to.head=null,to.hold=0,to.bits=0,to.lencode=to.lendyn=new tu.Buf32(852),to.distcode=to.distdyn=new tu.Buf32(592),to.sane=1,to.back=-1,0):-2}function S(tn){var to;return tn&&tn.state?((to=tn.state).wsize=0,to.whave=0,to.wnext=0,w(tn)):-2}function b(tn,to){var ta,tu;return tn&&tn.state?(tu=tn.state,to<0?(ta=0,to=-to):(ta=1+(to>>4),to<48&&(to&=15)),to&&(to<8||to>15)?-2:(null!==tu.window&&tu.wbits!==to&&(tu.window=null),tu.wrap=ta,tu.wbits=to,S(tn))):-2}function E(tn,to){var ta,tu;return tn?(tu=new m,tn.state=tu,tu.window=null,0!==(ta=b(tn,to))&&(tn.state=null),ta):-2}var tp,ty,tg=!0;function A(tn,to,ta,tc){var th,td=tn.state;return null===td.window&&(td.wsize=1<<td.wbits,td.wnext=0,td.whave=0,td.window=new tu.Buf8(td.wsize)),tc>=td.wsize?(tu.arraySet(td.window,to,ta-td.wsize,td.wsize,0),td.wnext=0,td.whave=td.wsize):((th=td.wsize-td.wnext)>tc&&(th=tc),tu.arraySet(td.window,to,ta-tc,th,td.wnext),(tc-=th)?(tu.arraySet(td.window,to,ta-tc,tc,0),td.wnext=tc,td.whave=td.wsize):(td.wnext+=th,td.wnext===td.wsize&&(td.wnext=0),td.whave<td.wsize&&(td.whave+=th))),0}to.inflateReset=S,to.inflateReset2=b,to.inflateResetKeep=w,to.inflateInit=function(tn){return E(tn,15)},to.inflateInit2=E,to.inflate=function(tn,to){var ta,tv,tm,tw,tS,tb,tE,tI,t_,tD,tA,tT,tx,tO,tP,tR,tk,tN,tF,tC,tL,tj,tM,tK,tB=0,tU=new tu.Buf8(4),tq=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!tn||!tn.state||!tn.output||!tn.input&&0!==tn.avail_in)return -2;12===(ta=tn.state).mode&&(ta.mode=13),tS=tn.next_out,tm=tn.output,tE=tn.avail_out,tw=tn.next_in,tv=tn.input,tb=tn.avail_in,tI=ta.hold,t_=ta.bits,tD=tb,tA=tE,tj=0;t:for(;;)switch(ta.mode){case 1:if(0===ta.wrap){ta.mode=13;break}for(;t_<16;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(2&ta.wrap&&35615===tI){ta.check=0,tU[0]=255&tI,tU[1]=tI>>>8&255,ta.check=th(ta.check,tU,2,0),tI=0,t_=0,ta.mode=2;break}if(ta.flags=0,ta.head&&(ta.head.done=!1),!(1&ta.wrap)||(((255&tI)<<8)+(tI>>8))%31){tn.msg="incorrect header check",ta.mode=30;break}if(8!=(15&tI)){tn.msg="unknown compression method",ta.mode=30;break}if(t_-=4,tL=8+(15&(tI>>>=4)),0===ta.wbits)ta.wbits=tL;else if(tL>ta.wbits){tn.msg="invalid window size",ta.mode=30;break}ta.dmax=1<<tL,tn.adler=ta.check=1,ta.mode=512&tI?10:12,tI=0,t_=0;break;case 2:for(;t_<16;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(ta.flags=tI,8!=(255&ta.flags)){tn.msg="unknown compression method",ta.mode=30;break}if(57344&ta.flags){tn.msg="unknown header flags set",ta.mode=30;break}ta.head&&(ta.head.text=tI>>8&1),512&ta.flags&&(tU[0]=255&tI,tU[1]=tI>>>8&255,ta.check=th(ta.check,tU,2,0)),tI=0,t_=0,ta.mode=3;case 3:for(;t_<32;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}ta.head&&(ta.head.time=tI),512&ta.flags&&(tU[0]=255&tI,tU[1]=tI>>>8&255,tU[2]=tI>>>16&255,tU[3]=tI>>>24&255,ta.check=th(ta.check,tU,4,0)),tI=0,t_=0,ta.mode=4;case 4:for(;t_<16;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}ta.head&&(ta.head.xflags=255&tI,ta.head.os=tI>>8),512&ta.flags&&(tU[0]=255&tI,tU[1]=tI>>>8&255,ta.check=th(ta.check,tU,2,0)),tI=0,t_=0,ta.mode=5;case 5:if(1024&ta.flags){for(;t_<16;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}ta.length=tI,ta.head&&(ta.head.extra_len=tI),512&ta.flags&&(tU[0]=255&tI,tU[1]=tI>>>8&255,ta.check=th(ta.check,tU,2,0)),tI=0,t_=0}else ta.head&&(ta.head.extra=null);ta.mode=6;case 6:if(1024&ta.flags&&((tT=ta.length)>tb&&(tT=tb),tT&&(ta.head&&(tL=ta.head.extra_len-ta.length,ta.head.extra||(ta.head.extra=Array(ta.head.extra_len)),tu.arraySet(ta.head.extra,tv,tw,tT,tL)),512&ta.flags&&(ta.check=th(ta.check,tv,tT,tw)),tb-=tT,tw+=tT,ta.length-=tT),ta.length))break t;ta.length=0,ta.mode=7;case 7:if(2048&ta.flags){if(0===tb)break t;tT=0;do tL=tv[tw+tT++],ta.head&&tL&&ta.length<65536&&(ta.head.name+=String.fromCharCode(tL));while(tL&&tT<tb);if(512&ta.flags&&(ta.check=th(ta.check,tv,tT,tw)),tb-=tT,tw+=tT,tL)break t}else ta.head&&(ta.head.name=null);ta.length=0,ta.mode=8;case 8:if(4096&ta.flags){if(0===tb)break t;tT=0;do tL=tv[tw+tT++],ta.head&&tL&&ta.length<65536&&(ta.head.comment+=String.fromCharCode(tL));while(tL&&tT<tb);if(512&ta.flags&&(ta.check=th(ta.check,tv,tT,tw)),tb-=tT,tw+=tT,tL)break t}else ta.head&&(ta.head.comment=null);ta.mode=9;case 9:if(512&ta.flags){for(;t_<16;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(tI!==(65535&ta.check)){tn.msg="header crc mismatch",ta.mode=30;break}tI=0,t_=0}ta.head&&(ta.head.hcrc=ta.flags>>9&1,ta.head.done=!0),tn.adler=ta.check=0,ta.mode=12;break;case 10:for(;t_<32;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}tn.adler=ta.check=v(tI),tI=0,t_=0,ta.mode=11;case 11:if(0===ta.havedict)return tn.next_out=tS,tn.avail_out=tE,tn.next_in=tw,tn.avail_in=tb,ta.hold=tI,ta.bits=t_,2;tn.adler=ta.check=1,ta.mode=12;case 12:if(5===to||6===to)break t;case 13:if(ta.last){tI>>>=7&t_,t_-=7&t_,ta.mode=27;break}for(;t_<3;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}switch(ta.last=1&tI,t_-=1,3&(tI>>>=1)){case 0:ta.mode=14;break;case 1:if(function(tn){if(tg){var to;for(tp=new tu.Buf32(512),ty=new tu.Buf32(32),to=0;to<144;)tn.lens[to++]=8;for(;to<256;)tn.lens[to++]=9;for(;to<280;)tn.lens[to++]=7;for(;to<288;)tn.lens[to++]=8;for(tf(1,tn.lens,0,288,tp,0,tn.work,{bits:9}),to=0;to<32;)tn.lens[to++]=5;tf(2,tn.lens,0,32,ty,0,tn.work,{bits:5}),tg=!1}tn.lencode=tp,tn.lenbits=9,tn.distcode=ty,tn.distbits=5}(ta),ta.mode=20,6===to){tI>>>=2,t_-=2;break t}break;case 2:ta.mode=17;break;case 3:tn.msg="invalid block type",ta.mode=30}tI>>>=2,t_-=2;break;case 14:for(tI>>>=7&t_,t_-=7&t_;t_<32;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if((65535&tI)!=(tI>>>16^65535)){tn.msg="invalid stored block lengths",ta.mode=30;break}if(ta.length=65535&tI,tI=0,t_=0,ta.mode=15,6===to)break t;case 15:ta.mode=16;case 16:if(tT=ta.length){if(tT>tb&&(tT=tb),tT>tE&&(tT=tE),0===tT)break t;tu.arraySet(tm,tv,tw,tT,tS),tb-=tT,tw+=tT,tE-=tT,tS+=tT,ta.length-=tT;break}ta.mode=12;break;case 17:for(;t_<14;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(ta.nlen=257+(31&tI),tI>>>=5,t_-=5,ta.ndist=1+(31&tI),tI>>>=5,t_-=5,ta.ncode=4+(15&tI),tI>>>=4,t_-=4,ta.nlen>286||ta.ndist>30){tn.msg="too many length or distance symbols",ta.mode=30;break}ta.have=0,ta.mode=18;case 18:for(;ta.have<ta.ncode;){for(;t_<3;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}ta.lens[tq[ta.have++]]=7&tI,tI>>>=3,t_-=3}for(;ta.have<19;)ta.lens[tq[ta.have++]]=0;if(ta.lencode=ta.lendyn,ta.lenbits=7,tM={bits:ta.lenbits},tj=tf(0,ta.lens,0,19,ta.lencode,0,ta.work,tM),ta.lenbits=tM.bits,tj){tn.msg="invalid code lengths set",ta.mode=30;break}ta.have=0,ta.mode=19;case 19:for(;ta.have<ta.nlen+ta.ndist;){for(;tR=(tB=ta.lencode[tI&(1<<ta.lenbits)-1])>>>16&255,tk=65535&tB,!((tP=tB>>>24)<=t_);){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(tk<16)tI>>>=tP,t_-=tP,ta.lens[ta.have++]=tk;else{if(16===tk){for(tK=tP+2;t_<tK;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(tI>>>=tP,t_-=tP,0===ta.have){tn.msg="invalid bit length repeat",ta.mode=30;break}tL=ta.lens[ta.have-1],tT=3+(3&tI),tI>>>=2,t_-=2}else if(17===tk){for(tK=tP+3;t_<tK;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}t_-=tP,tL=0,tT=3+(7&(tI>>>=tP)),tI>>>=3,t_-=3}else{for(tK=tP+7;t_<tK;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}t_-=tP,tL=0,tT=11+(127&(tI>>>=tP)),tI>>>=7,t_-=7}if(ta.have+tT>ta.nlen+ta.ndist){tn.msg="invalid bit length repeat",ta.mode=30;break}for(;tT--;)ta.lens[ta.have++]=tL}}if(30===ta.mode)break;if(0===ta.lens[256]){tn.msg="invalid code -- missing end-of-block",ta.mode=30;break}if(ta.lenbits=9,tM={bits:ta.lenbits},tj=tf(1,ta.lens,0,ta.nlen,ta.lencode,0,ta.work,tM),ta.lenbits=tM.bits,tj){tn.msg="invalid literal/lengths set",ta.mode=30;break}if(ta.distbits=6,ta.distcode=ta.distdyn,tM={bits:ta.distbits},tj=tf(2,ta.lens,ta.nlen,ta.ndist,ta.distcode,0,ta.work,tM),ta.distbits=tM.bits,tj){tn.msg="invalid distances set",ta.mode=30;break}if(ta.mode=20,6===to)break t;case 20:ta.mode=21;case 21:if(tb>=6&&tE>=258){tn.next_out=tS,tn.avail_out=tE,tn.next_in=tw,tn.avail_in=tb,ta.hold=tI,ta.bits=t_,td(tn,tA),tS=tn.next_out,tm=tn.output,tE=tn.avail_out,tw=tn.next_in,tv=tn.input,tb=tn.avail_in,tI=ta.hold,t_=ta.bits,12===ta.mode&&(ta.back=-1);break}for(ta.back=0;tR=(tB=ta.lencode[tI&(1<<ta.lenbits)-1])>>>16&255,tk=65535&tB,!((tP=tB>>>24)<=t_);){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(tR&&0==(240&tR)){for(tN=tP,tF=tR,tC=tk;tR=(tB=ta.lencode[tC+((tI&(1<<tN+tF)-1)>>tN)])>>>16&255,tk=65535&tB,!(tN+(tP=tB>>>24)<=t_);){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}tI>>>=tN,t_-=tN,ta.back+=tN}if(tI>>>=tP,t_-=tP,ta.back+=tP,ta.length=tk,0===tR){ta.mode=26;break}if(32&tR){ta.back=-1,ta.mode=12;break}if(64&tR){tn.msg="invalid literal/length code",ta.mode=30;break}ta.extra=15&tR,ta.mode=22;case 22:if(ta.extra){for(tK=ta.extra;t_<tK;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}ta.length+=tI&(1<<ta.extra)-1,tI>>>=ta.extra,t_-=ta.extra,ta.back+=ta.extra}ta.was=ta.length,ta.mode=23;case 23:for(;tR=(tB=ta.distcode[tI&(1<<ta.distbits)-1])>>>16&255,tk=65535&tB,!((tP=tB>>>24)<=t_);){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(0==(240&tR)){for(tN=tP,tF=tR,tC=tk;tR=(tB=ta.distcode[tC+((tI&(1<<tN+tF)-1)>>tN)])>>>16&255,tk=65535&tB,!(tN+(tP=tB>>>24)<=t_);){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}tI>>>=tN,t_-=tN,ta.back+=tN}if(tI>>>=tP,t_-=tP,ta.back+=tP,64&tR){tn.msg="invalid distance code",ta.mode=30;break}ta.offset=tk,ta.extra=15&tR,ta.mode=24;case 24:if(ta.extra){for(tK=ta.extra;t_<tK;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}ta.offset+=tI&(1<<ta.extra)-1,tI>>>=ta.extra,t_-=ta.extra,ta.back+=ta.extra}if(ta.offset>ta.dmax){tn.msg="invalid distance too far back",ta.mode=30;break}ta.mode=25;case 25:if(0===tE)break t;if(tT=tA-tE,ta.offset>tT){if((tT=ta.offset-tT)>ta.whave&&ta.sane){tn.msg="invalid distance too far back",ta.mode=30;break}tT>ta.wnext?(tT-=ta.wnext,tx=ta.wsize-tT):tx=ta.wnext-tT,tT>ta.length&&(tT=ta.length),tO=ta.window}else tO=tm,tx=tS-ta.offset,tT=ta.length;tT>tE&&(tT=tE),tE-=tT,ta.length-=tT;do tm[tS++]=tO[tx++];while(--tT);0===ta.length&&(ta.mode=21);break;case 26:if(0===tE)break t;tm[tS++]=ta.length,tE--,ta.mode=21;break;case 27:if(ta.wrap){for(;t_<32;){if(0===tb)break t;tb--,tI|=tv[tw++]<<t_,t_+=8}if(tA-=tE,tn.total_out+=tA,ta.total+=tA,tA&&(tn.adler=ta.check=ta.flags?th(ta.check,tm,tA,tS-tA):tc(ta.check,tm,tA,tS-tA)),tA=tE,(ta.flags?tI:v(tI))!==ta.check){tn.msg="incorrect data check",ta.mode=30;break}tI=0,t_=0}ta.mode=28;case 28:if(ta.wrap&&ta.flags){for(;t_<32;){if(0===tb)break t;tb--,tI+=tv[tw++]<<t_,t_+=8}if(tI!==(4294967295&ta.total)){tn.msg="incorrect length check",ta.mode=30;break}tI=0,t_=0}ta.mode=29;case 29:tj=1;break t;case 30:tj=-3;break t;case 31:return -4;default:return -2}return tn.next_out=tS,tn.avail_out=tE,tn.next_in=tw,tn.avail_in=tb,ta.hold=tI,ta.bits=t_,(ta.wsize||tA!==tn.avail_out&&ta.mode<30&&(ta.mode<27||4!==to))&&A(tn,tn.output,tn.next_out,tA-tn.avail_out),tD-=tn.avail_in,tA-=tn.avail_out,tn.total_in+=tD,tn.total_out+=tA,ta.total+=tA,ta.wrap&&tA&&(tn.adler=ta.check=ta.flags?th(ta.check,tm,tA,tn.next_out-tA):tc(ta.check,tm,tA,tn.next_out-tA)),tn.data_type=ta.bits+(ta.last?64:0)+(12===ta.mode?128:0)+(20===ta.mode||15===ta.mode?256:0),(0===tD&&0===tA||4===to)&&0===tj&&(tj=-5),tj},to.inflateEnd=function(tn){if(!tn||!tn.state)return -2;var to=tn.state;return to.window&&(to.window=null),tn.state=null,0},to.inflateGetHeader=function(tn,to){var ta;return tn&&tn.state?0==(2&(ta=tn.state).wrap)?-2:(ta.head=to,to.done=!1,0):-2},to.inflateSetDictionary=function(tn,to){var ta,tu=to.length;return tn&&tn.state?0!==(ta=tn.state).wrap&&11!==ta.mode?-2:11===ta.mode&&tc(1,to,tu,0)!==ta.check?-3:A(tn,to,tu,tu)?(ta.mode=31,-4):(ta.havedict=1,0):-2},to.inflateInfo="pako inflate (from Nodeca project)"},function(tn,to){var ta="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;to.assign=function(tn){for(var to=Array.prototype.slice.call(arguments,1);to.length;){var ta=to.shift();if(ta){if("object"!=typeof ta)throw TypeError(ta+"must be non-object");for(var tu in ta)ta.hasOwnProperty(tu)&&(tn[tu]=ta[tu])}}return tn},to.shrinkBuf=function(tn,to){return tn.length===to?tn:tn.subarray?tn.subarray(0,to):(tn.length=to,tn)};var tu={arraySet:function(tn,to,ta,tu,tc){if(to.subarray&&tn.subarray)tn.set(to.subarray(ta,ta+tu),tc);else for(var th=0;th<tu;th++)tn[tc+th]=to[ta+th]},flattenChunks:function(tn){var to,ta,tu,tc,th,td;for(tu=0,to=0,ta=tn.length;to<ta;to++)tu+=tn[to].length;for(td=new Uint8Array(tu),tc=0,to=0,ta=tn.length;to<ta;to++)th=tn[to],td.set(th,tc),tc+=th.length;return td}},tc={arraySet:function(tn,to,ta,tu,tc){for(var th=0;th<tu;th++)tn[tc+th]=to[ta+th]},flattenChunks:function(tn){return[].concat.apply([],tn)}};to.setTyped=function(tn){tn?(to.Buf8=Uint8Array,to.Buf16=Uint16Array,to.Buf32=Int32Array,to.assign(to,tu)):(to.Buf8=Array,to.Buf16=Array,to.Buf32=Array,to.assign(to,tc))},to.setTyped(ta)},function(tn,to){tn.exports=function(tn,to,ta,tu){for(var tc=65535&tn|0,th=tn>>>16&65535|0,td=0;0!==ta;){ta-=td=ta>2e3?2e3:ta;do th=th+(tc=tc+to[tu++]|0)|0;while(--td);tc%=65521,th%=65521}return tc|th<<16|0}},function(tn,to){var ta=function(){for(var tn,to=[],ta=0;ta<256;ta++){tn=ta;for(var tu=0;tu<8;tu++)tn=1&tn?3988292384^tn>>>1:tn>>>1;to[ta]=tn}return to}();tn.exports=function(tn,to,tu,tc){var th=tc+tu;tn^=-1;for(var td=tc;td<th;td++)tn=tn>>>8^ta[255&(tn^to[td])];return -1^tn}},function(tn,to){tn.exports=function(tn,to){var ta,tu,tc,th,td,tf,tp,ty,tg,tv,tm,tw,tS,tb,tE,tI,t_,tD,tA,tT,tx,tO,tP,tR,tk;ta=tn.state,tu=tn.next_in,tR=tn.input,tc=tu+(tn.avail_in-5),th=tn.next_out,tk=tn.output,td=th-(to-tn.avail_out),tf=th+(tn.avail_out-257),tp=ta.dmax,ty=ta.wsize,tg=ta.whave,tv=ta.wnext,tm=ta.window,tw=ta.hold,tS=ta.bits,tb=ta.lencode,tE=ta.distcode,tI=(1<<ta.lenbits)-1,t_=(1<<ta.distbits)-1;t:do for(tS<15&&(tw+=tR[tu++]<<tS,tS+=8,tw+=tR[tu++]<<tS,tS+=8),tD=tb[tw&tI];;){if(tw>>>=tA=tD>>>24,tS-=tA,0==(tA=tD>>>16&255))tk[th++]=65535&tD;else{if(!(16&tA)){if(0==(64&tA)){tD=tb[(65535&tD)+(tw&(1<<tA)-1)];continue}if(32&tA){ta.mode=12;break t}tn.msg="invalid literal/length code",ta.mode=30;break t}for(tT=65535&tD,(tA&=15)&&(tS<tA&&(tw+=tR[tu++]<<tS,tS+=8),tT+=tw&(1<<tA)-1,tw>>>=tA,tS-=tA),tS<15&&(tw+=tR[tu++]<<tS,tS+=8,tw+=tR[tu++]<<tS,tS+=8),tD=tE[tw&t_];;){if(tw>>>=tA=tD>>>24,tS-=tA,!(16&(tA=tD>>>16&255))){if(0==(64&tA)){tD=tE[(65535&tD)+(tw&(1<<tA)-1)];continue}tn.msg="invalid distance code",ta.mode=30;break t}if(tx=65535&tD,tS<(tA&=15)&&(tw+=tR[tu++]<<tS,(tS+=8)<tA&&(tw+=tR[tu++]<<tS,tS+=8)),(tx+=tw&(1<<tA)-1)>tp){tn.msg="invalid distance too far back",ta.mode=30;break t}if(tw>>>=tA,tS-=tA,tx>(tA=th-td)){if((tA=tx-tA)>tg&&ta.sane){tn.msg="invalid distance too far back",ta.mode=30;break t}if(tO=0,tP=tm,0===tv){if(tO+=ty-tA,tA<tT){tT-=tA;do tk[th++]=tm[tO++];while(--tA);tO=th-tx,tP=tk}}else if(tv<tA){if(tO+=ty+tv-tA,(tA-=tv)<tT){tT-=tA;do tk[th++]=tm[tO++];while(--tA);if(tO=0,tv<tT){tT-=tA=tv;do tk[th++]=tm[tO++];while(--tA);tO=th-tx,tP=tk}}}else if(tO+=tv-tA,tA<tT){tT-=tA;do tk[th++]=tm[tO++];while(--tA);tO=th-tx,tP=tk}for(;tT>2;)tk[th++]=tP[tO++],tk[th++]=tP[tO++],tk[th++]=tP[tO++],tT-=3;tT&&(tk[th++]=tP[tO++],tT>1&&(tk[th++]=tP[tO++]))}else{tO=th-tx;do tk[th++]=tk[tO++],tk[th++]=tk[tO++],tk[th++]=tk[tO++],tT-=3;while(tT>2);tT&&(tk[th++]=tk[tO++],tT>1&&(tk[th++]=tk[tO++]))}break}}break}while(tu<tc&&th<tf);tu-=tT=tS>>3,tw&=(1<<(tS-=tT<<3))-1,tn.next_in=tu,tn.next_out=th,tn.avail_in=tu<tc?tc-tu+5:5-(tu-tc),tn.avail_out=th<tf?tf-th+257:257-(th-tf),ta.hold=tw,ta.bits=tS}},function(tn,to,ta){var tu=ta(33),tc=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],th=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],td=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],tf=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];tn.exports=function(tn,to,ta,tp,ty,tg,tv,tm){var tw,tS,tb,tE,tI,t_,tD,tA,tT,tx=tm.bits,tO=0,tP=0,tR=0,tk=0,tN=0,tF=0,tC=0,tL=0,tj=0,tM=0,tK=null,tB=0,tU=new tu.Buf16(16),tq=new tu.Buf16(16),tz=null,tV=0;for(tO=0;tO<=15;tO++)tU[tO]=0;for(tP=0;tP<tp;tP++)tU[to[ta+tP]]++;for(tN=tx,tk=15;tk>=1&&0===tU[tk];tk--);if(tN>tk&&(tN=tk),0===tk)return ty[tg++]=20971520,ty[tg++]=20971520,tm.bits=1,0;for(tR=1;tR<tk&&0===tU[tR];tR++);for(tN<tR&&(tN=tR),tL=1,tO=1;tO<=15;tO++)if(tL<<=1,(tL-=tU[tO])<0)return -1;if(tL>0&&(0===tn||1!==tk))return -1;for(tq[1]=0,tO=1;tO<15;tO++)tq[tO+1]=tq[tO]+tU[tO];for(tP=0;tP<tp;tP++)0!==to[ta+tP]&&(tv[tq[to[ta+tP]]++]=tP);if(0===tn?(tK=tz=tv,t_=19):1===tn?(tK=tc,tB-=257,tz=th,tV-=257,t_=256):(tK=td,tz=tf,t_=-1),tM=0,tP=0,tO=tR,tI=tg,tF=tN,tC=0,tb=-1,tE=(tj=1<<tN)-1,1===tn&&tj>852||2===tn&&tj>592)return 1;for(;;){tD=tO-tC,tv[tP]<t_?(tA=0,tT=tv[tP]):tv[tP]>t_?(tA=tz[tV+tv[tP]],tT=tK[tB+tv[tP]]):(tA=96,tT=0),tw=1<<tO-tC,tR=tS=1<<tF;do ty[tI+(tM>>tC)+(tS-=tw)]=tD<<24|tA<<16|tT|0;while(0!==tS);for(tw=1<<tO-1;tM&tw;)tw>>=1;if(0!==tw?(tM&=tw-1,tM+=tw):tM=0,tP++,0==--tU[tO]){if(tO===tk)break;tO=to[ta+tv[tP]]}if(tO>tN&&(tM&tE)!==tb){for(0===tC&&(tC=tN),tI+=tR,tL=1<<(tF=tO-tC);tF+tC<tk&&!((tL-=tU[tF+tC])<=0);)tF++,tL<<=1;if(tj+=1<<tF,1===tn&&tj>852||2===tn&&tj>592)return 1;ty[tb=tM&tE]=tN<<24|tF<<16|tI-tg|0}}return 0!==tM&&(ty[tI+tM]=tO-tC<<24|4194304),tm.bits=tN,0}},function(tn,to,ta){var tu=ta(33),tc=!0,th=!0;try{String.fromCharCode.apply(null,[0])}catch(tn){tc=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(tn){th=!1}for(var td=new tu.Buf8(256),tf=0;tf<256;tf++)td[tf]=tf>=252?6:tf>=248?5:tf>=240?4:tf>=224?3:tf>=192?2:1;function l(tn,to){if(to<65537&&(tn.subarray&&th||!tn.subarray&&tc))return String.fromCharCode.apply(null,tu.shrinkBuf(tn,to));for(var ta="",td=0;td<to;td++)ta+=String.fromCharCode(tn[td]);return ta}td[254]=td[254]=1,to.string2buf=function(tn){var to,ta,tc,th,td,tf=tn.length,tp=0;for(th=0;th<tf;th++)55296==(64512&(ta=tn.charCodeAt(th)))&&th+1<tf&&56320==(64512&(tc=tn.charCodeAt(th+1)))&&(ta=65536+(ta-55296<<10)+(tc-56320),th++),tp+=ta<128?1:ta<2048?2:ta<65536?3:4;for(to=new tu.Buf8(tp),td=0,th=0;td<tp;th++)55296==(64512&(ta=tn.charCodeAt(th)))&&th+1<tf&&56320==(64512&(tc=tn.charCodeAt(th+1)))&&(ta=65536+(ta-55296<<10)+(tc-56320),th++),ta<128?to[td++]=ta:(ta<2048?to[td++]=192|ta>>>6:(ta<65536?to[td++]=224|ta>>>12:(to[td++]=240|ta>>>18,to[td++]=128|ta>>>12&63),to[td++]=128|ta>>>6&63),to[td++]=128|63&ta);return to},to.buf2binstring=function(tn){return l(tn,tn.length)},to.binstring2buf=function(tn){for(var to=new tu.Buf8(tn.length),ta=0,tc=to.length;ta<tc;ta++)to[ta]=tn.charCodeAt(ta);return to},to.buf2string=function(tn,to){var ta,tu,tc,th,tf=to||tn.length,tp=Array(2*tf);for(tu=0,ta=0;ta<tf;)if((tc=tn[ta++])<128)tp[tu++]=tc;else if((th=td[tc])>4)tp[tu++]=65533,ta+=th-1;else{for(tc&=2===th?31:3===th?15:7;th>1&&ta<tf;)tc=tc<<6|63&tn[ta++],th--;th>1?tp[tu++]=65533:tc<65536?tp[tu++]=tc:(tc-=65536,tp[tu++]=55296|tc>>10&1023,tp[tu++]=56320|1023&tc)}return l(tp,tu)},to.utf8border=function(tn,to){var ta;for((to=to||tn.length)>tn.length&&(to=tn.length),ta=to-1;ta>=0&&128==(192&tn[ta]);)ta--;return ta<0||0===ta?to:ta+td[tn[ta]]>to?ta:to}},function(tn,to){tn.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(tn,to){tn.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(tn,to){tn.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(tn,to){tn.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}}]);var tM=(t8=tj.exports)&&t8.__esModule&&Object.prototype.hasOwnProperty.call(t8,"default")?t8.default:t8;let tK=tj.exports.BFSRequire("fs"),{existsSync:tB,mkdirSync:tU,readdirSync:tq,readFileSync:tz,renameSync:tV,rmdirSync:tJ,statSync:tW,lstatSync:tY,writeFileSync:tH,unlinkSync:tX}=tK;tM.configure({fs:"LocalStorage",options:{}},function(tn){if(tn)throw tn});let tG=new T("DIDStore");let Be=class Be{constructor(tn,to,ta){tn<0&&(tn=0),to<0&&(to=0),this.cache=new dl({maxItems:to}),this.storage=ta,tG.info("DID store opened: {}, cache(init:{}, max:{})",ta.getLocation(),tn,to)}static open(tn,to=Be.DEFAULT_STORAGE,ta=Be.CACHE_INITIAL_CAPACITY,tu=Be.CACHE_MAX_CAPACITY){return A(this,void 0,void 0,function*(){let tc;if(qt(null!=tn&&""!=tn,"Invalid store context"),qt(null!=to&&""!=to,"Invalid storage name"),qt(tu>=ta,"Invalid cache capacity spec"),to==Be.DEFAULT_STORAGE||null==to)tc=new be(tn);else try{tc=new(this.storages.get(to))(tn)}catch(tn){throw new R("Unsupport "+to+" storage")}yield tc.init();let th=new Be(ta,tu,tc);return th.metadata=yield tc.loadMetadata(),th.metadata.attachStore(th),th})}close(){this.cache.invalidateAll(),this.cache=null,this.metadata=null,this.storage=null}static calcFingerprint(tn){let to=Ye(th.Buffer.from(tn)).toString();try{return Ye(Ca.encrypt(th.Buffer.from(to,"hex"),tn)).toString()}catch(tn){throw new j("Calculate fingerprint error.",tn)}}static register(tn,to){if(tn==Be.DEFAULT_STORAGE)throw new P("'fs' is remained for default storage, please change one");this.storages.set(tn,to)}static encryptToBase64(tn,to){try{return Ca.encryptToBase64(tn,to)}catch(tn){throw new j("Encrypt data error.",tn)}}static decryptFromBase64(tn,to){try{return Ca.decryptFromBase64(tn,to)}catch(tn){throw new x("Decrypt private key error.",tn)}}static reEncrypt(tn,to,ta){let tu=this.decryptFromBase64(tn,to);return this.encryptToBase64(tu,ta)}encrypt(tn,to){let ta=this.metadata.getFingerprint(),tu=Be.calcFingerprint(to);if(null!=ta&&tu!==ta)throw new x("Password mismatched with previous password.");let tc=Be.encryptToBase64(tn,to);return null!=ta&&""!==ta||this.metadata.setFingerprint(tu),tc}decrypt(tn,to){let ta=this.metadata.getFingerprint(),tu=Be.calcFingerprint(to),tc=Be.decryptFromBase64(tn,to);return null!=ta&&""!==ta||this.metadata.setFingerprint(tu),tc}storeRootIdentity(tn,to){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid identity"),void 0!==to){qt(null!=to&&""!==to,"Invalid storepass");let ta=null;null!=tn.getMnemonic()&&(ta=this.encrypt(th.Buffer.from(tn.getMnemonic(),"utf8"),to));let tu=this.encrypt(tn.getRootPrivateKey().serialize(),to),tc=tn.getPreDerivedPublicKey().serializePublicKeyBase58();yield this.storage.storeRootIdentity(tn.getId(),ta,tu,tc,tn.getIndex()),null==this.metadata.getDefaultRootIdentity()&&this.metadata.setDefaultRootIdentity(tn.getId()),this.cache.invalidate(Be.Key.forRootIdentity(tn.getId())),this.cache.invalidate(Be.Key.forRootIdentityPrivateKey(tn.getId()))}else yield this.storage.updateRootIdentityIndex(tn.getId(),tn.getIndex())})}setDefaultRootIdentity(tn){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid identity"),!(yield this.containsRootIdentity(tn.getId())))throw new P("Invalid identity, not exists in the store");this.metadata.setDefaultRootIdentity(tn.getId())})}loadRootIdentity(tn){return A(this,void 0,void 0,function*(){if(void 0===tn&&(null==(tn=this.metadata.getDefaultRootIdentity())||""===tn)){let tn=yield this.storage.listRootIdentities();if(1!=tn.length)return null;{let to=tn[0],ta=yield this.loadRootIdentityMetadata(to.getId());return to.setMetadata(ta),this.metadata.setDefaultRootIdentity(to.getId()),to}}qt(null!=tn&&""!==tn,"Invalid id");try{let to=yield this.cache.getAsync(Be.Key.forRootIdentity(tn),()=>A(this,void 0,void 0,function*(){let to=yield this.storage.loadRootIdentity(tn);return null!=to?(to.setMetadata((yield this.loadRootIdentityMetadata(tn))),{value:to}):{value:Be.NULL}}));return to===Be.NULL?null:to}catch(to){throw new R("Load root identity failed: "+tn,to)}})}containsRootIdentity(tn){return A(this,void 0,void 0,function*(){return qt(null!=tn&&""!==tn,"Invalid id"),yield this.storage.containsRootIdentity(tn)})}exportRootIdentityMnemonic(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid id"),qt(null!=to&&""!==to,"Invalid storepass");let ta=yield this.storage.loadRootIdentityMnemonic(tn);return null!=ta?new String(this.decrypt(ta,to)).valueOf():null})}containsRootIdentityMnemonic(tn){return A(this,void 0,void 0,function*(){return qt(null!=tn&&""!==tn,"Invalid id"),null!=(yield this.storage.loadRootIdentityMnemonic(tn))})}loadRootIdentityPrivateKey(tn,to){return A(this,void 0,void 0,function*(){try{let ta=yield this.cache.getAsync(Be.Key.forRootIdentityPrivateKey(tn),()=>A(this,void 0,void 0,function*(){let to=yield this.storage.loadRootIdentityPrivateKey(tn);return{value:null!=to?to:Be.NULL}}));if(ta!==Be.NULL){let tn=this.decrypt(ta,to);return Na.deserialize(tn)}return null}catch(to){throw to instanceof x?to:new R("Load root identity private key failed: "+tn,to)}})}derive(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid identity"),qt(null!=to&&""!==to,"Invalid path"),qt(null!=ta&&""!==ta,"Invalid storepass");let tu=yield this.loadRootIdentityPrivateKey(tn,ta);if(!tu)throw new j("Unable to load root private key for id "+tn+". Null private key returned.");return tu.deriveWithPath(to)})}deleteRootIdentity(tn){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid id");let to=yield this.storage.deleteRootIdentity(tn);return to&&(null!=this.metadata.getDefaultRootIdentity()&&this.metadata.getDefaultRootIdentity()===tn&&this.metadata.setDefaultRootIdentity(null),this.cache.invalidate(Be.Key.forRootIdentity(tn)),this.cache.invalidate(Be.Key.forRootIdentityPrivateKey(tn))),to})}listRootIdentities(){return A(this,void 0,void 0,function*(){let tn=yield this.storage.listRootIdentities();for(let to of tn){let tn=yield this.loadRootIdentityMetadata(to.getId());to.setMetadata(tn)}return tn})}containsRootIdentities(){return A(this,void 0,void 0,function*(){return yield this.storage.containsRootIdenities()})}storeRootIdentityMetadata(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid id"),qt(null!=to,"Invalid metadata"),yield this.storage.storeRootIdentityMetadata(tn,to)})}loadRootIdentityMetadata(tn){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid id");let to=yield this.storage.loadRootIdentityMetadata(tn);return null!=to?(to.setId(tn),to.attachStore(this)):to=new we.Metadata(tn,this),to})}storeDid(tn){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid doc"),yield this.storage.storeDid(tn),tn.getStore()!=this){let to=yield this.loadDidMetadata(tn.getSubject());tn.getMetadata().merge(to),tn.getMetadata().attachStore(this)}for(let to of(yield this.storeDidMetadata(tn.getSubject(),tn.getMetadata()),tn.getCredentials()))yield this.storeCredential(to);this.cache.put(Be.Key.forDidDocument(tn.getSubject()),tn)})}loadDid(tn){return A(this,void 0,void 0,function*(){let to;qt(null!=tn,"Invalid did"),to=tn instanceof Jt?tn:Jt.from(tn);try{let tn=yield this.cache.getAsync(Be.Key.forDidDocument(to),()=>A(this,void 0,void 0,function*(){let tn=yield this.storage.loadDid(to);return null!=tn?(tn.setMetadata((yield this.loadDidMetadata(to))),{value:tn}):{value:Be.NULL}}));return tn===Be.NULL?null:tn}catch(tn){throw new R("Load did document failed: "+to,tn)}})}containsDid(tn){return A(this,void 0,void 0,function*(){let to;return qt(null!=tn,"Invalid did"),to=tn instanceof Jt?tn:Jt.from(tn),yield this.storage.containsDid(to)})}containsDids(){return A(this,void 0,void 0,function*(){return yield this.storage.containsDids()})}storeDidMetadata(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid did"),qt(null!=to,"Invalid metadata"),yield this.storage.storeDidMetadata(tn,to),to.attachStore(this),this.cache.put(Be.Key.forDidMetadata(tn),to)})}loadDidMetadata(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid did");try{let to=yield this.cache.getAsync(Be.Key.forDidMetadata(tn),()=>A(this,void 0,void 0,function*(){let to=yield this.storage.loadDidMetadata(tn);return null!=to?(to.setDid(tn),to.attachStore(this)):to=new Kt(tn,this),{value:to}}));return to===Be.NULL?null:to}catch(to){throw new R("Load did metadata failed: "+tn,to)}})}deleteDid(tn){return A(this,void 0,void 0,function*(){let to;qt(null!=tn,"Invalid did"),to=tn instanceof Jt?tn:Jt.from(tn);let ta=yield this.storage.deleteDid(to);return ta&&(this.cache.invalidate(Be.Key.forDidDocument(to)),this.cache.invalidate(Be.Key.forDidMetadata(to)),this.cache.invalidateAll(tn=>tn.id instanceof Xt&&tn.id.getDid()===to)),ta})}listDids(){return A(this,void 0,void 0,function*(){let tn=yield this.storage.listDids();for(let to of tn){let tn=yield this.loadDidMetadata(to);null==tn?tn=new Kt(to,this):(tn.setDid(to),tn.attachStore(this)),to.setMetadata(tn)}return tn})}selectDids(tn){return A(this,void 0,void 0,function*(){let to=yield this.listDids();if(null!=tn){let ta=[];for(let tu of to)tn.select(tu)&&ta.push(tu);to=ta}return to})}storeCredential(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid credential");let ta=tn.serialize(!0),tu=th.Buffer.from(ta,"utf-8"),tc=!1;if(to&&(tu=th.Buffer.from(this.encrypt(tu,to),"utf-8"),tc=!0),yield this.storage.storeCredential(tn.getId(),tu,tc),tn.getMetadata().getStore()!=this){let to=yield this.loadCredentialMetadata(tn.getId());tn.getMetadata().merge(to),tn.getMetadata().attachStore(this)}yield this.storeCredentialMetadata(tn.getId(),tn.getMetadata()),this.cache.put(Be.Key.forCredential(tn.getId()),tn)})}loadCredential(tn,to){return A(this,void 0,void 0,function*(){if(qt(null!=tn,"Invalid credential id"),"string"==typeof tn&&(tn=Xt.from(tn)),to){let tn=this.metadata.getFingerprint(),ta=Be.calcFingerprint(to);if(null!=tn&&ta!==tn)throw new x("Password mismatched with previous password.")}qt(tn.isQualified(),"Unqualified credential id");try{let ta=yield this.cache.getAsync(Be.Key.forCredential(tn),()=>A(this,void 0,void 0,function*(){let ta,[tu,tc]=yield this.storage.loadCredential(tn);if(!tu)return{value:Be.NULL};if(tc&&!to)throw new R("Credential is encrypted, please provide password to get it.");return(ta=tc?se.parse(this.decrypt(tu.toString(),to).toString()):se.parse(tu.toString())).setMetadata((yield this.loadCredentialMetadata(tn))),{value:ta}}));return ta===Be.NULL?null:ta}catch(to){throw new R("Load credential failed: "+tn,to)}})}containsCredential(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid credential id");let to=Xt.from(tn);return qt(to.isQualified(),"Unqualified credential id"),yield this.storage.containsCredential(to)})}containsCredentials(tn){return A(this,void 0,void 0,function*(){return qt(null!=tn,"Invalid did"),yield this.storage.containsCredentials(tn)})}storeCredentialMetadata(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid credential id"),qt(tn.isQualified(),"Unqualified credential id"),qt(null!=to,"Invalid credential metadata"),yield this.storage.storeCredentialMetadata(tn,to),to.attachStore(this),this.cache.put(Be.Key.forCredentialMetadata(tn),to)})}loadCredentialMetadata(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid credential id"),qt(tn.isQualified(),"Unqualified credential id");try{let to=yield this.cache.getAsync(Be.Key.forCredentialMetadata(tn),()=>A(this,void 0,void 0,function*(){let to=yield this.storage.loadCredentialMetadata(tn);return null!=to?(to.setId(tn),to.attachStore(this)):to=new re(tn,this),{value:to}}));return to===Be.NULL?null:to}catch(to){throw new R("Load Credential metadata failed: "+tn,to)}})}deleteCredential(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid credential id");let to=Xt.from(tn);qt(to.isQualified(),"Unqualified credential id");let ta=yield this.storage.deleteCredential(to);return ta&&(this.cache.invalidate(Be.Key.forCredential(to)),this.cache.invalidate(Be.Key.forCredentialMetadata(to))),ta})}listCredentials(tn){return A(this,void 0,void 0,function*(){let to;qt(null!=tn,"Invalid did"),to=tn instanceof Jt?tn:Jt.from(tn);let ta=yield this.storage.listCredentials(to);for(let tn of ta){let to=yield this.loadCredentialMetadata(tn);null==to?to=new re(tn,this):(to.setId(tn),to.attachStore(this)),tn.setMetadata(to)}return ta})}selectCredentials(tn,to){return A(this,void 0,void 0,function*(){let ta;qt(null!=tn,"Invalid did"),ta=tn instanceof Jt?tn:Jt.from(tn);let tu=yield this.listCredentials(ta);if(null!=to){let tn=[];for(let ta of tu)to.select(ta)&&tn.push(ta);tu=tn}return tu})}storePrivateKey(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid private key id");let tu=Xt.from(tn);qt(tu.isQualified(),"Unqualified private key id"),qt(null!=to&&0!=to.length,"Invalid private key"),qt(null!=ta&&""!==ta,"Invalid storepass");let tc=this.encrypt(to,ta);yield this.storage.storePrivateKey(tu,tc),this.cache.put(Be.Key.forDidPrivateKey(tu),tc)})}storeLazyPrivateKey(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid private key id"),qt(tn.isQualified(),"Unqualified private key id"),yield this.storage.storePrivateKey(tn,Be.DID_LAZY_PRIVATEKEY),this.cache.put(Be.Key.forDidPrivateKey(tn),Be.DID_LAZY_PRIVATEKEY)})}loadPrivateKey(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid private key id"),qt(tn.isQualified(),"Unqualified private key id"),qt(to&&null!=to,"Invalid storepass");try{let ta=yield this.cache.getAsync(Be.Key.forDidPrivateKey(tn),()=>A(this,void 0,void 0,function*(){let to=yield this.storage.loadPrivateKey(tn);return{value:null!=to?to:Be.NULL}}));return ta!==Be.NULL&&ta?ta===Be.DID_LAZY_PRIVATEKEY?yield we.lazyCreateDidPrivateKey(tn,this,to):this.decrypt(ta,to):null}catch(tn){throw new R("Load did private key failed.")}})}containsPrivateKey(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid private key id");let to=Xt.from(tn);return qt(to.isQualified(),"Unqualified private key id"),yield this.storage.containsPrivateKey(to)})}containsPrivateKeys(tn){return A(this,void 0,void 0,function*(){let to;return qt(null!=tn,"Invalid did"),to=tn instanceof Jt?tn:Jt.from(tn),yield this.storage.containsPrivateKeys(to)})}deletePrivateKey(tn){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid private key id");let to=Xt.from(tn),ta=yield this.storage.deletePrivateKey(to);return ta&&this.cache.invalidate(Be.Key.forDidPrivateKey(to)),ta})}sign(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid private key id"),qt(tn.isQualified(),"Unqualified private key id"),qt(null!=to&&""!==to,"Invalid storepass"),qt(null!=ta&&ta.length>0,"Invalid digest");let tu=yield this.loadPrivateKey(tn,to);if(null==tu)throw new R("Private key not exists: "+tn.toString());let tc=Na.deserialize(tu),th=He.sign(tc.getPrivateKeyBytes(),ta);return tu.fill(0),tc.wipe(),Je.fromHex(th.toString("hex"))})}changePassword(tn,to){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid old password"),qt(null!=to&&""!==to,"Invalid new password"),yield this.storage.changePassword({reEncrypt:ta=>Be.reEncrypt(ta,tn,to)}),this.metadata.setFingerprint(Be.calcFingerprint(to)),this.cache.invalidateAll()})}synchronize(tn=null,to){return A(this,void 0,void 0,function*(){for(let to of(null==tn&&(tn=Ma.getInstance()),yield this.listRootIdentities()))yield to.synchronize(tn);for(let ta of yield this.storage.listDids()){let tu=yield this.storage.loadDid(ta);if(tu.isCustomizedDid()){let to=yield ta.resolve();if(null==to)continue;let tc=to;if(tu.getMetadata().detachStore(),tu.getSignature()===to.getSignature()||null!=tu.getMetadata().getSignature()&&tu.getProof().getSignature()===tu.getMetadata().getSignature())tc.getMetadata().merge(tu.getMetadata());else{if(tG.debug("{} on-chain copy conflict with local copy.",ta.toString()),null==(tc=tn.merge(to,tu))||!tc.getSubject().equals(ta))throw tG.error("Conflict handle merge the DIDDocument error."),new R("deal with local modification error.");tG.debug("Conflict handle return the final copy.")}tu.getMetadata().attachStore(this);let th=tc.getMetadata();th.setPublished(to.getMetadata().getPublished()),th.setSignature(to.getProof().getSignature()),to.getMetadata().isDeactivated()&&th.setDeactivated(!0),th.attachStore(this),yield this.storage.storeDid(tc)}for(let tn of yield this.storage.listCredentials(ta)){let ta=yield this.loadCredential(tn,to),tu=yield se.resolve(tn,ta.getIssuer());null!=tu&&(tu.getMetadata().merge(ta.getMetadata()),yield this.storeCredential(tu))}}})}exportDid(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid id"),qt(null!=to&&""!==to,"Invalid password"),qt(null!=ta&&""!==ta,"Invalid storepass"),"string"==typeof tn&&(tn=Jt.from(tn));let tu=yield this.storage.loadDid(tn);if(null==tu)throw new R("Export DID "+tn+" failed, not exist.");tu.setMetadata((yield this.storage.loadDidMetadata(tn))),tG.debug("Exporting {}...",tn.toString());let tc=new Be.DIDExport(tn);if(tc.setDocument(tu),yield this.storage.containsCredentials(tn)){let to=Array.from((yield this.listCredentials(tn)));for(let tn of(to.sort(),to)){tG.debug("Exporting credential {}...",tn.toString());let to=yield this.loadCredential(tn);to.setMetadata((yield this.storage.loadCredentialMetadata(tn))),tc.addCredential(to)}}if(yield this.storage.containsPrivateKeys(tn))for(let th of tu.getPublicKeys()){if(!th.getController().equals(tn))continue;let tu=th.getId(),td=yield this.storage.loadPrivateKey(tu);null!=td&&(tG.debug("Exporting private key {}...",tu.toString()),tc.addPrivatekey(tu,td,ta,to))}return tc.seal(to),tc.serialize(!0)})}importDid(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid import data"),qt(null!=to&&""!==to,"Invalid password"),qt(null!=ta&&""!==ta,"Invalid storepass");let tu=Be.DIDExport.parse(tn);tu.verify(to);let tc=tu.getDocument();for(let tn of(yield this.storage.storeDid(tc),yield this.storage.storeDidMetadata(tc.getSubject(),tc.getMetadata()),tu.getCredentials()))yield this.storeCredential(tn),yield this.storage.storeCredentialMetadata(tn.getId(),tn.getMetadata());for(let tn of tu.getPrivateKeys())yield this.storage.storePrivateKey(tn.getId(),tn.getKey(to,ta));return null})}exportRootIdentity(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid id"),qt(null!=to&&""!==to,"Invalid password"),qt(null!=ta&&""!==ta,"Invalid storepass");let tu=new Be.RootIdentityExport,tc=yield this.storage.loadRootIdentityMnemonic(tn);null!==tc&&tu.setMnemonic(tc,ta,to),tu.setPirvateKey((yield this.storage.loadRootIdentityPrivateKey(tn)),ta,to);let th=yield this.storage.loadRootIdentity(tn);return tu.setPublicKey(th.getPreDerivedPublicKey().serializePublicKeyBase58()),tu.setIndex(th.getIndex()),th.getId()==this.metadata.getDefaultRootIdentity()&&tu.setDefault(),tu.seal(to),tu.serialize(!0)})}importRootIdentity(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn&&""!==tn,"Invalid import data"),qt(null!=to&&""!==to,"Invalid password"),qt(null!=ta&&""!==ta,"Invalid storepass");let tu=Be.RootIdentityExport.parse(tn);tu.verify(to);let tc=tu.getMnemonic(to,ta),th=tu.getPrivateKey(to,ta),td=tu.getPublicKey(),tf=Na.deserializeBase58(td),tp=we.getId(tf.serializePublicKey());return yield this.storage.storeRootIdentity(tp,tc,th,td,tu.getIndex()),tu.isDefault()&&null==this.metadata.getDefaultRootIdentity()&&this.metadata.setDefaultRootIdentity(tp),null})}exportStore(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid zip file"),qt(null!=to&&""!==to,"Invalid password"),qt(null!=ta&&""!==ta,"Invalid storepass");let tu=new tE;for(let tn of yield this.listDids()){let tc=yield this.exportDid(tn,to,ta);tu.file("did-"+tn.getMethodSpecificId(),tc)}for(let tn of yield this.listRootIdentities()){let tc=yield this.exportRootIdentity(tn.getId(),to,ta);tu.file("rootIdentity-"+tn.getId(),tc)}new La(tn).createFile();try{let to=yield tu.generateAsync({type:"nodebuffer",platform:"UNIX"});tH(tn,to,{mode:420,flag:"w+"})}catch(tn){throw new _t(tn)}})}importStore(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid zip file"),qt(null!=to&&""!==to,"Invalid password"),qt(null!=ta&&""!==ta,"Invalid storepass");let tu=this.metadata.getFingerprint(),tc=Be.calcFingerprint(ta);if(null!=tu&&tc!==tu)throw new x("Password mismatched with previous password.");try{let tu=[],tc=yield tz(tn),th=yield tE.loadAsync(tc);th.forEach((tn,tc)=>{let td=th.file(tn).async("string").then(tu=>A(this,void 0,void 0,function*(){tn.startsWith("rootIdentity-")?yield this.importRootIdentity(tu,to,ta):tn.startsWith("did-")?yield this.importDid(tu,to,ta):console.log("Skip unknow export entry: "+tn)}));tu.push(td)}),yield Promise.all(tu)}catch(tn){throw new _t(tn)}null!=tu&&""!=tu||this.metadata.setFingerprint(tc)})}};Be.CACHE_INITIAL_CAPACITY=16,Be.CACHE_MAX_CAPACITY=128,Be.NULL=null,Be.DID_LAZY_PRIVATEKEY="lazy-private-key",Be.storages=new Map,Be.DEFAULT_STORAGE="fs",function(tn){let i=class i{constructor(tn,to){this.type=tn,this.id=to}hashCode(){return this.type+this.id.hashCode()}equals(tn){return tn==this||tn instanceof i&&this.type==tn.type&&this.id.equals(tn.id)}static forRootIdentity(to){return new i(tn.Key.TYPE_ROOT_IDENTITY,new class{equals(tn){return tn===to}compareTo(tn){return to.localeCompare(tn)}hashCode(){return Ht(to)}})}static forRootIdentityPrivateKey(to){return new i(tn.Key.TYPE_ROOT_IDENTITY_PRIVATEKEY,new class{constructor(){this.key=to}equals(tn){return tn===this.key}compareTo(tn){return this.key<tn?-1:this.key>tn?1:0}hashCode(){return Ht(this.key)}})}static forDidDocument(to){return new i(tn.Key.TYPE_DID_DOCUMENT,to)}static forDidMetadata(to){return new i(tn.Key.TYPE_DID_METADATA,to)}static forDidPrivateKey(to){return new i(tn.Key.TYPE_DID_PRIVATEKEY,to)}static forCredential(to){return new i(tn.Key.TYPE_CREDENTIAL,to)}static forCredentialMetadata(to){return new i(tn.Key.TYPE_CREDENTIAL_METADATA,to)}};i.TYPE_ROOT_IDENTITY=0,i.TYPE_ROOT_IDENTITY_PRIVATEKEY=1,i.TYPE_DID_DOCUMENT=16,i.TYPE_DID_METADATA=17,i.TYPE_DID_PRIVATEKEY=18,i.TYPE_CREDENTIAL=32,i.TYPE_CREDENTIAL_METADATA=33,tn.Key=i;let r=class r extends Ft{constructor(tn=null){super(),this.document=null,this.credentials=[],this.privatekeys=[],this.created=null,this.fingerprint=null,this.type=r.DID_EXPORT,this.id=tn}getId(){return this.id}getDocument(){return this.document.content}setDocument(to){this.document=new tn.DIDExport.Document(to,to.getMetadata().isEmpty()?null:to.getMetadata())}getCredentials(){if(null==this.credentials)return[];let tn=[];for(let to of this.credentials)tn.push(to.content);return tn}addCredential(tn){null==this.credentials&&(this.credentials=[]),this.credentials.push(new r.Credential(tn,tn.getMetadata().isEmpty()?null:tn.getMetadata()))}getPrivateKeys(){return null!=this.privatekeys?this.privatekeys:[]}addPrivatekey(to,ta,tu,tc){null==this.privatekeys&&(this.privatekeys=[]);let th=new tn.DIDExport.PrivateKey(to);th.setKey(ta,tu,tc),this.privatekeys.push(th)}calculateFingerprint(tn){let to=tg("sha256");if(to.update(th.Buffer.from(tn)),to.update(th.Buffer.from(this.type)),to.update(th.Buffer.from(this.id.toString())),to.update(th.Buffer.from(this.document.content.toString(!0))),this.document.metadata&&to.update(th.Buffer.from(this.document.metadata.toString(!0))),this.credentials)for(let tn of this.credentials)to.update(th.Buffer.from(tn.content.toString(!0))),tn.metadata&&to.update(th.Buffer.from(tn.metadata.toString(!0)));for(let tn of this.privatekeys)to.update(th.Buffer.from(tn.id.toString())),to.update(th.Buffer.from(tn.key));to.update(th.Buffer.from(this.dateToString(this.created)));let ta=to.digest();return Je.toUrlFormat(ta.toString("base64"))}seal(tn){let to=tw();return to.set("milliseconds",0),this.created=to.toDate(),this.fingerprint=this.calculateFingerprint(tn),this}verify(tn){if(this.fingerprint!==this.calculateFingerprint(tn))throw new _t("Invalid export data, fingerprint mismatch. "+this.id.toString())}toJSON(tn=null){let to={};return to.type=this.type,to.id=this.id.toString(),to.document=this.document.toJSON(),this.credentials&&this.credentials.length>0&&(to.credential=Array.from(this.credentials,tn=>tn.toJSON())),this.privatekeys&&this.privatekeys.length>0&&(to.privateKey=Array.from(this.privatekeys,tn=>tn.toJSON())),to.created=this.dateToString(this.created),to.fingerprint=this.fingerprint,to}fromJSON(tn,to=null){if(this.type=this.getString("type",tn.type,{mandatory:!0,nullable:!1}),!this.type||this.type!==r.DID_EXPORT)throw new _t("Invalid export data, unknown type.");if(this.id=this.getDid("id",tn.id,{mandatory:!0,nullable:!1}),!tn.document)throw new _t("Invalid export data, missing document.");if(this.document=r.Document.parse(tn.document),tn.credential){if(!Array.isArray(tn.credential))throw new _t("Invalid export data, invalid credentials.");this.credentials=Array.from(tn.credential,tn=>r.Credential.parse(tn))}if(tn.privateKey){if(!Array.isArray(tn.privateKey))throw new _t("Invalid export data, invalid privatekeys.");this.privatekeys=Array.from(tn.privateKey,tn=>r.PrivateKey.parse(tn))}this.created=this.getDate("created",tn.created,{mandatory:!0,nullable:!1}),this.fingerprint=this.getString("fingerprint",tn.fingerprint,{mandatory:!0,nullable:!1})}static parse(tn,to=null){try{return Ft.deserialize(tn,r,to)}catch(tn){throw tn instanceof _t?tn:new _t(tn)}}};r.DID_EXPORT="did.elastos.export/2.0",tn.DIDExport=r,function(to){let i=class i extends Ft{constructor(tn=null,to=null){super(),this.content=tn,this.metadata=to}toJSON(tn=null){let to={};return to.content=this.content.toJSON(),this.metadata&&(to.metadata=this.metadata.toJSON()),to}fromJSON(tn,to=null){if(!tn.content)throw new _t("Invalid export data, missing document content");this.content=ve._parseOnly(tn.content),tn.metadata&&(this.metadata=Kt.parse(tn.metadata),this.content.setMetadata(this.metadata))}static parse(tn,to=null){try{return Ft.deserialize(tn,i,to)}catch(tn){throw tn instanceof _t?tn:new _t(tn)}}};to.Document=i;let r=class r extends Ft{constructor(tn=null,to=null){super(),this.content=tn,this.metadata=to}toJSON(tn=null){let to={};return to.content=this.content.toJSON(),this.metadata&&(to.metadata=this.metadata.toJSON()),to}fromJSON(tn,to=null){if(!tn.content)throw new _t("Invalid export data, missing credential content");this.content=se.parse(tn.content),tn.metadata&&(this.metadata=re.parse(tn.metadata),this.content.setMetadata(this.metadata))}static parse(tn,to=null){try{return Ft.deserialize(tn,r,to)}catch(tn){throw tn instanceof _t?tn:new _t(tn)}}};to.Credential=r;let n=class n extends Ft{constructor(tn=null){super(),this.id=tn}getId(){return this.id}setId(tn){this.id=tn}getKey(to,ta){return tn.reEncrypt(this.key,to,ta)}setKey(to,ta,tu){this.key=tn.reEncrypt(to,ta,tu)}toJSON(tn=null){return{id:this.id.toString(),key:this.key}}fromJSON(tn,to=null){this.id=this.getDidUrl("id",tn.id,{mandatory:!0,nullable:!1}),this.key=this.getString("key",tn.key,{mandatory:!0,nullable:!1})}static parse(tn,to=null){try{return Ft.deserialize(tn,n,to)}catch(tn){throw tn instanceof _t?tn:new _t(tn)}}};to.PrivateKey=n}(r=tn.DIDExport||(tn.DIDExport={}));let n=class n extends Ft{constructor(){super(),this.type=n.DID_EXPORT}getMnemonic(to,ta){return null==this.mnemonic?null:tn.reEncrypt(this.mnemonic,to,ta)}setMnemonic(to,ta,tu){this.mnemonic=tn.reEncrypt(to,ta,tu)}getPrivateKey(to,ta){return tn.reEncrypt(this.privatekey,to,ta)}setPirvateKey(to,ta,tu){this.privatekey=tn.reEncrypt(to,ta,tu)}getPublicKey(){return this.publickey}setPublicKey(tn){this.publickey=tn}getIndex(){return this.index}setIndex(tn){this.index=tn}isDefault(){return 1==this.default}setDefault(){this.default=!0}calculateFingerprint(tn){let to=tg("sha256");to.update(th.Buffer.from(tn)),to.update(th.Buffer.from(this.type)),this.mnemonic&&to.update(th.Buffer.from(this.mnemonic)),to.update(th.Buffer.from(this.privatekey)),to.update(th.Buffer.from(this.publickey)),to.update(th.Buffer.from(this.index.toString())),to.update(th.Buffer.from(this.default.toString())),to.update(th.Buffer.from(this.dateToString(this.created)));let ta=to.digest();return Je.toUrlFormat(ta.toString("base64"))}seal(tn){let to=tw();return to.set("milliseconds",0),this.created=to.toDate(),this.fingerprint=this.calculateFingerprint(tn),this}verify(tn){if(this.fingerprint!==this.calculateFingerprint(tn))throw new _t("Invalid export data, fingerprint mismatch.")}toJSON(tn=null){return{type:this.type,mnemonic:this.mnemonic,privateKey:this.privatekey,publicKey:this.publickey,index:this.index.toString(),default:this.default.toString(),created:this.dateToString(this.created),fingerprint:this.fingerprint}}fromJSON(tn,to=null){if(this.type=this.getString("type",tn.type,{mandatory:!0,nullable:!1}),!this.type||this.type!==n.DID_EXPORT)throw new _t("Invalid export data, unknown type.");this.mnemonic=this.getString("mnemonic",tn.mnemonic,{mandatory:!0,nullable:!1}),this.privatekey=this.getString("privateKey",tn.privateKey,{mandatory:!0,nullable:!1}),this.publickey=this.getString("publicKey",tn.publicKey,{mandatory:!0,nullable:!1});let ta=this.getString("index",tn.index,{mandatory:!0,nullable:!1});this.index=null!=ta?Number.parseInt(ta):0;let tu=this.getString("default",tn.default,{mandatory:!0,nullable:!1});this.default=!(!tu||"true"!==tu),this.created=this.getDate("created",tn.created,{mandatory:!0,nullable:!1}),this.fingerprint=this.getString("fingerprint",tn.fingerprint,{mandatory:!0,nullable:!1})}static parse(tn,to=null){try{return Ft.deserialize(tn,n,to)}catch(tn){throw tn instanceof _t?tn:new _t(tn)}}};n.DID_EXPORT="did.elastos.export/2.0",tn.RootIdentityExport=n}(Be||(Be={}));let Ve=class Ve{constructor(){}static create(tn,to){return A(this,void 0,void 0,function*(){let ta=new Ve;if(ta.self=tn,to){if(!ta.self.isAuthenticationKey(to))throw new X(to.toString()+" isn't the authentication key")}else if(null==(to=ta.self.getDefaultPublicKeyId()))throw new X("Need explict sign key or effective controller");if(!(yield tn.hasPrivateKey(to)))throw new X("No private key: "+to);return ta.signKey=to,ta})}static newWithDocument(tn,to){return A(this,void 0,void 0,function*(){return qt(null!=tn,"Invalid document"),to?to instanceof Xt?yield Ve.create(tn,to):yield Ve.create(tn,Xt.from(to,tn.getSubject())):yield Ve.create(tn)})}static newWithDID(tn,to,ta){return A(this,void 0,void 0,function*(){qt(null!=tn,"Invalid did"),qt(null!=to,"Invalid store");let tu=yield to.loadDid(tn);return ta?ta instanceof Xt?yield Ve.create(tu,ta):yield Ve.create(tu,Xt.from(ta,tn)):yield Ve.create(tu)})}getDid(){return this.self.getSubject()}getDocument(){return this.self}getSignKey(){return this.signKey}sign(tn,to){return this.self.signWithId(this.signKey,tn,to)}issueFor(tn){return qt(null!=tn,"Invalid did"),tn instanceof Jt?new se.Builder(this,tn):new se.Builder(this,Jt.from(tn))}};let qe=class qe{constructor(tn){this.buffer=tn,this.position=0}static wrap(tn){let to=new Uint8Array(tn);for(let ta=0;ta<tn.length;++ta)to[ta]=tn[ta];return new qe(to)}static allocate(tn){return new qe(new Uint8Array(tn))}hasRemaining(){return this.size()>this.position}size(){return this.buffer.length}reallocate(){let tn=new Uint8Array(2*this.size());tn.set(this.buffer),this.buffer=tn}shrink(){return this.buffer=this.buffer.subarray(0,this.position),this.buffer}put(tn){this.buffer.length<this.position+1&&this.reallocate(),this.buffer[this.position++]=tn}get(tn){return null==tn&&(tn=this.position,this.position+=1),this.buffer.length<tn+1?0:this.buffer[tn]}putShort(tn){if(65535<tn)throw tn+" is over short value";this.put(255&tn),this.put((65280&tn)>>8)}getShort(tn){if(null==tn&&(tn=this.position,this.position+=2),this.buffer.length<tn+2)return 0;let to=this.buffer[tn];return(this.buffer[tn+1]<<8)+to}putInt(tn){if(4294967295<tn)throw tn+" is over integer value";this.put(255&tn),this.put((65280&tn)>>8),this.put((16711680&tn)>>16),this.put((4278190080&tn)>>24)}getInt(tn){if(tn>this.size()+4)throw new Et;if(null==tn&&(tn=this.position,this.position+=4),this.buffer.length<tn+4)return 0;let to=this.buffer[tn],ta=this.buffer[tn+1],tu=this.buffer[tn+2];return(this.buffer[tn+3]<<24)+(tu<<16)+(ta<<8)+to}readInt(){if(!this.hasRemaining())throw new Et("Buffer exhausted");let tn=this.position;return this.position+=4,this.getInt(tn)}putString(tn){let to=this.stringToUtf8Bytes(tn);for(let tn=0;tn<to.length;tn++)this.put(to[tn]);this.put(0)}getString(tn){let to,ta=[];for(null==tn&&(tn=this.position);!(this.buffer.length<tn+1)&&0!==(to=this.get(tn++));)ta.push(to);return this.position=tn,this.utf8BytesToString(ta)}stringToUtf8Bytes(tn){let to=new Uint8Array(4*tn.length),ta=0,tu=0;for(;ta<tn.length;){let tc;let th=tn.charCodeAt(ta++);if(th>=55296&&th<=56319){let to=tn.charCodeAt(ta++);if(!(to>=56320&&to<=57343))return null;tc=1024*(th-55296)+65536+(to-56320)}else tc=th;tc<128?to[tu++]=tc:tc<2048?(to[tu++]=tc>>>6|192,to[tu++]=63&tc|128):tc<65536?(to[tu++]=tc>>>12|224,to[tu++]=tc>>6&63|128,to[tu++]=63&tc|128):tc<2097152&&(to[tu++]=tc>>>18|240,to[tu++]=tc>>12&63|128,to[tu++]=tc>>6&63|128,to[tu++]=63&tc|128)}return to.subarray(0,tu)}utf8BytesToString(tn){let to,ta,tu,tc,th="",td=0;for(;td<tn.length;)(to=(ta=tn[td++])<128?ta:ta>>5==6?(31&ta)<<6|63&(tu=tn[td++]):ta>>4==14?(15&ta)<<12|(63&(tu=tn[td++]))<<6|63&(tc=tn[td++]):(7&ta)<<18|(63&(tu=tn[td++]))<<12|(63&(tc=tn[td++]))<<6|63&tn[td++])<65536?th+=String.fromCharCode(to):(to-=65536,th+=String.fromCharCode(55296|to>>10,56320|1023&to));return th}};function Ye(tn){return td.createHash("md5").update(tn).digest("hex")}let We=class We{static hashTwice(tn){let to=tg("sha256").update(tn).digest();return tg("sha256").update(to).digest()}static sha256ripemd160(tn){let to=tg("sha256").update(tn).digest();return tg("ripemd160").update(to).digest()}static encodeToString(...tn){let to=tn.reduce((tn,to)=>th.Buffer.concat([tn,to]),th.Buffer.from(""));return tg("sha256").update(to).digest().toString()}static encodeToBuffer(...tn){let to=tn.reduce((tn,to)=>th.Buffer.concat([tn,to]),th.Buffer.from(""));return tg("sha256").update(to).digest()}};let He=class He{static sign(tn,to){let ta=new ty.ec("p256").keyFromPrivate(tn,"hex").sign(to);return th.Buffer.from(ta.r.toString("hex",64)+ta.s.toString("hex",64),"hex")}static signData(tn,...to){return this.sign(tn,We.encodeToBuffer(...to))}static verify(tn,to,ta){let tu=new ty.ec("p256").keyFromPublic(tn,"hex"),tc={r:to.slice(0,32).toString("hex"),s:to.slice(32).toString("hex")};return tu.verify(ta,tc)}static verifyData(tn,to,...ta){return this.verify(tn,to,We.encodeToBuffer(...ta))}static sha256Digest(...tn){return We.encodeToBuffer(...tn)}};let Je=class Je{static fromString(tn){let to=th.Buffer.from(tn,"utf-8").toString("base64");return this.convertToURI(to)}static fromHex(tn){return this.encode(tn)}static fromUrlFormat(tn){return this.convertFromURI(tn)}static toUrlFormat(tn){return this.convertToURI(tn)}static toHex(tn){return this.decode(tn)}static toString(tn){let to=tn;return to.endsWith("=")||(to=this.convertFromURI(to)),th.Buffer.from(to,"base64").toString("utf-8")}static decode(tn){let to=tn;return to.endsWith("=")||(to=this.convertFromURI(to)),th.Buffer.from(to,"base64").toString("hex")}static encode(tn){let to=th.Buffer.from(tn,"hex").toString("base64");return this.convertToURI(to)}static convertToURI(tn){return tn.replace(/[+/]/g,tn=>"+"==tn?"-":"_").replace(/=+$/m,"")}static convertFromURI(tn){return tn.replace(/[-_]/g,tn=>"-"==tn?"+":"/")+"="}};var tZ="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function Ge(){throw Error("setTimeout has not been defined")}function Ze(){throw Error("clearTimeout has not been defined")}var tQ=Ge,t$=Ze;function ti(tn){if(tQ===setTimeout)return setTimeout(tn,0);if((tQ===Ge||!tQ)&&setTimeout)return tQ=setTimeout,setTimeout(tn,0);try{return tQ(tn,0)}catch(to){try{return tQ.call(null,tn,0)}catch(to){return tQ.call(this,tn,0)}}}"function"==typeof tZ.setTimeout&&(tQ=setTimeout),"function"==typeof tZ.clearTimeout&&(t$=clearTimeout);var t0,t1,t2,t5,t3,t6,t8,t4,t7=[],t9=!1,ei=-1;function oi(){t9&&t4&&(t9=!1,t4.length?t7=t4.concat(t7):ei=-1,t7.length&&si())}function si(){if(!t9){var tn=ti(oi);t9=!0;for(var to=t7.length;to;){for(t4=t7,t7=[];++ei<to;)t4&&t4[ei].run();ei=-1,to=t7.length}t4=null,t9=!1,function(tn){if(t$===clearTimeout)return clearTimeout(tn);if((t$===Ze||!t$)&&clearTimeout)return t$=clearTimeout,clearTimeout(tn);try{t$(tn)}catch(to){try{return t$.call(null,tn)}catch(to){return t$.call(this,tn)}}}(tn)}}function ai(tn){var to=Array(arguments.length-1);if(arguments.length>1)for(var ta=1;ta<arguments.length;ta++)to[ta-1]=arguments[ta];t7.push(new li(tn,to)),1!==t7.length||t9||ti(si)}function li(tn,to){this.fun=tn,this.array=to}li.prototype.run=function(){this.fun.apply(null,this.array)};var en,eo=tZ.performance||{},ea=(eo.now||eo.mozNow||eo.msNow||eo.oNow||eo.webkitNow,{env:{}}),eu={exports:{}},ec={},eh={},Di=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var tn={},to=Symbol("test"),ta=Object(to);if("string"==typeof to||"[object Symbol]"!==Object.prototype.toString.call(to)||"[object Symbol]"!==Object.prototype.toString.call(ta))return!1;for(to in tn[to]=42,tn)return!1;if("function"==typeof Object.keys&&0!==Object.keys(tn).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(tn).length)return!1;var tu=Object.getOwnPropertySymbols(tn);if(1!==tu.length||tu[0]!==to||!Object.prototype.propertyIsEnumerable.call(tn,to))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var tc=Object.getOwnPropertyDescriptor(tn,to);if(42!==tc.value||!0!==tc.enumerable)return!1}return!0},Ai=function(){return Di()&&!!Symbol.toStringTag},ed="undefined"!=typeof Symbol&&Symbol,ef={foo:{}},ep=Object,ey=Array.prototype.slice,eg=Object.prototype.toString,ev=Function.prototype.bind||function(tn){var to=this;if("function"!=typeof to||"[object Function]"!==eg.call(to))throw TypeError("Function.prototype.bind called on incompatible "+to);for(var ta,tu=ey.call(arguments,1),tc=Math.max(0,to.length-tu.length),th=[],td=0;td<tc;td++)th.push("$"+td);if(ta=Function("binder","return function ("+th.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof ta){var tc=to.apply(this,tu.concat(ey.call(arguments)));return Object(tc)===tc?tc:this}return to.apply(tn,tu.concat(ey.call(arguments)))}),to.prototype){var a=function(){};a.prototype=to.prototype,ta.prototype=new a,a.prototype=null}return ta},em={}.hasOwnProperty,ew=Function.prototype.call,eS=ew.bind?ew.bind(em):function(tn,to){return ew.call(em,tn,to)},eb=SyntaxError,eE=Function,eI=TypeError,Bi=function(tn){try{return eE('"use strict"; return ('+tn+").constructor;")()}catch(tn){}},e_=Object.getOwnPropertyDescriptor,qi=function(){throw new eI},eD=e_?function(){try{return qi}catch(tn){try{return e_(arguments,"callee").get}catch(tn){return qi}}}():qi,eA="function"==typeof ed&&"function"==typeof Symbol&&"symbol"==typeof ed("foo")&&"symbol"==typeof Symbol("bar")&&Di(),eT={__proto__:ef}.foo===ef.foo&&!(({__proto__:null})instanceof ep),ex=Object.getPrototypeOf||(eT?function(tn){return tn.__proto__}:null),eO={},eP="undefined"!=typeof Uint8Array&&ex?ex(Uint8Array):en,eR={"%AggregateError%":"undefined"==typeof AggregateError?en:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?en:ArrayBuffer,"%ArrayIteratorPrototype%":eA&&ex?ex([][Symbol.iterator]()):en,"%AsyncFromSyncIteratorPrototype%":en,"%AsyncFunction%":eO,"%AsyncGenerator%":eO,"%AsyncGeneratorFunction%":eO,"%AsyncIteratorPrototype%":eO,"%Atomics%":"undefined"==typeof Atomics?en:Atomics,"%BigInt%":"undefined"==typeof BigInt?en:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?en:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?en:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?en:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?en:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?en:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?en:FinalizationRegistry,"%Function%":eE,"%GeneratorFunction%":eO,"%Int8Array%":"undefined"==typeof Int8Array?en:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?en:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?en:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":eA&&ex?ex(ex([][Symbol.iterator]())):en,"%JSON%":"object"==typeof JSON?JSON:en,"%Map%":"undefined"==typeof Map?en:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&eA&&ex?ex((new Map)[Symbol.iterator]()):en,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?en:Promise,"%Proxy%":"undefined"==typeof Proxy?en:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?en:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?en:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&eA&&ex?ex((new Set)[Symbol.iterator]()):en,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?en:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":eA&&ex?ex(""[Symbol.iterator]()):en,"%Symbol%":eA?Symbol:en,"%SyntaxError%":eb,"%ThrowTypeError%":eD,"%TypedArray%":eP,"%TypeError%":eI,"%Uint8Array%":"undefined"==typeof Uint8Array?en:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?en:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?en:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?en:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?en:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?en:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?en:WeakSet},Qi=function t(tn){var to;if("%AsyncFunction%"===tn)to=Bi("async function () {}");else if("%GeneratorFunction%"===tn)to=Bi("function* () {}");else if("%AsyncGeneratorFunction%"===tn)to=Bi("async function* () {}");else if("%AsyncGenerator%"===tn){var ta=t("%AsyncGeneratorFunction%");ta&&(to=ta.prototype)}else if("%AsyncIteratorPrototype%"===tn){var tu=t("%AsyncGenerator%");tu&&ex&&(to=ex(tu.prototype))}return eR[tn]=to,to},ek={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},eN=ev.call(Function.call,Array.prototype.concat),eF=ev.call(Function.apply,Array.prototype.splice),eC=ev.call(Function.call,String.prototype.replace),eL=ev.call(Function.call,String.prototype.slice),ej=ev.call(Function.call,RegExp.prototype.exec),eM=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,eK=/\\(\\)?/g,ur=function(tn,to){var ta,tu=tn;if(eS(ek,tu)&&(tu="%"+(ta=ek[tu])[0]+"%"),eS(eR,tu)){var tc=eR[tu];if(tc===eO&&(tc=Qi(tu)),void 0===tc&&!to)throw new eI("intrinsic "+tn+" exists, but is not available. Please file an issue!");return{alias:ta,name:tu,value:tc}}throw new eb("intrinsic "+tn+" does not exist!")},cr=function(tn,to){if("string"!=typeof tn||0===tn.length)throw new eI("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof to)throw new eI('"allowMissing" argument must be a boolean');if(null===ej(/^%?[^%]*%?$/,tn))throw new eb("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ta=function(tn){var to=eL(tn,0,1),ta=eL(tn,-1);if("%"===to&&"%"!==ta)throw new eb("invalid intrinsic syntax, expected closing `%`");if("%"===ta&&"%"!==to)throw new eb("invalid intrinsic syntax, expected opening `%`");var tu=[];return eC(tn,eM,function(tn,to,ta,tc){tu[tu.length]=ta?eC(tc,eK,"$1"):to||tn}),tu}(tn),tu=ta.length>0?ta[0]:"",tc=ur("%"+tu+"%",to),th=tc.name,td=tc.value,tf=!1,tp=tc.alias;tp&&(tu=tp[0],eF(ta,eN([0,1],tp)));for(var ty=1,tg=!0;ty<ta.length;ty+=1){var tv=ta[ty],tm=eL(tv,0,1),tw=eL(tv,-1);if(('"'===tm||"'"===tm||"`"===tm||'"'===tw||"'"===tw||"`"===tw)&&tm!==tw)throw new eb("property names with quotes must have matching quotes");if("constructor"!==tv&&tg||(tf=!0),eS(eR,th="%"+(tu+="."+tv)+"%"))td=eR[th];else if(null!=td){if(!(tv in td)){if(!to)throw new eI("base intrinsic for "+tn+" exists, but the property is not available.");return}if(e_&&ty+1>=ta.length){var tS=e_(td,tv);td=(tg=!!tS)&&"get"in tS&&!("originalValue"in tS.get)?tS.get:td[tv]}else tg=eS(td,tv),td=td[tv];tg&&!tf&&(eR[th]=td)}}return td},eB={exports:{}};!function(tn){var to=cr("%Function.prototype.apply%"),ta=cr("%Function.prototype.call%"),tu=cr("%Reflect.apply%",!0)||ev.call(ta,to),tc=cr("%Object.getOwnPropertyDescriptor%",!0),th=cr("%Object.defineProperty%",!0),td=cr("%Math.max%");if(th)try{th({},"a",{value:1})}catch(tn){th=null}tn.exports=function(tn){var to=tu(ev,ta,arguments);return tc&&th&&tc(to,"length").configurable&&th(to,"length",{value:1+td(0,tn.length-(arguments.length-1))}),to};var u=function(){return tu(ev,to,arguments)};th?th(tn.exports,"apply",{value:u}):tn.exports.apply=u}(eB);var eU=eB.exports,eq=eU(cr("String.prototype.indexOf")),yr=function(tn,to){var ta=cr(tn,!!to);return"function"==typeof ta&&eq(tn,".prototype.")>-1?eU(ta):ta},ez=Ai(),eV=yr("Object.prototype.toString"),mr=function(tn){return!(ez&&tn&&"object"==typeof tn&&Symbol.toStringTag in tn)&&"[object Arguments]"===eV(tn)},wr=function(tn){return!!mr(tn)||null!==tn&&"object"==typeof tn&&"number"==typeof tn.length&&tn.length>=0&&"[object Array]"!==eV(tn)&&"[object Function]"===eV(tn.callee)},eJ=function(){return mr(arguments)}();mr.isLegacyArguments=wr;var eW,eY,eH,eX=eJ?mr:wr,eG=Object.prototype.toString,eZ=Function.prototype.toString,eQ=/^\s*(?:function)?\*/,e$=Ai(),e0=Object.getPrototypeOf,xr=function(tn){if("function"!=typeof tn)return!1;if(eQ.test(eZ.call(tn)))return!0;if(!e$)return"[object GeneratorFunction]"===eG.call(tn);if(!e0)return!1;if(void 0===eW){var to=function(){if(!e$)return!1;try{return Function("return function*() {}")()}catch(tn){}}();eW=!!to&&e0(to)}return e0(tn)===eW},e1=Function.prototype.toString,e2="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof e2&&"function"==typeof Object.defineProperty)try{eY=Object.defineProperty({},"length",{get:function(){throw eH}}),eH={},e2(function(){throw 42},null,eY)}catch(tn){tn!==eH&&(e2=null)}else e2=null;var e5=/^\s*class\b/,Cr=function(tn){try{var to=e1.call(tn);return e5.test(to)}catch(tn){return!1}},Fr=function(tn){try{return!Cr(tn)&&(e1.call(tn),!0)}catch(tn){return!1}},e3=Object.prototype.toString,e6="function"==typeof Symbol&&!!Symbol.toStringTag,e8=!(0 in[,]),Kr=function(){return!1};if("object"==typeof document){var e4=document.all;e3.call(e4)===e3.call(document.all)&&(Kr=function(tn){if((e8||!tn)&&(void 0===tn||"object"==typeof tn))try{var to=e3.call(tn);return("[object HTMLAllCollection]"===to||"[object HTML document.all class]"===to||"[object HTMLCollection]"===to||"[object Object]"===to)&&null==tn("")}catch(tn){}return!1})}var e7=e2?function(tn){if(Kr(tn))return!0;if(!tn||"function"!=typeof tn&&"object"!=typeof tn)return!1;try{e2(tn,null,eY)}catch(tn){if(tn!==eH)return!1}return!Cr(tn)&&Fr(tn)}:function(tn){if(Kr(tn))return!0;if(!tn||"function"!=typeof tn&&"object"!=typeof tn)return!1;if(e6)return Fr(tn);if(Cr(tn))return!1;var to=e3.call(tn);return!("[object Function]"!==to&&"[object GeneratorFunction]"!==to&&!/^\[object HTML/.test(to))&&Fr(tn)},e9=Object.prototype.toString,ii=Object.prototype.hasOwnProperty,ir=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],is="undefined"==typeof globalThis?tL:globalThis,ia=cr("%Object.getOwnPropertyDescriptor%",!0);if(ia)try{ia([],"length")}catch(tn){ia=null}var iu=ia,Xr=function(tn,to,ta){var tu;if(!e7(to))throw TypeError("iterator must be a function");arguments.length>=3&&(tu=ta),"[object Array]"===e9.call(tn)?function(tn,to,ta){for(var tu=0,tc=tn.length;tu<tc;tu++)ii.call(tn,tu)&&(null==ta?to(tn[tu],tu,tn):to.call(ta,tn[tu],tu,tn))}(tn,to,tu):"string"==typeof tn?function(tn,to,ta){for(var tu=0,tc=tn.length;tu<tc;tu++)null==ta?to(tn.charAt(tu),tu,tn):to.call(ta,tn.charAt(tu),tu,tn)}(tn,to,tu):function(tn,to,ta){for(var tu in tn)ii.call(tn,tu)&&(null==ta?to(tn[tu],tu,tn):to.call(ta,tn[tu],tu,tn))}(tn,to,tu)},ic=eB.exports,ih=yr("Object.prototype.toString"),id=Ai(),ip="undefined"==typeof globalThis?tL:globalThis,iy=function(){for(var tn=[],to=0;to<ir.length;to++)"function"==typeof is[ir[to]]&&(tn[tn.length]=ir[to]);return tn}(),ig=yr("String.prototype.slice"),iv=Object.getPrototypeOf,im=yr("Array.prototype.indexOf",!0)||function(tn,to){for(var ta=0;ta<tn.length;ta+=1)if(tn[ta]===to)return ta;return -1},iw={__proto__:null};Xr(iy,id&&iu&&iv?function(tn){var to=new ip[tn];if(Symbol.toStringTag in to){var ta=iv(to),tu=iu(ta,Symbol.toStringTag);tu||(tu=iu(iv(ta),Symbol.toStringTag)),iw["$"+tn]=ic(tu.get)}}:function(tn){var to=new ip[tn];iw["$"+tn]=ic(to.slice)});var un=function(tn){if(!tn||"object"!=typeof tn)return!1;if(!id){var to,ta,tu=ig(ih(tn),8,-1);return im(iy,tu)>-1?tu:"Object"===tu&&(ta=!1,Xr(iw,function(to,tu){if(!ta)try{to(tn),ta=ig(tu,1)}catch(tn){}}),ta)}return iu?(to=!1,Xr(iw,function(ta,tu){if(!to)try{"$"+ta(tn)===tu&&(to=ig(tu,1))}catch(tn){}}),to):null},hn=function(tn){return!!un(tn)};!function(tn){function o(tn){return tn.call.bind(tn)}var to="undefined"!=typeof BigInt,ta="undefined"!=typeof Symbol,tu=o(Object.prototype.toString),tc=o(Number.prototype.valueOf),th=o(String.prototype.valueOf),td=o(Boolean.prototype.valueOf);if(to)var tf=o(BigInt.prototype.valueOf);if(ta)var tp=o(Symbol.prototype.valueOf);function p(tn,to){if("object"!=typeof tn)return!1;try{return to(tn),!0}catch(tn){return!1}}function y(tn){return"[object Map]"===tu(tn)}function g(tn){return"[object Set]"===tu(tn)}function v(tn){return"[object WeakMap]"===tu(tn)}function m(tn){return"[object WeakSet]"===tu(tn)}function w(tn){return"[object ArrayBuffer]"===tu(tn)}function S(tn){return"undefined"!=typeof ArrayBuffer&&(w.working?w(tn):tn instanceof ArrayBuffer)}function b(tn){return"[object DataView]"===tu(tn)}function E(tn){return"undefined"!=typeof DataView&&(b.working?b(tn):tn instanceof DataView)}tn.isArgumentsObject=eX,tn.isGeneratorFunction=xr,tn.isTypedArray=hn,tn.isPromise=function(tn){return"undefined"!=typeof Promise&&tn instanceof Promise||null!==tn&&"object"==typeof tn&&"function"==typeof tn.then&&"function"==typeof tn.catch},tn.isArrayBufferView=function(tn){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(tn):hn(tn)||E(tn)},tn.isUint8Array=function(tn){return"Uint8Array"===un(tn)},tn.isUint8ClampedArray=function(tn){return"Uint8ClampedArray"===un(tn)},tn.isUint16Array=function(tn){return"Uint16Array"===un(tn)},tn.isUint32Array=function(tn){return"Uint32Array"===un(tn)},tn.isInt8Array=function(tn){return"Int8Array"===un(tn)},tn.isInt16Array=function(tn){return"Int16Array"===un(tn)},tn.isInt32Array=function(tn){return"Int32Array"===un(tn)},tn.isFloat32Array=function(tn){return"Float32Array"===un(tn)},tn.isFloat64Array=function(tn){return"Float64Array"===un(tn)},tn.isBigInt64Array=function(tn){return"BigInt64Array"===un(tn)},tn.isBigUint64Array=function(tn){return"BigUint64Array"===un(tn)},y.working="undefined"!=typeof Map&&y(new Map),tn.isMap=function(tn){return"undefined"!=typeof Map&&(y.working?y(tn):tn instanceof Map)},g.working="undefined"!=typeof Set&&g(new Set),tn.isSet=function(tn){return"undefined"!=typeof Set&&(g.working?g(tn):tn instanceof Set)},v.working="undefined"!=typeof WeakMap&&v(new WeakMap),tn.isWeakMap=function(tn){return"undefined"!=typeof WeakMap&&(v.working?v(tn):tn instanceof WeakMap)},m.working="undefined"!=typeof WeakSet&&m(new WeakSet),tn.isWeakSet=function(tn){return m(tn)},w.working="undefined"!=typeof ArrayBuffer&&w(new ArrayBuffer),tn.isArrayBuffer=S,b.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&b(new DataView(new ArrayBuffer(1),0,1)),tn.isDataView=E;var ty="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function _(tn){return"[object SharedArrayBuffer]"===tu(tn)}function D(tn){return void 0!==ty&&(void 0===_.working&&(_.working=_(new ty)),_.working?_(tn):tn instanceof ty)}function T(tn){return p(tn,tc)}function A(tn){return p(tn,th)}function O(tn){return p(tn,td)}function P(tn){return to&&p(tn,tf)}function x(tn){return ta&&p(tn,tp)}tn.isSharedArrayBuffer=D,tn.isAsyncFunction=function(tn){return"[object AsyncFunction]"===tu(tn)},tn.isMapIterator=function(tn){return"[object Map Iterator]"===tu(tn)},tn.isSetIterator=function(tn){return"[object Set Iterator]"===tu(tn)},tn.isGeneratorObject=function(tn){return"[object Generator]"===tu(tn)},tn.isWebAssemblyCompiledModule=function(tn){return"[object WebAssembly.Module]"===tu(tn)},tn.isNumberObject=T,tn.isStringObject=A,tn.isBooleanObject=O,tn.isBigIntObject=P,tn.isSymbolObject=x,tn.isBoxedPrimitive=function(tn){return T(tn)||A(tn)||O(tn)||P(tn)||x(tn)},tn.isAnyArrayBuffer=function(tn){return"undefined"!=typeof Uint8Array&&(S(tn)||D(tn))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(to){Object.defineProperty(tn,to,{enumerable:!1,value:function(){throw Error(to+" is not supported in userland")}})})}(eh);var dn=function(tn){return tn&&"object"==typeof tn&&"function"==typeof tn.copy&&"function"==typeof tn.fill&&"function"==typeof tn.readUInt8},iS={exports:{}};"function"==typeof Object.create?iS.exports=function(tn,to){to&&(tn.super_=to,tn.prototype=Object.create(to.prototype,{constructor:{value:tn,enumerable:!1,writable:!0,configurable:!0}}))}:iS.exports=function(tn,to){if(to){tn.super_=to;var i=function(){};i.prototype=to.prototype,tn.prototype=new i,tn.prototype.constructor=tn}};var ib={};function yn(tn){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(tn){return typeof tn}:function(tn){return tn&&"function"==typeof Symbol&&tn.constructor===Symbol&&tn!==Symbol.prototype?"symbol":typeof tn})(tn)}function vn(tn){return(vn=Object.setPrototypeOf?Object.getPrototypeOf:function(tn){return tn.__proto__||Object.getPrototypeOf(tn)})(tn)}function mn(tn,to){return(mn=Object.setPrototypeOf||function(tn,to){return tn.__proto__=to,tn})(tn,to)}!function(tn){var to=Object.getOwnPropertyDescriptors||function(tn){for(var to=Object.keys(tn),ta={},tu=0;tu<to.length;tu++)ta[to[tu]]=Object.getOwnPropertyDescriptor(tn,to[tu]);return ta},ta=/%[sdj%]/g;tn.format=function(tn){if(!g(tn)){for(var to=[],tu=0;tu<arguments.length;tu++)to.push(s(arguments[tu]));return to.join(" ")}tu=1;for(var tc=arguments,th=tc.length,td=String(tn).replace(ta,function(tn){if("%%"===tn)return"%";if(tu>=th)return tn;switch(tn){case"%s":return String(tc[tu++]);case"%d":return Number(tc[tu++]);case"%j":try{return JSON.stringify(tc[tu++])}catch(tn){return"[Circular]"}default:return tn}}),tf=tc[tu];tu<th;tf=tc[++tu])p(tf)||!w(tf)?td+=" "+tf:td+=" "+s(tf);return td},tn.deprecate=function(to,ta){if(void 0!==ea&&!0===ea.noDeprecation)return to;if(void 0===ea)return function(){return tn.deprecate(to,ta).apply(this,arguments)};var tu=!1;return function(){return tu||(console.error(ta),tu=!0),to.apply(this,arguments)}};var tu={},tc=/^$/;if(ea.env.NODE_DEBUG){var th=ea.env.NODE_DEBUG;tc=RegExp("^"+(th=th.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase())+"$","i")}function s(to,ta){var tu={seen:[],stylize:l};return arguments.length>=3&&(tu.depth=arguments[2]),arguments.length>=4&&(tu.colors=arguments[3]),f(ta)?tu.showHidden=ta:ta&&tn._extend(tu,ta),v(tu.showHidden)&&(tu.showHidden=!1),v(tu.depth)&&(tu.depth=2),v(tu.colors)&&(tu.colors=!1),v(tu.customInspect)&&(tu.customInspect=!0),tu.colors&&(tu.stylize=a),u(tu,to,tu.depth)}function a(tn,to){var ta=s.styles[to];return ta?"\x1b["+s.colors[ta][0]+"m"+tn+"\x1b["+s.colors[ta][1]+"m":tn}function l(tn,to){return tn}function u(to,ta,tu){if(to.customInspect&&ta&&E(ta.inspect)&&ta.inspect!==tn.inspect&&(!ta.constructor||ta.constructor.prototype!==ta)){var tc,th,td=ta.inspect(tu,to);return g(td)||(td=u(to,td,tu)),td}var tf=function(tn,to){if(v(to))return tn.stylize("undefined","undefined");if(g(to)){var ta="'"+JSON.stringify(to).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return tn.stylize(ta,"string")}return y(to)?tn.stylize(""+to,"number"):f(to)?tn.stylize(""+to,"boolean"):p(to)?tn.stylize("null","null"):void 0}(to,ta);if(tf)return tf;var tp=Object.keys(ta),ty=(tv={},tp.forEach(function(tn,to){tv[tn]=!0}),tv);if(to.showHidden&&(tp=Object.getOwnPropertyNames(ta)),b(ta)&&(tp.indexOf("message")>=0||tp.indexOf("description")>=0))return c(ta);if(0===tp.length){if(E(ta)){var tg=ta.name?": "+ta.name:"";return to.stylize("[Function"+tg+"]","special")}if(m(ta))return to.stylize(RegExp.prototype.toString.call(ta),"regexp");if(S(ta))return to.stylize(Date.prototype.toString.call(ta),"date");if(b(ta))return c(ta)}var tv,tm,tw="",tS=!1,tb=["{","}"];return d(ta)&&(tS=!0,tb=["[","]"]),E(ta)&&(tw=" [Function"+(ta.name?": "+ta.name:"")+"]"),m(ta)&&(tw=" "+RegExp.prototype.toString.call(ta)),S(ta)&&(tw=" "+Date.prototype.toUTCString.call(ta)),b(ta)&&(tw=" "+c(ta)),0!==tp.length||tS&&0!=ta.length?tu<0?m(ta)?to.stylize(RegExp.prototype.toString.call(ta),"regexp"):to.stylize("[Object]","special"):(to.seen.push(ta),tm=tS?function(tn,to,ta,tu,tc){for(var th=[],td=0,tf=to.length;td<tf;++td)T(to,String(td))?th.push(h(tn,to,ta,tu,String(td),!0)):th.push("");return tc.forEach(function(tc){tc.match(/^\d+$/)||th.push(h(tn,to,ta,tu,tc,!0))}),th}(to,ta,tu,ty,tp):tp.map(function(tn){return h(to,ta,tu,ty,tn,tS)}),to.seen.pop(),tc=tw,th=tb,tm.reduce(function(tn,to){return to.indexOf("\n"),tn+to.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?th[0]+(""===tc?"":tc+"\n ")+" "+tm.join(",\n  ")+" "+th[1]:th[0]+tc+" "+tm.join(", ")+" "+th[1]):tb[0]+tw+tb[1]}function c(tn){return"["+Error.prototype.toString.call(tn)+"]"}function h(tn,to,ta,tu,tc,th){var td,tf,tp;if((tp=Object.getOwnPropertyDescriptor(to,tc)||{value:to[tc]}).get?tf=tp.set?tn.stylize("[Getter/Setter]","special"):tn.stylize("[Getter]","special"):tp.set&&(tf=tn.stylize("[Setter]","special")),T(tu,tc)||(td="["+tc+"]"),tf||(0>tn.seen.indexOf(tp.value)?(tf=p(ta)?u(tn,tp.value,null):u(tn,tp.value,ta-1)).indexOf("\n")>-1&&(tf=th?tf.split("\n").map(function(tn){return"  "+tn}).join("\n").substr(2):"\n"+tf.split("\n").map(function(tn){return"   "+tn}).join("\n")):tf=tn.stylize("[Circular]","special")),v(td)){if(th&&tc.match(/^\d+$/))return tf;(td=JSON.stringify(""+tc)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(td=td.substr(1,td.length-2),td=tn.stylize(td,"name")):(td=td.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),td=tn.stylize(td,"string"))}return td+": "+tf}function d(tn){return Array.isArray(tn)}function f(tn){return"boolean"==typeof tn}function p(tn){return null===tn}function y(tn){return"number"==typeof tn}function g(tn){return"string"==typeof tn}function v(tn){return void 0===tn}function m(tn){return w(tn)&&"[object RegExp]"===I(tn)}function w(tn){return"object"==typeof tn&&null!==tn}function S(tn){return w(tn)&&"[object Date]"===I(tn)}function b(tn){return w(tn)&&("[object Error]"===I(tn)||tn instanceof Error)}function E(tn){return"function"==typeof tn}function I(tn){return Object.prototype.toString.call(tn)}function _(tn){return tn<10?"0"+tn.toString(10):tn.toString(10)}tn.debuglog=function(to){if(!tu[to=to.toUpperCase()]){if(tc.test(to)){var ta=ea.pid;tu[to]=function(){var tu=tn.format.apply(tn,arguments);console.error("%s %d: %s",to,ta,tu)}}else tu[to]=function(){}}return tu[to]},tn.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},tn.types=eh,tn.isArray=d,tn.isBoolean=f,tn.isNull=p,tn.isNullOrUndefined=function(tn){return null==tn},tn.isNumber=y,tn.isString=g,tn.isSymbol=function(tn){return"symbol"==typeof tn},tn.isUndefined=v,tn.isRegExp=m,tn.types.isRegExp=m,tn.isObject=w,tn.isDate=S,tn.types.isDate=S,tn.isError=b,tn.types.isNativeError=b,tn.isFunction=E,tn.isPrimitive=function(tn){return null===tn||"boolean"==typeof tn||"number"==typeof tn||"string"==typeof tn||"symbol"==typeof tn||void 0===tn},tn.isBuffer=dn;var td=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(tn,to){return Object.prototype.hasOwnProperty.call(tn,to)}tn.log=function(){var to,ta;console.log("%s - %s",(ta=[_((to=new Date).getHours()),_(to.getMinutes()),_(to.getSeconds())].join(":"),[to.getDate(),td[to.getMonth()],ta].join(" ")),tn.format.apply(tn,arguments))},tn.inherits=iS.exports,tn._extend=function(tn,to){if(!to||!w(to))return tn;for(var ta=Object.keys(to),tu=ta.length;tu--;)tn[ta[tu]]=to[ta[tu]];return tn};var tf="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(tn,to){if(!tn){var ta=Error("Promise was rejected with a falsy value");ta.reason=tn,tn=ta}return to(tn)}tn.promisify=function(tn){if("function"!=typeof tn)throw TypeError('The "original" argument must be of type Function');if(tf&&tn[tf]){var i;if("function"!=typeof(i=tn[tf]))throw TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(i,tf,{value:i,enumerable:!1,writable:!1,configurable:!0}),i}function i(){for(var to,ta,tu=new Promise(function(tn,tu){to=tn,ta=tu}),tc=[],th=0;th<arguments.length;th++)tc.push(arguments[th]);tc.push(function(tn,tu){tn?ta(tn):to(tu)});try{tn.apply(this,tc)}catch(tn){ta(tn)}return tu}return Object.setPrototypeOf(i,Object.getPrototypeOf(tn)),tf&&Object.defineProperty(i,tf,{value:i,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(i,to(tn))},tn.promisify.custom=tf,tn.callbackify=function(tn){if("function"!=typeof tn)throw TypeError('The "original" argument must be of type Function');function i(){for(var to=[],ta=0;ta<arguments.length;ta++)to.push(arguments[ta]);var tu=to.pop();if("function"!=typeof tu)throw TypeError("The last argument must be of type Function");var tc=this,o=function(){return tu.apply(tc,arguments)};tn.apply(this,to).then(function(tn){ai(o.bind(null,null,tn))},function(tn){ai(O.bind(null,tn,o))})}return Object.setPrototypeOf(i,Object.getPrototypeOf(tn)),Object.defineProperties(i,to(tn)),i}}(ib);var iE,iI,i_={};function En(tn,to,ta){ta||(ta=Error);var tu=function(ta){function r(ta,tu,tc){var th,td;return function(tn,to){if(!(tn instanceof to))throw TypeError("Cannot call a class as a function")}(this,r),(th=(td=vn(r).call(this,"string"==typeof to?to:to(ta,tu,tc)))&&("object"===yn(td)||"function"==typeof td)?td:function(tn){if(void 0===tn)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return tn}(this)).code=tn,th}return function(tn,to){if("function"!=typeof to&&null!==to)throw TypeError("Super expression must either be null or a function");tn.prototype=Object.create(to&&to.prototype,{constructor:{value:tn,writable:!0,configurable:!0}}),to&&mn(tn,to)}(r,ta),r}(ta);i_[tn]=tu}function In(tn,to){if(Array.isArray(tn)){var ta=tn.length;return tn=tn.map(function(tn){return String(tn)}),ta>2?"one of ".concat(to," ").concat(tn.slice(0,ta-1).join(", "),", or ")+tn[ta-1]:2===ta?"one of ".concat(to," ").concat(tn[0]," or ").concat(tn[1]):"of ".concat(to," ").concat(tn[0])}return"of ".concat(to," ").concat(String(tn))}function Dn(tn,to){for(var ta=0;ta<to.length;ta++){var tu=to[ta];tu.enumerable=tu.enumerable||!1,tu.configurable=!0,"value"in tu&&(tu.writable=!0),Object.defineProperty(tn,tu.key,tu)}}function Tn(tn,to){return to&&("object"===kn(to)||"function"==typeof to)?to:An(tn)}function An(tn){if(void 0===tn)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return tn}function On(tn){var to="function"==typeof Map?new Map:void 0;return(On=function(tn){if(null===tn||-1===Function.toString.call(tn).indexOf("[native code]"))return tn;if("function"!=typeof tn)throw TypeError("Super expression must either be null or a function");if(void 0!==to){if(to.has(tn))return to.get(tn);to.set(tn,r)}function r(){return Pn(tn,arguments,Rn(this).constructor)}return r.prototype=Object.create(tn.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),xn(r,tn)})(tn)}function Pn(tn,to,ta){return(Pn=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(tn){return!1}}()?function(tn,to,ta){var tu=[null];tu.push.apply(tu,to);var tc=new(Function.bind.apply(tn,tu));return ta&&xn(tc,ta.prototype),tc}:Reflect.construct).apply(null,arguments)}function xn(tn,to){return(xn=Object.setPrototypeOf||function(tn,to){return tn.__proto__=to,tn})(tn,to)}function Rn(tn){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf:function(tn){return tn.__proto__||Object.getPrototypeOf(tn)})(tn)}function kn(tn){return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(tn){return typeof tn}:function(tn){return tn&&"function"==typeof Symbol&&tn.constructor===Symbol&&tn!==Symbol.prototype?"symbol":typeof tn})(tn)}En("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError),En("ERR_INVALID_ARG_TYPE",function(tn,to,ta){if(void 0===iE&&(iE=null),iE("string"==typeof tn,"'name' must be a string"),"string"==typeof to&&(tc="not ",to.substr(!th||th<0?0:+th,tc.length)===tc)?(tu="must not be",to=to.replace(/^not /,"")):tu="must be",tf=" argument",(void 0===tp||tp>tn.length)&&(tp=tn.length),tn.substring(tp-tf.length,tp)===tf)td="The ".concat(tn," ").concat(tu," ").concat(In(to,"type"));else{var tu,tc,th,td,tf,tp,ty,tg=("number"!=typeof ty&&(ty=0),ty+1>tn.length||-1===tn.indexOf(".",ty))?"argument":"property";td='The "'.concat(tn,'" ').concat(tg," ").concat(tu," ").concat(In(to,"type"))}return td+". Received type ".concat(yn(ta))},TypeError),En("ERR_INVALID_ARG_VALUE",function(tn,to){var ta=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid";void 0===iI&&(iI=ib);var tu=iI.inspect(to);return tu.length>128&&(tu="".concat(tu.slice(0,128),"...")),"The argument '".concat(tn,"' ").concat(ta,". Received ").concat(tu)},TypeError),En("ERR_INVALID_RETURN_VALUE",function(tn,to,ta){var tu;return tu=ta&&ta.constructor&&ta.constructor.name?"instance of ".concat(ta.constructor.name):"type ".concat(yn(ta)),"Expected ".concat(tn,' to be returned from the "').concat(to,'"')+" function but got ".concat(tu,".")},TypeError),En("ERR_MISSING_ARGS",function(){for(var tn=arguments.length,to=Array(tn),ta=0;ta<tn;ta++)to[ta]=arguments[ta];void 0===iE&&(iE=null),iE(to.length>0,"At least one arg needs to be specified");var tu="The ",tc=to.length;switch(to=to.map(function(tn){return'"'.concat(tn,'"')}),tc){case 1:tu+="".concat(to[0]," argument");break;case 2:tu+="".concat(to[0]," and ").concat(to[1]," arguments");break;default:tu+=to.slice(0,tc-1).join(", ")+", and ".concat(to[tc-1]," arguments")}return"".concat(tu," must be specified")},TypeError),ec.codes=i_;var iD=ib.inspect,iA=ec.codes.ERR_INVALID_ARG_TYPE;function Fn(tn,to,ta){return(void 0===ta||ta>tn.length)&&(ta=tn.length),tn.substring(ta-to.length,ta)===to}var iT={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"};function Kn(tn){var to=Object.keys(tn),ta=Object.create(Object.getPrototypeOf(tn));return to.forEach(function(to){ta[to]=tn[to]}),Object.defineProperty(ta,"message",{value:tn.message}),ta}function Un(tn){return iD(tn,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}var ix,iO=function(tn){var to,ta;function e(tn){if(function(tn,to){if(!(tn instanceof to))throw TypeError("Cannot call a class as a function")}(this,e),"object"!==kn(tn)||null===tn)throw new iA("options","Object",tn);var to,ta=tn.message,tu=tn.operator,tc=tn.stackStartFn,th=tn.actual,td=tn.expected,tf=Error.stackTraceLimit;if(Error.stackTraceLimit=0,null!=ta)to=Tn(this,Rn(e).call(this,String(ta)));else if("object"===kn(th)&&null!==th&&"object"===kn(td)&&null!==td&&"stack"in th&&th instanceof Error&&"stack"in td&&td instanceof Error&&(th=Kn(th),td=Kn(td)),"deepStrictEqual"===tu||"strictEqual"===tu)to=Tn(this,Rn(e).call(this,function(tn,to,ta){var tu="",tc="",th=0,td="",tf=!1,tp=Un(tn),ty=tp.split("\n"),tg=Un(to).split("\n"),tv=0,tm="";if("strictEqual"===ta&&"object"===kn(tn)&&"object"===kn(to)&&null!==tn&&null!==to&&(ta="strictEqualObject"),1===ty.length&&1===tg.length&&ty[0]!==tg[0]){var tw=ty[0].length+tg[0].length;if(tw<=10){if(!("object"===kn(tn)&&null!==tn||"object"===kn(to)&&null!==to||0===tn&&0===to))return"".concat(iT[ta],"\n\n")+"".concat(ty[0]," !== ").concat(tg[0],"\n")}else if("strictEqualObject"!==ta&&tw<80){for(;ty[0][tv]===tg[0][tv];)tv++;tv>2&&(tm="\n  ".concat(function(tn,to){if(to=Math.floor(to),0==tn.length||0==to)return"";var ta=tn.length*to;for(to=Math.floor(Math.log(to)/Math.log(2));to;)tn+=tn,to--;return tn+tn.substring(0,ta-tn.length)}(" ",tv),"^"),tv=0)}}for(var tS=ty[ty.length-1],tb=tg[tg.length-1];tS===tb&&(tv++<2?td="\n  ".concat(tS).concat(td):tu=tS,ty.pop(),tg.pop(),0!==ty.length&&0!==tg.length);)tS=ty[ty.length-1],tb=tg[tg.length-1];var tE=Math.max(ty.length,tg.length);if(0===tE){var tI=tp.split("\n");if(tI.length>30)for(tI[26]="".concat("","...").concat("");tI.length>27;)tI.pop();return"".concat(iT.notIdentical,"\n\n").concat(tI.join("\n"),"\n")}tv>3&&(td="\n".concat("","...").concat("").concat(td),tf=!0),""!==tu&&(td="\n  ".concat(tu).concat(td),tu="");var t_=0,tD=iT[ta]+"\n".concat("","+ actual").concat(""," ").concat("","- expected").concat(""),tA=" ".concat("","...").concat(""," Lines skipped");for(tv=0;tv<tE;tv++){var tT=tv-th;if(ty.length<tv+1)tT>1&&tv>2&&(tT>4?(tc+="\n".concat("","...").concat(""),tf=!0):tT>3&&(tc+="\n  ".concat(tg[tv-2]),t_++),tc+="\n  ".concat(tg[tv-1]),t_++),th=tv,tu+="\n".concat("","-").concat(""," ").concat(tg[tv]),t_++;else if(tg.length<tv+1)tT>1&&tv>2&&(tT>4?(tc+="\n".concat("","...").concat(""),tf=!0):tT>3&&(tc+="\n  ".concat(ty[tv-2]),t_++),tc+="\n  ".concat(ty[tv-1]),t_++),th=tv,tc+="\n".concat("","+").concat(""," ").concat(ty[tv]),t_++;else{var tx=tg[tv],tO=ty[tv],tP=tO!==tx&&(!Fn(tO,",")||tO.slice(0,-1)!==tx);tP&&Fn(tx,",")&&tx.slice(0,-1)===tO&&(tP=!1,tO+=","),tP?(tT>1&&tv>2&&(tT>4?(tc+="\n".concat("","...").concat(""),tf=!0):tT>3&&(tc+="\n  ".concat(ty[tv-2]),t_++),tc+="\n  ".concat(ty[tv-1]),t_++),th=tv,tc+="\n".concat("","+").concat(""," ").concat(tO),tu+="\n".concat("","-").concat(""," ").concat(tx),t_+=2):(tc+=tu,tu="",1!==tT&&0!==tv||(tc+="\n  ".concat(tO),t_++))}if(t_>20&&tv<tE-2)return"".concat(tD).concat(tA,"\n").concat(tc,"\n").concat("","...").concat("").concat(tu,"\n")+"".concat("","...").concat("")}return"".concat(tD).concat(tf?tA:"","\n").concat(tc).concat(tu).concat(td).concat(tm)}(th,td,tu)));else if("notDeepStrictEqual"===tu||"notStrictEqual"===tu){var tp=iT[tu],ty=Un(th).split("\n");if("notStrictEqual"===tu&&"object"===kn(th)&&null!==th&&(tp=iT.notStrictEqualObject),ty.length>30)for(ty[26]="".concat("","...").concat("");ty.length>27;)ty.pop();to=1===ty.length?Tn(this,Rn(e).call(this,"".concat(tp," ").concat(ty[0]))):Tn(this,Rn(e).call(this,"".concat(tp,"\n\n").concat(ty.join("\n"),"\n")))}else{var tg=Un(th),tv="",tm=iT[tu];"notDeepEqual"===tu||"notEqual"===tu?(tg="".concat(iT[tu],"\n\n").concat(tg)).length>1024&&(tg="".concat(tg.slice(0,1021),"...")):(tv="".concat(Un(td)),tg.length>512&&(tg="".concat(tg.slice(0,509),"...")),tv.length>512&&(tv="".concat(tv.slice(0,509),"...")),"deepEqual"===tu||"equal"===tu?tg="".concat(tm,"\n\n").concat(tg,"\n\nshould equal\n\n"):tv=" ".concat(tu," ").concat(tv)),to=Tn(this,Rn(e).call(this,"".concat(tg).concat(tv)))}return Error.stackTraceLimit=tf,to.generatedMessage=!ta,Object.defineProperty(An(to),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),to.code="ERR_ASSERTION",to.actual=th,to.expected=td,to.operator=tu,Error.captureStackTrace&&Error.captureStackTrace(An(to),tc),to.name="AssertionError",Tn(to)}return function(tn,to){if("function"!=typeof to&&null!==to)throw TypeError("Super expression must either be null or a function");tn.prototype=Object.create(to&&to.prototype,{constructor:{value:tn,writable:!0,configurable:!0}}),to&&xn(tn,to)}(e,On(Error)),to=[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:iD.custom,value:function(tn,to){return iD(this,function(tn){for(var to=1;to<arguments.length;to++){var ta=null!=arguments[to]?arguments[to]:{},tu=Object.keys(ta);"function"==typeof Object.getOwnPropertySymbols&&(tu=tu.concat(Object.getOwnPropertySymbols(ta).filter(function(tn){return Object.getOwnPropertyDescriptor(ta,tn).enumerable}))),tu.forEach(function(to){var tu;tu=ta[to],to in tn?Object.defineProperty(tn,to,{value:tu,enumerable:!0,configurable:!0,writable:!0}):tn[to]=tu})}return tn}({},to,{customInspect:!1,depth:0}))}}],Dn(e.prototype,to),ta&&Dn(e,ta),e}(),iP=Object.prototype.toString,Jn=function(tn){var to=iP.call(tn),ta="[object Arguments]"===to;return ta||(ta="[object Array]"!==to&&null!==tn&&"object"==typeof tn&&"number"==typeof tn.length&&tn.length>=0&&"[object Function]"===iP.call(tn.callee)),ta};if(!Object.keys){var iR=Object.prototype.hasOwnProperty,ik=Object.prototype.toString,iN=Object.prototype.propertyIsEnumerable,iF=!iN.call({toString:null},"toString"),iC=iN.call(function(){},"prototype"),iL=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],io=function(tn){var to=tn.constructor;return to&&to.prototype===tn},ij={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},iM=function(){if("undefined"==typeof window)return!1;for(var tn in window)try{if(!ij["$"+tn]&&iR.call(window,tn)&&null!==window[tn]&&"object"==typeof window[tn])try{io(window[tn])}catch(tn){return!0}}catch(tn){return!0}return!1}();ix=function(tn){var to=null!==tn&&"object"==typeof tn,ta="[object Function]"===ik.call(tn),tu=Jn(tn),tc=to&&"[object String]"===ik.call(tn),th=[];if(!to&&!ta&&!tu)throw TypeError("Object.keys called on a non-object");var td=iC&&ta;if(tc&&tn.length>0&&!iR.call(tn,0))for(var tf=0;tf<tn.length;++tf)th.push(String(tf));if(tu&&tn.length>0)for(var tp=0;tp<tn.length;++tp)th.push(String(tp));else for(var ty in tn)td&&"prototype"===ty||!iR.call(tn,ty)||th.push(String(ty));if(iF)for(var tg=function(tn){if("undefined"==typeof window||!iM)return io(tn);try{return io(tn)}catch(tn){return!1}}(tn),tv=0;tv<iL.length;++tv)tg&&"constructor"===iL[tv]||!iR.call(tn,iL[tv])||th.push(iL[tv]);return th}}var iK=ix,iB=Array.prototype.slice,iU=Object.keys,iq=iU?function(tn){return iU(tn)}:iK,iz=Object.keys;iq.shim=function(){return Object.keys?function(){var tn=Object.keys(arguments);return tn&&tn.length===arguments.length}(1,2)||(Object.keys=function(tn){return Jn(tn)?iz(iB.call(tn)):iz(tn)}):Object.keys=iq,Object.keys||iq};var iV=cr("%Object.defineProperty%",!0),po=function(){if(iV)try{return iV({},"a",{value:1}),!0}catch(tn){}return!1};po.hasArrayLengthDefineBug=function(){if(!po())return null;try{return 1!==iV([],"length",{value:1}).length}catch(tn){return!0}};var iJ=po()&&cr("%Object.defineProperty%",!0),iW=cr("%SyntaxError%"),iY=cr("%TypeError%"),iH="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),iX=Object.prototype.toString,iG=Array.prototype.concat,To=function(tn,to,ta){if(!tn||"object"!=typeof tn&&"function"!=typeof tn)throw new iY("`obj` must be an object or a function`");if("string"!=typeof to&&"symbol"!=typeof to)throw new iY("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new iY("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new iY("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new iY("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new iY("`loose`, if provided, must be a boolean");var tu=arguments.length>3?arguments[3]:null,tc=arguments.length>4?arguments[4]:null,th=arguments.length>5?arguments[5]:null,td=arguments.length>6&&arguments[6],tf=!!iu&&iu(tn,to);if(iJ)iJ(tn,to,{configurable:null===th&&tf?tf.configurable:!th,enumerable:null===tu&&tf?tf.enumerable:!tu,value:ta,writable:null===tc&&tf?tf.writable:!tc});else{if(!td&&(tu||tc||th))throw new iW("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");tn[to]=ta}},iZ=po(),Oo=function(tn,to,ta,tu){if(to in tn){if(!0===tu){if(tn[to]===ta)return}else if("function"!=typeof tu||"[object Function]"!==iX.call(tu)||!tu())return}iZ?To(tn,to,ta,!0):To(tn,to,ta)},Po=function(tn,to){var ta=arguments.length>2?arguments[2]:{},tu=iq(to);iH&&(tu=iG.call(tu,Object.getOwnPropertySymbols(to)));for(var tc=0;tc<tu.length;tc+=1)Oo(tn,tu[tc],to[tu[tc]],ta[tu[tc]])};Po.supportsDescriptors=!!iZ;var Ro=function(tn){return tn!=tn},ko=function(tn,to){return 0===tn&&0===to?1/tn==1/to:tn===to||!(!Ro(tn)||!Ro(to))},Co=function(){return"function"==typeof Object.is?Object.is:ko},iQ=(0,eB.exports)(Co(),Object);Po(iQ,{getPolyfill:Co,implementation:ko,shim:function(){var tn=Co();return Po(Object,{is:tn},{is:function(){return Object.is!==tn}}),tn}});var Vo=function(tn){return tn!=tn},Yo=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:Vo},i$=(0,eB.exports)(Yo(),Number);function ts(tn,to){return function(tn){if(Array.isArray(tn))return tn}(tn)||function(tn,to){var ta=[],tu=!0,tc=!1,th=void 0;try{for(var td,tf=tn[Symbol.iterator]();!(tu=(td=tf.next()).done)&&(ta.push(td.value),!to||ta.length!==to);tu=!0);}catch(tn){tc=!0,th=tn}finally{try{tu||null==tf.return||tf.return()}finally{if(tc)throw th}}return ta}(tn,to)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance")}()}function es(tn){return(es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(tn){return typeof tn}:function(tn){return tn&&"function"==typeof Symbol&&tn.constructor===Symbol&&tn!==Symbol.prototype?"symbol":typeof tn})(tn)}Po(i$,{getPolyfill:Yo,implementation:Vo,shim:function(){var tn=Yo();return Po(Number,{isNaN:tn},{isNaN:function(){return Number.isNaN!==tn}}),tn}});var i0=void 0!==/a/g.flags,rs=function(tn){var to=[];return tn.forEach(function(tn){return to.push(tn)}),to},ns=function(tn){var to=[];return tn.forEach(function(tn,ta){return to.push([ta,tn])}),to},i1=Object.is?Object.is:iQ,i2=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},i5=Number.isNaN?Number.isNaN:i$;function ls(tn){return tn.call.bind(tn)}var i3=ls(Object.prototype.hasOwnProperty),i6=ls(Object.prototype.propertyIsEnumerable),i8=ls(Object.prototype.toString),i4=ib.types,i7=i4.isAnyArrayBuffer,i9=i4.isArrayBufferView,ri=i4.isDate,rn=i4.isMap,ro=i4.isRegExp,ra=i4.isSet,ru=i4.isNativeError,rc=i4.isBoxedPrimitive,rh=i4.isNumberObject,rd=i4.isStringObject,rf=i4.isBooleanObject,rp=i4.isBigIntObject,ry=i4.isSymbolObject,rg=i4.isFloat32Array,rv=i4.isFloat64Array;function Os(tn){if(0===tn.length||tn.length>10)return!0;for(var to=0;to<tn.length;to++){var ta=tn.charCodeAt(to);if(ta<48||ta>57)return!0}return 10===tn.length&&tn>=4294967296}function Ps(tn){return Object.keys(tn).filter(Os).concat(i2(tn).filter(Object.prototype.propertyIsEnumerable.bind(tn)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function xs(tn,to){if(tn===to)return 0;for(var ta=tn.length,tu=to.length,tc=0,th=Math.min(ta,tu);tc<th;++tc)if(tn[tc]!==to[tc]){ta=tn[tc],tu=to[tc];break}return ta<tu?-1:tu<ta?1:0}function Fs(tn,to,ta,tu){if(tn===to)return 0!==tn||!ta||i1(tn,to);if(ta){if("object"!==es(tn))return"number"==typeof tn&&i5(tn)&&i5(to);if("object"!==es(to)||null===tn||null===to||Object.getPrototypeOf(tn)!==Object.getPrototypeOf(to))return!1}else{if(null===tn||"object"!==es(tn))return(null===to||"object"!==es(to))&&tn==to;if(null===to||"object"!==es(to))return!1}var tc=i8(tn);if(tc!==i8(to))return!1;if(Array.isArray(tn)){if(tn.length!==to.length)return!1;var th=Ps(tn),td=Ps(to);return th.length===td.length&&Ms(tn,to,ta,tu,1,th)}if("[object Object]"===tc&&(!rn(tn)&&rn(to)||!ra(tn)&&ra(to)))return!1;if(ri(tn)){if(!ri(to)||Date.prototype.getTime.call(tn)!==Date.prototype.getTime.call(to))return!1}else if(ro(tn)){if(!ro(to)||!(i0?tn.source===to.source&&tn.flags===to.flags:RegExp.prototype.toString.call(tn)===RegExp.prototype.toString.call(to)))return!1}else if(ru(tn)||tn instanceof Error){if(tn.message!==to.message||tn.name!==to.name)return!1}else{if(i9(tn)){if(!ta&&(rg(tn)||rv(tn))){if(!function(tn,to){if(tn.byteLength!==to.byteLength)return!1;for(var ta=0;ta<tn.byteLength;ta++)if(tn[ta]!==to[ta])return!1;return!0}(tn,to))return!1}else if(tn.byteLength!==to.byteLength||0!==xs(new Uint8Array(tn.buffer,tn.byteOffset,tn.byteLength),new Uint8Array(to.buffer,to.byteOffset,to.byteLength)))return!1;var tf=Ps(tn),tp=Ps(to);return tf.length===tp.length&&Ms(tn,to,ta,tu,0,tf)}if(ra(tn))return!(!ra(to)||tn.size!==to.size)&&Ms(tn,to,ta,tu,2);if(rn(tn))return!(!rn(to)||tn.size!==to.size)&&Ms(tn,to,ta,tu,3);if(i7(tn)){if(tn.byteLength!==to.byteLength||0!==xs(new Uint8Array(tn),new Uint8Array(to)))return!1}else if(rc(tn)&&(rh(tn)?!(rh(to)&&i1(Number.prototype.valueOf.call(tn),Number.prototype.valueOf.call(to))):rd(tn)?!rd(to)||String.prototype.valueOf.call(tn)!==String.prototype.valueOf.call(to):rf(tn)?!rf(to)||Boolean.prototype.valueOf.call(tn)!==Boolean.prototype.valueOf.call(to):rp(tn)?!rp(to)||BigInt.prototype.valueOf.call(tn)!==BigInt.prototype.valueOf.call(to):!ry(to)||Symbol.prototype.valueOf.call(tn)!==Symbol.prototype.valueOf.call(to)))return!1}return Ms(tn,to,ta,tu,0)}function Ls(tn,to){return to.filter(function(to){return i6(tn,to)})}function Ms(tn,to,ta,tu,tc,th){if(5==arguments.length){th=Object.keys(tn);var td=Object.keys(to);if(th.length!==td.length)return!1}for(var tf=0;tf<th.length;tf++)if(!i3(to,th[tf]))return!1;if(ta&&5==arguments.length){var tp=i2(tn);if(0!==tp.length){var ty=0;for(tf=0;tf<tp.length;tf++){var tg=tp[tf];if(i6(tn,tg)){if(!i6(to,tg))return!1;th.push(tg),ty++}else if(i6(to,tg))return!1}var tv=i2(to);if(tp.length!==tv.length&&Ls(to,tv).length!==ty)return!1}else{var tm=i2(to);if(0!==tm.length&&0!==Ls(to,tm).length)return!1}}if(0===th.length&&(0===tc||1===tc&&0===tn.length||0===tn.size))return!0;if(void 0===tu)tu={val1:new Map,val2:new Map,position:0};else{var tw=tu.val1.get(tn);if(void 0!==tw){var tS=tu.val2.get(to);if(void 0!==tS)return tw===tS}tu.position++}tu.val1.set(tn,tu.position),tu.val2.set(to,tu.position);var tb=function(tn,to,ta,tu,tc,th){var td=0;if(2===th){if(!function(tn,to,ta,tu){for(var tc=null,th=rs(tn),td=0;td<th.length;td++){var tf=th[td];if("object"===es(tf)&&null!==tf)null===tc&&(tc=new Set),tc.add(tf);else if(!to.has(tf)){if(ta||!function(tn,to,ta){var tu=Ks(ta);return null!=tu?tu:to.has(tu)&&!tn.has(tu)}(tn,to,tf))return!1;null===tc&&(tc=new Set),tc.add(tf)}}if(null!==tc){for(var tp=rs(to),ty=0;ty<tp.length;ty++){var tg=tp[ty];if("object"===es(tg)&&null!==tg){if(!js(tc,tg,ta,tu))return!1}else if(!ta&&!tn.has(tg)&&!js(tc,tg,ta,tu))return!1}return 0===tc.size}return!0}(tn,to,ta,tc))return!1}else if(3===th){if(!function(tn,to,ta,tu){for(var tc=null,th=ns(tn),td=0;td<th.length;td++){var tf=ts(th[td],2),tp=tf[0],ty=tf[1];if("object"===es(tp)&&null!==tp)null===tc&&(tc=new Set),tc.add(tp);else{var tg=to.get(tp);if(void 0===tg&&!to.has(tp)||!Fs(ty,tg,ta,tu)){if(ta||!function(tn,to,ta,tu,tc){var th=Ks(ta);if(null!=th)return th;var td=to.get(th);return!(void 0===td&&!to.has(th)||!Fs(tu,td,!1,tc))&&!tn.has(th)&&Fs(tu,td,!1,tc)}(tn,to,tp,ty,tu))return!1;null===tc&&(tc=new Set),tc.add(tp)}}}if(null!==tc){for(var tv=ns(to),tm=0;tm<tv.length;tm++){var tw=ts(tv[tm],2),tS=(tp=tw[0],tw[1]);if("object"===es(tp)&&null!==tp){if(!Bs(tc,tn,tp,tS,ta,tu))return!1}else if(!(ta||tn.has(tp)&&Fs(tn.get(tp),tS,!1,tu)||Bs(tc,tn,tp,tS,!1,tu)))return!1}return 0===tc.size}return!0}(tn,to,ta,tc))return!1}else if(1===th)for(;td<tn.length;td++){if(!i3(tn,td)){if(i3(to,td))return!1;for(var tf=Object.keys(tn);td<tf.length;td++){var tp=tf[td];if(!i3(to,tp)||!Fs(tn[tp],to[tp],ta,tc))return!1}return tf.length===Object.keys(to).length}if(!i3(to,td)||!Fs(tn[td],to[td],ta,tc))return!1}for(td=0;td<tu.length;td++){var ty=tu[td];if(!Fs(tn[ty],to[ty],ta,tc))return!1}return!0}(tn,to,ta,th,tu,tc);return tu.val1.delete(tn),tu.val2.delete(to),tb}function js(tn,to,ta,tu){for(var tc=rs(tn),th=0;th<tc.length;th++){var td=tc[th];if(Fs(to,td,ta,tu))return tn.delete(td),!0}return!1}function Ks(tn){switch(es(tn)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":tn=+tn;case"number":if(i5(tn))return!1}return!0}function Bs(tn,to,ta,tu,tc,th){for(var td=rs(tn),tf=0;tf<td.length;tf++){var tp=td[tf];if(Fs(ta,tp,tc,th)&&Fs(tu,to.get(tp),tc,th))return tn.delete(tp),!0}return!1}var rm={isDeepEqual:function(tn,to){return Fs(tn,to,!1)},isDeepStrictEqual:function(tn,to){return Fs(tn,to,!0)}};function qs(tn){return(qs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(tn){return typeof tn}:function(tn){return tn&&"function"==typeof Symbol&&tn.constructor===Symbol&&tn!==Symbol.prototype?"symbol":typeof tn})(tn)}var rw,rS,rb=ec.codes,rE=rb.ERR_AMBIGUOUS_ARGUMENT,rI=rb.ERR_INVALID_ARG_TYPE,r_=rb.ERR_INVALID_ARG_VALUE,rD=rb.ERR_INVALID_RETURN_VALUE,rA=rb.ERR_MISSING_ARGS,rT=ib.inspect,rx=ib.types,rO=rx.isPromise,rP=rx.isRegExp,rR=Object.assign?Object.assign:function(tn,to){if(null==tn)throw TypeError("Cannot convert first argument to object");for(var ta=Object(tn),tu=1;tu<arguments.length;tu++){var tc=arguments[tu];if(null!=tc)for(var th=Object.keys(Object(tc)),td=0,tf=th.length;td<tf;td++){var tp=th[td],ty=Object.getOwnPropertyDescriptor(tc,tp);void 0!==ty&&ty.enumerable&&(ta[tp]=tc[tp])}}return ta},rk=Object.is?Object.is:iQ;function sa(){rw=rm.isDeepEqual,rS=rm.isDeepStrictEqual}var rN=!1,rF=eu.exports=da,rC={};function ca(tn){if(tn.message instanceof Error)throw tn.message;throw new iO(tn)}function ha(tn,to,ta,tu){if(!ta){var tc=!1;if(0===to)tc=!0,tu="No value argument passed to `assert.ok()`";else if(tu instanceof Error)throw tu;var th=new iO({actual:ta,expected:!0,message:tu,operator:"==",stackStartFn:tn});throw th.generatedMessage=tc,th}}function da(){for(var tn=arguments.length,to=Array(tn),ta=0;ta<tn;ta++)to[ta]=arguments[ta];ha.apply(void 0,[da,to.length].concat(to))}rF.fail=function t(tn,to,ta,tu,tc){var th,td=arguments.length;if(0===td?th="Failed":1===td?(ta=tn,tn=void 0):(!1===rN&&(rN=!0,console.warn.bind(console)("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")),2===td&&(tu="!=")),ta instanceof Error)throw ta;var tf={actual:tn,expected:to,operator:void 0===tu?"fail":tu,stackStartFn:tc||t};void 0!==ta&&(tf.message=ta);var tp=new iO(tf);throw th&&(tp.message=th,tp.generatedMessage=!0),tp},rF.AssertionError=iO,rF.ok=da,rF.equal=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");tn!=to&&ca({actual:tn,expected:to,message:ta,operator:"==",stackStartFn:t})},rF.notEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");tn==to&&ca({actual:tn,expected:to,message:ta,operator:"!=",stackStartFn:t})},rF.deepEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");void 0===rw&&sa(),rw(tn,to)||ca({actual:tn,expected:to,message:ta,operator:"deepEqual",stackStartFn:t})},rF.notDeepEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");void 0===rw&&sa(),rw(tn,to)&&ca({actual:tn,expected:to,message:ta,operator:"notDeepEqual",stackStartFn:t})},rF.deepStrictEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");void 0===rw&&sa(),rS(tn,to)||ca({actual:tn,expected:to,message:ta,operator:"deepStrictEqual",stackStartFn:t})},rF.notDeepStrictEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");void 0===rw&&sa(),rS(tn,to)&&ca({actual:tn,expected:to,message:ta,operator:"notDeepStrictEqual",stackStartFn:t})},rF.strictEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");rk(tn,to)||ca({actual:tn,expected:to,message:ta,operator:"strictEqual",stackStartFn:t})},rF.notStrictEqual=function t(tn,to,ta){if(arguments.length<2)throw new rA("actual","expected");rk(tn,to)&&ca({actual:tn,expected:to,message:ta,operator:"notStrictEqual",stackStartFn:t})};var fa=function t(tn,to,ta){var tu=this;!function(tn,to){if(!(tn instanceof to))throw TypeError("Cannot call a class as a function")}(this,t),to.forEach(function(to){to in tn&&(void 0!==ta&&"string"==typeof ta[to]&&rP(tn[to])&&tn[to].test(ta[to])?tu[to]=ta[to]:tu[to]=tn[to])})};function pa(tn,to,ta,tu){if("function"!=typeof to){if(rP(to))return to.test(tn);if(2==arguments.length)throw new rI("expected",["Function","RegExp"],to);if("object"!==qs(tn)||null===tn){var tc=new iO({actual:tn,expected:to,message:ta,operator:"deepStrictEqual",stackStartFn:tu});throw tc.operator=tu.name,tc}var th=Object.keys(to);if(to instanceof Error)th.push("name","message");else if(0===th.length)throw new r_("error",to,"may not be an empty object");return void 0===rw&&sa(),th.forEach(function(tc){"string"==typeof tn[tc]&&rP(to[tc])&&to[tc].test(tn[tc])||function(tn,to,ta,tu,tc,th){if(!(ta in tn)||!rS(tn[ta],to[ta])){if(!tu){var td=new fa(tn,tc),tf=new fa(to,tc,tn),tp=new iO({actual:td,expected:tf,operator:"deepStrictEqual",stackStartFn:th});throw tp.actual=tn,tp.expected=to,tp.operator=th.name,tp}ca({actual:tn,expected:to,message:tu,operator:th.name,stackStartFn:th})}}(tn,to,tc,ta,th,tu)}),!0}return void 0!==to.prototype&&tn instanceof to||!Error.isPrototypeOf(to)&&!0===to.call({},tn)}function ya(tn){if("function"!=typeof tn)throw new rI("fn","Function",tn);try{tn()}catch(tn){return tn}return rC}function ga(tn){return rO(tn)||null!==tn&&"object"===qs(tn)&&"function"==typeof tn.then&&"function"==typeof tn.catch}function va(tn){return Promise.resolve().then(function(){var to;if("function"==typeof tn){if(!ga(to=tn()))throw new rD("instance of Promise","promiseFn",to)}else{if(!ga(tn))throw new rI("promiseFn",["Function","Promise"],tn);to=tn}return Promise.resolve().then(function(){return to}).then(function(){return rC}).catch(function(tn){return tn})})}function ma(tn,to,ta,tu){if("string"==typeof ta){if(4==arguments.length)throw new rI("error",["Object","Error","Function","RegExp"],ta);if("object"===qs(to)&&null!==to){if(to.message===ta)throw new rE("error/message",'The error message "'.concat(to.message,'" is identical to the message.'))}else if(to===ta)throw new rE("error/message",'The error "'.concat(to,'" is identical to the message.'));tu=ta,ta=void 0}else if(null!=ta&&"object"!==qs(ta)&&"function"!=typeof ta)throw new rI("error",["Object","Error","Function","RegExp"],ta);if(to===rC){var tc="";ta&&ta.name&&(tc+=" (".concat(ta.name,")")),tc+=tu?": ".concat(tu):".";var th="rejects"===tn.name?"rejection":"exception";ca({actual:void 0,expected:ta,operator:tn.name,message:"Missing expected ".concat(th).concat(tc),stackStartFn:tn})}if(ta&&!pa(to,ta,tu,tn))throw to}function wa(tn,to,ta,tu){if(to!==rC){if("string"==typeof ta&&(tu=ta,ta=void 0),!ta||pa(to,ta)){var tc=tu?": ".concat(tu):".",th="doesNotReject"===tn.name?"rejection":"exception";ca({actual:to,expected:ta,operator:tn.name,message:"Got unwanted ".concat(th).concat(tc,"\n")+'Actual message: "'.concat(to&&to.message,'"'),stackStartFn:tn})}throw to}}rF.throws=function t(tn){for(var to=arguments.length,ta=Array(to>1?to-1:0),tu=1;tu<to;tu++)ta[tu-1]=arguments[tu];ma.apply(void 0,[t,ya(tn)].concat(ta))},rF.rejects=function t(tn){for(var to=arguments.length,ta=Array(to>1?to-1:0),tu=1;tu<to;tu++)ta[tu-1]=arguments[tu];return va(tn).then(function(tn){return ma.apply(void 0,[t,tn].concat(ta))})},rF.doesNotThrow=function t(tn){for(var to=arguments.length,ta=Array(to>1?to-1:0),tu=1;tu<to;tu++)ta[tu-1]=arguments[tu];wa.apply(void 0,[t,ya(tn)].concat(ta))},rF.doesNotReject=function t(tn){for(var to=arguments.length,ta=Array(to>1?to-1:0),tu=1;tu<to;tu++)ta[tu-1]=arguments[tu];return va(tn).then(function(tn){return wa.apply(void 0,[t,tn].concat(ta))})},rF.ifError=function t(tn){if(null!=tn){var to="ifError got unwanted exception: ";"object"===qs(tn)&&"string"==typeof tn.message?0===tn.message.length&&tn.constructor?to+=tn.constructor.name:to+=tn.message:to+=rT(tn);var ta=new iO({actual:tn,expected:null,operator:"ifError",message:to,stackStartFn:t}),tu=tn.stack;if("string"==typeof tu){var tc=tu.split("\n");tc.shift();for(var th=ta.stack.split("\n"),td=0;td<tc.length;td++){var tf=th.indexOf(tc[td]);if(-1!==tf){th=th.slice(0,tf);break}}ta.stack="".concat(th.join("\n"),"\n").concat(tc.join("\n"))}throw ta}},rF.strict=rR(function Sa(){for(var tn=arguments.length,to=Array(tn),ta=0;ta<tn;ta++)to[ta]=arguments[ta];ha.apply(void 0,[Sa,to.length].concat(to))},rF,{equal:rF.strictEqual,deepEqual:rF.deepStrictEqual,notEqual:rF.notStrictEqual,notDeepEqual:rF.notDeepStrictEqual}),rF.strict.strict=rF.strict;var rL="the public key could not be parsed or is invalid",rj="nonce generation function failed or private key is invalid";let rM=new ty.ec("p256"),rK=rM.curve;function Ta(tn){return rM.keyFromPublic(tn)}let rB=th.Buffer.from("Bitcoin seed","utf8"),rU={private:76066276,public:76067358};let Pa=class Pa{constructor(tn){this.versions=tn||rU,this.depth=0,this.index=0,this._privateKey=null,this._publicKey=null,this.chainCode=null,this._fingerprint=0,this.parentFingerprint=0}static fromMasterSeed(tn,to){let ta=td.createHmac("sha512",rB).update(tn).digest(),tu=ta.slice(0,32),tc=ta.slice(32),th=new Pa(to);return th.chainCode=tc,th.privateKey=tu,th}static fromExtendedKey(tn,to){let ta=new Pa(to=to||rU),tu=tf.decode(tn),tc=tu.readUInt32BE(0);eu.exports.ok(tc===to.private||tc===to.public,"Version mismatch: does not match private or public"),ta.depth=tu.readUInt8(4),ta.parentFingerprint=tu.readUInt32BE(5),ta.index=tu.readUInt32BE(9),ta.chainCode=tu.slice(13,45);let th=tu.slice(45);return 0===th.readUInt8(0)?(eu.exports.ok(tc===to.private,"Version mismatch: version does not match private"),ta.privateKey=th.slice(1,33)):(eu.exports.ok(tc===to.public,"Version mismatch: version does not match public"),ta.publicKey=th.slice(0,33)),ta}static fromJSON(tn){return Pa.fromExtendedKey(tn.xpriv)}get fingerprint(){return this._fingerprint}get identifier(){return this._identifier}get pubKeyHash(){return this.identifier}get privateKey(){return this._privateKey}set privateKey(tn){if(null===tn)throw Error("Can not directly set privateKey to null.");eu.exports.equal(tn.length,32,"Private key must be 32 bytes."),eu.exports.ok(!0===function(tn){let to=new tp(tn);return 0>to.cmp(rK.n)&&!to.isZero()}(tn),"Invalid private key"),this._privateKey=tn,this._publicKey=function(tn,to){let ta=new tp(tn);if(ta.cmp(rK.n)>=0||ta.isZero())throw Error("private was invalid, try again");return th.Buffer.from(rM.keyFromPrivate(tn).getPublic(to,"true"))}(tn,!0),this._identifier=Ra(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0)}get publicKey(){return this._publicKey}set publicKey(tn){if(null===tn)throw Error("Can not directly set privateKey to null.");eu.exports.ok(33===tn.length||65===tn.length,"Public key must be 33 or 65 bytes."),eu.exports.ok(!0==(null!==Ta(tn)),"Invalid public key"),this._publicKey=function(tn,to){let ta=Ta(tn);if(null===ta)throw Error(rL);return th.Buffer.from(ta.getPublic(to,"true"))}(tn,!0),this._identifier=Ra(this.publicKey),this._fingerprint=this._identifier.slice(0,4).readUInt32BE(0),this._privateKey=null}get privateExtendedKey(){return this._privateKey?tf.encode(xa(this,this.versions.private,th.Buffer.concat([th.Buffer.alloc(1,0),this.privateKey]))):null}get publicExtendedKey(){return tf.encode(xa(this,this.versions.public,this.publicKey))}derive(tn){if("m"===tn||"M"===tn||"m'"===tn||"M'"===tn)return this;let to=tn.split("/"),ta=this;return to.forEach(function(tn,to){if(0===to)return void eu.exports.ok(/^[mM]{1}/.test(tn),'Path must start with "m" or "M"');let tu=tn.length>1&&"'"===tn[tn.length-1],tc=parseInt(tn,10);eu.exports.ok(tc<Pa.HARDENED_OFFSET,"Invalid index"),tu&&(tc+=Pa.HARDENED_OFFSET),ta=ta.deriveChild(tc)}),ta}deriveChild(tn){let to;let ta=tn>=Pa.HARDENED_OFFSET,tu=th.Buffer.allocUnsafe(4);if(tu.writeUInt32BE(tn,0),ta){eu.exports.ok(this.privateKey,"Could not derive hardened child key");let tn=this.privateKey,ta=th.Buffer.alloc(1,0);tn=th.Buffer.concat([ta,tn]),to=th.Buffer.concat([tn,tu])}else to=th.Buffer.concat([this.publicKey,tu]);let tc=td.createHmac("sha512",this.chainCode).update(to).digest(),tf=tc.slice(0,32),ty=tc.slice(32),tg=new Pa(this.versions);if(this.privateKey)try{tg.privateKey=function(tn,to){let ta=new tp(to);if(ta.cmp(rK.n)>=0||(ta.iadd(new tp(tn)),ta.cmp(rK.n)>=0&&ta.isub(rK.n),ta.isZero()))throw Error("tweak out of range or resulting private key is invalid");return ta.toArrayLike(th.Buffer,"be",32)}(this.privateKey,tf)}catch(to){return this.deriveChild(tn+1)}else try{tg.publicKey=function(tn,to,ta){let tu=Ta(tn);if(null===tu)throw Error(rL);if((to=new tp(to)).cmp(rK.n)>=0)throw Error("tweak out of range or resulting public key is invalid");return th.Buffer.from(rK.g.mul(to).add(tu.getPublic()).encode(!0,ta))}(this.publicKey,tf,!0)}catch(to){return this.deriveChild(tn+1)}return tg.chainCode=ty,tg.depth=this.depth+1,tg.parentFingerprint=this.fingerprint,tg.index=tn,tg}sign(tn){return function(tn,to,ta,tu){if("function"==typeof ta){let tc=ta;ta=function(ta){let td=tc(tn,to,null,tu,ta);if(!th.Buffer.isBuffer(td)||32!==td.length)throw Error(rj);return new tp(td)}}let tc=new tp(to);if(tc.cmp(rK.n)>=0||tc.isZero())throw Error(rj);let td=rM.sign(tn,to,{canonical:!0,k:ta,pers:tu});return{signature:th.Buffer.concat([td.r.toArrayLike(th.Buffer,"be",32),td.s.toArrayLike(th.Buffer,"be",32)]),recovery:td.recoveryParam}}(tn,this.privateKey).signature}verify(tn,to){return function(tn,to,ta){if(tn.length%2!=0)throw Error("Wrong message length");let tu={r:to.slice(0,32),s:to.slice(32,64)},tc=new tp(tu.r),th=new tp(tu.s);if(tc.cmp(rK.n)>=0||th.cmp(rK.n)>=0)throw Error("couldn't parse signature");if(1===th.cmp(rM.nh)||tc.isZero()||th.isZero())return!1;let td=Ta(ta);if(null===td)throw Error(rL);return rM.verify(tn,tu,{x:td.getPublic().x,y:td.getPublic().y})}(tn,to,this.publicKey)}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}};function xa(tn,to,ta){let tu=th.Buffer.allocUnsafe(78);tu.writeUInt32BE(to,0),tu.writeUInt8(tn.depth,4);let tc=tn.depth?tn.parentFingerprint:0;return tu.writeUInt32BE(tc,5),tu.writeUInt32BE(tn.index,9),tn.chainCode.copy(tu,13),ta.copy(tu,45),tu}function Ra(tn){let to=td.createHash("sha256").update(tn).digest();return td.createHash("rmd160").update(to).digest()}Pa.HARDENED_OFFSET=2147483648;let ka=class ka{static decode(tn){return tf.decode(tn)}static encode(tn){return tf.encode(tn)}};let Na=class Na{constructor(tn){this.key=tn}static newWithMnemonic(tn,to){let ta=Fa.toSeed(tn,to);return Na.newWithSeed(ta)}static newWithSeed(tn){return Na.newWithKey(Pa.fromMasterSeed(tn))}static newWithKey(tn){return new Na(tn)}getPrivateKeyBytes(){return this.key.privateKey}getPrivateKeyBase58(){return ka.encode(this.getPrivateKeyBytes())}getPublicKeyBytes(){return this.key.publicKey}getPublicKeyBase58(){return ka.encode(this.getPublicKeyBytes())}serialize(){return ka.decode(this.serializeBase58())}serializeBase58(){let tn=ka.decode(this.key.privateExtendedKey),to=th.Buffer.alloc(82);return tn.copy(to),We.hashTwice(tn).copy(to,78,0,4),ka.encode(to)}serializePublicKey(){return ka.decode(this.serializePublicKeyBase58())}serializePublicKeyBase58(){let tn=ka.decode(this.key.publicExtendedKey),to=th.Buffer.alloc(82);return tn.copy(to),We.hashTwice(tn).copy(to,78,0,4),ka.encode(to)}static deserialize(tn){return this.deserializeBase58(ka.encode(tn))}static deserializeBase58(tn){return new Na(Pa.fromExtendedKey(tn))}static transformBip32HeaderToBuffer(tn){let to=th.Buffer.alloc(4);return to[0]=tn>>24&255,to[1]=tn>>16&255,to[2]=tn>>8&255,to[3]=255&tn,to}static paddingToExtendedPrivateKey(tn){let to=th.Buffer.alloc(Na.EXTENDED_PRIVATEKEY_BYTES);Na.transformBip32HeaderToBuffer(this.bip32HeaderP2PKHpriv).copy(to),tn.copy(to,46,0,32);let ta=th.Buffer.alloc(78);return to.copy(ta,0,0,78),We.hashTwice(ta).copy(to,78,0,4),to}static paddingToExtendedPublicKey(tn){let to=th.Buffer.alloc(Na.EXTENDED_PUBLICKEY_BYTES);Na.transformBip32HeaderToBuffer(this.bip32HeaderP2PKHpub).copy(to),tn.copy(to,45,0,33);let ta=th.Buffer.alloc(78);return to.copy(ta,0,0,78),We.hashTwice(ta).copy(to,78,0,4),to}deriveWithPath(tn){return new Na(this.key.derive(tn))}deriveWithIndex(tn,to=!1){return to&&(tn+=Na.HARDENED_BIT),new Na(this.key.deriveChild(tn))}static getRedeemScript(tn){let to=th.Buffer.alloc(35);return to[0]=33,tn.copy(to,1),to[34]=Na.PADDING_STANDARD,to}static getBinAddressFromBuffer(tn){let to=this.getRedeemScript(tn),ta=We.sha256ripemd160(to),tu=th.Buffer.alloc(ta.length+1);tu[0]=Na.PADDING_IDENTITY,ta.copy(tu,1),ta=We.hashTwice(tu);let tc=th.Buffer.alloc(tu.length+4);return tu.copy(tc,0),ta.copy(tc,tu.length,0,4),tc}getBinAddress(){return Na.getBinAddressFromBuffer(this.getPublicKeyBytes())}getAddress(){let tn=this.getBinAddress();return ka.encode(tn)}static toAddress(tn){return ka.encode(this.getBinAddressFromBuffer(tn))}static isAddressValid(tn){let to=ka.decode(tn);if(25!=to.length||to[0]!=Na.PADDING_IDENTITY)return!1;let ta=We.hashTwice(th.Buffer.from(to.toString("hex").substr(0,21)));return ta[0]==to[21]&&ta[1]==to[22]&&ta[2]==to[23]&&ta[3]==to[24]}wipe(){}};Na.PUBLICKEY_BYTES=33,Na.PRIVATEKEY_BYTES=32,Na.SEED_BYTES=64,Na.EXTENDED_KEY_BYTES=82,Na.EXTENDED_PRIVATEKEY_BYTES=Na.EXTENDED_KEY_BYTES,Na.EXTENDED_PUBLICKEY_BYTES=Na.EXTENDED_KEY_BYTES,Na.HARDENED_BIT=2147483648,Na.PADDING_IDENTITY=103,Na.PADDING_STANDARD=173,Na.bip32HeaderP2PKHpub=76067358,Na.bip32HeaderP2PKHpriv=76066276,Na.bip32HeaderP2WPKHpub=78792518,Na.bip32HeaderP2WPKHpriv=78791436,Na.DERIVE_PATH_PREFIX="m/44'/0'/0'/0/",Na.PRE_DERIVED_PUBLICKEY_PATH="m/44'/0'/0'";let Ca=class Ca{static generateKeyAndIv(tn){let to=th.Buffer.from(tn,"utf-8"),ta=td.createHash("md5").update(to).digest(),tu=td.createHash("md5").update(ta).update(to).digest(),tc=td.createHash("md5").update(tu).update(to).digest();return{key:th.Buffer.concat([ta,tu]),iv:tc}}static encrypt(tn,to){let{key:ta,iv:tu}=Ca.generateKeyAndIv(to),tc=td.createCipheriv("aes-256-cbc",ta,tu);return th.Buffer.concat([tc.update(tn),tc.final()])}static decrypt(tn,to){let{key:ta,iv:tu}=this.generateKeyAndIv(to),tc=td.createDecipheriv("aes-256-cbc",ta,tu);return th.Buffer.concat([tc.update(tn),tc.final()])}static encryptToBase64(tn,to){let ta=this.encrypt(tn,to);return Je.toUrlFormat(ta.toString("base64"))}static decryptFromBase64(tn,to){let ta=th.Buffer.from(Je.fromUrlFormat(tn),"base64");return Ca.decrypt(ta,to)}};let Fa=class Fa{constructor(tn=Fa.ENGLISH){if(this.language=tn,!(tn in Fa.WORDLISTS))throw new N("Unsupported language for mnemonic "+tn)}static getInstance(tn=Fa.ENGLISH){return null!==tn&&""!==tn||(tn=Fa.ENGLISH),new Fa(tn)}generate(tn){return tn?(0,tv.JJ)(tn,Fa.WORDLISTS[this.language]):(0,tv.OF)(Fa.TWELVE_WORDS_ENTROPY,null,Fa.WORDLISTS[this.language])}isValid(tn){return qt(null!=tn&&""!==tn,"Invalid mnemonic"),tn=tn.normalize("NFKD"),(0,tv._I)(tn,Fa.WORDLISTS[this.language])}static getLanguage(tn){for(let to of(qt(null!=tn&&""!==tn,"Invalid menmonic"),tn=tn.normalize("NFKD"),Object.keys(Fa.WORDLISTS)))if(new Fa(to).isValid(tn))return to;return null}static checkIsValid(tn){return qt(null!=tn&&""!==tn,"Invalid menmonic"),null!=this.getLanguage(tn)}static toSeed(tn,to){return qt(null!=tn&&""!==tn,"Invalid menmonic"),null==to&&(to=""),tn=tn.normalize("NFKD"),to=to.normalize("NFKD"),(0,tv.Z1)(tn,to)}};Fa.DEFAULT=null,Fa.CHINESE_SIMPLIFIED="chinese_simplified",Fa.CHINESE_TRADITIONAL="chinese_traditional",Fa.CZECH="czech",Fa.ENGLISH="english",Fa.FRENCH="french",Fa.ITALIAN="italian",Fa.JAPANESE="japanese",Fa.KOREAN="korean",Fa.SPANISH="spanish",Fa.TWELVE_WORDS_ENTROPY=128,Fa.WORDLISTS={english:tv.ET.english,czech:tv.ET.czech,chinese_simplified:tv.ET.chinese_simplified,chinese_traditional:tv.ET.chinese_traditional,french:tv.ET.french,italian:tv.ET.italian,japanese:tv.ET.japanese,spanish:tv.ET.spanish,korean:tv.ET.korean};let La=class La{constructor(tn,to){let ta=tn instanceof La?tn.getAbsolutePath():tn;to&&(ta+=La.SEPARATOR+to),ta.startsWith("/")||ta.startsWith("./")||":"===ta[1]||(ta="./"+ta),this.fullPath=ta}static exists(tn){return"string"==typeof tn&&(tn=new La(tn)),tn.exists()}static isFile(tn){return"string"==typeof tn&&(tn=new La(tn)),tn.isFile()}static isDirectory(tn){return"string"==typeof tn&&(tn=new La(tn)),tn.isDirectory()}getStats(){return this.fileStats?this.fileStats:this.exists()?tW(this.fullPath):null}exists(){return tB(this.fullPath)}length(){return this.exists()?this.getStats().size:0}getAbsolutePath(){return this.fullPath}getName(){return this.fullPath.includes(La.SEPARATOR)?this.fullPath.substring(this.fullPath.lastIndexOf(La.SEPARATOR)+1):this.fullPath}getParentDirectory(){let tn=this.getParentDirectoryName();return tn?new La(tn):null}getParentDirectoryName(){return this.fullPath.includes(La.SEPARATOR)?this.fullPath.substring(0,this.fullPath.lastIndexOf(La.SEPARATOR)):this.isDirectory?this.fullPath:""}isDirectory(){return!!this.exists()&&this.getStats().isDirectory()}isFile(){return!!this.exists()&&this.getStats().isFile()}list(){return this.exists()&&this.getStats().isDirectory()?tq(this.fullPath):null}listFiles(){if(!this.exists()||!this.getStats().isDirectory())return null;let tn=[];return this.list().forEach(to=>{tn.push(new La(this.getAbsolutePath()+"/"+to))}),tn}writeText(tn){this.exists()&&!this.getStats().isFile()||("string"==typeof tn?tH(this.fullPath,tn,{encoding:"utf-8"}):tH(this.fullPath,tn))}readText(tn=!0){return this.exists()?tn?tz(this.fullPath,{encoding:"utf-8"}):tz(this.fullPath):null}rename(tn){if(this.exists()){let to=this.fullPath.includes(La.SEPARATOR)&&!tn.includes(La.SEPARATOR)?this.getParentDirectoryName+La.SEPARATOR+tn:tn;tV(this.fullPath,to)}}createFile(tn){this.exists()&&!tn||(tH(this.fullPath,"",{encoding:"utf-8"}),this.fileStats=void 0)}createDirectory(tn){this.exists()&&!tn||(this.mkdirpath(this.fullPath),this.fileStats=void 0)}mkdirpath(tn){if(!tB(tn))try{tU(tn)}catch(ta){let to=tI.dirname(tn);if(to===tn)throw ta;this.mkdirpath(to),this.mkdirpath(tn)}}delete(){this.exists()&&(this.isDirectory()?this.deleteDirectory(this.fullPath):tX(this.fullPath),this.fileStats=void 0)}deleteDirectory(tn){tB(tn)&&(tq(tn).forEach((to,ta)=>{let tu=tI.join(tn,to);tY(tu).isDirectory()?this.deleteDirectory(tu):tX(tu)}),tJ(tn))}toString(){return this.fullPath}};La.SEPARATOR="/";let Ma=class Ma{constructor(){}static getInstance(){return Ma.instance||(Ma.instance=new Ma),Ma.instance}merge(tn,to){return to}};let ja=class ja extends Ft{constructor(){super()}constructWithOperation(tn){this.header=ja.Header.newWithPreviousTxId(tn,null)}constructWithPreviousTxId(tn,to){this.header=ja.Header.newWithPreviousTxId(tn,to)}constructWithTransferTicket(tn,to){this.header=ja.Header.newWithTransferTicket(tn,to)}constructWithIDChainRequest(tn){this.header=tn.header,this.payload=tn.payload,this.proof=tn.proof}getHeader(){return this.header}getOperation(){return this.header.getOperation()}getPayload(){return this.payload}setPayload(tn){this.payload=tn}getProof(){return this.proof}setProof(tn){this.proof=tn}getSigningInputs(){let tn=this.getOperation().equals(ja.Operation.UPDATE)?this.header.getPreviousTxid():"",to=this.getOperation().equals(ja.Operation.TRANSFER)?this.header.getTicket():"";return[th.Buffer.from(this.header.getSpecification()),th.Buffer.from(this.header.getOperation().toString()),th.Buffer.from(tn),th.Buffer.from(to),th.Buffer.from(this.payload)]}isValid(){return A(this,void 0,void 0,function*(){let tn=this.proof.getVerificationMethod(),to=yield this.getSignerDocument();if(null==to||!to.isGenuine())return!1;if(this.getOperation().equals(ja.Operation.DEACTIVATE)){if(!to.isAuthenticationKey(tn)&&!to.isAuthorizationKey(tn))return!1}else if(!to.isAuthenticationKey(tn))return!1;return to.verify(this.proof.getVerificationMethod(),this.proof.getSignature(),...this.getSigningInputs())})}toJSON(tn=null){return{header:this.header.toJSON(),payload:this.payload,proof:this.proof.toJSON()}}fromJSON(tn,to=null){if(!tn.header)throw new J("Missing header");if(this.header=ja.Header.parse(tn.header),!tn.payload)throw new J("Missing payload");if(this.payload=this.getString("payload",tn.payload,{mandatory:!0,nullable:!1}),!tn.proof)throw new J("Missing proof");this.proof=ja.Proof.parse(tn.proof),this.sanitize()}};ja.DID_SPECIFICATION="elastos/did/1.0",ja.CREDENTIAL_SPECIFICATION="elastos/credential/1.0",function(tn){var to;let e=class e{constructor(tn,to){this.name=tn,this.specification=to}getSpecification(){return this.specification}toString(){return this.name}static fromString(tn){return e[tn.toUpperCase()]}equals(tn){return this.name===tn.name}};tn.Operation=e,(to=e=tn.Operation||(tn.Operation={})).CREATE=new to("create",tn.DID_SPECIFICATION),to.UPDATE=new to("update",tn.DID_SPECIFICATION),to.TRANSFER=new to("transfer",tn.DID_SPECIFICATION),to.DEACTIVATE=new to("deactivate",tn.DID_SPECIFICATION),to.DECLARE=new to("declare",tn.CREDENTIAL_SPECIFICATION),to.REVOKE=new to("revoke",tn.CREDENTIAL_SPECIFICATION);let i=class i extends Ft{constructor(tn=null){super(),this.specification=tn}static newWithPreviousTxId(tn,to){let ta=new i(tn.getSpecification());return ta.operation=tn,ta.previousTxid=to,ta}static newWithTransferTicket(tn,to){qt(null!=to,"Invalid ticket");let ta=new i(tn.getSpecification());ta.operation=tn;let tu=to.toString(!0);return ta.ticket=Je.fromString(tu),ta.transferTicket=to,ta}getSpecification(){return this.specification}getOperation(){return this.operation}getPreviousTxid(){return this.previousTxid}getTicket(){return this.ticket}getTransferTicket(){if(this.ticket&&!this.transferTicket){let tn=Je.toString(this.ticket);try{this.transferTicket=Ee.parse(tn)}catch(tn){throw new P("Invalid ticket",tn)}}return this.transferTicket}toJSON(tn=null){let to={};return to.specification=this.specification,to.operation=this.operation.toString(),this.previousTxid&&(to.previousTxid=this.previousTxid),this.ticket&&(to.ticket=this.ticket),to}fromJSON(tn,to=null){this.specification=this.getString("specification",tn.specification,{mandatory:!0,nullable:!1});let ta=this.getString("operation",tn.operation,{mandatory:!0,nullable:!1});this.operation=e.fromString(ta),this.previousTxid=this.getString("previousTxid",tn.previousTxid,{mandatory:!1,nullable:!1,defaultValue:null}),this.ticket=this.getString("ticket",tn.ticket,{mandatory:!1,nullable:!1,defaultValue:null})}static parse(tn,to=null){try{return Ft.deserialize(tn,i,to)}catch(tn){throw tn instanceof J?tn:new J(tn)}}};tn.Header=i;let r=class r extends Ft{constructor(tn=null,to=null,ta=ne.DEFAULT_PUBLICKEY_TYPE){super(),this.type=null!=ta?ta:ne.DEFAULT_PUBLICKEY_TYPE,this.verificationMethod=tn,this.signature=to}getType(){return this.type}getVerificationMethod(){return this.verificationMethod}qualifyVerificationMethod(tn){null==this.verificationMethod.getDid()&&(this.verificationMethod=Xt.from(this.verificationMethod,tn))}getSignature(){return this.signature}toJSON(tn=null){return{type:this.type,verificationMethod:this.verificationMethod.toString(),signature:this.signature}}fromJSON(tn,to=null){this.type=this.getString("type",tn.type,{mandatory:!1,defaultValue:ne.DEFAULT_PUBLICKEY_TYPE,nullable:!1}),this.verificationMethod=this.getDidUrl("verificationMethod",tn.verificationMethod,{mandatory:!0,nullable:!1}),this.signature=this.getString("signature",tn.signature,{mandatory:!0,nullable:!1})}static parse(tn,to=null){try{return Ft.deserialize(tn,r,to)}catch(tn){throw tn instanceof J?tn:new J(tn)}}};tn.Proof=r}(ja||(ja={}));let Ka=class Ka extends Ft{constructor(tn=null,to=null){super(),this.requestId=tn,this.method=to}getRequestId(){return this.requestId}getMethod(){return this.method}setParameters(tn){this.params=tn}getParameters(){return this.params}hashCode(){return Ht(this.method)+this.params.hashCode()}equals(tn){return tn instanceof Ka&&this.method===tn.method&&this.params===tn.params}toJSON(tn=null){return{id:this.requestId,method:this.method,params:[this.params.toJSON(null)]}}fromJSON(tn,to=null){if(this.requestId=super.getString("id",tn.id,{mandatory:!1,nullable:!0}),this.method=this.getString("method",tn.method,{mandatory:!0,nullable:!1}),!tn.params)throw new $("Missing parameters");if(!Array.isArray(tn.params))throw new $("Invalid parameters");this.params=this.paramsFromJson(tn.params[0])}};Ka.ID="id",Ka.METHOD="method",Ka.PARAMETERS="params",(Ka||(Ka={})).Parameters=class extends Ft{};let Ua=class Ua{constructor(tn,to){this.code=tn,this.message=to}};let za=class za extends Ft{constructor(tn=null,to=null){super(),this.jsonrpc=za.JSON_RPC_VERSION,this.id=tn,to instanceof Ua?this.error=new za.JsonRpcError(to.code,to.message):to instanceof za.JsonRpcError?this.error=to:this.result=to}getResponseId(){return this.id}getErrorCode(){return this.error.getCode()}getErrorMessage(){return this.error.getMessage()}getResult(){return this.result}toJSON(tn=null){let to={};return to.id=this.id,to.jsonrpc=this.jsonrpc,this.result&&(to.result=this.result.toJSON(null)),this.error&&(to.error=this.error.toJSON()),to}fromJSON(tn,to=null){if(this.id=this.getString("id",tn.id,{mandatory:!1,nullable:!0,defaultValue:null}),this.jsonrpc=this.getString("jsonrpc",tn.jsonrpc,{mandatory:!0,nullable:!1}),null==this.jsonrpc||this.jsonrpc!==za.JSON_RPC_VERSION)throw new tt("Invalid JsonRPC version");if(!tn.result&&!tn.error)throw new tt("Missing response data");tn.result&&(this.result=this.resultFromJson(tn.result)),tn.error&&(this.error=za.JsonRpcError.parse(tn.error))}};za.JSON_RPC_VERSION="2.0",function(tn){let e=class e extends Ft{constructor(tn=0,to=null,ta=null){super(),this.code=tn,this.message=to,this.data=ta}getCode(){return this.code}getMessage(){return this.message}getData(){return this.data}toJSON(tn=null){return{code:this.code,message:this.message,data:this.data}}fromJSON(tn,to=null){this.code=this.getNumber("code",tn.code,{mandatory:!0,nullable:!1,defaultValue:0}),this.message=this.getString("message",tn.message,{mandatory:!1,nullable:!0}),this.data=this.getString("data",tn.data,{mandatory:!1,nullable:!0})}static parse(tn,to=null){try{return Ft.deserialize(tn,e,to)}catch(tn){throw tn instanceof tt?tn:new tt(tn)}}};tn.JsonRpcError=e,tn.Result=class extends Ft{}}(za||(za={}));let Ba=class Ba extends Ka{constructor(tn=null){super(tn,Ba.METHOD_NAME)}setParameters(tn,to=!1){tn instanceof Jt?super.setParameters(new Va(tn,to)):tn instanceof Va?super.setParameters(tn):super.setParameters(new Va(Jt.from(tn),to))}getDid(){return this.getParameters().did}isResolveAll(){return this.getParameters().all}toString(){let tn=new Xt.Builder(this.getParameters().did);return tn.setQueryParameter(Ba.PARAMETER_ALL,this.getParameters().all?"true":"false"),tn.build().toString()}paramsFromJson(tn){return Va.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,Ba,to)}catch(tn){throw tn instanceof $?tn:new $(tn)}}};Ba.PARAMETER_DID="did",Ba.PARAMETER_ALL="all",Ba.METHOD_NAME="did_resolveDID";let Va=class Va extends Ka.Parameters{constructor(tn=null,to=!1){super(),this.did=tn,this.all=to}hashCode(){return this.did.hashCode()+Ht(this.all)}equals(tn){return tn instanceof Va&&!!this.did.equals(tn.did)&&this.all==tn.all}toJSON(tn=null){let to={};return to.did=this.did.toString(),this.all&&!0===this.all&&(to.all=this.all),to}fromJSON(tn,to=null){this.did=super.getDid("did",tn.did,{mandatory:!0,nullable:!1}),this.all=this.getBoolean("all",tn.all,{mandatory:!1,nullable:!1,defaultValue:!1})}static parse(tn,to=null){try{return Ft.deserialize(tn,Va,to)}catch(tn){throw tn instanceof $?tn:new $(tn)}}};let qa=class qa{constructor(tn,to){this.name=to,this.value=tn}getValue(){return this.value}static fromValue(tn){switch(String(tn)){case"0":return qa.VALID;case"2":return qa.REVOKED;case"3":return qa.NOT_FOUND;default:throw new P("Invalid CredentialBiographyStatus")}}toString(){return this.name.toLowerCase()}equals(tn){return this.value==tn.value}};(tu=qa||(qa={})).VALID=new tu(0,"valid"),tu.REVOKED=new tu(2,"revoked"),tu.NOT_FOUND=new tu(3,"not_found");let Ya=class Ya extends za.Result{constructor(tn=null,to=null){super(),this.id=tn,this.status=to}getId(){return this.id}setStatus(tn){this.status=tn}getStatus(){return this.status}getTransactionCount(){return null!=this.txs?this.txs.length:0}getTransaction(tn){return null!=this.txs?this.txs[tn]:null}getAllTransactions(){return null!=this.txs?this.txs:[]}addTransaction(tn){null==this.txs&&(this.txs=[]),this.txs.push(tn)}toJSON(tn=null){let to={};return to.id=this.id.toString(),to.status=this.status.toString(),this.txs&&this.txs.length>0&&(to.transaction=Array.from(this.txs,tn=>tn.toJSON())),to}fromJSON(tn,to=null){this.id=this.getDidUrl("id",tn.id,{mandatory:!0,nullable:!1});let ta=this.getNumber("status",tn.status,{mandatory:!0,nullable:!1});if(this.status=qa.fromValue(ta),this.status.equals(qa.NOT_FOUND)){if(tn.transaction)throw new Z("Should not include transaction")}else{if(!tn.transaction)throw new Z("Missing transaction");if(!Array.isArray(tn.transaction)||0==tn.transaction.length)throw new Z("Invalid transaction");this.txs=Array.from(tn.transaction,tn=>$a.parse(tn))}}static parse(tn,to=null){try{return Ft.deserialize(tn,Ya,to)}catch(tn){throw tn instanceof Z?tn:new Z(tn)}}};let Wa=class Wa extends za{constructor(tn=null,to=null){super(tn,to)}resultFromJson(tn){return Ya.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,Wa,to)}catch(tn){throw tn instanceof tt?tn:new tt(tn)}}};let Ha=class Ha extends Ft{constructor(tn=null,to=null,ta=null){super(),this.txId=tn,this.timestamp=to,this.request=ta}getTransactionId(){return this.txId}getTimestamp(){return this.timestamp}getRequest(){return this.request}toJSON(tn=null){return{txid:this.txId,timestamp:this.dateToString(this.timestamp),operation:this.request.toJSON()}}fromJSON(tn,to=null){if(this.txId=this.getString("txid",tn.txid,{mandatory:!0,nullable:!1}),this.timestamp=this.getDate("timestamp",tn.timestamp,{mandatory:!0,nullable:!1}),!tn.operation)throw new G("Missing request");this.request=this.requestFromJSON(tn.operation)}};Ha.TXID="txid",Ha.TIMESTAMP="timestamp",Ha.OPERATION="operation";let Ja=class Ja extends ja{static newWithOperation(tn){let to=new Ja;return to.constructWithOperation(tn),to}static newWithPreviousTxId(tn,to){let ta=new Ja;return ta.constructWithPreviousTxId(tn,to),ta}static newWithTransferTicket(tn,to){let ta=new Ja;return ta.constructWithTransferTicket(tn,to),ta}static newWithDIDRequest(tn){let to=new Ja;to.constructWithIDChainRequest(tn),to.did=tn.did,to.doc=tn.doc}static create(tn,to,ta){return A(this,void 0,void 0,function*(){let tu=Ja.newWithOperation(ja.Operation.CREATE);tu.setPayload(tn);try{yield tu.seal(to,ta)}catch(tn){throw new M(tn)}return tu})}static update(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=Ja.newWithPreviousTxId(ja.Operation.UPDATE,to);tc.setPayload(tn);try{yield tc.seal(ta,tu)}catch(tn){throw new M(tn)}return tc})}static transfer(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=Ja.newWithTransferTicket(ja.Operation.TRANSFER,to);tc.setPayload(tn);try{yield tc.seal(ta,tu)}catch(tn){throw new M(tn)}return tc})}static deactivate(tn,to,ta){return A(this,void 0,void 0,function*(){let tu=Ja.newWithOperation(ja.Operation.DEACTIVATE);tu.setPayload(tn);try{yield tu.seal(to,ta)}catch(tn){throw new M(tn)}return tu})}static deactivateTarget(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){let th=Ja.newWithOperation(ja.Operation.DEACTIVATE);th.setPayload(tn);try{yield th.sealTarget(to,ta,tu,tc)}catch(tn){}return th})}getPreviousTxid(){return this.getHeader().getPreviousTxid()}getTransferTicket(){return this.getHeader().getTransferTicket()}getDid(){return this.did}getDocument(){return this.doc}setPayload(tn){if(tn instanceof ve){if(this.doc=tn,this.did=this.doc.getSubject(),this.getHeader().getOperation().equals(ja.Operation.DEACTIVATE))super.setPayload(this.doc.getSubject().toString());else{let tn=this.doc.toString(!0),to=th.Buffer.from(tn,"utf-8");this.setPayload(Je.fromString(to.toString()))}}else super.setPayload(tn)}sanitize(){let tn=this.getHeader();if(null==tn)throw new J("Missing header");if(null==tn.getSpecification())throw new J("Missing specification");if(tn.getSpecification()!==Ja.DID_SPECIFICATION)throw new J("Unsupported specification");let to=tn.getOperation();if(to.equals(ja.Operation.CREATE));else if(to.equals(ja.Operation.UPDATE)){if(null==tn.getPreviousTxid()||""===tn.getPreviousTxid())throw new J("Missing previousTxid")}else if(to.equals(ja.Operation.TRANSFER)){if(null==tn.getTicket()||""===tn.getTicket())throw new J("Missing ticket")}else if(!to.equals(ja.Operation.DEACTIVATE))throw new J("Invalid operation "+tn.getOperation().toString());let ta=this.getPayload();if(null==ta||""===ta)throw new J("Missing payload");let tu=this.getProof();if(null==tu)throw new J("Missing proof");try{if(tn.getOperation().equals(ja.Operation.DEACTIVATE))this.did=new Jt(ta);else{let tn=Je.toString(ta);this.doc=ve._parseOnly(tn),this.did=this.doc.getSubject()}}catch(tn){throw new J("Invalid payload",tn)}tu.qualifyVerificationMethod(this.did)}seal(tn,to){return A(this,void 0,void 0,function*(){if(!this.doc.isAuthenticationKey(tn))throw new X("Not an authentication key.");if(null==this.getPayload()||""===this.getPayload())throw new J("Missing payload");let ta=yield this.doc.signWithId(tn,to,...this.getSigningInputs());this.setProof(new Ja.Proof(tn,ta))})}sealTarget(tn,to,ta,tu){return A(this,void 0,void 0,function*(){if(!this.doc.isAuthorizationKey(tn))throw new X("Not an authorization key: "+tn);if(!to.isAuthenticationKey(ta))throw new X("Not an authentication key: "+ta);if(!this.getPayload()||null==this.getPayload())throw new J("Missing payload");let tc=yield to.signWithId(ta,tu,...this.getSigningInputs());this.setProof(new Ja.Proof(tn,tc))})}getSignerDocument(){return A(this,void 0,void 0,function*(){return null==this.doc?this.doc=yield this.did.resolve():this.doc.isCustomizedDid()&&(yield this.doc.resolveControllers()),this.doc})}static parse(tn,to=null){try{return Ft.deserialize(tn,Ja,to)}catch(tn){throw tn instanceof J?tn:new J(tn)}}};let Xa=class Xa extends Ha{constructor(tn=null,to=null,ta=null){super(tn,to,ta)}getDid(){return this.getRequest().getDid()}requestFromJSON(tn){return Ja.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,Xa,to)}catch(tn){throw tn instanceof G?tn:new G(tn)}}};let Ga=class Ga extends Ka{constructor(tn=null){super(tn,Ga.METHOD_NAME)}setParameters(tn,to=null){tn instanceof Za?super.setParameters(tn):super.setParameters(new Za(tn,to))}getId(){return this.getParameters().id}getIssuer(){return this.getParameters().issuer}toString(){let tn=new Xt.Builder(this.getParameters().id);return null!=this.getParameters().issuer&&tn.setQueryParameter(Ga.PARAMETER_ISSUER,this.getParameters().issuer.toString()),tn.build().toString()}paramsFromJson(tn){return Za.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,Ga,to)}catch(tn){throw tn instanceof $?tn:new $(tn)}}};Ga.PARAMETER_ID="id",Ga.PARAMETER_ISSUER="issuer",Ga.METHOD_NAME="did_resolveCredential";let Za=class Za extends Ka.Parameters{constructor(tn=null,to=null){super(),this.id=tn,this.issuer=to}hashCode(){let tn=this.id.hashCode();return null!=this.issuer&&(tn+=this.issuer.hashCode()),tn}equals(tn){if(!(tn instanceof Za)||!this.id.equals(tn.id))return!1;let to=null!=this.issuer?this.issuer:this.id.getDid(),ta=null!=tn.issuer?tn.issuer:tn.id.getDid();return to.equals(ta)}toJSON(tn=null){let to={};return to.id=this.id.toString(),this.issuer&&(to.issuer=this.issuer.toString()),to}fromJSON(tn,to=null){this.id=super.getDidUrl("id",tn.id,{mandatory:!0,nullable:!1}),this.issuer=this.getDid("issuer",tn.issuer,{mandatory:!1,nullable:!0,defaultValue:null})}static parse(tn,to=null){try{return Ft.deserialize(tn,Za,to)}catch(tn){throw tn instanceof $?tn:new $(tn)}}};let Qa=class Qa extends ja{constructor(){super()}static newWithOperation(tn){let to=new Qa;return to.constructWithOperation(tn),to}static newWithCredentialRequest(tn){let to=new Qa;return to.constructWithIDChainRequest(tn),to.id=tn.id,to.vc=tn.vc,to.signer=tn.signer,to}static declare(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=Qa.newWithOperation(ja.Operation.DECLARE);tc.setPayload(tn),tc.setSigner(to);try{yield tc.seal(to,ta,tu)}catch(tn){throw new M(tn)}return tc})}static revoke(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=Qa.newWithOperation(ja.Operation.REVOKE);tc.setPayload(tn),tc.setSigner(to);try{yield tc.seal(to,ta,tu)}catch(tn){throw new M(tn)}return tc})}setSigner(tn){this.signer=tn}getCredentialId(){return this.id}getCredential(){return this.vc}setPayload(tn){if(tn instanceof se){if(this.id=tn.getId(),this.vc=tn,this.getHeader().getOperation().equals(ja.Operation.DECLARE)){let to=tn.toString(!0);this.setPayload(Je.fromString(to))}else this.getHeader().getOperation().equals(ja.Operation.REVOKE)&&this.setPayload(tn.getId().toString())}else tn instanceof Xt?(this.id=tn,this.vc=null,super.setPayload(tn.toString())):super.setPayload(tn)}sanitize(){let tn=this.getHeader();if(null==tn)throw new J("Missing header");if(null==tn.getSpecification())throw new J("Missing specification");if(tn.getSpecification()!==Qa.CREDENTIAL_SPECIFICATION)throw new J("Unsupported specification");if(!tn.getOperation().equals(ja.Operation.DECLARE)&&!tn.getOperation().equals(ja.Operation.REVOKE))throw new J("Invalid operation "+tn.getOperation());let to=this.getPayload();if(null==to||""===to)throw new J("Missing payload");let ta=this.getProof();if(null==ta)throw new J("Missing proof");try{if(tn.getOperation().equals(ja.Operation.DECLARE)){let tn=Je.toString(to);this.vc=se.parse(tn),this.id=this.vc.getId()}else this.id=Xt.from(to)}catch(tn){throw new J("Invalid payload",tn)}ta.qualifyVerificationMethod(this.id.getDid())}seal(tn,to,ta){return A(this,void 0,void 0,function*(){if(!tn.isAuthenticationKey(to))throw new X("Not an authentication key.");if(null==this.getPayload()||""===this.getPayload())throw new J("Missing payload");let tu=yield tn.signWithId(to,ta,...this.getSigningInputs());this.setProof(new ja.Proof(to,tu))})}getSignerDocument(){return A(this,void 0,void 0,function*(){return null!=this.signer||(this.getOperation().equals(ja.Operation.DECLARE)?this.signer=yield this.getCredential().getSubject().getId().resolve():this.signer=yield this.getProof().getVerificationMethod().getDid().resolve()),this.signer})}static parse(tn,to=null){try{return Ft.deserialize(tn,Qa,to)}catch(tn){throw tn instanceof J?tn:new J(tn)}}};let $a=class $a extends Ha{constructor(tn=null,to=null,ta=null){super(tn,to,ta)}getId(){return this.getRequest().getCredentialId()}requestFromJSON(tn){return Qa.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,$a,to)}catch(tn){throw tn instanceof G?tn:new G(tn)}}};let tl=class tl extends Ka{constructor(tn=null){super(tn,tl.METHOD_NAME)}setParameters(tn,to=0,ta=0){tn instanceof Jt?super.setParameters(new el(tn,to,ta)):super.setParameters(tn)}getDid(){return this.getParameters().did}getSkip(){return this.getParameters().skip}getLimit(){return this.getParameters().limit}toString(){let tn=new Xt.Builder(this.getParameters().did);return tn.setPath("/credentials"),tn.setQueryParameter(tl.PARAMETER_SKIP,this.getParameters().skip.toFixed()),tn.setQueryParameter(tl.PARAMETER_LIMIT,this.getParameters().limit.toFixed()),tn.build().toString()}paramsFromJson(tn){return el.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,tl,to)}catch(tn){throw tn instanceof $?tn:new $(tn)}}};tl.PARAMETER_DID="did",tl.PARAMETER_SKIP="skip",tl.PARAMETER_LIMIT="limit",tl.METHOD_NAME="did_listCredentials";let el=class el extends Ka.Parameters{constructor(tn=null,to=0,ta=0){super(),this.did=tn,this.skip=to,this.limit=ta}hashCode(){return this.did.hashCode()+(Ht(this.skip)+Ht(this.limit))}equals(tn){return tn instanceof el&&!!this.did.equals(tn.did)&&this.skip==tn.skip&&this.limit==tn.limit}toJSON(tn=null){let to={};return to.did=this.did.toString(),this.skip&&0!=this.skip&&(to.skip=this.skip),this.limit&&0!=this.limit&&(to.limit=this.limit),to}fromJSON(tn,to=null){this.did=super.getDid("did",tn.did,{mandatory:!0,nullable:!1}),this.skip=this.getNumber("skip",tn.skip,{mandatory:!1,nullable:!1,defaultValue:0}),this.limit=this.getNumber("limit",tn.limit,{mandatory:!1,nullable:!1,defaultValue:0})}static parse(tn,to=null){try{return Ft.deserialize(tn,el,to)}catch(tn){throw tn instanceof $?tn:new $(tn)}}};let il=class il extends za.Result{constructor(tn=null){super(),this.did=tn}getDid(){return this.did}getCredentialIds(){return null!=this.credentialIds?this.credentialIds:[]}size(){return null!=this.credentialIds?this.credentialIds.length:0}getCredentialId(tn){return null!=this.credentialIds?this.credentialIds[tn]:null}addCredentialId(tn){null==this.credentialIds&&(this.credentialIds=[]),this.credentialIds.push(tn)}toJSON(tn=null){let to={};return to.did=this.did.toString(),this.credentialIds&&this.credentialIds.length>0&&(to.credentials=Array.from(this.credentialIds,tn=>tn.toString())),to}fromJSON(tn,to=null){if(this.did=super.getDid("did",tn.did,{mandatory:!0,nullable:!1}),tn.credentials){if(!Array.isArray(tn.credentials))throw new Z("Invalid credential list");tn.credentials.length>0&&(this.credentialIds=Array.from(tn.credentials,tn=>new Xt(String(tn))))}}static parse(tn,to=null){try{return Ft.deserialize(tn,il,to)}catch(tn){throw tn instanceof Z?tn:new Z(tn)}}};il.DEFAULT_SIZE=128,il.MAX_SIZE=512;let rl=class rl{constructor(tn,to){this.name=to,this.value=tn}getValue(){return this.value}static fromValue(tn){switch(String(tn)){case"0":return rl.VALID;case"2":return rl.DEACTIVATED;case"3":return rl.NOT_FOUND;default:throw new P("Invalid DIDBiographyStatus")}}toString(){return this.name.toLowerCase()}equals(tn){return this.value==tn.value}};(tc=rl||(rl={})).VALID=new tc(0,"valid"),tc.DEACTIVATED=new tc(2,"deactivated"),tc.NOT_FOUND=new tc(3,"not_found");let nl=class nl extends za.Result{constructor(tn=null){super(),this.did=tn}getDid(){return this.did}setStatus(tn){this.status=tn}getStatus(){return this.status}getTransactionCount(){return null!=this.txs?this.txs.length:0}getTransaction(tn){return null!=this.txs?this.txs[tn]:null}getAllTransactions(){return null!=this.txs?this.txs:[]}addTransaction(tn){null==this.txs&&(this.txs=[]),this.txs.push(tn)}toJSON(tn=null){let to={};return to.did=this.did.toString(),to.status=this.status.toString(),this.txs&&this.txs.length>0&&(to.transaction=Array.from(this.txs,tn=>tn.toJSON())),to}fromJSON(tn,to=null){this.did=super.getDid("did",tn.did,{mandatory:!0,nullable:!1});let ta=this.getNumber("status",tn.status,{mandatory:!0,nullable:!1});if(this.status=rl.fromValue(ta),this.status.equals(rl.NOT_FOUND)){if(tn.transaction)throw new Z("Should not include transaction")}else{if(!tn.transaction)throw new Z("Missing transaction");if(!Array.isArray(tn.transaction)||0==tn.transaction.length)throw new Z("Invalid transaction");this.txs=Array.from(tn.transaction,tn=>Xa.parse(tn))}}static parse(tn,to=null){try{return Ft.deserialize(tn,nl,to)}catch(tn){throw tn instanceof Z?tn:new Z(tn)}}};let ol=class ol extends za{constructor(tn=null,to=null){super(tn,to)}resultFromJson(tn){return il.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,ol,to)}catch(tn){throw tn instanceof tt?tn:new tt(tn)}}};let sl=class sl extends za{constructor(tn=null,to=null){super(tn,to)}resultFromJson(tn){return nl.parse(tn)}static parse(tn,to=null){try{return Ft.deserialize(tn,sl,to)}catch(tn){throw tn instanceof tt?tn:new tt(tn)}}};let rq=new T("DIDBackend");let ll=class ll{constructor(tn,to,ta,tu){to<0&&(to=0),ta<0&&(ta=0),tu<0&&(tu=0),this.adapter=tn,this.cache=new dl({maxItems:ta,maxAge:tu/1e3,asyncLoader:tn=>A(this,void 0,void 0,function*(){return{value:yield this.resolve(tn)}})}),rq.info("DID backend initialized, cache(init:{}, max:{}, ttl:{})",to,ta,tu/1e3)}static initialize(tn,to=ll.DEFAULT_CACHE_INITIAL_CAPACITY,ta=ll.DEFAULT_CACHE_MAX_CAPACITY,tu=ll.DEFAULT_CACHE_TTL){qt(null!=tn,"Invalid adapter"),qt(to<=ta,"Invalid cache capacity"),to=to<ta?to:ta,this.instance=new ll(tn,to,ta,tu)}static getInstance(){return qt(null!=this.instance,"The DIDBackend was not initialized. Please call DIDBackend.initialize() with a valid DIDAdapter (i.e. new DefaultDIDAdapter()) first."),this.instance}static isInitialized(){return null!==this.instance}generateRequestId(){return(0,td.randomBytes)(16).toString("hex")}getAdapter(){return this.adapter}setResolveHandle(tn){this.resolveHandle=tn}resolve(tn){return A(this,void 0,void 0,function*(){let to=tn.serialize(!0);rq.trace("Resolving request: "+to);let ta=yield this.getAdapter().resolve(to);if(rq.trace("Resolving response: "+JSON.stringify(ta)),null==ta)throw new k("Unknown error, got null result.");let tu=null;try{switch(tn.getMethod()){case Ba.METHOD_NAME:tu=sl.parse(ta,sl);break;case Ga.METHOD_NAME:tu=Wa.parse(ta,Wa);break;case tl.METHOD_NAME:tu=ol.parse(ta,ol);break;default:throw rq.error("INTERNAL - unknown resolve method '{}'",tn.getMethod()),new k("Unknown resolve method: "+tn.getMethod())}}catch(tn){throw new k(tn)}if(null==tu.getResponseId()||tu.getResponseId()!==tn.getRequestId())throw new k("Mismatched resolve result with request.");if(null!=tu.getResult())return tu.getResult();throw new k("Server error("+tu.getErrorCode()+"): "+tu.getErrorMessage())})}resolveDidBiography(tn,to=!0,ta=!1){return A(this,void 0,void 0,function*(){rq.info("Resolving DID {}, all={}...",tn.toString(),to);let tu=new Ba(this.generateRequestId());tu.setParameters(tn,to),ta&&this.cache.invalidate(tu);try{return yield this.cache.getAsync(tu)}catch(tn){throw new k(tn)}})}resolveDid(tn,to=!1){return A(this,void 0,void 0,function*(){if(rq.debug("Resolving DID {}...",tn.toString()),null!=this.resolveHandle){let to=this.resolveHandle.resolve(tn);if(null!=to)return to}let ta=yield this.resolveDidBiography(tn,!1,to),tu=null;if(ta.getStatus().equals(rl.VALID))tu=ta.getTransaction(0);else if(ta.getStatus().equals(rl.DEACTIVATED)){if(2!=ta.getTransactionCount())throw new k("Invalid DID biography, wrong transaction count.");if(!(tu=ta.getTransaction(0)).getRequest().getOperation().equals(ja.Operation.DEACTIVATE))throw new k("Invalid DID biography, wrong status.");let tn=ta.getTransaction(1).getRequest().getDocument();if(null==tn)throw new k("Invalid DID biography, invalid trancations.");let to=new class extends Ja{constructor(tn){super(),this.constructWithIDChainRequest(tn)}getSignerDocument(){return A(this,void 0,void 0,function*(){let to=null==this.getDocument()?tn:this.getDocument();return to.isCustomizedDid()&&(yield to.resolveControllers()),to})}}(tu.getRequest());if(!(yield to.isValid()))throw new k("Invalid DID biography, transaction signature mismatch.");tu=ta.getTransaction(1)}else if(ta.getStatus().equals(rl.NOT_FOUND))return null;if(!tu.getRequest().getOperation().equals(ja.Operation.CREATE)&&!tu.getRequest().getOperation().equals(ja.Operation.UPDATE)&&!tu.getRequest().getOperation().equals(ja.Operation.TRANSFER))throw new k("Invalid ID transaction, unknown operation.");if(!(yield tu.getRequest().isValid()))throw new k("Invalid ID transaction, signature mismatch.");let tc=tu.getRequest().getDocument().clone();yield tc.resolveControllers();let th=tc.getMetadata();return th.setTransactionId(tu.getTransactionId()),th.setSignature(tc.getProof().getSignature()),th.setPublished(tu.getTimestamp()),ta.getStatus().equals(rl.DEACTIVATED)&&th.setDeactivated(!0),tc})}resolveUntrustedDid(tn,to){return A(this,void 0,void 0,function*(){if(rq.debug("Resolving untrusted DID {}...",tn.toString()),null!=this.resolveHandle){let to=this.resolveHandle.resolve(tn);if(null!=to)return to}let ta=yield this.resolveDidBiography(tn,!1,to),tu=null;switch(ta.getStatus().getValue()){case rl.VALID.getValue():tu=ta.getTransaction(0);break;case rl.DEACTIVATED.getValue():if(2!=ta.getTransactionCount())throw new k("Invalid DID biography, wrong transaction count.");if((tu=ta.getTransaction(0)).getRequest().getOperation()!=ja.Operation.DEACTIVATE)throw new k("Invalid DID biography, wrong status.");if(null==ta.getTransaction(1).getRequest().getDocument())throw new k("Invalid DID biography, invalid trancations.");tu=ta.getTransaction(1);break;case rl.NOT_FOUND.getValue():return null}if(tu.getRequest().getOperation()!=ja.Operation.CREATE&&tu.getRequest().getOperation()!=ja.Operation.UPDATE&&tu.getRequest().getOperation()!=ja.Operation.TRANSFER)throw new k("Invalid ID transaction, unknown operation.");let tc=tu.getRequest().getDocument().clone();yield tc.resolveControllers();let th=tc.getMetadata();return th.setTransactionId(tu.getTransactionId()),th.setSignature(tc.getProof().getSignature()),th.setPublished(tu.getTimestamp()),ta.getStatus()==rl.DEACTIVATED&&th.setDeactivated(!0),tc})}resolveCredentialBiography(tn,to=null,ta=!1){rq.info("Resolving credential {}, issuer={}...",tn,to);let tu=new Ga(this.generateRequestId());tu.setParameters(tn,to),ta&&this.cache.invalidate(tu);try{return this.cache.getAsync(tu)}catch(tn){throw new k(tn)}}resolveCredential(tn,to=null,ta=!1){return A(this,void 0,void 0,function*(){rq.debug("Resolving credential {}...",tn);let tu=yield this.resolveCredentialBiography(tn,to,ta),tc=null;if(tu.getStatus().equals(qa.VALID))tc=tu.getTransaction(0);else if(tu.getStatus().equals(qa.REVOKED)){if(!(tc=tu.getTransaction(0)).getRequest().getOperation().equals(ja.Operation.REVOKE))throw new k("Invalid credential biography, wrong status.");if(1>tu.getTransactionCount()||tu.getTransactionCount()>2)throw new k("Invalid credential biography, transaction signature mismatch.");if(1==tu.getTransactionCount()){if(!(yield tc.getRequest().isValid()))throw new k("Invalid credential biography, transaction signature mismatch.");return null}{let tn=tu.getTransaction(1).getRequest().getCredential(),to=new class extends Qa{constructor(tn){super(),this.constructWithIDChainRequest(tn)}getCredential(){return tn}}(tc.getRequest());if(!(yield to.isValid()))throw new k("Invalid credential biography, transaction signature mismatch.")}tc=tu.getTransaction(1)}else if(tu.getStatus().equals(qa.NOT_FOUND))return null;if(!tc.getRequest().getOperation().equals(ja.Operation.DECLARE))throw new k("Invalid credential transaction, unknown operation.");if(!(yield tc.getRequest().isValid()))throw new k("Invalid credential transaction, signature mismatch.");let th=tc.getRequest().getCredential(),td=new re(th.getId());return td.setTransactionId(tc.getTransactionId()),td.setPublished(tc.getTimestamp()),tu.getStatus()==qa.REVOKED&&td.setRevoked(!0),th.setMetadata(td),th})}listCredentials(tn,to,ta){return A(this,void 0,void 0,function*(){rq.info("List credentials for {}",tn);let tu=new tl(this.generateRequestId());tu.setParameters(tn,to,ta);let tc=yield this.resolve(tu);return null==tc||0==tc.size()?null:tc.getCredentialIds()})}createTransaction(tn,to){return A(this,void 0,void 0,function*(){rq.info("Create ID transaction...");let ta=tn.serialize(!0);rq.trace("Transaction payload: '{}'",ta),null==to&&(to=this.getAdapter()),yield to.createIdTransaction(ta,null),rq.info("ID transaction complete.")})}invalidDidCache(tn){let to=new Ba(this.generateRequestId());to.setParameters(tn,!0),this.cache.invalidate(to),to.setParameters(tn,!1),this.cache.invalidate(to)}invalidCredentialCache(tn,to){let ta=new Ga(this.generateRequestId());ta.setParameters(tn,to),this.cache.invalidate(ta),null!=to&&(ta.setParameters(tn,null),this.cache.invalidate(ta))}clearCache(){this.cache.invalidateAll()}createDid(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=yield Ja.create(tn,to,ta);yield this.createTransaction(tc,tu),this.invalidDidCache(tn.getSubject())})}updateDid(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){let th=yield Ja.update(tn,to,ta,tu);yield this.createTransaction(th,tc),this.invalidDidCache(tn.getSubject())})}transferDid(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){let th=yield Ja.transfer(tn,to,ta,tu);yield this.createTransaction(th,tc),this.invalidDidCache(tn.getSubject())})}deactivateDid(tn,to,ta,tu){return A(this,void 0,void 0,function*(){let tc=yield Ja.deactivate(tn,to,ta);yield this.createTransaction(tc,tu),this.invalidDidCache(tn.getSubject())})}deactivateTargetDid(tn,to,ta,tu,tc,th){return A(this,void 0,void 0,function*(){let td=yield Ja.deactivateTarget(tn,to,ta,tu,tc);yield this.createTransaction(td,th),this.invalidDidCache(tn.getSubject())})}declareCredential(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){let th=yield Qa.declare(tn,to,ta,tu);yield this.createTransaction(th,tc),this.invalidCredentialCache(tn.getId(),null),this.invalidCredentialCache(tn.getId(),tn.getIssuer())})}revokeCredential(tn,to,ta,tu,tc){return A(this,void 0,void 0,function*(){if(tn instanceof se){let th=yield Qa.revoke(tn,to,ta,tu);yield this.createTransaction(th,tc),this.invalidCredentialCache(tn.getId(),null),this.invalidCredentialCache(tn.getId(),tn.getIssuer())}else{let th=yield Qa.revoke(tn,to,ta,tu);yield this.createTransaction(th,tc),this.invalidCredentialCache(tn,null),this.invalidCredentialCache(tn,to.getSubject())}})}};ll.DEFAULT_CACHE_INITIAL_CAPACITY=16,ll.DEFAULT_CACHE_MAX_CAPACITY=64,ll.DEFAULT_CACHE_TTL=6e5,ll.instance=null;let rz=new T("DefaultDIDAdapter");let cl=class cl{constructor(tn){qt(tn&&null!=tn,"Invalid resolver URL");let to=null;switch(tn.toLowerCase()){case"mainnet":tn=cl.MAINNET_RPC_ENDPOINTS[0],to=cl.MAINNET_RPC_ENDPOINTS;break;case"testnet":tn=cl.TESTNET_RPC_ENDPOINTS[0],to=cl.TESTNET_RPC_ENDPOINTS}try{this.rpcEndpoint=new URL(tn)}catch(tn){throw new P("Invalid resolver URL",tn)}to&&this.checkNetwork(to).then(()=>{rz.info("finished the network check")}).catch(tn=>{rz.error("check the network error: "+tn)})}checkEndpoint(tn){return A(this,void 0,void 0,function*(){let to={},ta=Date.now();to.id=ta,to.jsonrpc="2.0",to.method="eth_blockNumber";let tu,tc=JSON.stringify(to),th=Date.now();try{tu=yield this.performRequest(tn,tc);let to=Date.now()-th;if(tu.id!=ta)throw new Pt("Invalid JSON RPC id.");let td=tu.result;td.startsWith("0x")&&(td=td.substring(2));let tf=parseInt(td,16);return new cl.CheckResult(tn,to,tf)}catch(to){return rz.info("Checking the resolver {}...error",tn),cl.CheckResult.from(tn)}})}checkNetwork(tn){return A(this,void 0,void 0,function*(){let to=[],ta=[];for(let tu of tn){let tn=this.checkEndpoint(new URL(tu)).then(tn=>{to.push(tn)});ta.push(tn)}try{yield Promise.all(ta)}catch(tn){}to.length>0&&ae.sort(to);let tu=to[0];tu.available()&&(this.rpcEndpoint=tu.endpoint)})}performRequest(tn,to){return new Promise((ta,tu)=>{t_({method:"post",url:tn.toString(),maxRedirects:5,headers:{"Content-Type":"application/json",Accept:"application/json"},data:to,timeout:6e3}).then(tn=>{tn.status>=200&&tn.status<400?ta(tn.data):tu(new wt("HTTP error"))}).catch(tn=>{tu(new wt("HTTP timeout."))})})}resolve(tn){return A(this,void 0,void 0,function*(){qt(tn&&null!=tn,"Invalid request");try{return yield this.performRequest(this.rpcEndpoint,tn)}catch(tn){throw new mt("Network error: "+tn)}})}createIdTransaction(tn,to){throw new vt("Not implemented")}};cl.MAINNET_RPC_ENDPOINTS=["https://api.elastos.io/eid","https://api.trinity-tech.io/eid"],cl.TESTNET_RPC_ENDPOINTS=["https://api-testnet.elastos.io/eid","https://api-testnet.trinity-tech.io/eid"],function(tn){let e=class e{constructor(tn,to,ta){this.endpoint=tn,this.latency=to,this.lastBlock=ta}static from(tn){return new e(tn,-1,-1)}equals(tn){return 0==this.compareTo(tn)}compareTo(tn){if(null==tn)return -1;if(tn.latency<0&&this.latency<0)return 0;if(tn.latency<0||this.latency<0)return this.latency<0?1:-1;let to=tn.lastBlock.valueOf()-this.lastBlock.valueOf();return Math.abs(to)-e.MAX_DIFF>0||this.latency==tn.latency?to>0?1:-1:this.latency-tn.latency}available(){return this.latency>=0}};e.MAX_DIFF=10,tn.CheckResult=e}(cl||(cl={}));let hl=class hl extends cl{constructor(tn){super(new URL("/resolve",new URL(tn)).toString()),this.serverURL=new URL(tn),this.idtxEndpoint=new URL("/idtx",this.serverURL)}createIdTransaction(tn,to){return A(this,void 0,void 0,function*(){qt(null!==tn&&tn.length>0,"Invalid payload");try{yield this.performRequest(this.idtxEndpoint,tn)}catch(tn){throw new It("Create ID transaction failed.",tn)}})}resetData(){return A(this,void 0,void 0,function*(){let tn=new URL("/reset",this.serverURL);yield this.performRequest(tn)})}};let dl=class dl{constructor(tn={}){this.count=0,this.items=new Map,this.first=null,this.last=null,this.options=Object.assign({maxItems:void 0,maxAge:void 0,loader:void 0},tn),this.invalidateAll()}put(tn,to,ta){this.putInternal(tn,to,ta)}putInternal(tn,to,ta){let tu=this.getHash(tn),tc=this.items.get(tu);if(tc)tc.value=to;else{let tu=this.getHash(tn);tc={key:tn,value:to,prev:null,next:null,meta:ta},this.items.set(tu,tc),this.count++}return this.options.maxAge&&(tc.expires=Date.now()/1e3+this.options.maxAge),this.promote(tc),this.options.maxItems&&this.count>this.options.maxItems&&this.invalidate(this.last.key),tc}getHash(tn){return"string"==typeof tn?tn:tn.hashCode().toString()}get(tn,to){let ta=this.getHash(tn),tu=this.items.get(ta);if(tu&&tu.expires&&Date.now()/1e3>=tu.expires&&(this.invalidate(tn),tu=null),!tu){let ta=null;if(to?ta=to:this.options.loader&&(ta=this.options.loader),ta){let{value:to,meta:tc}=ta(tn);null!=to&&(tu=this.putInternal(tn,to,tc))}if(!tu)return null}return this.promote(tu),tu.value}getAsync(tn,to){return A(this,void 0,void 0,function*(){let ta=this.getHash(tn),tu=this.items.get(ta);if(tu&&tu.expires&&Date.now()/1e3>=tu.expires&&(this.invalidate(tn),tu=null),!tu){let ta=null;if(to?ta=to:this.options.asyncLoader&&(ta=this.options.asyncLoader),ta){let{value:to,meta:tc}=yield ta(tn);null!=to&&(tu=this.putInternal(tn,to,tc))}if(!tu)return null}return this.promote(tu),tu.value})}invalidateAll(tn){tn?this.items.forEach((to,ta,tu)=>{tn(to.key)&&this.invalidate(to.key)}):(this.items.clear(),this.first=null,this.last=null,this.count=0)}invalidate(tn){let to=this.getHash(tn),ta=this.items.get(to);return!!ta&&(this.count--,this.items.delete(to),ta.prev&&(ta.prev.next=ta.next),ta.next&&(ta.next.prev=ta.prev),ta===this.first&&(this.first=ta.next),ta===this.last&&(this.last=ta.prev),!0)}has(tn){let to=this.getHash(tn),ta=this.items.get(to);return!!ta&&!(ta.expires&&Date.now()/1e3>=ta.expires)}promote(tn){tn!==this.first&&(tn.prev&&(tn.prev.next=tn.next),tn.next&&(tn.next.prev=tn.prev),tn===this.last&&(this.last=tn.prev),tn.prev=null,tn.next=this.first,this.first&&(this.first.prev=tn),this.first=tn,this.last||(this.last=tn))}getMeta(tn){let to=this.getHash(tn),ta=this.items.get(to);return ta?ta.expires&&Date.now()/1e3>=ta.expires?(this.invalidate(tn),null):(this.promote(ta),ta.meta):null}};if("undefined"!=typeof window){if("elastos_did_ver"in window)throw Error("Elastos DID sdk("+window.elastos_did_ver+") already loaded.");window.elastos_did_ver="2.3.1"}}}]);