"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9510],{89510:function(e,t,i){i.d(t,{identityFromJson:function(){return identityFromJson}});var n=i(47276),a=i(36079),r=i(4746),s=i(62067),l=i.n(s),d=i(59885),o=i(70779),c=i(45685);let ProfileFeature=class ProfileFeature{constructor(e){this.identity=e,this.appInfoCredential$=new o.P(null,async()=>{this.identity.credentials().credentials$.pipe((0,c.U)(e=>null==e?void 0:e.filter(e=>!!e.getTypes().find(e=>"ApplicationCredential"===e))),(0,c.U)(e=>null==e?void 0:e[0])).subscribe(e=>{this.appInfoCredential$.next(e)})})}};let ApplicationIdentity=class ApplicationIdentity extends d.i{static async fromJson(e,t){let i=new ApplicationIdentity;return await i.fillFromJson(e,t),i}profile(){return this.get("profile")}async update(e,t){return a.k.log("identity","DID Session debug (did):",this.did),this.upsertApplicationCredential("#appinfo",{name:e,iconUrl:t,developer:{did:""},endpoints:{redirectUrl:"",callbackUrl:"",customScheme:""}},"did://elastos/iXyYFboFAd2d9VmfqSvppqg1XQxBtX9ea2/ApplicationCredential#ApplicationCredential")}async upsertApplicationCredential(e,t,i){let s;await (0,r.B)(this.credentials().credentials$);do(s=this.credentials().getCredentialByType(new n.d(i).getShortType()))&&(await this.document().setCredentialVisibility(s.id,!1),await this.credentials().deleteCredential(s));while(s);a.k.log("identity","Creating application credential");let d=l()().add(5,"years"),o=await this.credentials().createCredential(e,[i],d.toDate(),t);return await this.document().setCredentialVisibility(o.id,!0),o}constructor(){super(),this.addFeature("profile",new ProfileFeature(this))}};var p=i(58087),u=i(396);async function identityFromJson(e,t){switch(e.type){case u.M.REGULAR:return p.l.fromJson(e,t);case u.M.APPLICATION:return ApplicationIdentity.fromJson(e,t);default:throw Error("Unknow identity type ".concat(e.type))}}}}]);