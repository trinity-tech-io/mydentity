"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9510],{89510:function(e,t,i){i.d(t,{identityFromJson:function(){return y}});var n=i(36079),a=i(4746),r=i(62067),s=i.n(r),l=i(59885),d=i(70779),c=i(45685);class o{constructor(e){this.identity=e,this.appInfoCredential$=new d.P(null,async()=>{this.identity.credentials().credentials$.pipe((0,c.U)(e=>null==e?void 0:e.filter(e=>!!e.getTypes().find(e=>"ApplicationCredential"===e))),(0,c.U)(e=>null==e?void 0:e[0])).subscribe(e=>{this.appInfoCredential$.next(e)})})}}class p extends l.i{static async fromJson(e,t){let i=new p;return await i.fillFromJson(e,t),i}profile(){return this.get("profile")}async update(e,t){return n.k.log("identity","DID Session debug (did):",this.did),this.upsertApplicationCredential("#appinfo",{name:e,iconUrl:t,developer:{did:""},endpoints:{redirectUrl:"",callbackUrl:"",customScheme:""}},"did://elastos/iXyYFboFAd2d9VmfqSvppqg1XQxBtX9ea2/ApplicationCredential#ApplicationCredential")}async upsertApplicationCredential(e,t,i){await (0,a.B)(this.credentials().credentials$);let r=this.credentials().getCredentialByType(i);r&&(await this.document().setCredentialVisibility(r.id,!1),await this.credentials().deleteCredential(r)),n.k.log("identity","Creating application credential");let l=s()().add(5,"years"),d=await this.credentials().createCredential(e,[i],l.toDate(),t);return await this.document().setCredentialVisibility(d.id,!0),d}constructor(){super(),this.addFeature("profile",new o(this))}}var u=i(58087),h=i(396);async function y(e,t){switch(e.type){case h.M.REGULAR:return u.l.fromJson(e,t);case h.M.APPLICATION:return p.fromJson(e,t);default:throw Error("Unknow identity type ".concat(e.type))}}}}]);