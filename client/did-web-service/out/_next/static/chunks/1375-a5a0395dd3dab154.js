(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1375],{80950:function(){},46601:function(){},89214:function(){},8623:function(){},7748:function(){},85568:function(){},75992:function(){},78110:function(){},56619:function(){},77108:function(){},52361:function(){},94616:function(){},12131:function(e,t,n){"use strict";n.d(t,{c:function(){return l}});var r=n(57437),i=n(6882),a=n(35551),s=n(57042);let l=e=>{let{leftIcon:t,size:n="medium",mode:l="default",onClick:o,children:u,busy:c=!1,disabled:d=!1,className:h}=e,f=(0,r.jsx)(i.Z,{size:16});return(0,r.jsx)("div",{className:(0,s.Z)("flex",h),children:(0,r.jsx)(a.Z,{className:"flex-1",startIcon:c?f:t,disabled:c||d,size:n,color:"default"===l?"primary":"error",variant:"contained",onClick:o,children:u})})}},57135:function(e,t,n){"use strict";n.d(t,{au:function(){return g},lJ:function(){return m}});var r=n(57437),i=n(451),a=n(10530),s=n(89394),l=n(43226),o=n(69990),u=n(2265),c=n(12131);let d=e=>{let{onConfirm:t,disabled:n}=e,[a]=(0,i.V)((0,o.jU)()),s=null==a?void 0:a.get("security"),l=async()=>{let e=await s.unlockPasskeyLocally();t(e)};return(0,r.jsxs)("div",{className:"flex flex-row gap-4 bg-gray-100 mt-4 p-4 items-center",children:[(0,r.jsxs)("p",{className:"uppercase text-xs",children:["Browser",(0,r.jsx)("br",{}),"authentication"]}),(0,r.jsx)(c.c,{onClick:l,disabled:n,children:"Unlock with passkey"})]})};var h=n(20879);let f=e=>{let{onConfirm:t,disabled:n}=e,i=(0,u.createRef)();return(0,r.jsxs)("div",{className:"flex flex-row gap-4 bg-gray-100 mt-4 p-4",children:[(0,r.jsxs)("p",{className:"uppercase text-xs",children:["master",(0,r.jsx)("br",{}),"password"]}),(0,r.jsx)(h.Z,{label:"Your password",inputRef:i,autoFocus:!0,type:"password",name:"master-password",variant:"outlined",size:"small",disabled:n}),(0,r.jsx)(c.c,{onClick:()=>{let e=i.current.value;t(e)},disabled:n,children:"Continue"})]})},y=(0,u.createContext)({actions:null,setActions:null});function g(e){let[t,n]=(0,u.useState)(null);return(0,r.jsxs)(y.Provider,{value:{actions:t,setActions:n},children:[e.children,(0,r.jsx)(p,{})]})}let p=()=>{let{actions:e,setActions:t}=(0,u.useContext)(y),[n]=(0,i.V)((0,o.jU)()),c=null==n?void 0:n.get("security"),[h]=(0,i.V)(null==c?void 0:c.passwordKeys$),[g]=(0,i.V)(null==c?void 0:c.passkeyKeys$),p=()=>{t(null)};return(0,r.jsx)(s.Z,{open:!!e,disablePortal:!0,onClose:()=>{var t;null===(t=e.onUnlockKey)||void 0===t||t.call(e,null),p()},children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)(l.Z,{variant:"h4",children:"Content unlock needed!"}),(0,r.jsxs)(l.Z,{color:"#666",fontSize:14,children:["Your encrypted data needs to be unlocked so we can display it.",(0,r.jsx)("br",{}),"We can't do this without your interaction."]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(f,{onConfirm:t=>{var n;null===(n=e.onUnlockKey)||void 0===n||n.call(e,{type:a.J.PASSWORD,keyId:"unused-for-now-for-passwords",key:t}),p()},disabled:(null==h?void 0:h.length)==0})}),(0,r.jsx)("div",{className:"my-4 text-center text-xs",children:"or"}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(d,{onConfirm:t=>{var n;null===(n=e.onUnlockKey)||void 0===n||n.call(e,t),p()},disabled:(null==g?void 0:g.length)==0})})]})})},m=()=>{let{setActions:e}=(0,u.useContext)(y);return{promptMasterKeyUnlock:()=>new Promise(t=>{e({onUnlockKey:t})})}}},451:function(e,t,n){"use strict";n.d(t,{V:function(){return i}});var r=n(2265);let i=(e,t)=>{let[n,i]=(0,r.useState)(null==e?void 0:e.getValue()),[a,s]=(0,r.useState)();return(0,r.useEffect)(()=>{if(!e)return;let n=e.subscribe({next:e=>{i(e),null==t||t(e)},error:s});return()=>n.unsubscribe()},[e]),[n]}},99617:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var r=n(10530),i=n(20708),a=n(69990),s=n(18961),l=n(17390);let o=new l.R;class u{get activeShadowKey$(){return this._activeShadowKey$.getSubject()}static async fromJson(e){return o.get(e.id,{create:async function(){return new u},fill:async function(t){Object.assign(t,e),t.createdAt=new Date(e.createdAt),t.lastUsedAt=new Date(e.lastUsedAt)}})}isCurrentBrowser(){return this.id===(0,i.NN)()}equals(e){return this.id===(null==e?void 0:e.id)}constructor(){this._activeShadowKey$=new s.h(null,async()=>{(0,a.jU)().subscribe(e=>null==e?void 0:e.get("security").shadowKeys$.subscribe(e=>{this.activeShadowKey$.next(e.find(e=>{var t;return e.type===r.J.WEBAUTHN&&(null===(t=e.browser)||void 0===t?void 0:t.equals(this))}))}))})}}},69144:function(e,t,n){"use strict";n.d(t,{C:function(){return o},q:function(){return l}});var r=n(26588),i=n(89488),a=n(31710),s=n(5676);async function l(e){let t;let n=r.O7.parse(e.verifiableCredential),l=(0,i.m)(n.type);return Object.assign(t=l?new s.E(l):new a.h,e),t.createdAt=new Date(e.createdAt),t.verifiableCredential=n,t.prepareForDisplay(),t}async function o(e){let t;let n=(0,i.m)(e.type);return(t=n?new s.E(n):new a.h).verifiableCredential=e,t.prepareForDisplay(),t}},31710:function(e,t,n){"use strict";n.d(t,{h:function(){return D}});var r=n(26588);class i{static async loadOrCreate(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=new i(e,n,t);return await r.load(),r}set(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.items.findIndex(t=>t.key==e),i={key:e,timeValue:n,data:t};-1===r?this.items.push(i):this.items[r]=i,this.items.sort((e,t)=>0===e.timeValue?-1:0===t.timeValue?1:e.timeValue>t.timeValue?-1:e.timeValue<t.timeValue?1:0)}remove(e){let t=this.items.findIndex(t=>t.key==e);t>=0&&this.items.splice(t,1)}get(e){return this.items.find(t=>t.key==e)}values(){return this.items}size(){return this.items.length}async save(){let e=this.items.slice(0,Math.min(this.items.length,this.maxItemsOnDisk)),t="cache"+this.name;localStorage.setItem(t,JSON.stringify(e))}async load(){let e="cache"+this.name,t=localStorage.getItem(e);t&&(this.items=JSON.parse(t))}async delete(){let e="cache"+this.name;localStorage.removeItem(e)}constructor(e,t,n){this.name=e,this.maxItemsOnDisk=t,this.storeGlobally=n}}var a=n(3883),s=n(69810),l=n.n(s),o=n(50676),u=n(88262);class c{get(e){if(!this.documentsSubjects.has(e)){let t=new o.X({checking:!1,checked:!1,document:null});this.documentsSubjects.set(e,t)}return this.documentsSubjects.get(e)}set(e,t,n,r){this.documentsSubjects.get(e).next({checking:t,checked:n,document:r})}constructor(){this.documentsSubjects=new Map}}let d=new class{async fetchActiveUserOnlineDIDDocument(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=u.D.getActiveIdentityId(),n=await this.resolveDIDWithoutDIDStore(t,e);return a.k.log("Identity","Resolved on chain document: ",n),this.onlineDIDDocumentsStatus.set(t,!1,!0,n),n}resolveDIDWithoutDIDStore(e,t){return this.resolveDIDQueue.add(async()=>{a.k.log("Identity","Resolving DID without DID store",e,t);let n=new r.y7(e);return r.D0.getInstance().resolveDid(n,t)})}fetchOrAwaitDIDDocumentWithStatus(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.onlineDIDDocumentsStatus.get(e);return new Promise(async r=>{if(n.value.checking){let e=n.subscribe(t=>{t.checked&&(e.unsubscribe(),r(t))})}else if(!n.value.checked||t){this.onlineDIDDocumentsStatus.set(e,!0,!1,null);let i=await this.resolveDIDWithoutDIDStore(e,t);a.k.log("Identity","Resolved on chain document: ",i),this.onlineDIDDocumentsStatus.set(e,!1,!0,i),r(n.value)}else r(n.value)})}getRepresentativeIcon(e){if(!e)return null;let t=null,n=e.getCredentials(),i=this.getCredentialsByType(n,"ApplicationCredential");if(i&&i.length>0){let e=i[0].getSubject().getProperties();"iconUrl"in e&&(t=e.iconUrl)}if(!t){let e=this.getCredentialsByType(n,"AvatarCredential");if(!e||0===e.length){let t=this.getCredentialById(n,new r.DD("#avatar"));t&&e.push(t)}if(e&&e.length>0){let n=e[0].getSubject().getProperties();if("avatar"in n&&"object"==typeof n.avatar){let e=n.avatar;"type"in e&&"elastoshive"===e.type&&(t=e.data)}}}if(!t)return null}getRepresentativeOwnerName(e){if(!e)return null;let t=null,n=e.getCredentials(),i=this.getCredentialsByType(n,"ApplicationCredential");if(i&&i.length>0){let e=i[0].getSubject().getProperties();"name"in e&&(t=e.name)}if(!t){let e=this.getCredentialsByType(n,"NameCredential");if(e&&e.length>0){let n=e[0].getSubject().getProperties();"name"in n&&(t=n.name)}}if(!t){let e=this.getCredentialById(n,new r.DD("#name"));if(e){let n=e.getSubject().getProperties();"name"in n&&(t=n.name)}}return t}getCredentialsByType(e,t){return null==e?void 0:e.filter(e=>e.getType().indexOf(t)>=0)}getCredentialById(e,t){return e.find(e=>t.getFragment()==e.getId().getFragment())}constructor(){this.onlineDIDDocumentsStatus=new c,this.resolveDIDQueue=new(l())(1),this.network="mainnet",r.D0.initialize(new r.lL(this.network))}};var h=n(13952),f=n.n(h),y=n(62067),g=n.n(y);let p=new class{async init(){this.contextsCache=await i.loadOrCreate("credentialcontextpayloads",!0)}async resolveExpandedCredentialTypeIdentifiers(e){let t=null;try{t=e.toJSON()}catch(e){return a.k.warn("credentialtypes","Credential could not be parsed, returning empty types"),[]}if(!("@context"in t)||0!==t["@context"].indexOf("https://www.w3.org/2018/credentials/v1"))return[];try{let e=await f().expand(t,{documentLoader:this.buildElastosJsonLdDocLoader()});if(e&&e.length>0){let t=e[0];return Array.isArray(t["@type"])?t["@type"]:[t["@type"]]}console.log("error")}catch(e){a.k.warn("credentialtypes","Credential could not be expanded, returning empty types.",e)}return[]}async resolveTypesWithContexts(e){let t=null;try{if(t=e.toJSON(),!("@context"in t)||0!==t["@context"].indexOf("https://www.w3.org/2018/credentials/v1"))return[];let n=t["@context"],r=[];for(let e of n){let t=await this.fetchContext(e);if(!t){a.k.warn("credentialtypes","Failed to fetch credential type context for",e);continue}"@context"in t&&r.push({url:e,payload:t})}let i=[];for(let t of e.getType()){let e=r.find(e=>Object.keys(e.payload["@context"]).indexOf(t)>=0);e&&i.push({context:e.url,shortType:t})}return i}catch(e){return a.k.warn("credentialtypes","Credential could not be parsed or , returning empty types.",e),[]}}async fetchContext(e){let t=this.contextsCache.get(e);return t?t.data:this.fetchContextQueue.add(async()=>{if(e.startsWith("http"))try{let t=await fetch(e),n=await t.json();return this.contextsCache.set(e,n,g()().unix()),n}catch(e){return a.k.warn("credentialtypes","Failed to get payload from context.",e),null}else{if(!e.startsWith("did:"))return a.k.log("credentialtypes","Unsupported credential context url",e),null;let{publisher:t,shortType:n}=this.extractEIDContext(e);if(!t)return a.k.warn("credentialtypes","Failed to extract publisher from context",e),null;let r=await d.fetchOrAwaitDIDDocumentWithStatus(t);if(!r.document)return null;{let i="".concat(t,"#").concat(n),a=this.getContextPayloadFromDIDDocument(r.document,i);return this.contextsCache.set(e,a,g()().unix()),a}}})}extractEIDContext(e){let t=new RegExp(/^did:\/\/elastos\/([a-zA-Z0-9]+)\/([a-zA-Z0-9]+)/).exec(e);return!t||t.length<3?(a.k.warn("credentialtypes","Invalid url format, cannot find credential publisher and ID"),null):{publisher:"did:elastos:".concat(t[1]),shortType:t[2]}}getContextPayloadFromDIDDocument(e,t){let n=e.getService(t);if(!n)return a.k.warn("credentialtypes","The DID document has no service with ID: "+t),null;let i=n.getServiceEndpoint(),s=this.getCredentialById(e,new r.DD(i));if(!s)return a.k.warn("credentialtypes","The DID document has no credential context credential that matches (service id, credential id): ",t,i),null;let l=s.getSubject().getProperties();return"definition"in l&&"@context"in l.definition?l.definition:(a.k.warn("credentialtypes","Credential ".concat(i," found but no definition/@context in the subject. Invalid format."),l),null)}buildElastosJsonLdDocLoader(){return(e,t)=>new Promise(async(t,n)=>{try{if(e.startsWith("did")){let n=await this.fetchContext(e);t({contextUrl:null,documentUrl:e,document:n})}else{let n=f().documentLoaders.xhr(),r=await n(e);t(r)}}catch(e){n(e)}})}async verifyCredential(e){try{let t=e.toJSON();if("object"!=typeof t)return a.k.warn("credentialtypes","verifyCredential false 331"),!1;if(!("@context"in t)||0!==t["@context"].indexOf("https://www.w3.org/2018/credentials/v1")||!("credentialSubject"in t)||!("proof"in t))return!1;let n=await f().compact(t,t["@context"],{documentLoader:this.buildElastosJsonLdDocLoader()});if(n){"credentialSubject"in n&&"string"!=typeof n.credentialSubject||(n.credentialSubject={id:n.credentialSubject});let{modifiedDoc:e,warningsGenerated:r}=this.addMissingFieldsToCompactHtmlResult(t,n);if(!r)return!0}}catch(e){a.k.warn("credentialtypes","verifyCredential error",e)}return!1}addMissingFieldsToCompactHtmlResult(e,t){let n=!1,r=Object.assign({},t);for(let i of Object.keys(e.credentialSubject))i in t.credentialSubject||(r.credentialSubject["MISSING_KEY_"+i]="This field is missing in credential types",n=!0);for(let i of Object.keys(e.proof))i in t.proof||(r.proof["MISSING_KEY_"+i]="This field is missing in credential types",n=!0);return{modifiedDoc:r,warningsGenerated:n}}getCredentialById(e,t){return e.getCredentials().find(e=>t.getFragment()==e.getId().getFragment())}constructor(){this.fetchContextQueue=new(l())(1)}};var m=n(67133).Buffer;let w=[{mime:"image/png",pattern:[137,80,78,71]},{mime:"image/jpeg",pattern:[255,216,255]},{mime:"image/gif",pattern:[71,73,70,56]},{mime:"image/webp",pattern:[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80,86,80]}];async function v(e){if(!e)return null;let t=await function(e){if("string"==typeof e){var t;t=e,e=m.from(t,"base64")}let n=Math.max(...w.map(e=>e.pattern.length)),r=new Blob([e.slice(0,n)]),i=new FileReader,a=new Promise(e=>{i.onloadend=t=>{if("loadend"==t.type){if(!t||!i.result){e(null);return}let n=new Uint8Array(i.result),r=w.find(e=>e.pattern.every((e,t)=>!e||n[t]===e));r?e(r.mime):e(null)}}});return i.readAsArrayBuffer(r),a}(e);return t?"data:"+t+";base64,"+(e?m.from(e).toString("base64"):null):(a.k.warn("picturehelper","Unable to extract mime type from picture buffer. rawImageToBase64DataUrl() returns null picture."),null)}let b=new class{async getIssuerName(e){let t=await this.fetchDIDDocument(e);return await d.getRepresentativeOwnerName(t)}async getIssuerAvatar(e){return new Promise(async t=>{let n=await this.fetchDIDDocument(e),r=await d.getRepresentativeIcon(n);r?r.subscribe(async e=>{if(e){let n=await v(e);t(n)}else t(null)}):t(null)})}async isPublished(e){let t=await this.fetchDIDDocument(e);return null!=t}async fetchDIDDocument(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=await d.fetchOrAwaitDIDDocumentWithStatus(e,t);return n.checked?n.document:null}};var I=n(18961);let k=(e,t)=>{t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"");let n=t.split(".");for(let t=0,r=n.length;t<r;++t){let r=n[t];if(!(r in e))return;e=e[r]}return e};var S=n(9177);class D{get issuerInfo$(){return this._issuerInfo$.getSubject()}get isConform$(){return this._isConform$.getSubject()}prepareForDisplay(){this.prepareDisplayTitle(),this.prepareDisplayValue(),this.prepareIcon()}getDisplayableCredentialTitle(){let e=this.verifiableCredential.getSubject();if(!("displayable"in e))return null;this.displayTitle=e.displayable.title}prepareDisplayTitle(){let e=this.getDisplayableCredentialTitle();if(e)this.displayTitle=e;else{let e=this.verifiableCredential.getId().getFragment();this.displayTitle=(0,S.fm)(e)}}getDisplayableCredentialDescription(){let e=this.verifiableCredential.getSubject();if(!("displayable"in e))return null;{let t=e.displayable.description;if(t){let n=t.match(/\${([a-zA-Z0-9.]+)}/g),r=n?Array.from(n):[],i=t;for(let t of r){let n=t.match(/\${([a-zA-Z0-9.]+)}/);if(n&&n.length>1){let r=n[1],a=k(e,r);i=i.replace(t,a)}}return i}}}prepareDisplayValue(){let e=this.getDisplayableCredentialDescription();if(e)this.displayValue=e;else{let e=this.getValueItems();if(e.length<=1){var t;this.displayValue=null===(t=e[0])||void 0===t?void 0:t.value}else this.displayValue=JSON.stringify(e)}}getDisplayValue(){return this.displayValue}async prepareIcon(){}loadIconWithFallback(){null==this.iconSrc&&(this.iconSrc=this.getFallbackIcon());let e=new Image;e.crossOrigin="anonymous",e.onload=()=>{var t;this.iconSrc=e.src,null===(t=this.onIconReadyCallback)||void 0===t||t.call(this,this.iconSrc)},e.onerror=()=>{var e;this.iconSrc=this.getFallbackIcon(),null===(e=this.onIconReadyCallback)||void 0===e||e.call(this,this.iconSrc)},e.src=this.iconSrc}getFallbackIcon(){return this.isUserAvatar()?"assets/identity/smallIcons/dark/name.svg":"assets/identity/smallIcons/dark/finger-print.svg"}hasRemotePictureToFetch(){let e=this.verifiableCredential.getId().getFragment();return"avatar"===e}isUserAvatar(){let e=this.verifiableCredential.getId().getFragment();return"avatar"===e}getDisplayableIconSrc(){return this.iconSrc}getDisplayableTitle(){return this.displayTitle}onIconReady(e){this.onIconReadyCallback=e}getSubject(){return this.verifiableCredential.getSubject()}getFragment(){return this.verifiableCredential.getId().getFragment()}getTypes(){return this.verifiableCredential.getType()}getId(){return this.verifiableCredential.getId()}isSensitiveCredential(){return this.verifiableCredential.getType().indexOf("SensitiveCredential")>=0}selfIssued(){return this.verifiableCredential.getIssuer().toString()===u.D.getActiveIdentityId()}getIssuer(){return this.verifiableCredential.getIssuer().toString()}async fetchIssuerInfo(){let e=this.verifiableCredential.getIssuer().toString(),t=null,n=null,r=await b.isPublished(e);r&&(t=await b.getIssuerName(e),n=await b.getIssuerAvatar(e));let i={avatarIcon:n,didString:e,name:t,isPublished:r};return a.k.log("credential","fetchIssuerInfo:",i),i}async verifyCredential(){return await p.verifyCredential(this.verifiableCredential)}equals(e){return this.id===e.id}constructor(){this._issuerInfo$=new I.h(null,()=>this.fetchIssuerInfo()),this._isConform$=new I.h(null,()=>this.verifyCredential()),this.id=null,this.createdAt=null,this.displayValue=null,this.iconSrc=null,this.onIconReadyCallback=null,this.getValueItems=()=>{let e=this.verifiableCredential.getId().getFragment();if("avatar"===e)return null;let t=this.verifiableCredential.getSubject().getProperties();return Object.keys(t).filter(e=>"id"!=e).filter(e=>"displayable"!=e).sort().map(e=>{let n="";return"wallet"==e?(n="wallet",t[e]):"gender"==e?"M"==t[e]||"male"==t[e]?n="male":("F"==t[e]||"female"==t[e])&&(n="female"):n=""!=t[e].toString()?t[e].toString():"not set",{name:e,value:n}})}}}},5676:function(e,t,n){"use strict";n.d(t,{E:function(){return a}});var r=n(9177),i=n(31710);class a extends i.h{prepareDisplayTitle(){let e=this.getDisplayableCredentialTitle();e?this.displayTitle=e:this.displayTitle=(0,r.fm)(this.profileInfo.key)}prepareDisplayValue(){let e=this.getDisplayableCredentialTitle();e?this.displayValue=e:this.displayValue=this.profileInfo.options.converter.toDisplayableValue(this)}getProfileInfo(){return this.profileInfo}constructor(e){super(),this.profileInfo=e}}},66533:function(e,t,n){"use strict";n.d(t,{_:function(){return r}});class r{static fromJson(e){if(!r.isCustomException(e))return null;let t=new r;return Object.assign(t,e),t.timestamp=new Date(e.timestamp),t}static isCustomException(e){return"object"==typeof e&&"source"in e&&"api"===e.source}static newClientError(e,t){let n=new r;return n.message=t,n.appExceptionCode=e,n.statusCode=-1,n.timestamp=new Date,n.source="client",n}}},48023:function(e,t,n){"use strict";var r,i,a,s,l,o,u,c;n.d(t,{Wg:function(){return r},XF:function(){return s},gs:function(){return i}}),(l=r||(r={}))[l.SomethingTodo=10101]="SomethingTodo",l[l.AuthError=10102]="AuthError",l[l.EmailAlreadyExists=10103]="EmailAlreadyExists",l[l.EmailNotExists=10104]="EmailNotExists",l[l.AuthKeyNotExists=10105]="AuthKeyNotExists",l[l.Unspecific=10199]="Unspecific",(o=i||(i={}))[o.DatabaseError=10201]="DatabaseError",o[o.InvalidKeyRingConfig=10202]="InvalidKeyRingConfig",o[o.KeyRingNotExists=10203]="KeyRingNotExists",o[o.KeyNotExists=10204]="KeyNotExists",o[o.InvalidChallengeId=10205]="InvalidChallengeId",o[o.InvalidAuthKey=10206]="InvalidAuthKey",o[o.CanNotRemoveKey=10207]="CanNotRemoveKey",o[o.WebAuthnVerifyError=20208]="WebAuthnVerifyError",o[o.WrongPassword=10209]="WrongPassword",o[o.Unauthorized=10210]="Unauthorized",(u=a||(a={}))[u.DIDStorageError=10301]="DIDStorageError",u[u.MnemonicError=10302]="MnemonicError",u[u.DIDAlreadyExists=10303]="DIDAlreadyExists",u[u.DIDNotExists=10304]="DIDNotExists",u[u.CredentialAlreadyExists=10305]="CredentialAlreadyExists",u[u.CredentialNotExists=10306]="CredentialNotExists",u[u.InvalidCredential=10307]="InvalidCredential",u[u.DIDNotUpToDateError=10308]="DIDNotUpToDateError",u[u.DIDTransactionError=10309]="DIDTransactionError",u[u.NetworkError=10310]="NetworkError",(c=s||(s={}))[c.OtherApolloError=10901]="OtherApolloError",c[c.OtherAxiosError=10902]="OtherAxiosError"},1349:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});class r extends Error{}},10343:function(e,t,n){"use strict";n.d(t,{h:function(){return r}});class r extends Error{}},18093:function(e,t,n){"use strict";n.d(t,{t:function(){return r}});let r="\n  id\n  createdAt\n  lastUsedAt\n  userAgent\n  name\n"},5344:function(e,t,n){"use strict";n.d(t,{j:function(){return i}});var r=n(18093);let i="\n  createdAt\n  updatedAt\n  keyId\n  key\n  type\n  browser { ".concat(r.t," }\n")},10530:function(e,t,n){"use strict";var r,i;n.d(t,{J:function(){return r}}),(i=r||(r={})).PASSWORD="PASSWORD",i.WEBAUTHN="WEBAUTHN"},95640:function(e,t,n){"use strict";n.d(t,{M:function(){return s}});var r=n(99617),i=n(17390);let a=new i.R;class s{static async fromJson(e){return a.get(e.keyId,{create:async()=>new s,async fill(t){Object.assign(t,e),t.createdAt=new Date(e.createdAt),t.updatedAt=new Date(e.updatedAt),e.browser&&(t.browser=await r.A.fromJson(e.browser))}})}equals(e){return this.keyId===e.keyId}}},63863:function(e,t,n){"use strict";n.d(t,{lu:function(){return w},zl:function(){return p},qR:function(){return m}});var r=n(60230),i=n(23965),a=n(48023);class s{static fromJson(e,t){let n=Object.assign(new s,e);return n.user=t,n}}var l=n(51385),o=n(76506),u=n(3883),c=n(18961);function d(){let e=(0,r._)(["\n                query FetchUserEmails {\n                  fetchUserEmails {\n                    ","\n                  }\n                }\n                "]);return d=function(){return e},e}function h(){let e=(0,r._)(["\n                query RemoveUserEmail($id: String!) {\n                  removeUserEmail(id: $id)\n                }\n                "]);return h=function(){return e},e}function f(){let e=(0,r._)(["\n                mutation BindOauthEmail($email: String!) {\n                  bindOauthEmail(email: $email)\n                }\n                "]);return f=function(){return e},e}function y(){let e=(0,r._)(["\n                    mutation CheckEmailBind($authKey: String!) {\n                        checkEmailBind(authKey: $authKey) { accessToken refreshToken }\n                    }\n                "]);return y=function(){return e},e}function g(){let e=(0,r._)(["\n                    mutation BindWithEmailAddress($emailAddress: String!) {\n                        bindWithEmailAddress(emailAddress: $emailAddress) { success }\n                    }\n                "]);return g=function(){return e},e}function p(e){return e.appExceptionCode===a.Wg.EmailAlreadyExists}function m(e){return e.appExceptionCode===a.Wg.EmailNotExists}class w{get userEmails$(){return this._userEmails$.getSubject()}async fetchUserEmails(){u.k.log("user","list user emails.");let{data:e}=await (0,l.Pt)(()=>(0,o.W)().query({query:(0,i.Ps)(d(),"id email createdAt")}));return(null==e?void 0:e.fetchUserEmails)?e.fetchUserEmails.map(e=>s.fromJson(e,this.user)):(console.error("user","can not fetch user emails."),null)}async removeUserEmail(e){u.k.log("user","remove user email.");let{data:t}=await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(h()),variables:{id:e}})),n=t&&t.removeUserEmail;return n||console.error("user","can not remove user email."),n}async bindOauthEmail(e){u.k.log("user","Bind oauth email address");let{data:t}=await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(f()),variables:{email:e}})),n=t&&t.bindOauthEmail;return n||u.k.error("user","Failed from bindOauthEmail api."),n}async checkEmailBind(e){u.k.log("user","Checking temporary authentication key for email bind.");let{data:t}=await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(y()),variables:{authKey:e}})),n=!!(t&&t.checkEmailBind);return n||u.k.error("Failed to check email bind"),n}async bindWithEmailAddress(e){u.k.log("user","Sending request to authentication by email"),await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(g()),variables:{emailAddress:e}}))}constructor(e){this.user=e,this._userEmails$=new c.h([],()=>this.fetchUserEmails())}}},81316:function(e,t,n){"use strict";n.d(t,{n:function(){return A}});var r=n(60230),i=n(23965),a=n(63863),s=n(51385),l=n(76506),o=n(3883),u=n(50676),c=n(18093),d=n(99617),h=n(18961);function f(){let e=(0,r._)(["\n        query ListBrowsers {\n          browsers {\n            ","\n          }\n        }\n      "]);return f=function(){return e},e}class y{get browsers$(){return this._browsers$.getSubject()}async fetchBrowsers(){o.k.log("devices","Fetching user browsers");let{data:e}=await (0,s.Pt)(()=>(0,l.W)().query({query:(0,i.Ps)(f(),c.t)}));if(e&&e.browsers){let t=await Promise.all(e.browsers.map(e=>d.A.fromJson(e)));return o.k.log("browsers","Fetched browsers:",t),t}return null}constructor(e){this.user=e,this._browsers$=new h.h([],()=>this.fetchBrowsers())}}var g=n(88262);class p{get identities$(){return this._identities$.getSubject()}async createIdentity(e){o.k.log("identities","Creating a new identity",e);let t=await g.D.createIdentity(e);return this.identities$.next([t,...this.identities$.value]),t}async deleteIdentity(e){o.k.log("identities","Deleting identity");let t=await g.D.deleteIdentity(e);return this.identities$.next(this.identities$.value.filter(t=>t.did!=e)),t}async createDIDPublishTransaction(e){return o.k.log("identities","Creating identity publication transaction"),await g.D.createDIDPublishTransaction(e)}async publishIdentity(e,t){return o.k.log("identities","Publishing identity"),await g.D.publishIdentity(e,t)}async getPublicationStatus(e,t){return o.k.log("identities","Getting publication status"),await g.D.getPublicationStatus(e,t)}async fetchIdentities(){return o.k.log("identities","Fetching identities"),g.D.listIdentities()}constructor(e){this.user=e,this._identities$=new h.h([],()=>this.fetchIdentities())}}var m=n(5344),w=n(95640),v=n(10530),b=n(21290),I=n(2512),k=n(45685),S=n(67133).Buffer;function D(){let e=(0,r._)(["\n        query FetchShadowKeys {\n          userKeys {\n            ","\n          }\n        }\n      "]);return D=function(){return e},e}class C{get shadowKeys$(){return this._shadowKeys$.getSubject()}get passwordKeys$(){return this._passwordKeys$.getSubject()}get passkeyKeys$(){return this._passkeyKeys$.getSubject()}async fetchShadowKeys(){var e;o.k.log("devices","Fetching shadow keys");let t=await (0,s.Pt)(()=>(0,l.W)().query({query:(0,i.Ps)(D(),m.j)}));if(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.userKeys){let e=await Promise.all(t.data.userKeys.map(e=>w.M.fromJson(e)));return o.k.log("security","Fetched user shadow keys:",e),e}return null}async bindPassword(e){let t;if(o.k.log("keyring","Binding password"),this.isPasswordBound())t=await (0,b.Cp)(e);else{let n={type:v.J.PASSWORD,key:e,keyId:"unused-for-now-for-passwords"};t=[await (0,b.cI)(n)]}return!!t&&(this.deletePasswordShadowKey(),t.forEach(e=>this.upsertShadowKey(e)),!0)}async bindPasskey(){let e=await (0,b.Dk)(),t=await this.pkCredentialCreationOptions(e,this.user.name$.value),n=await (0,I.RQ)(t[1]),r={type:v.J.WEBAUTHN,keyId:n.id,key:JSON.stringify(n),challengeId:e.id},i=await (0,b.cI)(r);return!!i&&(this.upsertShadowKey(i),!0)}async unlockPasskeyLocally(){o.k.log("Keyring","start unlock passkey...");let e=await (0,b.Dk)(),t=await this.pkCredentialCreationOptions(e,null),n=await (0,I.oz)(t[0],!1),r={type:v.J.WEBAUTHN,keyId:n.id,key:JSON.stringify(n),challengeId:e.id};return o.k.log("Keyring","start unlock passkey, attResp: ",n),r}async pkCredentialCreationOptions(e,t){let n="localhost",r=new TextEncoder,i=r.encode(e.content),a={challenge:S.from(i).toString(),allowCredentials:[],rpId:n,userVerification:"required",timeout:6e4},s={user:{id:t,name:t,displayName:t},pubKeyCredParams:[{type:"public-key",alg:-7}],rp:{id:n,name:"DID web app"},challenge:e.content};return[a,s]}upsertShadowKey(e){let t=this.shadowKeys$.value;this.shadowKeys$.next([...t.filter(t=>!t.equals(e)),e])}deletePasswordShadowKey(){let e=this.shadowKeys$.value;this.shadowKeys$.next([...e.filter(e=>e.type!==v.J.PASSWORD)])}isPasswordBound(){var e;return!!(null===(e=this.shadowKeys$.value)||void 0===e?void 0:e.find(e=>e.type===v.J.PASSWORD))}isThisBrowserBound(){var e;return!!(null===(e=this.passkeyKeys$.value)||void 0===e?void 0:e.find(e=>{var t;return null===(t=e.browser)||void 0===t?void 0:t.isCurrentBrowser()}))}constructor(e){this.user=e,this._shadowKeys$=new h.h(null,()=>this.fetchShadowKeys()),this._passwordKeys$=new h.h(null,async()=>{this.shadowKeys$.pipe((0,k.U)(e=>null==e?void 0:e.filter(e=>e.type===v.J.PASSWORD))).subscribe(this.passwordKeys$)}),this._passkeyKeys$=new h.h(null,async()=>{this.shadowKeys$.pipe((0,k.U)(e=>null==e?void 0:e.filter(e=>e.type===v.J.WEBAUTHN))).subscribe(this.passkeyKeys$)})}}var x=n(17390);let E=new x.R;var P=n(9177);function $(){let e=(0,r._)(["\n        mutation UpdateUserProperty($input: UserPropertyInput!) {\n          updateUserProperty(input: $input)\n        } "]);return $=function(){return e},e}class A{static async fromJson(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return E.get(e.id,{create:async()=>new A,async fill(t){t.fillFromJson(e),t.createdAt=new Date(e.createdAt),t.nameInitials$.next((0,P.OX)(e.name)),t.name$.next(e.name)}},t)}toJson(){return{id:this.id,type:this.type,name:this.name$.value,nameInitials:(0,P.OX)(this.name$.value),createdAt:this.createdAt.toISOString()}}get(e){if(!this.features.has(e))throw Error("Unhandled user feature '".concat(e,"'"));return this.features.get(e)}addFeature(e,t){if(!this.features.has(e))return this.features.set(e,t),t}fillFromJson(e){Object.assign(this,e)}equals(e){return!!e&&this.id===e.id}async updateUserName(e){o.k.log("user","update user name.");let{data:t}=await (0,s.Pt)(()=>(0,l.W)().mutate({mutation:(0,i.Ps)($()),variables:{input:{name:e}}}));return this.name$.next(e),console.info("user","update user name successfully."),null==t?void 0:t.updateUserProperty}constructor(){this.name$=new u.X(null),this.nameInitials$=new u.X(null),this.features=new Map,this.addFeature("email",new a.lu(this)),this.addFeature("identity",new p(this)),this.addFeature("browser",new y(this)),this.addFeature("security",new C(this))}}},20708:function(e,t,n){"use strict";n.d(t,{NN:function(){return u},Ny:function(){return o}});var r=n(175),i=n(3883),a=n(69990),s=n(16421);let l="browser-client-id";function o(e){let t;try{t=(0,r.Z)(e)}catch(e){i.k.error("browser","Access token received from the backend cannot be decoded!");return}if(!t.browserId)throw Error("Abnormal state: no browser ID found in the access token!");let n=u();if(n&&n!==t.browserId)throw function(){let e=(0,a.M6)();if(!e)throw Error("Cannot delete the browser ID without active user!");localStorage.removeItem(e.id+l)}(),(0,s.w7)(),Error("State error! Browser ID ".concat(n," is different from access token browser ID ").concat(t.browserId," !"));!function(e){let t=(0,a.M6)();if(!t)throw Error("Cannot set the browser ID without active user!");localStorage.setItem(t.id+l,e)}(t.browserId)}function u(){let e=(0,a.M6)();return e?localStorage.getItem(e.id+l):null}},21417:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});let r=new class{init(e){this.config=e}get(e){if(!this.config)throw Error("The config service has not been initialized yet. Make sure to call configService.init() first");return this.config[e]}}},51385:function(e,t,n){"use strict";n.d(t,{Pt:function(){return w},rs:function(){return y}});var r=n(17205),i=n(66533),a=n(48023),s=n(1349),l=n(10343),o=n(63863),u=n(81630),c=n(21704),d=n(34891),h=n(3883),f=n(52856);let y=new d.x;function g(e){return h.k.error("apollo","Client error",e),i._.newClientError(a.XF.OtherApolloError,e.message)}function p(e){return h.k.error("apollo","Protocol error",e),i._.newClientError(a.XF.OtherApolloError,e.message)}function m(e){var t;let n=e.path,r=e.originalError||(null===(t=e.extensions)||void 0===t?void 0:t.originalError),s=i._.fromJson(r);return s?(h.k.error("graphql","Custom API exception when calling GraphQL method:",n,r),s):(h.k.error("graphql","GraphQL error when calling GraphQL method:",n,e),i._.newClientError(a.XF.OtherApolloError,e.message))}async function w(e,t){try{let t=await e();return t}catch(v){let e;if(v instanceof r.cA){let t;t=(t=(t=(t=[]).concat(v.clientErrors.map(g))).concat(v.graphQLErrors.map(m))).concat(v.protocolErrors.map(p)),v.networkError&&(t=t.concat(function(e){let t=[];return"ServerError"===e.name?"object"==typeof e.result&&e.result.forEach(e=>{var n;null===(n=e.errors)||void 0===n||n.forEach(e=>{h.k.error("graphql","GraphQL server network error:",e.message),t.push(i._.newClientError(a.XF.OtherApolloError,e.message))})}):(h.k.error("graphql","GraphQL network error:",e),t.push(i._.newClientError(a.XF.OtherApolloError,e.message))),t}(v.networkError))),e=t}else v instanceof c.__?e=[m(v)]:v instanceof u.AxiosError?e=[function(e){let t=i._.fromJson(e.response.data);return t?(h.k.error("axios","Axios app exception",t),t):(h.k.error("Unhandled axios error:",e),i._.newClientError(a.XF.OtherAxiosError,e.message))}(v)]:h.k.error("Unhandled error:",v);e.map(e=>{y.next(e)});let n=e.find(e=>(0,f.z)(e));if(n)throw n;let d=e.find(e=>(0,o.zl)(e));if(d)throw new s.E;let w=e.find(e=>(0,o.qR)(e));if(w)throw new l.h;return t||null}}},76506:function(e,t,n){"use strict";n.d(t,{B:function(){return f},W:function(){return y}});var r=n(14456),i=n(23139),a=n(79977),s=n(29526),l=n(15740),o=n(2594),u=n(85932),c=n(16421),d=n(20708),h=n(21417);let f=new class{async init(){let e=new l.A({uri:"".concat(h.l.get("backendUrl"),"/graphql"),batchMax:30,batchInterval:50}),t=(0,u.q)(e=>{let{graphQLErrors:t,networkError:n,operation:i,forward:a}=e;if(t){if(!localStorage.getItem("access_token"))return;for(let e of t)switch(e.extensions.code){case"UNAUTHENTICATED":return(0,r.p)((0,c.g$)().catch(e=>{})).filter(e=>!!e).flatMap(e=>{let t=i.getContext().headers;return i.setContext({headers:{...t,authorization:"Bearer ".concat(e)}}),a(i)});case"INVALID_REFRESH_TOKEN":(0,c.JA)()}}}),n=(0,o.v)((e,t)=>{let{headers:n}=t,r=localStorage.getItem("access_token"),i=(0,d.NN)();return{headers:{...n,authorization:r?"Bearer ".concat(r):"",...i&&{"x-browser-id":i}}}});this.apolloClient=new i.f({link:(0,a.D)([t,n,e]),cache:new s.h})}},y=()=>f.apolloClient},89488:function(e,t,n){"use strict";n.d(t,{m:function(){return u},y:function(){return o}});class r{setup(e){if(0>=e.indexOf("#"))this.shortType=e,this.context=null,this.longType=null;else{let t=e.split("#");this.context=t[0],this.shortType=t[1],this.longType=e}}getContext(){return this.context}getShortType(){return this.shortType}getLongType(){return this.longType}isLongType(){return!!this.longType}containedIn(e){return e.includes(this.getLongType())||e.includes(this.getShortType())}constructor(e){this.type=e,this.setup(e)}}var i=n(57969);class a{getInfo(e){return u(e.verifiableCredential.getType())}getEditionType(){return this.editionType}constructor(e){this.editionType=e}}class s extends a{toEditableValue(e){return e.verifiableCredential.getSubject().getProperty(this.subjectKey)}toDisplayableValue(e){return e.verifiableCredential.getSubject().getProperty(this.subjectKey)}toSubject(e){return{[this.subjectKey]:e}}constructor(e){super(i.E.SingleLineString),this.subjectKey=e}}let l=[new i.h("name",new r("https://ns.elastos.org/credentials/profile/name/v1#NameCredential"),{converter:new s("name")}),new i.h("avatar",null,{defaultSubject:{"content-type":"",type:"",data:""},converter:null}),new i.h("email",new r("https://ns.elastos.org/credentials/profile/email/v1#EmailCredential"),{multipleInstancesAllowed:!0,converter:new s("email")}),new i.h("birthDate"),new i.h("nationality",new r("did://elastos/iUq76mi2inkZfqqbHkovbcDkzEkAh2dKrb/ISONationalityCredential#ISONationalityCredential")),new i.h("gender",new r("https://ns.elastos.org/credentials/profile/gender/v1#GenderCredential")),new i.h("telephone"),new i.h("nickname"),new i.h("birthPlace"),new i.h("occupation"),new i.h("education"),new i.h("interests"),new i.h("description",new r("https://ns.elastos.org/credentials/profile/description/v1#DescriptionCredential")),new i.h("url",new r("https://ns.elastos.org/credentials/profile/url/v1#URLCredential")),new i.h("discord",new r("https://ns.elastos.org/credentials/social/discord/v1#DiscordCredential")),new i.h("linkedin",new r("https://ns.elastos.org/credentials/social/linkedin/v1#LinkedinCredential")),new i.h("facebook",new r("https://ns.elastos.org/credentials/social/facebook/v1#FacebookCredential")),new i.h("instagram",new r("https://ns.elastos.org/credentials/social/instagram/v1#InstagramCredential")),new i.h("twitter",new r("https://ns.elastos.org/credentials/social/twitter/v1#TwitterCredential")),new i.h("snapchat",new r("https://ns.elastos.org/credentials/social/snapchat/v1#SnapchatCredential")),new i.h("telegram",new r("https://ns.elastos.org/credentials/social/telegram/v1#TelegramCredential")),new i.h("wechat",new r("https://ns.elastos.org/credentials/social/wechat/v1#WechatCredential")),new i.h("weibo",new r("https://ns.elastos.org/credentials/social/weibo/v1#WeiboCredential")),new i.h("twitch"),new i.h("elaAddress",null),new i.h("wallet",new r("https://ns.elastos.org/credentials/wallet/v1#WalletCredential"),{isSensitive:!0,converter:null})];function o(){return l}function u(e){return l.find(t=>{var n;return null===(n=t.type)||void 0===n?void 0:n.containedIn(e)})}},57969:function(e,t,n){"use strict";n.d(t,{E:function(){return i},h:function(){return o}});var r,i,a=n(40218),s=n.n(a);(r=i||(i={}))[r.SingleLineString=0]="SingleLineString",r[r.MultiLineText=1]="MultiLineText",r[r.Date=2]="Date",r[r.Country=3]="Country";let l={defaultSubject:"",isSensitive:!1,multipleInstancesAllowed:!1,converter:null};class o{getConverter(){return this.options.converter}typesForCreation(){return[this.type.getLongType()]}constructor(e,t,n={converter:null}){this.key=e,this.type=t,this.options=n,n=s()({},l,n)}}},53932:function(e,t,n){"use strict";n.d(t,{B:function(){return i}});var r=n(50676);let i=new r.X(null)},88262:function(e,t,n){"use strict";n.d(t,{D:function(){return W}});var r=n(60230),i=n(23965),a=n(26588);let s="\n  id\n  createdAt\n  verifiableCredential\n",l="\n  did\n  createdAt\n";var o=n(69144),u=n(3883),c=n(18961);class d{get credentials$(){return this._credentials$.getSubject()}async createCredential(e,t,n,r){u.k.log("credentials","Creating credential",e,t,n,r);let i=await this.identity.provider.createCredential(this.identity.did,e,t,n,r);return this.credentials$.next([i,...this.credentials$.value]),i}async addCredential(e){u.k.log("credentials","Adding credential",e);let t=await this.identity.provider.addCredential(this.identity.did,e);return this.credentials$.next([t,...this.credentials$.value]),t}async fetchCredentials(){return u.k.log("credentials","Fetching credentials"),this.identity.provider.listCredentials(this.identity.did)}async deleteCredential(e){u.k.log("credentials","Deleting credential");let t=await this.identity.provider.deleteCredential(e);return this.credentials$.next(this.credentials$.value.filter(t=>t.verifiableCredential.getId().toString()!=e)),t}constructor(e){this.identity=e,this._credentials$=new c.h([],()=>this.fetchCredentials())}}var h=n(5676),f=n(89488),y=n(44853),g=n.n(y),p=n(72440),m=n.n(p),w=n(62067),v=n.n(w),b=n(50676),I=n(45685);class k{get profileCredentials$(){return this._profileCredentials$.getSubject()}get name$(){return this._name$.getSubject()}setActiveCredential(e){this.activeCredential$.next(e)}async deleteProfileCredential(e){try{return await this.identity.get("credentials").deleteCredential(e),!0}catch(e){return u.k.error("profile",e),!1}}async createProfileCredential(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=[];try{let a;a=e||this.identity.did+"#"+n+function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return g()(Array(e),()=>"".concat(m()(1,10))).join("")}();let s=(0,f.m)(t);i.push(s.type.getLongType());let l=v()().add(5,"years").toDate(),o=s.options.converter.toSubject(r);return await this.identity.get("credentials").createCredential(a,i,l,o),!0}catch(e){return u.k.error("profile",e),!1}}async addProfileCredential(e){try{return await this.identity.get("credentials").addCredential(e.credential.verifiableCredential),!0}catch(e){return u.k.error("profile",e),!1}}async updateProfileCredential(e,t){let n=e.verifiableCredential.getId().toString(),r=(0,f.m)(e.verifiableCredential.getType());try{let e=await this.deleteProfileCredential(n);if(!e)return!1;let i=await this.createProfileCredential(n,r.typesForCreation(),r.key,t);return i}catch(e){return u.k.error("profile",e),!1}}getName(){var e;let t=null===(e=this.profileCredentials$.value)||void 0===e?void 0:e.find(e=>"name"===e.getProfileInfo().key);return t?t.getDisplayValue():null}constructor(e){this.identity=e,this.activeCredential$=new b.X(null),this._profileCredentials$=new c.h(null,async()=>{this.identity.get("credentials").credentials$.pipe((0,I.U)(e=>e.filter(e=>e instanceof h.E))).subscribe(e=>{this.profileCredentials$.next(e)})}),this._name$=new c.h(null,async()=>{this.profileCredentials$.subscribe(e=>{this.name$.next(this.getName())})})}}class S{static async fromJson(e,t){let n=new S;return Object.assign(n,e),n.createdAt=new Date(e.createdAt),n.provider=t,n}get(e){if(!this.features.has(e))throw Error("Unhandled user feature '".concat(e,"'"));return this.features.get(e)}addFeature(e,t){if(!this.features.has(e))return this.features.set(e,t),t}createVerifiablePresentation(e,t,n){return this.provider.createVerifiablePresentation(this.did,e,t,n)}equals(e){return this.did===e.did}constructor(){this.features=new Map,this.addFeature("credentials",new d(this)),this.addFeature("profile",new k(this))}}var D=n(51385),C=n(76506);function x(){let e=(0,r._)(["\n        mutation createIdentity($name: String!) {\n          createIdentity(input: { name: $name }) {\n            ","\n          }\n        }\n      "]);return x=function(){return e},e}function E(){let e=(0,r._)(["\n        mutation deleteIdentity($identityDid: String!) {\n          deleteIdentity(identityDid: $identityDid)\n        }\n      "]);return E=function(){return e},e}function P(){let e=(0,r._)(["\n        query ListIdentities {\n          identities {\n            ","\n          }\n        }\n      "]);return P=function(){return e},e}function $(){let e=(0,r._)(["\n        mutation createDIDPublishTransaction($identityDid: String!) {\n          createDIDPublishTransaction(identityDid: $identityDid) {\n            ","\n          }\n        }\n      "]);return $=function(){return e},e}function A(){let e=(0,r._)(["\n        mutation publishIdentity($identityDid: String!, $payload: String!) {\n          publishIdentity(input: { identityDid: $identityDid, payload: $payload}) {\n            ","\n          }\n        }\n      "]);return A=function(){return e},e}function T(){let e=(0,r._)(["\n        mutation getPublicationStatus($identityDid: String!, $publicationId: String!) {\n          getPublicationStatus(input: { identityDid: $identityDid, publicationId: $publicationId})\n        }\n      "]);return T=function(){return e},e}function j(){let e=(0,r._)(["\n        mutation createCredential($identityDid: String!, $credentialId: String!, $types: Json!, $expirationDate: String!, $properties: Json!) {\n          createCredential(input: { identityDid: $identityDid, credentialId: $credentialId, types: $types, expirationDate: $expirationDate, properties: $properties}) {\n            ","\n          }\n        }\n      "]);return j=function(){return e},e}function _(){let e=(0,r._)(["\n        mutation addCredential($identityDid: String!, $credentialString: String!) {\n          addCredential(input: { identityDid: $identityDid, credentialString: $credentialString}) {\n            ","\n          }\n        }\n      "]);return _=function(){return e},e}function K(){let e=(0,r._)(["\n        query ListCredentials($identityDid: String!) {\n          credentials(identityDid: $identityDid) {\n            ","\n          }\n        }\n      "]);return K=function(){return e},e}function F(){let e=(0,r._)(["\n        mutation deleteCredential($credentialId: String!) {\n          deleteCredential(credentialId: $credentialId)\n        }\n      "]);return F=function(){return e},e}function U(){let e=(0,r._)(["\n        mutation createVerifiablePresentation($identityDid: String!, $credentials: Json!, $realm: String!, $nonce: String!) {\n          createVerifiablePresentation(input: { identityDid: $identityDid, credentials: $credentials, realm: $realm, nonce: $nonce}) {\n            ","\n          }\n        }\n      "]);return U=function(){return e},e}class O{async createIdentity(e){let{data:t}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(x(),l),variables:{name:e}}));if(console.log(t),null==t?void 0:t.createIdentity)return S.fromJson(t.createIdentity,this);throw Error("Failed to create DID")}async deleteIdentity(e){let{data:t}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(E()),variables:{identityDid:e}}));if(console.log(t),null==t?void 0:t.deleteIdentity)return!0;throw Error("Failed to delete DID")}async listIdentities(){var e;let t=await (0,D.Pt)(()=>(0,C.W)().query({query:(0,i.Ps)(P(),l)}));if(null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.identities){let e=await Promise.all(t.data.identities.map(e=>S.fromJson(e,this)));return u.k.log("custodial-provider","Fetched identities:",e),e}return null}async createDIDPublishTransaction(e){let{data:t}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)($(),"\n  payload\n"),variables:{identityDid:e}}));if(console.log(t),null==t?void 0:t.createDIDPublishTransaction.payload)return t.createDIDPublishTransaction.payload;throw Error("Failed to create transaction")}async publishIdentity(e,t){let{data:n}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(A(),"\n  publicationId\n"),variables:{identityDid:e,payload:t}}));if(console.log(n),null==n?void 0:n.publishIdentity.publicationId)return n.publishIdentity.publicationId;throw Error("Failed to publish DID")}async getPublicationStatus(e,t){let{data:n}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(T()),variables:{identityDid:e,publicationId:t}}));if(console.log(n),null==n?void 0:n.getPublicationStatus)return n.getPublicationStatus;throw Error("Failed to get publication status")}async createCredential(e,t,n,r,a){let{data:l}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(j(),s),variables:{identityDid:e,credentialId:t,types:n,expirationDate:r,properties:a}}));return l&&l.createCredential?(0,o.q)(l.createCredential):null}async addCredential(e,t){let{data:n}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(_(),s),variables:{identityDid:e,credentialString:t.toString()}}));return n&&n.addCredential?(0,o.q)(n.addCredential):null}async listCredentials(e){let{data:t}=await (0,D.Pt)(()=>(0,C.W)().query({query:(0,i.Ps)(K(),s),variables:{identityDid:e}}));if(t&&t.credentials){let e=await Promise.all(t.credentials.map(e=>(0,o.q)(e)));return u.k.log("custodial-provider","Fetched credentials:",e),e}return null}async deleteCredential(e){let{data:t}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(F()),variables:{credentialId:e}}));if(null==t?void 0:t.deleteCredential)return!0;throw Error("Failed to remove Credential")}async createVerifiablePresentation(e,t,n,r){let s=[];t.forEach(e=>{s.push(e.toJSON())});let{data:l}=await (0,D.Pt)(()=>(0,C.W)().mutate({mutation:(0,i.Ps)(U(),"\n  verifiablePresentation\n"),variables:{identityDid:e,credentials:s,realm:n,nonce:r}}));return l&&l.createVerifiablePresentation?a.uB.parse(l.createVerifiablePresentation.verifiablePresentation):null}}var N=n(53932);let W=new class{createIdentity(e){return this.provider.createIdentity(e)}deleteIdentity(e){return this.provider.deleteIdentity(e)}createDIDPublishTransaction(e){return this.provider.createDIDPublishTransaction(e)}publishIdentity(e,t){return this.provider.publishIdentity(e,t)}getPublicationStatus(e,t){return this.provider.getPublicationStatus(e,t)}setActiveIdentity(e){if(!e){N.B.next(null),this.activeIdentityId="",localStorage.setItem("activeIdentityId","");return}N.B.next(e),this.activeIdentityId=e.did,localStorage.setItem("activeIdentityId",this.activeIdentityId)}getActiveIdentityId(){return this.activeIdentityId||(this.activeIdentityId=this.loadActiveIdentityId()),this.activeIdentityId}loadActiveIdentityId(){return localStorage.getItem("activeIdentityId")}restoreActiveIdentity(e){if(!N.B.value){if(this.getActiveIdentityId()){let t=this.findIdentityByDID(this.activeIdentityId,e);this.setActiveIdentity(t);return}e.length>0&&W.setActiveIdentity(e[0])}}findIdentityByDID(e,t){let n=null==t?void 0:t.find(t=>t.did===e);return n}async listIdentities(){let e=await this.provider.listIdentities();return this.restoreActiveIdentity(e),e}constructor(){this.provider=new O,this.activeIdentityId=""}}},21290:function(e,t,n){"use strict";n.d(t,{Cp:function(){return g},Dk:function(){return m},cI:function(){return y},wo:function(){return p}});var r=n(60230),i=n(23965),a=n(5344),s=n(95640),l=n(51385),o=n(76506),u=n(3883);function c(){let e=(0,r._)(["\n        mutation bindKey($newKey: AuthKeyInput!) {\n          bindKey(newKey: $newKey) {\n            ","\n          }\n        }\n      "]);return c=function(){return e},e}function d(){let e=(0,r._)(["\n        mutation ChangePassword($newPassword: String!) {\n          changePassword(newPassword: $newPassword) {\n            ","\n          }\n        }\n      "]);return d=function(){return e},e}function h(){let e=(0,r._)(["\n          mutation unlockMasterKey($authKey: AuthKeyInput!) {\n            unlockMasterKey(authKey: $authKey)\n          }\n        "]);return h=function(){return e},e}function f(){let e=(0,r._)(["\n      query GenerateChallenge {\n        generateChallenge{\n          id,\n          content\n        }\n    }\n    "]);return f=function(){return e},e}async function y(e){var t,n;u.k.log("keyring","Binding key");let r=await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(c(),a.j),variables:{newKey:e}}),null);if(null==r||null===(t=r.data)||void 0===t||!t.bindKey)return u.k.error("keyring","Failed to bind key"),null;{let e=await s.M.fromJson(null==r?void 0:null===(n=r.data)||void 0===n?void 0:n.bindKey);return u.k.log("keyring","Key bound successfully"),e}}async function g(e){var t,n;u.k.log("keyring","Changing password");let r=await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(d(),a.j),variables:{newPassword:e}}),null);if(null==r||null===(t=r.data)||void 0===t||!t.changePassword)return null;{let e=await Promise.all(null==r?void 0:null===(n=r.data)||void 0===n?void 0:n.changePassword.map(e=>s.M.fromJson(e)));return u.k.log("keyring","Password changed successfully",e),e}}async function p(e){var t;u.k.log("security","Trying to unlock master key");let n=await (0,l.Pt)(()=>(0,o.W)().mutate({mutation:(0,i.Ps)(h()),variables:{authKey:e}}),null);return null!=n&&null!==(t=n.data)&&void 0!==t&&!!t.unlockMasterKey&&(u.k.log("security","Master key unlocked successfully"),!0)}async function m(){u.k.log("passkey","get challenge to generate passkey");let e=await (0,l.Pt)(()=>(0,o.W)().query({query:(0,i.Ps)(f()),fetchPolicy:"network-only",variables:{}}));if(e){var t,n;let r=null===(t=e.data)||void 0===t?void 0:t.generateChallenge.id,i=null===(n=e.data)||void 0===n?void 0:n.generateChallenge.content;return{id:r,content:i}}throw Error("Can not get challenge by generateChallenge api.")}},3883:function(e,t,n){"use strict";n.d(t,{k:function(){return a}});var r=n(62067),i=n.n(r);let a=new class{init(e){this.originalConsole=e,this.originalDebugLog=this.originalConsole.log,this.originalDebugWarn=this.originalConsole.warn,this.originalDebugErr=this.originalConsole.error}log(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.originalDebugLog.apply(this.originalConsole,["%c"+i()(new Date().getTime()).format("HH:mm:ss.SSS")+" "+e.toUpperCase()+"*","background: #008730; color: #FFF; font-weight:bold; padding:5px;",...n])}warn(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.originalDebugWarn.apply(this.originalConsole,["%c"+i()(new Date().getTime()).format("HH:mm:ss.SSS")+" "+e.toUpperCase()+"* WARNING","background: #d59100; color: #FFF; font-weight:bold; padding:5px;",...n])}error(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.originalDebugErr.apply(this.originalConsole,["%c"+i()(new Date().getTime()).format("HH:mm:ss.SSS")+" "+e.toUpperCase()+"* ERROR","background: #b30202; color: #FFF; font-weight:bold; padding:5px;",...n])}test(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.originalDebugLog.apply(this.originalConsole,["%c"+i()(new Date().getTime()).format("HH:mm:ss.SSS")+" "+e.toUpperCase()+"* TEST","background: #7B68EE; color: #FFF; font-weight:bold; padding:5px;",...n])}constructor(){this.originalConsole=null}}},52856:function(e,t,n){"use strict";n.d(t,{h:function(){return d},z:function(){return c}});var r=n(57135),i=n(451),a=n(66533),s=n(48023),l=n(21290),o=n(3883),u=n(69990);function c(e){return e.appExceptionCode===s.gs.Unauthorized}function d(){let[e]=(0,i.V)((0,u.jU)()),{promptMasterKeyUnlock:t}=(0,r.lJ)(),n=async e=>{try{let t=await e();return t}catch(r){if(r instanceof a._&&c(r)){o.k.warn("security","This method call requires unlock authorization from the user. Prompting");let r=await t();if(r)return await (0,l.wo)(r),n(e);return o.k.warn("security","Unlock operation cancelled by user"),null}}};return{callWithUnlock:n}}},69990:function(e,t,n){"use strict";n.d(t,{M6:function(){return l},jU:function(){return s}});var r=n(81316),i=n(18961);let a=new i.h(null,async()=>{{let e=localStorage.getItem("authenticated_user");return e?r.n.fromJson(JSON.parse(e)):null}});function s(){return a.getSubject()}function l(){return s().value}},16421:function(e,t,n){"use strict";n.d(t,{X:function(){return A},bB:function(){return O},GC:function(){return _},jF:function(){return U},h3:function(){return W},U:function(){return N},JA:function(){return F},g$:function(){return K},HA:function(){return P},w7:function(){return j},y1:function(){return x}});var r=n(60230),i=n(23965),a=n(10530),s=n(81316),l=n(20708),o=n(51385),u=n(76506),c=n(21290),d=n(3883),h=n(2512),f=n(69810),y=n.n(f),g=n(69990),p=n(67133).Buffer;function m(){let e=(0,r._)(["\n        mutation SignUp($input: SignUpInput!) {\n          signUp(input: $input) { accessToken refreshToken }\n        }\n      "]);return m=function(){return e},e}function w(){let e=(0,r._)(["\n        query GetSelfUser {\n          getSelfUser { "," }\n        }\n      "]);return w=function(){return e},e}function v(){let e=(0,r._)(["\n      mutation RequestEmailAuthentication($emailAddress: String!) {\n        requestEmailAuthentication(emailAddress: $emailAddress) { success }\n      }\n    "]);return v=function(){return e},e}function b(){let e=(0,r._)(["\n        mutation CheckEmailAuthentication($authKey: String!) {\n          checkEmailAuthentication(authKey: $authKey) { accessToken refreshToken }\n        }\n      "]);return b=function(){return e},e}function I(){let e=(0,r._)(["\n        mutation RefreshToken($token: String!) {\n          refreshToken(refreshTokenInput: { refreshToken: $token }) { accessToken }\n        }\n      "]);return I=function(){return e},e}function k(){let e=(0,r._)(["\n        query signInWithPasskey ($authKey: AuthKeyInput!) {\n          signInWithPasskey (authKey: $authKey) {\n            accessToken,\n            refreshToken\n          }\n        }\n      "]);return k=function(){return e},e}function S(){let e=(0,r._)(["\n        mutation OauthMSSignIn($input: MsSignInInput!) {\n          oauthMSSignIn(input: $input) { accessToken refreshToken }\n        }\n      "]);return S=function(){return e},e}function D(){let e=(0,r._)(["\n        mutation OauthMSBindEmail($input: MsBindEmailInput!) {\n          oauthMSBindEmail(input: $input)\n        }\n      "]);return D=function(){return e},e}let C=new(y())(1);async function x(e){d.k.log("user","Sign up user, creating new user entry");let t={name:e},n=await (0,o.Pt)(()=>(0,u.W)().mutate({mutation:(0,i.Ps)(m()),variables:{input:t}}));if(null==n||!n.data||!n.data.signUp)return d.k.error("user","failed to sign up."),!1;{let{accessToken:e,refreshToken:t}=n.data.signUp;return T(e,t),!0}}async function E(e){localStorage.setItem("authenticated_user",JSON.stringify(e)),(0,g.jU)().next(await s.n.fromJson(e))}async function P(e){return E(e.toJson())}async function $(e,t){return C.add(async()=>{d.k.log("users","Fetching self user profile"),e&&localStorage.setItem("access_token",e),t&&localStorage.setItem("refresh_token",t);let{data:n}=await (0,o.Pt)(()=>(0,u.W)().query({query:(0,i.Ps)(w(),"id name createdAt")}));if(n){let e=n.getSelfUser,t=await s.n.fromJson(e);return await E(e),d.k.log("users","user from fetchSelfUser():",t),t}throw Error("no data got from fetchSelfUser()")})}async function A(e){d.k.log("user","Sending request to authentication by email"),await (0,o.Pt)(()=>(0,u.W)().mutate({mutation:(0,i.Ps)(v()),variables:{emailAddress:e}}))}async function T(e,t){let n=localStorage.getItem("access_token"),r=localStorage.getItem("refresh_token");localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t);try{let t=await $(e);return await (0,l.Ny)(e),t}catch(e){return d.k.error("userService","failed to fetch user info.: ",e),localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",r),null}}function j(){localStorage.removeItem("authenticated_user"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),(0,g.jU)().next(null)}async function _(e){d.k.log("user","Checking temporary authentication key");try{let{data:t}=await (0,o.Pt)(()=>(0,u.W)().mutate({mutation:(0,i.Ps)(b()),variables:{authKey:e}}));if(!t||!t.checkEmailAuthentication)return!1;{let{accessToken:e,refreshToken:n}=t.checkEmailAuthentication;return await T(e,n),!0}}catch(e){return d.k.warn("user","Exception while checking temporary auth key. Key expired?"),null}}async function K(){let e=localStorage.getItem("refresh_token");if(!e){F();return}let{data:t}=await (0,o.Pt)(()=>(0,u.W)().mutate({mutation:(0,i.Ps)(I()),variables:{token:e}}));if(t){d.k.log("user","Got refreshed access token");let{accessToken:e}=t.refreshToken;return localStorage.setItem("access_token",e),await (0,l.Ny)(e),(0,g.jU)().next((0,g.M6)()),e}throw Error("Can not get access token by refresh token.")}function F(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("authenticated_user"),window.location.href="/dashboard"}function U(){let e=localStorage.getItem("access_token");return e&&""!==e}async function O(){var e,t,n,r,s,l;d.k.log("user","Authenticating with passkey");let f=await (0,c.Dk)(),y=function(e){let t=new TextEncoder,n=t.encode(e.content),r={challenge:p.from(n).toString(),allowCredentials:[],rpId:"localhost",userVerification:"required",timeout:6e4};return r}(f),g=await (0,h.oz)(y,!1),m={type:a.J.WEBAUTHN,keyId:g.id,key:JSON.stringify(g),challengeId:f.id},w=await (0,o.Pt)(()=>(0,u.W)().query({query:(0,i.Ps)(k()),variables:{authKey:m},fetchPolicy:"network-only"}));if(null==w||null===(t=w.data)||void 0===t||null===(e=t.signInWithPasskey)||void 0===e||!e.accessToken)return d.k.error("Failed to sign in with passkey."),!1;{let e=null==w?void 0:null===(r=w.data)||void 0===r?void 0:null===(n=r.signInWithPasskey)||void 0===n?void 0:n.accessToken,t=null==w?void 0:null===(l=w.data)||void 0===l?void 0:null===(s=l.signInWithPasskey)||void 0===s?void 0:s.refreshToken;return await T(e,t),!0}}async function N(e){d.k.log("user","oauth MS sign in.");let t={code:e},n=await (0,o.Pt)(()=>(0,u.W)().mutate({mutation:(0,i.Ps)(S()),variables:{input:t}}));if(null==n||!n.data||!n.data.oauthMSSignIn)return d.k.error("user","failed to oauth MS sign in."),!1;{let{accessToken:e,refreshToken:t}=n.data.oauthMSSignIn;return T(e,t),!0}}async function W(e){d.k.log("user","oauth MS bind email.");let t={code:e},n=await (0,o.Pt)(()=>(0,u.W)().mutate({mutation:(0,i.Ps)(D()),variables:{input:t}}));return null!=n&&!!n.data&&!!n.data.oauthMSBindEmail||(d.k.error("user","failed to oauth MS bind email."),!1)}},18961:function(e,t,n){"use strict";n.d(t,{h:function(){return i}});var r=n(50676);class i{getSubject(e){return this.fetchedOrFetching||(this.fetchedOrFetching=!0,this.initializer().then(e=>e&&this.subject.next(e))),this.subject}constructor(e,t){this.initializer=t,this.fetchedOrFetching=!1,this.subject=new r.X(e)}}},17390:function(e,t,n){"use strict";n.d(t,{R:function(){return s}});var r=n(3883),i=n(69810),a=n.n(i);class s{async get(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return n&&this.has(e)?this.cache[e]:(n||null===e||r.k.warn("cache","Forcing to not use cache for key:",e,". This could create duplicate objects that don't update well everywhere"),t)?this.loadQueue.add(async()=>{if(n&&this.has(e)){let n=this.cache[e];return t&&await t.fill(n),n}{if(!t)return null;let n=await t.create();return await t.fill(n),this.cache[e]=n,n}}):null}has(e){return e in this.cache}constructor(){this.cache={},this.loadQueue=new(a())(1)}}},9177:function(e,t,n){"use strict";function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}function i(e,t){return(null==e?void 0:e.length)>t?e.substring(0,t/2-1)+"..."+e.substring(e.length-(t/2-1),e.length):e}function a(e){return null==e?null:r(e.split(" ").map(e=>e[0]).join(""))}n.d(t,{OX:function(){return a},Sy:function(){return i},fm:function(){return r}})}}]);