(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8541],{43381:function(e,t,n){"use strict";n.d(t,{Z:function(){return extendSxProp}});var i=n(13428),a=n(20791),r=n(15959),s=n(58122);let l=["sx"],splitProps=e=>{var t,n;let i={systemProps:{},otherProps:{}},a=null!=(t=null==e||null==(n=e.theme)?void 0:n.unstable_sxConfig)?t:s.Z;return Object.keys(e).forEach(t=>{a[t]?i.systemProps[t]=e[t]:i.otherProps[t]=e[t]}),i};function extendSxProp(e){let t;let{sx:n}=e,s=(0,a.Z)(e,l),{systemProps:o,otherProps:c}=splitProps(s);return t=Array.isArray(n)?[o,...n]:"function"==typeof n?(...e)=>{let t=n(...e);return(0,r.P)(t)?(0,i.Z)({},o,t):o}:(0,i.Z)({},o,n),(0,i.Z)({},c,{sx:t})}},62784:function(e,t,n){Promise.resolve().then(n.bind(n,24988))},24988:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return page}});var i=n(57437),a=n(96283),r=n(9254),s=n(57042);let VerticalStackLoadingCard_VerticalStackLoadingCard=e=>{let{className:t}=e;return(0,i.jsx)("div",{className:(0,s.Z)("vertical-stack-loading-card",t),children:(0,i.jsxs)("div",{className:"content",children:[(0,i.jsx)("p",{}),(0,i.jsx)("h2",{}),(0,i.jsx)("h2",{})]})})};var l=n(40542),o=n(97716),c=n(90726),u=n(95815),d=n(94025),g=n(43226),m=n(19739),f=n(63491),p=n(60230),h=n(23965),y=n(51894);let x="\n  id\n  identityInfo { ".concat("\n  did\n  createdAt\n  credentialsCount\n  creatingAppDid\n"," }\n  claimUrl\n  expiresAt\n  claimCompletedAt\n");let ClaimableIdentity=class ClaimableIdentity{static async fromJson(e){let t=new ClaimableIdentity;return Object.assign(t,e),t.createdAt=new Date(e.createdAt),t}};let IdentityClaimRequest=class IdentityClaimRequest{static async fromJson(e){let t=new IdentityClaimRequest;return Object.assign(t,e),t.identityInfo=await ClaimableIdentity.fromJson(e.identityInfo),e.expiresAt&&(t.expiresAt=new Date(e.expiresAt)),e.claimCompletedAt&&(t.claimCompletedAt=new Date(e.claimCompletedAt)),t}};var v=n(29748),w=n(91395);function _templateObject(){let e=(0,p._)(["\n            query IdentityClaimRequest($claimRequestId: String!, $nonce: String!) {\n              identityClaimRequest(id: $claimRequestId, nonce: $nonce) {\n                ","\n              }\n            }\n          "]);return _templateObject=function(){return e},e}async function fetchIdentityClaimRequest(e,t){return(0,y.H)(async()=>{var n,i;let a=await (0,v.Pt)(async()=>(await (0,w.W)()).query({query:(0,h.Ps)(_templateObject(),x),variables:{claimRequestId:e,nonce:t}}),null,[d._s.RequestExpired,d._s.AlreadyClaimed,d._s.InvalidNonce,d._s.RequestNotExists]);return(null==a?void 0:null===(n=a.data)||void 0===n?void 0:n.identityClaimRequest)?IdentityClaimRequest.fromJson(null==a?void 0:null===(i=a.data)||void 0===i?void 0:i.identityClaimRequest):null})}var S=n(78596),I=n(36079),j=n(14776),C=n(24033),b=n(2265);let k="claim-identity";var page=()=>{let{mounted:e}=(0,o.s)(),t=(0,C.useSearchParams)(),n=t.get("request"),s=t.get("nonce"),[p,h]=(0,b.useState)(!0),[y,x]=(0,b.useState)(!1),[v,w]=(0,b.useState)(null),[q,O]=(0,b.useState)(null),[A,_]=(0,b.useState)(null),[P,Z]=(0,b.useState)(null),[D]=(0,l.V)(null==P?void 0:P.name$),[F,R]=(0,b.useState)(null),E=(0,C.useRouter)(),[N]=(0,l.V)(j.DR),[B]=(0,l.V)(j.jU),T=!p&&N,{showSuccessToast:V,showErrorToast:G}=(0,m.p)();(0,b.useEffect)(()=>{n&&!v&&(I.k.log(k,"Fetching claim request details"),fetchIdentityClaimRequest(n,s).then(e=>{if(I.k.log(k,"Got claim request",e),e){var t;w(e),O(null===(t=e.identityInfo)||void 0===t?void 0:t.creatingAppDid)}else h(!1)}).catch(e=>{if(h(!1),e instanceof u._)switch(e.appExceptionCode){case d._s.AlreadyClaimed:R("This identity is already claimed");break;case d._s.InvalidNonce:R("Security code is invalie");break;case d._s.RequestExpired:R("Request expired, please try again from your original application");break;case d._s.RequestNotExists:R("This identity transfer request doesn't exist")}}))},[n,s,v]),(0,b.useEffect)(()=>{q&&!A&&(I.k.log(k,"Fetching creating app's DID document on chain"),S._.resolveDIDDocument(q).then(async e=>{if(h(!1),_(e),I.k.log(k,"Got creating app's DID document:",e),e){let t=e.getCredentialByType("ApplicationCredential");t?Z(await (0,c.C)(t)):I.k.error(k,"The on chain DID document supposed to contain an app info credential doesn't have such credential")}else I.k.warn(k,"Unable to resolve DID Document of the app that created the managed identity")}))},[q,A]);let claimIdentity=async()=>{x(!0);let e=await B.get("identity").claimManagedIdentity(v,s);e?(V("Identity claimed successfully"),E.replace("/dashboard")):(G("Sorry, the identity failed to be claimed for some reason"),x(!1))};return e?(0,i.jsxs)("div",{className:"flex flex-col col-span-full",children:[(0,i.jsx)(g.Z,{variant:"h5",children:"Identity claim"}),!T&&(0,i.jsx)(VerticalStackLoadingCard_VerticalStackLoadingCard,{}),T&&!p&&(0,i.jsx)(i.Fragment,{children:!v&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{children:"Sorry, we could not find information about this identity at the moment."}),F&&(0,i.jsx)(g.Z,{children:F})]})}),v&&(0,i.jsxs)(i.Fragment,{children:[D&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(g.Z,{children:["A new Web3 identity has been prepared for you by ",(0,i.jsx)("b",{children:D})," and is ready for you to claim."]}),(0,i.jsxs)(g.Z,{children:["Claiming means that this identity, initially created and controlled by ",D,", will now fully become yours, together with your other identities in your account."]})]}),!D&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{children:"A new Web3 identity has been prepared for you by a third party application."}),(0,i.jsx)(g.Z,{children:"Claiming means that this identity, initially created and controlled by another application, will now fully become yours, together with your other identities in your account."})]}),P&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(a.J,{credential:P})}),!B&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"flex items-center space-x-3 mt-8",children:e&&!B&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.c,{onClick:()=>{(0,f.qC)(window.location.toString()),E.push("/register")},children:"Sign up"}),(0,i.jsx)(r.c,{onClick:()=>{(0,f.qC)(window.location.toString()),E.push("/signin")},children:"Sign in"})]})})}),B&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.c,{className:"mt-8",onClick:claimIdentity,busy:y,children:"Claim this identity"}),(0,i.jsx)(g.Z,{children:"This new identity will be transfered to your account."})]})]})]}):null}},96283:function(e,t,n){"use strict";n.d(t,{J:function(){return CredentialAvatar}});var i=n(57437),a=n(40542),r=n(3283),s=n(57042),l=n(16691),o=n.n(l);let CredentialAvatar=e=>{let{credential:t,width:n=60,height:l=60,className:c}=e,[u]=(0,a.V)(null==t?void 0:t.representativeIcon$);return(0,i.jsx)(r.Z,{sx:{width:n,height:l,padding:"string"==typeof u?0:"".concat(.125*Math.floor(n/8),"rem"),backgroundColor:"#7575754d"},className:(0,s.Z)(c),children:"string"==typeof u?(0,i.jsx)(o(),{src:u,alt:"",width:n,height:l}):u})}},9254:function(e,t,n){"use strict";n.d(t,{c:function(){return MainButton}});var i=n(57437),a=n(6882),r=n(49050),s=n(57042);let MainButton=e=>{let{leftIcon:t,size:n="medium",mode:l="default",onClick:o,children:c,busy:u=!1,disabled:d=!1,className:g}=e,m=(0,i.jsx)(a.Z,{size:16});return(0,i.jsx)("div",{className:(0,s.Z)("flex",g),children:(0,i.jsx)(r.Z,{className:"flex-1",startIcon:u?m:t,disabled:u||d,size:n,color:"default"===l?"primary":"error",variant:"contained",onClick:o,children:c})})}},40542:function(e,t,n){"use strict";n.d(t,{V:function(){return useBehaviorSubject}});var i=n(2265);let useBehaviorSubject=e=>{let[t,n]=(0,i.useState)(null==e?void 0:e.getValue()),[a,r]=(0,i.useState)();return(0,i.useEffect)(()=>{if(!e){n(null);return}let t=e.subscribe({next:e=>{n(e)},error:r});return()=>t.unsubscribe()},[e]),[t]}},97716:function(e,t,n){"use strict";n.d(t,{s:function(){return useMounted}});var i=n(2265);let useMounted=()=>{let[e,t]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{t(!0)},[]),{mounted:e}}},19739:function(e,t,n){"use strict";n.d(t,{p:function(){return useToast}});var i=n(36953);function useToast(){let{enqueueSnackbar:e}=(0,i.Ds)();return{showSuccessToast:t=>{e(t,{variant:"success"})},showErrorToast:t=>{e(t,{variant:"error"})}}}},63491:function(e,t,n){"use strict";n.d(t,{$Y:function(){return setOnGoingFlowOperation},Ad:function(){return clearPostSignInUrl},Kt:function(){return getOnGoingFlowOperation},cX:function(){return a},fK:function(){return clearOnGoingFlowOperation},qC:function(){return setPostSignInUrl},vX:function(){return usePostSignInFlow}});var i,a,r=n(92e3),s=n(36079);(i=a||(a={}))[i.OnBoardingEmailBinding=0]="OnBoardingEmailBinding",i[i.OnBoardingBrowserBinding=1]="OnBoardingBrowserBinding",i[i.EmailSignIn=2]="EmailSignIn";let l="ongoingflowoperation",o="postsigninurl";function getOnGoingFlowOperation(){return a[localStorage.getItem(l)]}function setOnGoingFlowOperation(e){localStorage.setItem(l,a[e])}function clearOnGoingFlowOperation(){localStorage.removeItem(l)}function setPostSignInUrl(e){s.k.log("flow","Setting post sign in url to:",e),localStorage.setItem(o,e)}function clearPostSignInUrl(){s.k.log("flow","Clearing post sign in url"),localStorage.removeItem(o)}function usePostSignInFlow(){let e=(0,r.useRouter)();return{navigateToPostSignInLandingPage(t){let n=localStorage.getItem(o);if(n)s.k.log("flow","Navigating to post sign in landing page:",n),e.replace(n),clearPostSignInUrl();else{let n=t||"/dashboard";s.k.log("flow","Navigating to post sign in landing page ".concat(n)),e.push(n)}}}}}},function(e){e.O(0,[6990,9787,9443,8218,3988,395,8321,3824,6642,1228,5295,1396,1510,2e3,6953,2736,6691,3262,2971,7864,1744],function(){return e(e.s=62784)}),_N_E=e.O()}]);