(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1456],{26371:function(e,t,n){"use strict";var i,a=n(90952);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}t.Z=function(e){return a.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16"},e),i||(i=a.createElement("path",{fill:"currentColor",d:"M8 0h10c1.11 0 2 .89 2 2v2h-3.41L14 6.59v4l-2 2V16H8v-3.41l-2-2V5.41l2-2V0Zm8 7.41V10h4V6h-2.59L16 7.41ZM4.59 4 6 2.59V0H2C.89 0 0 .89 0 2v2h4.59ZM4 10V6H0v4h4Zm2 3.41L4.59 12H0v2c0 1.11.89 2 2 2h4v-2.59ZM15.41 12 14 13.41V16h4c1.11 0 2-.89 2-2v-2h-4.59Z"})))}},22017:function(e,t,n){Promise.resolve().then(n.bind(n,98072))},77814:function(e,t,n){"use strict";n.d(t,{O:function(){return PreparingRequest}});var i=n(57437),a=n(40471),r=n(57042);let PreparingRequest=e=>{let{className:t}=e;return(0,i.jsxs)("div",{className:(0,r.Z)("flex flex-col w-full",t),children:[(0,i.jsx)("div",{className:"italic",children:"Preparing request, hold on..."}),(0,i.jsx)(a.Z,{})]})}},26188:function(e,t,n){"use strict";n.d(t,{O:function(){return RequestingApp}});var i=n(57437),a=n(4528),r=n(13457),l=n(3283),s=n(96507),c=n(43226),o=n(78596),d=n(16691),u=n.n(d),m=n(2265);let RequestingApp=e=>{let{applicationDID:t,className:n}=e,[d,f]=(0,m.useState)(null),[p,h]=(0,m.useState)(null),[g,x]=(0,m.useState)(!1),updateApplicationData=async()=>{if(t){let e=await o._.resolveDIDDocument(t);x(!0),e?(f(await e.getRepresentativeIcon()),h(await e.getRepresentativeOwnerName())):(f(null),h(null))}};return((0,m.useEffect)(()=>{updateApplicationData()},[t]),g&&t)?(0,i.jsxs)(r.Z,{className:n,justifyContent:"center",alignItems:"center",spacing:1.5,children:[(0,i.jsxs)(r.Z,{justifyContent:"center",alignItems:"center",spacing:.5,children:[(0,i.jsx)(l.Z,{sx:{width:96,height:96},children:d&&(0,i.jsx)(u(),{src:d,alt:"",width:120,height:120})}),(0,i.jsx)("div",{children:(0,i.jsx)(s.Z,{className:"rounded-[4px] text-[8px] px-2.5 py-1 inline-block text-white whitespace-nowrap bg-[#9291A5]",children:"APPLICATION"})})]}),(0,i.jsx)(c.Z,{variant:"h4",children:p})]}):(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)(a.a,{width:120,height:120})})}},98072:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return page}});var i=n(57437),a=n(61568),r=n(24033),l=n(2265),s=n(77814),c=n(11920),o=n(40542),d=n(69147),u=n(61459),m=n(57958),f=n(57389),p=n(36079),h=n(14776),g=n(43639),x=n(26188),v=n(30666),j=n(51469),y=n(96283),C=n(96507),w=n(43226),S=n(42464),credential_CredentialBasicInfo=function(e){let{credential:t}=e;return(0,i.jsxs)(C.Z,{children:[(0,i.jsx)(w.Z,{variant:"body1",fontWeight:600,lineHeight:1.2,children:t.getDisplayableTitle()}),(0,i.jsx)(w.Z,{variant:"body2",color:"text.secondary",lineHeight:1.2,children:t.getDisplayValue()&&(0,i.jsx)(S.h,{data:t.getDisplayValue()})})]})},I=n(19959);let CredentialDisplayEntryWidget=e=>{let{claimDisplayEntry:t,credentialDisplayEntry:n,updateSummary:a}=e,[r,s]=(0,l.useState)(!1);(0,l.useEffect)(()=>{n&&s(n.selected)},[n]);let onCredentialSelection=(e,t)=>{let n=t.selected;if(p.k.log("RequestCredentialsIntent","onCredentialSelection",e,t),n)1===e.claimDescription.min&&1===e.claimDescription.max||(t.selected=!1);else{if(1===e.claimDescription.min&&1===e.claimDescription.max){let t=getFirstSelectedCredentialInClaim(e);t&&(t.selected=!1)}t.selected=!0}s(t.selected),a()},getFirstSelectedCredentialInClaim=e=>e.matchingCredentials.find(e=>e.selected);return(0,i.jsx)(I.m,{props:{hover:!0},onClick:()=>onCredentialSelection(t,n),className:"h-[3rem] cursor-pointer",avatar:(0,i.jsx)(y.J,{credential:n.credential,width:36,height:36}),rowCells:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{children:(0,i.jsx)(credential_CredentialBasicInfo,{credential:n.credential})}),(0,i.jsx)(v.Z,{align:"center",children:(0,i.jsx)(j.Z,{checked:r,sx:{"&.Mui-checked":{color:"#9D3E3E"}}})})]})})};var D=n(98489);let ClaimDisplayEntryWidget=e=>{let{claimDisplayEntry:t}=e,[n,a]=(0,l.useState)("");(0,l.useEffect)(()=>{t&&updateSummary()},[t]);let claimSelectionSummary=e=>{let t=numberOfSelectedCredentialsInClaim(e);return e.claimDescription.min===e.claimDescription.max?"".concat(t," / ").concat(e.claimDescription.min):0===e.claimDescription.min?"".concat(t," / max ").concat(e.claimDescription.max):"".concat(t," / min ").concat(e.claimDescription.min,", max ").concat(e.claimDescription.max)},numberOfSelectedCredentialsInClaim=e=>e.matchingCredentials.reduce((e,t)=>t.selected?e+1:e,0),updateSummary=()=>{let e=claimSelectionSummary(t);a(e)};return(0,i.jsx)(I.J,{headCells:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{children:"CREDENTIALS"}),(0,i.jsxs)(v.Z,{children:["SELECTED ",n]})]}),bodyRows:t&&t.matchingCredentials&&t.matchingCredentials.length>0?t.matchingCredentials.map(e=>(0,i.jsx)(CredentialDisplayEntryWidget,{credentialDisplayEntry:e,claimDisplayEntry:t,updateSummary:updateSummary},e.credential.id)):(0,i.jsx)(D.Z,{children:(0,i.jsx)(v.Z,{component:"th",colSpan:6,align:"center",children:(0,i.jsx)(w.Z,{variant:"body1",color:"text.primary",children:"No credential found"})})})})};var E=n(26371),N=n(83129),R=n(66267),O=n(96479);let ClaimDisplayEntryListWidget=e=>{let{claimDisplayEntryList:t}=e;return(0,i.jsx)(N.Z,{title:(0,i.jsxs)("div",{className:"inline-flex items-center",children:[(0,i.jsx)(R.C,{children:(0,i.jsx)("div",{className:"w-4 h-4 flex justify-center",children:(0,i.jsx)(E.Z,{})})}),(0,i.jsx)("span",{className:"pl-2",children:"Credentials Request"})]}),able2ShowAll:!1,children:(0,i.jsx)("div",{className:"mb-1",children:t&&t.length>0?t.map((e,t)=>(0,i.jsx)(ClaimDisplayEntryWidget,{claimDisplayEntry:e},t)):(0,i.jsx)(I.J,{headCells:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{children:"CREDENTIALS"}),(0,i.jsx)(v.Z,{children:"SELECT"})]}),bodyRows:t?(0,i.jsx)(D.Z,{children:(0,i.jsx)(v.Z,{component:"th",colSpan:6,align:"center",children:(0,i.jsx)(w.Z,{variant:"body1",color:"text.primary",children:"No credential found"})})}):[,,,].fill(0).map((e,t)=>(0,i.jsx)(O.IT,{},t))})})})};var b=n(13457),A=n(49050),_=n(23785);let RequestDetails=e=>{let{intent:t}=e,r="RequestCredentialsIntent",[s]=(0,o.V)(m.Bx),[v]=(0,o.V)(null==s?void 0:s.credentials().credentials$),[j,y]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),[I,D]=(0,l.useState)(""),[E,N]=(0,l.useState)("Demo App"),[R,O]=(0,l.useState)(!1),[P,Z]=(0,l.useState)(null),[T]=(0,o.V)(h.jU),q=t.requestPayload,k=t.requestPayload.caller;p.k.log(r,"payload",q),(0,l.useEffect)(()=>{runPreliminaryChecks(),v&&q&&(fetchApplicationDidInfo(q),organizeRequestedClaims(q).then(e=>{Z(e)}))},[v,q]);let runPreliminaryChecks=()=>{S(!1)},fetchApplicationDidInfo=async e=>{let t=e.caller;if(t){let e=await f.n.isPublished(t);if(e){let e=await f.n.getIssuerName(t);p.k.log(r,"Requesting App name:",e),N(e);let n=await f.n.getIssuerAvatar(t);D(n)}else p.k.warn(r,"Requesting App is not published.")}},prepareRawClaims=e=>{let t=JSON.parse(JSON.stringify(e.claims)),n=convertRawClaimsIfNeeded(e);return n&&(t=n),t.forEach(e=>(void 0===e.min&&(e.min=1),void 0===e.max&&(e.max=1),e)),t},convertRawClaimsIfNeeded=e=>{if("_version"in e)return null;{let t=[],n=e.claims;for(let e of n){let n=c.DID.claimDescription(e.reason).withMin(e.min).withMax(e.max).withNoMatchRecommendations(e.noMatchRecommendations).withClaim(new c.DID.Claim().withQuery(e.query).withIssuers(e.issuers));t.push(n)}return t}},organizeRequestedClaims=async e=>{let t=[],i=prepareRawClaims(e);for(let e of i){p.k.log(r,"Organizing claim",e);let i=[];for(let e of v){let t=JSON.parse(await e.verifiableCredential.toString());await appendTypesWithContextsToJsonCredential(e.verifiableCredential,t),i.push(t)}let a=[],l=[];for(let t of e.claims){try{let e=await n.e(9733).then(n.t.bind(n,73820,23));a=a.concat(e.query(i,t.query)),p.k.log(r,"Matching credentials (json)",a)}catch(e){p.k.warn(r,"JSON Path exception",e)}l=l.concat(a.map(e=>{let n=v.find(t=>t.verifiableCredential.getId().toString()===e.id);if(t.issuers){let e=t.issuers.find(e=>e===n.verifiableCredential.getIssuer().toString());if(!e)return null}return{credential:n,selected:!1,expired:!1}}).filter(e=>null!==e))}1==e.min&&e.max===e.min&&1===l.length&&(l[0].selected=!0);let s={claimDescription:e,matchingCredentials:l};t.push(s)}return O(!0),p.k.log(r,"Organized claims",t),t},appendTypesWithContextsToJsonCredential=async(e,t)=>{let n=await u.N.resolveTypesWithContexts(e);for(let e of n){let n="".concat(e.context,"#").concat(e.shortType),i=t.type;0>i.indexOf(n)&&i.push(n)}},buildDeliverableCredentialsList=()=>{let e=[];for(let t of P)for(let n of t.matchingCredentials)n.selected&&e.push(n.credential);return p.k.log(r,"Deliverable credentials:",e),e},approveRequest=async()=>{y(!0);let e=buildDeliverableCredentialsList(),n=await s.createVerifiablePresentation(e.map(e=>e.verifiableCredential),q.realm,q.nonce);if(!n){y(!1);return}let i=n.toString(!0),r=await (0,a.h)(t.id,i);if(r){await (null==T?void 0:T.get("activity").createActivity({type:d.T.CREDENTIALS_SHARED,credentialsCount:e.length,appDid:k})),q.caller&&await s.applications().recordRequestedCredentials(q.caller,e);let n=(0,g.Q)(t.redirectUrl,"rid",t.id);window.location.href=n}},rejectRequest=async()=>{await (0,a.h)(t.id,null);let e=(0,g.Q)(t.redirectUrl,"rid",t.id);window.location.href=e};return(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsxs)(b.Z,{spacing:2,children:[(0,i.jsx)(x.O,{applicationDID:k}),(0,i.jsxs)(w.Z,{variant:"body2",color:"text.primary",textAlign:"center",children:["This application is requesting access to some of your information.",(0,i.jsx)("br",{}),"Please review and select the profile items (credentials) you wish to share."]}),(0,i.jsx)(ClaimDisplayEntryListWidget,{claimDisplayEntryList:P}),P&&P.length>0&&(0,i.jsxs)("div",{className:"flex items-center gap-4 sm:px-4 sm: gap-8",children:[(0,i.jsx)(A.Z,{variant:"contained",className:"flex-1",onClick:rejectRequest,color:"error",children:"CANCEL"}),(0,i.jsx)(_.Kz,{className:"flex-1",onClick:approveRequest,loading:j,children:"APPROVE"})]})]}),!T&&(0,i.jsx)(w.Z,{variant:"h6",children:"Please sign in or sign up to continue"}),T&&!s&&(0,i.jsx)(w.Z,{variant:"h6",children:"Please make an identity active to continue"})]})};var P=n(63491),page=()=>{let e=(0,r.useSearchParams)(),t=e.get("rid"),[n,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),[f]=(0,o.V)(h.jU),[p]=(0,o.V)(m.Bx);return(0,l.useEffect)(()=>{t&&(0,a.S)(t).then(e=>{c(!1),u(e)})},[t]),(0,l.useEffect)(()=>{f&&p?(0,P.Ad)():(0,P.qC)(window.location.href)},[f,p]),(0,i.jsxs)("div",{className:"col-span-full",children:[n&&(0,i.jsx)(s.O,{className:"mb-6"}),!n&&d&&(0,i.jsx)(RequestDetails,{intent:d}),!n&&!d&&(0,i.jsx)("div",{children:"No matching request"})]})}},96283:function(e,t,n){"use strict";n.d(t,{J:function(){return CredentialAvatar}});var i=n(57437),a=n(40542),r=n(3283),l=n(57042),s=n(16691),c=n.n(s);let CredentialAvatar=e=>{let{credential:t,width:n=60,height:s=60,className:o}=e,[d]=(0,a.V)(null==t?void 0:t.representativeIcon$);return(0,i.jsx)(r.Z,{sx:{width:n,height:s,padding:"string"==typeof d?0:"".concat(.125*Math.floor(n/8),"rem"),backgroundColor:"#7575754d"},className:(0,l.Z)(o),children:"string"==typeof d?(0,i.jsx)(c(),{src:d,alt:"",width:n,height:s}):d})}},42464:function(e,t,n){"use strict";n.d(t,{h:function(){return JsonViewer}});var i=n(57437);function JsonViewer(e){let{data:t}=e,renderJson=e=>{if("object"!=typeof e||null===e)return(0,i.jsx)("span",{className:"json-value",children:String(e)});if(Array.isArray(e))return(0,i.jsx)("div",{className:"json-array",children:e.map((e,t)=>(0,i.jsx)("div",{children:renderJson(e)},t))});{let t=Object.keys(e);return(0,i.jsx)("div",{className:"json-object",children:t.map(t=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"json-key",children:[t,"："]})," ",renderJson(e[t])]},t))})}};return(0,i.jsxs)("div",{className:"json-viewer truncate",style:{textAlign:"left"},children:[renderJson(t),(0,i.jsx)("style",{children:"\n          .json-viewer {\n            font-family: Arial, sans-serif;\n          }\n          .json-object, .json-array {\n            list-style: none;\n            padding-left: 20px;\n          }\n          .json-key {\n            font-weight: bold;\n          }\n        "})]})}n(2265)},4528:function(e,t,n){"use strict";n.d(t,{a:function(){return LoadingCircle_LoadingCircle}});var i=n(57437),a=n(57042);let LoadingCircle_LoadingCircle=e=>{let{className:t,width:n,height:r}=e;return(0,i.jsx)("div",{className:(0,a.Z)("loading-circle",t),style:{...n&&{width:n},...r&&{height:r}},children:(0,i.jsx)("div",{className:"content",children:(0,i.jsx)("div",{className:"animated"})})})}},69147:function(e,t,n){"use strict";var i,a;n.d(t,{T:function(){return i}}),(a=i||(i={})).NEW_ACCOUNT="NEW_ACCOUNT",a.USER_SIGN_IN="USER_SIGN_IN",a.IDENTITY_CREATED="IDENTITY_CREATED",a.IDENTITY_DELETED="IDENTITY_DELETED",a.CREDENTIALS_IMPORTED="CREDENTIALS_IMPORTED",a.CREDENTIALS_SHARED="CREDENTIALS_SHARED",a.BIND_EMAIL="BIND_EMAIL",a.BIND_BROWSER="BIND_BROWSER",a.PASSWORD_CHANGED="PASSWORD_CHANGED"},63491:function(e,t,n){"use strict";n.d(t,{$Y:function(){return setOnGoingFlowOperation},Ad:function(){return clearPostSignInUrl},Kt:function(){return getOnGoingFlowOperation},cX:function(){return a},fK:function(){return clearOnGoingFlowOperation},qC:function(){return setPostSignInUrl},vX:function(){return usePostSignInFlow}});var i,a,r=n(92e3),l=n(36079);(i=a||(a={}))[i.OnBoardingEmailBinding=0]="OnBoardingEmailBinding",i[i.OnBoardingBrowserBinding=1]="OnBoardingBrowserBinding",i[i.EmailSignIn=2]="EmailSignIn";let s="ongoingflowoperation",c="postsigninurl";function getOnGoingFlowOperation(){return a[localStorage.getItem(s)]}function setOnGoingFlowOperation(e){localStorage.setItem(s,a[e])}function clearOnGoingFlowOperation(){localStorage.removeItem(s)}function setPostSignInUrl(e){l.k.log("flow","Setting post sign in url to:",e),localStorage.setItem(c,e)}function clearPostSignInUrl(){l.k.log("flow","Clearing post sign in url"),localStorage.removeItem(c)}function usePostSignInFlow(){let e=(0,r.useRouter)();return{navigateToPostSignInLandingPage(t){let n=localStorage.getItem(c);if(n)l.k.log("flow","Navigating to post sign in landing page:",n),e.replace(n),clearPostSignInUrl();else{let n=t||"/dashboard";l.k.log("flow","Navigating to post sign in landing page ".concat(n)),e.push(n)}}}}},61568:function(e,t,n){"use strict";n.d(t,{S:function(){return fetchIntent},h:function(){return fulfilIntentRequest}});var i=n(60230),a=n(23965);let Intent=class Intent{static async fromJson(e){let t=new Intent;return Object.assign(t,e),t.createdAt=new Date(e.createdAt),t}};var r=n(29748),l=n(91395),s=n(36079);function _templateObject(){let e=(0,i._)(["\n      query GetIntentRequest($intentId: String!) {\n        intent (id: $intentId) {\n          ","\n        }\n      }\n    "]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,i._)(["\n      mutation FulfilIntentRequest($input: FulfilIntentInput!) {\n        fulfilIntent (input: $input)\n      }\n    "]);return _templateObject1=function(){return e},e}async function fetchIntent(e){var t;let n=await (0,r.Pt)(async()=>(await (0,l.W)()).query({query:(0,a.Ps)(_templateObject(),"\n  id\n  createdAt\n  type\n  redirectUrl\n  requestPayload\n  responsePayload\n"),variables:{intentId:e}}));if(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.intent){let e=await Intent.fromJson(n.data.intent);return s.k.log("intents","Fetched intent:",e),e}return s.k.warn("intents","No intent found for id ".concat(e)),null}async function fulfilIntentRequest(e,t){var n;let i=await (0,r.Pt)(async()=>(await (0,l.W)()).mutate({mutation:(0,a.Ps)(_templateObject1()),variables:{input:{intentId:e,payload:t}}}));return(null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.fulfilIntent)?(s.k.log("intents","Successfully fulfilled intent id ".concat(e)),!0):(s.k.warn("intents","Failed to fulfil intent id ".concat(e)),!1)}},43639:function(e,t,n){"use strict";function setQueryParameter(e,t,n){let i=new URL(e),a=new URLSearchParams(i.search);return a.set(t,n),i.search=a.toString(),i.toString()}n.d(t,{Q:function(){return setQueryParameter}})}},function(e){e.O(0,[6990,9787,9443,8218,3988,395,8321,3824,6642,1228,5295,1510,8251,6953,2e3,1880,894,7998,1407,1462,3262,9513,5944,2971,7864,1744],function(){return e(e.s=22017)}),_N_E=e.O()}]);