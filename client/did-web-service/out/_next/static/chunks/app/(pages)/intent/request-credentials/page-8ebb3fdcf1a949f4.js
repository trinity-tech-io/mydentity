(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1456],{66798:function(e,t,n){Promise.resolve().then(n.bind(n,98072))},77814:function(e,t,n){"use strict";n.d(t,{O:function(){return PreparingRequest}});var i=n(57437),a=n(40471),r=n(57042);let PreparingRequest=e=>{let{className:t}=e;return(0,i.jsxs)("div",{className:(0,r.Z)("flex flex-col w-full",t),children:[(0,i.jsx)("div",{className:"italic",children:"Preparing request, hold on..."}),(0,i.jsx)(a.Z,{})]})}},26188:function(e,t,n){"use strict";n.d(t,{O:function(){return RequestingApp}});var i=n(57437),a=n(4528),r=n(13457),l=n(3283),s=n(43226),c=n(78596),o=n(57042),d=n(16691),u=n.n(d),f=n(2265);let RequestingApp=e=>{let{applicationDID:t,className:n}=e,[d,m]=(0,f.useState)(null),[p,g]=(0,f.useState)(null),[h,x]=(0,f.useState)(!1),updateApplicationData=async()=>{if(t){let e=await c._.resolveDIDDocument(t);x(!0),e?(m(await e.getRepresentativeIcon()),g(await e.getRepresentativeOwnerName())):(m(null),g(null))}};return((0,f.useEffect)(()=>{updateApplicationData()},[t]),h&&t)?(0,i.jsxs)("div",{className:(0,o.Z)("flex flex-col items-center",n),children:[(0,i.jsx)(r.Z,{direction:"row",justifyContent:"center",children:(0,i.jsx)(l.Z,{sx:{width:120,height:120},children:d&&(0,i.jsx)(u(),{src:d,alt:"",width:120,height:120})})}),(0,i.jsx)(s.Z,{mt:1,fontWeight:600,children:p})]}):(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)(a.a,{width:120,height:120})})}},98072:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return page}});var i=n(57437),a=n(61568),r=n(24033),l=n(2265),s=n(77814),c=n(9254),o=n(11920),d=n(40542),u=n(69147),f=n(61459),m=n(57958),p=n(57389),g=n(36079),h=n(14776),x=n(43639),v=n(26188),j=n(96507),y=n(54986),S=n(35266),w=n(96283),I=n(43226),C=n(28874),D=n(72502),N=n(8864),b=n(16691),E=n.n(b),R=n(42464),credential_CredentialBasicInfo=function(e){let{credential:t}=e,[n]=(0,d.V)(null==t?void 0:t.issuerInfo$);return(0,i.jsxs)(j.Z,{sx:{textAlign:"left",width:"100%"},children:[(0,i.jsx)(I.Z,{gutterBottom:!0,variant:"h6",children:t.getDisplayableTitle()}),(0,i.jsx)(I.Z,{variant:"body1",sx:{color:"text.secondary"},children:t.getDisplayValue()&&(0,i.jsx)(R.h,{data:t.getDisplayValue()})}),(0,i.jsxs)(C.ZP,{container:!0,spacing:2,sx:{mt:1},children:[t.isSensitiveCredential()&&(0,i.jsx)(I.Z,{fontSize:14,color:"#FF6347",children:"Sensitive"}),!t.isSelfIssued()&&(null==n?void 0:n.isPublished)&&(0,i.jsxs)(D.Z,{children:[(0,i.jsx)(N.Z,{children:(0,i.jsx)(E(),{unoptimized:!0,src:null==n?void 0:n.avatarIcon,width:30,height:30,style:{borderRadius:"50%"},alt:""})}),(0,i.jsxs)(I.Z,{variant:"body1",sx:{color:"text.secondary"},children:["Created by ",null==n?void 0:n.name]})]})]})]})},O=n(51469);let CredentialDisplayEntryWidget=e=>{let{claimDisplayEntry:t,credentialDisplayEntry:n,updateSummary:a}=e,[r,s]=(0,l.useState)(!1);(0,l.useEffect)(()=>{n&&s(n.selected)},[n]);let onCredentialSelection=(e,t)=>{let n=t.selected;if(g.k.log("RequestCredentialsIntent","onCredentialSelection",e,t),n)1===e.claimDescription.min&&1===e.claimDescription.max||(t.selected=!1);else{if(1===e.claimDescription.min&&1===e.claimDescription.max){let t=getFirstSelectedCredentialInClaim(e);t&&(t.selected=!1)}t.selected=!0}s(t.selected),a()},getFirstSelectedCredentialInClaim=e=>e.matchingCredentials.find(e=>e.selected);return(0,i.jsx)("div",{className:"flex flex-row mt-4 gap-6",children:(0,i.jsxs)(D.Z,{onClick:()=>onCredentialSelection(t,n),style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("div",{style:{marginRight:10},children:(0,i.jsx)(w.J,{credential:n.credential,width:60,height:60})}),(0,i.jsx)(credential_CredentialBasicInfo,{credential:n.credential}),(0,i.jsx)(O.Z,{checked:r})]})})},ClaimDisplayEntryWidget=e=>{let{claimDisplayEntry:t}=e,[n,a]=(0,l.useState)("");(0,l.useEffect)(()=>{t&&updateSummary()},[t]);let claimSelectionSummary=e=>{let t=numberOfSelectedCredentialsInClaim(e);return e.claimDescription.min===e.claimDescription.max?"".concat(t," / ").concat(e.claimDescription.min):0===e.claimDescription.min?"".concat(t," / max ").concat(e.claimDescription.max):"".concat(t," / min ").concat(e.claimDescription.min,", max ").concat(e.claimDescription.max)},numberOfSelectedCredentialsInClaim=e=>e.matchingCredentials.reduce((e,t)=>t.selected?e+1:e,0),updateSummary=()=>{let e=claimSelectionSummary(t);a(e)};return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("div",{className:"flex flex-row p-4",children:[(0,i.jsxs)("div",{className:"flex flex-row p-1",children:[" ",t.claimDescription.reason," "]}),(0,i.jsx)("div",{className:"absolute right-1 p-1",children:n})]}),t.matchingCredentials&&(0,i.jsx)(S.Z,{component:"nav","aria-label":"main mailbox folders",children:t.matchingCredentials.map(e=>(0,i.jsxs)("div",{children:[(0,i.jsx)(CredentialDisplayEntryWidget,{credentialDisplayEntry:e,claimDisplayEntry:t,updateSummary:updateSummary}),(0,i.jsx)(y.Z,{})]},e.credential.id))})]},t.claimDescription.reason)})},ClaimDisplayEntryListWidget=e=>{let{claimDisplayEntryList:t}=e;return(0,i.jsxs)("div",{className:"col-span-full p-2 xl:col-span-5 bg-white dark:bg-slate-800 shadow-lg rounded-sm border border-slate-200 dark:border-slate-700",children:["List of credentials",(0,i.jsx)(y.Z,{}),(0,i.jsx)(j.Z,{sx:{width:"100%",bgcolor:"background.paper"},children:t&&(0,i.jsx)(S.Z,{component:"nav","aria-label":"main mailbox folders",children:t.map(e=>(0,i.jsx)("div",{className:"flex flex-col flex-1",children:(0,i.jsx)(ClaimDisplayEntryWidget,{claimDisplayEntry:e})},e.claimDescription.reason))})})]})},RequestDetails=e=>{let{intent:t}=e,r="RequestCredentialsIntent",[s]=(0,d.V)(m.Bx),[j]=(0,d.V)(null==s?void 0:s.credentials().credentials$),[y,S]=(0,l.useState)(!1),[w,I]=(0,l.useState)(!1),[C,D]=(0,l.useState)(""),[N,b]=(0,l.useState)("Demo App"),[E,R]=(0,l.useState)(!1),[O,A]=(0,l.useState)(null),[_]=(0,d.V)(h.jU),P=t.requestPayload,k=t.requestPayload.caller;g.k.log(r,"payload",P),(0,l.useEffect)(()=>{runPreliminaryChecks(),j&&P&&(fetchApplicationDidInfo(P),organizeRequestedClaims(P).then(e=>{A(e)}))},[j,P]);let runPreliminaryChecks=()=>{I(!1)},fetchApplicationDidInfo=async e=>{let t=e.caller;if(t){let e=await p.n.isPublished(t);if(e){let e=await p.n.getIssuerName(t);g.k.log(r,"Requesting App name:",e),b(e);let n=await p.n.getIssuerAvatar(t);D(n)}else g.k.warn(r,"Requesting App is not published.")}},prepareRawClaims=e=>{let t=JSON.parse(JSON.stringify(e.claims)),n=convertRawClaimsIfNeeded(e);return n&&(t=n),t.forEach(e=>(void 0===e.min&&(e.min=1),void 0===e.max&&(e.max=1),e)),t},convertRawClaimsIfNeeded=e=>{if("_version"in e)return null;{let t=[],n=e.claims;for(let e of n){let n=o.DID.claimDescription(e.reason).withMin(e.min).withMax(e.max).withNoMatchRecommendations(e.noMatchRecommendations).withClaim(new o.DID.Claim().withQuery(e.query).withIssuers(e.issuers));t.push(n)}return t}},organizeRequestedClaims=async e=>{let t=[],i=prepareRawClaims(e);for(let e of i){g.k.log(r,"Organizing claim",e);let i=[];for(let e of j){let t=JSON.parse(await e.verifiableCredential.toString());await appendTypesWithContextsToJsonCredential(e.verifiableCredential,t),i.push(t)}let a=[],l=[];for(let t of e.claims){try{let e=await n.e(9733).then(n.t.bind(n,73820,23));a=a.concat(e.query(i,t.query)),g.k.log(r,"Matching credentials (json)",a)}catch(e){g.k.warn(r,"JSON Path exception",e)}l=l.concat(a.map(e=>{let n=j.find(t=>t.verifiableCredential.getId().toString()===e.id);if(t.issuers){let e=t.issuers.find(e=>e===n.verifiableCredential.getIssuer().toString());if(!e)return null}return{credential:n,selected:!1,expired:!1}}).filter(e=>null!==e))}1==e.min&&e.max===e.min&&1===l.length&&(l[0].selected=!0);let s={claimDescription:e,matchingCredentials:l};t.push(s)}return R(!0),g.k.log(r,"Organized claims",t),t},appendTypesWithContextsToJsonCredential=async(e,t)=>{let n=await f.N.resolveTypesWithContexts(e);for(let e of n){let n="".concat(e.context,"#").concat(e.shortType),i=t.type;0>i.indexOf(n)&&i.push(n)}},buildDeliverableCredentialsList=()=>{let e=[];for(let t of O)for(let n of t.matchingCredentials)n.selected&&e.push(n.credential);return g.k.log(r,"Deliverable credentials:",e),e},approveRequest=async()=>{S(!0);let e=buildDeliverableCredentialsList(),n=await s.createVerifiablePresentation(e.map(e=>e.verifiableCredential),P.realm,P.nonce);if(!n){S(!1);return}let i=n.toString(!0),r=await (0,a.h)(t.id,i);if(r){await (null==_?void 0:_.get("activity").createActivity({type:u.T.CREDENTIALS_SHARED,credentialsCount:e.length,appDid:k})),P.caller&&await s.applications().recordRequestedCredentials(P.caller,e);let n=(0,x.Q)(t.redirectUrl,"rid",t.id);window.location.href=n}};return(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsxs)("div",{children:[(0,i.jsx)(v.O,{applicationDID:k,className:"mb-4"}),(0,i.jsxs)("div",{className:"text-center mb-4",children:["This application is requesting to access some of your information.",(0,i.jsx)("tr",{}),"Please review profile entries you want to share:"]}),(0,i.jsx)(ClaimDisplayEntryListWidget,{claimDisplayEntryList:O}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)(c.c,{className:"w-1/2",onClick:()=>{let e=(0,x.Q)(t.redirectUrl,"rid",t.id);window.location.href=e},children:"Cancel"}),(0,i.jsx)(c.c,{className:"w-1/2",onClick:approveRequest,busy:y,children:"Approve"})]})]}),!_&&"Please sign in or sign up to continue",_&&!s&&"Please make an identity active to continue"]})};var A=n(63491),page=()=>{let e=(0,r.useSearchParams)(),t=e.get("rid"),[n,c]=(0,l.useState)(!0),[o,u]=(0,l.useState)(null),[f]=(0,d.V)(h.jU),[p]=(0,d.V)(m.Bx);return(0,l.useEffect)(()=>{t&&(0,a.S)(t).then(e=>{c(!1),u(e)})},[t]),(0,l.useEffect)(()=>{f&&p?(0,A.Ad)():(0,A.qC)(window.location.href)},[f,p]),(0,i.jsxs)("div",{className:"col-span-full",children:[n&&(0,i.jsx)(s.O,{className:"mb-6"}),!n&&o&&(0,i.jsx)(RequestDetails,{intent:o}),!n&&!o&&(0,i.jsx)("div",{children:"No matching request"})]})}},96283:function(e,t,n){"use strict";n.d(t,{J:function(){return CredentialAvatar}});var i=n(57437),a=n(40542),r=n(3283),l=n(57042),s=n(16691),c=n.n(s);let CredentialAvatar=e=>{let{credential:t,width:n=60,height:s=60,className:o}=e,[d]=(0,a.V)(null==t?void 0:t.representativeIcon$);return(0,i.jsx)(r.Z,{sx:{width:n,height:s,padding:"string"==typeof d?0:"".concat(.125*Math.floor(n/8),"rem"),backgroundColor:"#7575754d"},className:(0,l.Z)(o),children:"string"==typeof d?(0,i.jsx)(c(),{src:d,alt:"",width:n,height:s}):d})}},42464:function(e,t,n){"use strict";n.d(t,{h:function(){return JsonViewer}});var i=n(57437);function JsonViewer(e){let{data:t}=e,renderJson=e=>{if("object"!=typeof e||null===e)return(0,i.jsx)("span",{className:"json-value",children:String(e)});if(Array.isArray(e))return(0,i.jsx)("div",{className:"json-array",children:e.map((e,t)=>(0,i.jsx)("div",{children:renderJson(e)},t))});{let t=Object.keys(e);return(0,i.jsx)("div",{className:"json-object",children:t.map(t=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"json-key",children:[t,"："]})," ",renderJson(e[t])]},t))})}};return(0,i.jsxs)("div",{className:"json-viewer truncate",style:{textAlign:"left"},children:[renderJson(t),(0,i.jsx)("style",{children:"\n          .json-viewer {\n            font-family: Arial, sans-serif;\n          }\n          .json-object, .json-array {\n            list-style: none;\n            padding-left: 20px;\n          }\n          .json-key {\n            font-weight: bold;\n          }\n        "})]})}n(2265)},9254:function(e,t,n){"use strict";n.d(t,{c:function(){return MainButton}});var i=n(57437),a=n(6882),r=n(49050),l=n(57042);let MainButton=e=>{let{leftIcon:t,size:n="medium",mode:s="default",onClick:c,children:o,busy:d=!1,disabled:u=!1,className:f}=e,m=(0,i.jsx)(a.Z,{size:16});return(0,i.jsx)("div",{className:(0,l.Z)("flex",f),children:(0,i.jsx)(r.Z,{className:"flex-1",startIcon:d?m:t,disabled:d||u,size:n,color:"default"===s?"primary":"error",variant:"contained",onClick:c,children:o})})}},4528:function(e,t,n){"use strict";n.d(t,{a:function(){return LoadingCircle_LoadingCircle}});var i=n(57437),a=n(57042);let LoadingCircle_LoadingCircle=e=>{let{className:t,width:n,height:r}=e;return(0,i.jsx)("div",{className:(0,a.Z)("loading-circle",t),style:{...n&&{width:n},...r&&{height:r}},children:(0,i.jsx)("div",{className:"content",children:(0,i.jsx)("div",{className:"animated"})})})}},40542:function(e,t,n){"use strict";n.d(t,{V:function(){return useBehaviorSubject}});var i=n(2265);let useBehaviorSubject=e=>{let[t,n]=(0,i.useState)(null==e?void 0:e.getValue()),[a,r]=(0,i.useState)();return(0,i.useEffect)(()=>{if(!e){n(null);return}let t=e.subscribe({next:e=>{n(e)},error:r});return()=>t.unsubscribe()},[e]),[t]}},69147:function(e,t,n){"use strict";var i,a;n.d(t,{T:function(){return i}}),(a=i||(i={})).NEW_ACCOUNT="NEW_ACCOUNT",a.USER_SIGN_IN="USER_SIGN_IN",a.IDENTITY_CREATED="IDENTITY_CREATED",a.IDENTITY_DELETED="IDENTITY_DELETED",a.CREDENTIALS_IMPORTED="CREDENTIALS_IMPORTED",a.CREDENTIALS_SHARED="CREDENTIALS_SHARED",a.BIND_EMAIL="BIND_EMAIL",a.BIND_BROWSER="BIND_BROWSER",a.PASSWORD_CHANGED="PASSWORD_CHANGED"},63491:function(e,t,n){"use strict";n.d(t,{$Y:function(){return setOnGoingFlowOperation},Ad:function(){return clearPostSignInUrl},Kt:function(){return getOnGoingFlowOperation},cX:function(){return a},fK:function(){return clearOnGoingFlowOperation},qC:function(){return setPostSignInUrl},vX:function(){return usePostSignInFlow}});var i,a,r=n(92e3),l=n(36079);(i=a||(a={}))[i.OnBoardingEmailBinding=0]="OnBoardingEmailBinding",i[i.OnBoardingBrowserBinding=1]="OnBoardingBrowserBinding",i[i.EmailSignIn=2]="EmailSignIn";let s="ongoingflowoperation",c="postsigninurl";function getOnGoingFlowOperation(){return a[localStorage.getItem(s)]}function setOnGoingFlowOperation(e){localStorage.setItem(s,a[e])}function clearOnGoingFlowOperation(){localStorage.removeItem(s)}function setPostSignInUrl(e){l.k.log("flow","Setting post sign in url to:",e),localStorage.setItem(c,e)}function clearPostSignInUrl(){l.k.log("flow","Clearing post sign in url"),localStorage.removeItem(c)}function usePostSignInFlow(){let e=(0,r.useRouter)();return{navigateToPostSignInLandingPage(t){let n=localStorage.getItem(c);if(n)l.k.log("flow","Navigating to post sign in landing page:",n),e.replace(n),clearPostSignInUrl();else{let n=t||"/dashboard";l.k.log("flow","Navigating to post sign in landing page ".concat(n)),e.push(n)}}}}},61568:function(e,t,n){"use strict";n.d(t,{S:function(){return fetchIntent},h:function(){return fulfilIntentRequest}});var i=n(60230),a=n(23965);let Intent=class Intent{static async fromJson(e){let t=new Intent;return Object.assign(t,e),t.createdAt=new Date(e.createdAt),t}};var r=n(29748),l=n(91395),s=n(36079);function _templateObject(){let e=(0,i._)(["\n      query GetIntentRequest($intentId: String!) {\n        intent (id: $intentId) {\n          ","\n        }\n      }\n    "]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,i._)(["\n      mutation FulfilIntentRequest($input: FulfilIntentInput!) {\n        fulfilIntent (input: $input)\n      }\n    "]);return _templateObject1=function(){return e},e}async function fetchIntent(e){var t;let n=await (0,r.Pt)(async()=>(await (0,l.W)()).query({query:(0,a.Ps)(_templateObject(),"\n  id\n  createdAt\n  type\n  redirectUrl\n  requestPayload\n  responsePayload\n"),variables:{intentId:e}}));if(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.intent){let e=await Intent.fromJson(n.data.intent);return s.k.log("intents","Fetched intent:",e),e}return s.k.warn("intents","No intent found for id ".concat(e)),null}async function fulfilIntentRequest(e,t){var n;let i=await (0,r.Pt)(async()=>(await (0,l.W)()).mutate({mutation:(0,a.Ps)(_templateObject1()),variables:{input:{intentId:e,payload:t}}}));return(null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.fulfilIntent)?(s.k.log("intents","Successfully fulfilled intent id ".concat(e)),!0):(s.k.warn("intents","Failed to fulfil intent id ".concat(e)),!1)}},43639:function(e,t,n){"use strict";function setQueryParameter(e,t,n){let i=new URL(e),a=new URLSearchParams(i.search);return a.set(t,n),i.search=a.toString(),i.toString()}n.d(t,{Q:function(){return setQueryParameter}})}},function(e){e.O(0,[6990,9787,9443,8218,3988,395,8321,3824,6642,1228,5295,1510,1396,2e3,7998,8874,2597,4759,3262,2971,7864,1744],function(){return e(e.s=66798)}),_N_E=e.O()}]);