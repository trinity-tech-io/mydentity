(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1456],{66798:function(e,t,n){Promise.resolve().then(n.bind(n,71033))},77814:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});var i=n(57437),l=n(40471),r=n(57042);let a=e=>{let{className:t}=e;return(0,i.jsxs)("div",{className:(0,r.Z)("flex flex-col w-full",t),children:[(0,i.jsx)("div",{className:"italic",children:"Preparing request, hold on..."}),(0,i.jsx)(l.Z,{})]})}},26188:function(e,t,n){"use strict";n.d(t,{O:function(){return m}});var i=n(57437),l=n(46028),r=n(13457),a=n(3283),s=n(43226),c=n(78596),o=n(57042),u=n(16691),d=n.n(u),f=n(2265);let m=e=>{let{applicationDID:t,className:n}=e,[u,m]=(0,f.useState)(null),[h,x]=(0,f.useState)(null),[g,p]=(0,f.useState)(!1),v=async()=>{if(t){let e=await c._.resolveDIDDocument(t);p(!0),e?(m(await e.getRepresentativeIcon()),x(await e.getRepresentativeOwnerName())):(m(null),x(null))}};return((0,f.useEffect)(()=>{v()},[t]),g&&t)?(0,i.jsxs)("div",{className:(0,o.Z)("flex flex-col items-center",n),children:[(0,i.jsx)(r.Z,{direction:"row",justifyContent:"center",children:(0,i.jsx)(a.Z,{sx:{width:120,height:120},children:u&&(0,i.jsx)(d(),{src:u,alt:"",width:120,height:120})})}),(0,i.jsx)(s.Z,{mt:1,fontWeight:600,children:h})]}):(0,i.jsx)("div",{className:"flex items-center justify-center",children:(0,i.jsx)(l.a,{width:120,height:120})})}},71033:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var i=n(57437),l=n(61568),r=n(24033),a=n(2265),s=n(77814),c=n(9254),o=n(11920),u=n(40542),d=n(69147),f=n(61459),m=n(57958),h=n(57389),x=n(36079),g=n(14776),p=n(43639),v=n(26188),j=n(96507),y=n(54986),w=n(35266),N=n(96283),S=n(57025),D=n(72502),I=n(27760);let E=e=>{let{claimDisplayEntry:t,credentialDisplayEntry:n,updateSummary:l}=e,[r,s]=(0,a.useState)(!1);(0,a.useEffect)(()=>{n&&s(n.selected)},[n]);let c=(e,t)=>{let n=t.selected;if(x.k.log("RequestCredentialsIntent","onCredentialSelection",e,t),n)1===e.claimDescription.min&&1===e.claimDescription.max||(t.selected=!1);else{if(1===e.claimDescription.min&&1===e.claimDescription.max){let t=o(e);t&&(t.selected=!1)}t.selected=!0}s(t.selected),l()},o=e=>e.matchingCredentials.find(e=>e.selected);return(0,i.jsx)("div",{className:"flex flex-row mt-4 gap-6",children:(0,i.jsxs)(D.Z,{onClick:()=>c(t,n),style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("div",{style:{marginRight:10},children:(0,i.jsx)(N.J,{credential:n.credential,width:60,height:60})}),(0,i.jsx)(S.Z,{credential:n.credential}),(0,i.jsx)(I.Z,{checked:r})]})})},b=e=>{let{claimDisplayEntry:t}=e,[n,l]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&c()},[t]);let r=e=>{let t=s(e);return e.claimDescription.min===e.claimDescription.max?"".concat(t," / ").concat(e.claimDescription.min):0===e.claimDescription.min?"".concat(t," / max ").concat(e.claimDescription.max):"".concat(t," / min ").concat(e.claimDescription.min,", max ").concat(e.claimDescription.max)},s=e=>e.matchingCredentials.reduce((e,t)=>t.selected?e+1:e,0),c=()=>{let e=r(t);l(e)};return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("div",{className:"flex flex-row p-4",children:[(0,i.jsxs)("div",{className:"flex flex-row p-1",children:[" ",t.claimDescription.reason," "]}),(0,i.jsx)("div",{className:"absolute right-1 p-1",children:n})]}),t.matchingCredentials&&(0,i.jsx)(w.Z,{component:"nav","aria-label":"main mailbox folders",children:t.matchingCredentials.map(e=>(0,i.jsxs)("div",{children:[(0,i.jsx)(E,{credentialDisplayEntry:e,claimDisplayEntry:t,updateSummary:c}),(0,i.jsx)(y.Z,{})]},e.credential.id))})]},t.claimDescription.reason)})},C=e=>{let{claimDisplayEntryList:t}=e;return(0,i.jsxs)("div",{className:"col-span-full p-2 xl:col-span-5 bg-white dark:bg-slate-800 shadow-lg rounded-sm border border-slate-200 dark:border-slate-700",children:["List of credentials",(0,i.jsx)(y.Z,{}),(0,i.jsx)(j.Z,{sx:{width:"100%",bgcolor:"background.paper"},children:t&&(0,i.jsx)(w.Z,{component:"nav","aria-label":"main mailbox folders",children:t.map(e=>(0,i.jsx)("div",{className:"flex flex-col flex-1",children:(0,i.jsx)(b,{claimDisplayEntry:e})},e.claimDescription.reason))})})]})},R=e=>{let{intent:t}=e,r="RequestCredentialsIntent",[s]=(0,u.V)(m.Bx),[j]=(0,u.V)(null==s?void 0:s.credentials().credentials$),[y,w]=(0,a.useState)(!1),[N,S]=(0,a.useState)(!1),[D,I]=(0,a.useState)(""),[E,b]=(0,a.useState)("Demo App"),[R,A]=(0,a.useState)(!1),[k,_]=(0,a.useState)(null),[Z]=(0,u.V)(g.jU),O=t.requestPayload,T=t.requestPayload.caller;x.k.log(r,"payload",O),(0,a.useEffect)(()=>{P(),j&&O&&(q(O),V(O).then(e=>{_(e)}))},[j,O]);let P=()=>{S(!1)},q=async e=>{let t=e.caller;if(t){let e=await h.n.isPublished(t);if(e){let e=await h.n.getIssuerName(t);x.k.log(r,"Requesting App name:",e),b(e);let n=await h.n.getIssuerAvatar(t);I(n)}else x.k.warn(r,"Requesting App is not published.")}},B=e=>{let t=JSON.parse(JSON.stringify(e.claims)),n=L(e);return n&&(t=n),t.forEach(e=>(void 0===e.min&&(e.min=1),void 0===e.max&&(e.max=1),e)),t},L=e=>{if("_version"in e)return null;{let t=[],n=e.claims;for(let e of n){let n=o.DID.claimDescription(e.reason).withMin(e.min).withMax(e.max).withNoMatchRecommendations(e.noMatchRecommendations).withClaim(new o.DID.Claim().withQuery(e.query).withIssuers(e.issuers));t.push(n)}return t}},V=async e=>{let t=[],i=B(e);for(let e of i){x.k.log(r,"Organizing claim",e);let i=[];for(let e of j){let t=JSON.parse(await e.verifiableCredential.toString());await U(e.verifiableCredential,t),i.push(t)}let l=[],a=[];for(let t of e.claims){try{let e=await n.e(9733).then(n.t.bind(n,73820,23));l=l.concat(e.query(i,t.query)),x.k.log(r,"Matching credentials (json)",l)}catch(e){x.k.warn(r,"JSON Path exception",e)}a=a.concat(l.map(e=>{let n=j.find(t=>t.verifiableCredential.getId().toString()===e.id);if(t.issuers){let e=t.issuers.find(e=>e===n.verifiableCredential.getIssuer().toString());if(!e)return null}return{credential:n,selected:!1,expired:!1}}).filter(e=>null!==e))}1==e.min&&e.max===e.min&&1===a.length&&(a[0].selected=!0);let s={claimDescription:e,matchingCredentials:a};t.push(s)}return A(!0),x.k.log(r,"Organized claims",t),t},U=async(e,t)=>{let n=await f.N.resolveTypesWithContexts(e);for(let e of n){let n="".concat(e.context,"#").concat(e.shortType),i=t.type;0>i.indexOf(n)&&i.push(n)}},W=()=>{let e=[];for(let t of k)for(let n of t.matchingCredentials)n.selected&&e.push(n.credential);return x.k.log(r,"Deliverable credentials:",e),e},M=async()=>{w(!0);let e=W(),n=await s.createVerifiablePresentation(e.map(e=>e.verifiableCredential),O.realm,O.nonce);if(!n){w(!1);return}let i=n.toString(!0),r=await (0,l.h)(t.id,i);if(r){await (null==Z?void 0:Z.get("activity").createActivity({type:d.T.CREDENTIALS_SHARED,credentialsCount:e.length,appDid:T})),O.caller&&await s.applications().recordRequestedCredentials(O.caller,e);let n=(0,p.Q)(t.redirectUrl,"rid",t.id);window.location.href=n}};return(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsxs)("div",{children:[(0,i.jsx)(v.O,{applicationDID:T,className:"mb-4"}),(0,i.jsxs)("div",{className:"text-center mb-4",children:["This application is requesting to access some of your information.",(0,i.jsx)("tr",{}),"Please review profile entries you want to share:"]}),(0,i.jsx)(C,{claimDisplayEntryList:k}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)(c.c,{className:"w-1/2",onClick:()=>{let e=(0,p.Q)(t.redirectUrl,"rid",t.id);window.location.href=e},children:"Cancel"}),(0,i.jsx)(c.c,{className:"w-1/2",onClick:M,busy:y,children:"Approve"})]})]}),!Z&&"Please sign in or sign up to continue",Z&&!s&&"Please make an identity active to continue"]})};var A=n(63491),k=()=>{let e=(0,r.useSearchParams)(),t=e.get("rid"),[n,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null),[f]=(0,u.V)(g.jU),[h]=(0,u.V)(m.Bx);return(0,a.useEffect)(()=>{t&&(0,l.S)(t).then(e=>{c(!1),d(e)})},[t]),(0,a.useEffect)(()=>{f&&h?(0,A.Ad)():(0,A.qC)(window.location.href)},[f,h]),(0,i.jsxs)("div",{className:"col-span-full",children:[n&&(0,i.jsx)(s.O,{className:"mb-6"}),!n&&o&&(0,i.jsx)(R,{intent:o}),!n&&!o&&(0,i.jsx)("div",{children:"No matching request"})]})}},96283:function(e,t,n){"use strict";n.d(t,{J:function(){return o}});var i=n(57437),l=n(40542),r=n(3283),a=n(57042),s=n(16691),c=n.n(s);let o=e=>{let{credential:t,width:n=60,height:s=60,className:o}=e,[u]=(0,l.V)(null==t?void 0:t.representativeIcon$);return(0,i.jsx)(r.Z,{sx:{width:n,height:s},className:(0,a.Z)(o),children:"string"==typeof u?(0,i.jsx)(c(),{src:u,alt:"",width:n,height:s}):u})}},57025:function(e,t,n){"use strict";var i=n(57437),l=n(40542),r=n(96507),a=n(43226),s=n(28874),c=n(72502),o=n(8864),u=n(16691),d=n.n(u),f=n(42464);t.Z=function(e){let{credential:t}=e,[n]=(0,l.V)(null==t?void 0:t.issuerInfo$);return(0,i.jsxs)(r.Z,{sx:{textAlign:"left",width:"100%"},children:[(0,i.jsx)(a.Z,{gutterBottom:!0,variant:"h6",children:t.getDisplayableTitle()}),(0,i.jsx)(a.Z,{variant:"body1",sx:{color:"text.secondary"},children:t.getDisplayValue()&&(0,i.jsx)(f.h,{data:t.getDisplayValue()})}),(0,i.jsxs)(s.ZP,{container:!0,spacing:2,sx:{mt:1},children:[t.isSensitiveCredential()&&(0,i.jsx)(a.Z,{fontSize:14,color:"#FF6347",children:"Sensitive"}),!t.isSelfIssued()&&(null==n?void 0:n.isPublished)&&(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(d(),{unoptimized:!0,src:null==n?void 0:n.avatarIcon,width:30,height:30,style:{borderRadius:"50%"},alt:""})}),(0,i.jsxs)(a.Z,{variant:"body1",sx:{color:"text.secondary"},children:["Created by ",null==n?void 0:n.name]})]})]})]})}},42464:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});var i=n(57437);function l(e){let{data:t}=e,n=e=>{if("object"!=typeof e||null===e)return(0,i.jsx)("span",{className:"json-value",children:String(e)});if(Array.isArray(e))return(0,i.jsx)("div",{className:"json-array",children:e.map((e,t)=>(0,i.jsx)("div",{children:n(e)},t))});{let t=Object.keys(e);return(0,i.jsx)("div",{className:"json-object",children:t.map(t=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"json-key",children:[t,"ï¼š"]})," ",n(e[t])]},t))})}};return(0,i.jsxs)("div",{className:"json-viewer",style:{textAlign:"left"},children:[n(t),(0,i.jsx)("style",{children:"\n          .json-viewer {\n            font-family: Arial, sans-serif;\n          }\n          .json-object, .json-array {\n            list-style: none;\n            padding-left: 20px;\n          }\n          .json-key {\n            font-weight: bold;\n            color: #0074d9;\n          }\n          .json-value {\n            color: #333;\n          }\n        "})]})}n(2265)},9254:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var i=n(57437),l=n(6882),r=n(49050),a=n(57042);let s=e=>{let{leftIcon:t,size:n="medium",mode:s="default",onClick:c,children:o,busy:u=!1,disabled:d=!1,className:f}=e,m=(0,i.jsx)(l.Z,{size:16});return(0,i.jsx)("div",{className:(0,a.Z)("flex",f),children:(0,i.jsx)(r.Z,{className:"flex-1",startIcon:u?m:t,disabled:u||d,size:n,color:"default"===s?"primary":"error",variant:"contained",onClick:c,children:o})})}},46028:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var i=n(57437),l=n(57042);n(87661);let r=e=>{let{className:t,width:n,height:r}=e;return(0,i.jsx)("div",{className:(0,l.Z)("loading-circle",t),style:{...n&&{width:n},...r&&{height:r}},children:(0,i.jsx)("div",{className:"content",children:(0,i.jsx)("div",{className:"animated"})})})}},40542:function(e,t,n){"use strict";n.d(t,{V:function(){return l}});var i=n(2265);let l=e=>{let[t,n]=(0,i.useState)(null==e?void 0:e.getValue()),[l,r]=(0,i.useState)();return(0,i.useEffect)(()=>{if(!e){n(null);return}let t=e.subscribe({next:e=>{n(e)},error:r});return()=>t.unsubscribe()},[e]),[t]}},69147:function(e,t,n){"use strict";var i,l;n.d(t,{T:function(){return i}}),(l=i||(i={})).NEW_ACCOUNT="NEW_ACCOUNT",l.USER_SIGN_IN="USER_SIGN_IN",l.IDENTITY_CREATED="IDENTITY_CREATED",l.IDENTITY_DELETED="IDENTITY_DELETED",l.CREDENTIALS_IMPORTED="CREDENTIALS_IMPORTED",l.CREDENTIALS_SHARED="CREDENTIALS_SHARED",l.BIND_EMAIL="BIND_EMAIL",l.BIND_BROWSER="BIND_BROWSER",l.PASSWORD_CHANGED="PASSWORD_CHANGED"},63491:function(e,t,n){"use strict";n.d(t,{$Y:function(){return u},Ad:function(){return m},Kt:function(){return o},cX:function(){return l},fK:function(){return d},qC:function(){return f},vX:function(){return h}});var i,l,r=n(92e3),a=n(36079);(i=l||(l={}))[i.OnBoardingEmailBinding=0]="OnBoardingEmailBinding",i[i.OnBoardingBrowserBinding=1]="OnBoardingBrowserBinding",i[i.EmailSignIn=2]="EmailSignIn";let s="ongoingflowoperation",c="postsigninurl";function o(){return l[localStorage.getItem(s)]}function u(e){localStorage.setItem(s,l[e])}function d(){localStorage.removeItem(s)}function f(e){a.k.log("flow","Setting post sign in url to:",e),localStorage.setItem(c,e)}function m(){a.k.log("flow","Clearing post sign in url"),localStorage.removeItem(c)}function h(){let e=(0,r.useRouter)();return{navigateToPostSignInLandingPage(t){let n=localStorage.getItem(c);if(n)a.k.log("flow","Navigating to post sign in landing page:",n),e.replace(n),m();else{let n=t||"/dashboard";a.k.log("flow","Navigating to post sign in landing page ".concat(n)),e.replace(n)}}}}},61568:function(e,t,n){"use strict";n.d(t,{S:function(){return d},h:function(){return f}});var i=n(60230),l=n(23965);class r{static async fromJson(e){let t=new r;return Object.assign(t,e),t.createdAt=new Date(e.createdAt),t}}var a=n(29748),s=n(91395),c=n(36079);function o(){let e=(0,i._)(["\n      query GetIntentRequest($intentId: String!) {\n        intent (id: $intentId) {\n          ","\n        }\n      }\n    "]);return o=function(){return e},e}function u(){let e=(0,i._)(["\n      mutation FulfilIntentRequest($input: FulfilIntentInput!) {\n        fulfilIntent (input: $input)\n      }\n    "]);return u=function(){return e},e}async function d(e){var t;let n=await (0,a.Pt)(async()=>(await (0,s.W)()).query({query:(0,l.Ps)(o(),"\n  id\n  createdAt\n  type\n  redirectUrl\n  requestPayload\n  responsePayload\n"),variables:{intentId:e}}));if(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.intent){let e=await r.fromJson(n.data.intent);return c.k.log("intents","Fetched intent:",e),e}return c.k.warn("intents","No intent found for id ".concat(e)),null}async function f(e,t){var n;let i=await (0,a.Pt)(async()=>(await (0,s.W)()).mutate({mutation:(0,l.Ps)(u()),variables:{input:{intentId:e,payload:t}}}));return(null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.fulfilIntent)?(c.k.log("intents","Successfully fulfilled intent id ".concat(e)),!0):(c.k.warn("intents","Failed to fulfil intent id ".concat(e)),!1)}},43639:function(e,t,n){"use strict";function i(e,t,n){let i=new URL(e),l=new URLSearchParams(i.search);return l.set(t,n),i.search=l.toString(),i.toString()}n.d(t,{Q:function(){return i}})},87661:function(){}},function(e){e.O(0,[6990,9787,9443,8218,3988,395,8321,9152,5295,1396,1510,2e3,7998,3510,8415,3262,2971,7864,1744],function(){return e(e.s=66798)}),_N_E=e.O()}]);