(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2919],{5254:function(n,t,e){Promise.resolve().then(e.bind(e,76414))},76414:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return page}});var o=e(57437),i=e(4778),a=e(73052),l=e(40471),r=e(63491),u=e(60230),g=e(36079),s=e(29748),c=e(91395),f=e(23965),d=e(11059);function _templateObject(){let n=(0,u._)(["\n        mutation OauthGoogleSignIn($input: GoogleSignInInput!) {\n          oauthGoogleSignIn(input: $input) { accessToken refreshToken }\n        }\n      "]);return _templateObject=function(){return n},n}function _templateObject1(){let n=(0,u._)(["\n        mutation OauthGoogleBindEmail($input: GoogleBindEmailInput!) {\n          oauthGoogleBindEmail(input: $input)\n        }\n      "]);return _templateObject1=function(){return n},n}async function oauthGoogleSignIn(n){g.k.log("user","oauth Google sign in.");let t={code:n},e=await (0,s.Pt)(async()=>(await (0,c.W)()).mutate({mutation:(0,f.Ps)(_templateObject()),variables:{input:t}}));if(null==e||!e.data||!e.data.oauthGoogleSignIn)return g.k.error("user","failed to oauth Google sign in."),null;{let{accessToken:n,refreshToken:t}=e.data.oauthGoogleSignIn;return(0,d.vz)(n,t)}}async function oauthGoogleBindEmail(n){g.k.log("user","oauth Google bind email.");let t={code:n},e=await (0,s.Pt)(async()=>(await (0,c.W)()).mutate({mutation:(0,f.Ps)(_templateObject1()),variables:{input:t}}));return(null==e?void 0:e.data)&&e.data.oauthGoogleBindEmail?(g.k.log("user","Oauth Google email bound successfully"),!0):(g.k.error("user","failed to oauth Google bind email."),!1)}var h=e(24033),p=e(2265),page=()=>{let n=(0,h.useRouter)(),t=(0,h.useSearchParams)(),e=t.get("code"),{navigateToPostSignInLandingPage:u}=(0,r.vX)(),g=!1;return(0,p.useEffect)(()=>{if(g)return;if(g=!0,!e){alert("GoogleRedirect: No code from Google authentication callback.");return}let t=(0,r.Kt)();switch(t){case r.cX.OnBoardingEmailBinding:oauthGoogleBindEmail(e).then(t=>{t?n.push("/account/security"):((0,r.fK)(),n.push("/account/security?error=unknown"))}).catch(t=>{t&&t instanceof i.E?((0,r.fK)(),n.push("/account/security?error=emailExists")):((0,r.fK)(),n.push("/account/security?error=unknown"))});break;case r.cX.EmailSignIn:oauthGoogleSignIn(e).then(t=>{t?((0,r.fK)(),u()):((0,r.fK)(),n.push("/signin?error=unknownGoogle"))}).catch(t=>{t instanceof a.h&&((0,r.fK)(),n.push("/signin?error=oauthGoogleEmailNotExists"))});break;default:alert("Invalid operation, please try again.");return}},[e,n]),(0,o.jsx)("div",{className:"col-span-full",children:(0,o.jsxs)("div",{className:"flex flex-col w-full",children:[(0,o.jsx)("div",{className:"italic",children:"Checking authentication, hold on..."}),(0,o.jsx)(l.Z,{})]})})}},63491:function(n,t,e){"use strict";e.d(t,{$Y:function(){return setOnGoingFlowOperation},Ad:function(){return clearPostSignInUrl},Kt:function(){return getOnGoingFlowOperation},cX:function(){return i},fK:function(){return clearOnGoingFlowOperation},qC:function(){return setPostSignInUrl},vX:function(){return usePostSignInFlow}});var o,i,a=e(92e3),l=e(36079);(o=i||(i={}))[o.OnBoardingEmailBinding=0]="OnBoardingEmailBinding",o[o.OnBoardingBrowserBinding=1]="OnBoardingBrowserBinding",o[o.EmailSignIn=2]="EmailSignIn";let r="ongoingflowoperation",u="postsigninurl";function getOnGoingFlowOperation(){return i[localStorage.getItem(r)]}function setOnGoingFlowOperation(n){localStorage.setItem(r,i[n])}function clearOnGoingFlowOperation(){localStorage.removeItem(r)}function setPostSignInUrl(n){l.k.log("flow","Setting post sign in url to:",n),localStorage.setItem(u,n)}function clearPostSignInUrl(){l.k.log("flow","Clearing post sign in url"),localStorage.removeItem(u)}function usePostSignInFlow(){let n=(0,a.useRouter)();return{navigateToPostSignInLandingPage(t){let e=localStorage.getItem(u);if(e)l.k.log("flow","Navigating to post sign in landing page:",e),n.replace(e),clearPostSignInUrl();else{let e=t||"/dashboard";l.k.log("flow","Navigating to post sign in landing page ".concat(e)),n.push(e)}}}}}},function(n){n.O(0,[6990,9787,9443,8218,3988,395,8321,3824,6642,1396,2e3,471,3262,2971,7864,1744],function(){return n(n.s=5254)}),_N_E=n.O()}]);