(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1456],{26371:function(e,t,n){"use strict";var i,r=n(90952);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}t.Z=function(e){return r.createElement("svg",_extends({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16"},e),i||(i=r.createElement("path",{fill:"currentColor",d:"M8 0h10c1.11 0 2 .89 2 2v2h-3.41L14 6.59v4l-2 2V16H8v-3.41l-2-2V5.41l2-2V0Zm8 7.41V10h4V6h-2.59L16 7.41ZM4.59 4 6 2.59V0H2C.89 0 0 .89 0 2v2h4.59ZM4 10V6H0v4h4Zm2 3.41L4.59 12H0v2c0 1.11.89 2 2 2h4v-2.59ZM15.41 12 14 13.41V16h4c1.11 0 2-.89 2-2v-2h-4.59Z"})))}},22017:function(e,t,n){Promise.resolve().then(n.bind(n,98072))},77814:function(e,t,n){"use strict";n.d(t,{O:function(){return PreparingRequest}});var i=n(57437),r=n(40471),a=n(57042);let PreparingRequest=e=>{let{className:t}=e;return(0,i.jsxs)("div",{className:(0,a.Z)("flex flex-col w-full",t),children:[(0,i.jsx)("div",{className:"italic",children:"Preparing request, hold on..."}),(0,i.jsx)(r.Z,{})]})}},26188:function(e,t,n){"use strict";n.d(t,{O:function(){return RequestingApp}});var i=n(57437),r=n(2265),a=n(50724),l=n(16691),s=n.n(l),c=n(13457),o=n(3283),d=n(96507),u=n(43226),h=n(29061),m=n(23446),p=n(78596);let RequestingApp=e=>{let{applicationDID:t,className:n}=e,[l,f]=(0,r.useState)(null),[g,x]=(0,r.useState)(null),[j,v]=(0,r.useState)(!1),updateApplicationData=async()=>{if(t){let e=await p._.resolveDIDDocument(t);v(!0),e?(f(await e.getRepresentativeIcon()),x(await e.getRepresentativeOwnerName())):(f(null),x(null))}};return(0,r.useEffect)(()=>{updateApplicationData()},[t]),j&&t?(0,i.jsxs)(c.Z,{className:n,justifyContent:"center",alignItems:"center",spacing:1.5,children:[(0,i.jsxs)(c.Z,{justifyContent:"center",alignItems:"center",spacing:.5,children:[l?(0,i.jsx)(o.Z,{sx:{width:88,height:88},children:(0,i.jsx)(s(),{src:l,alt:"",width:120,height:120})}):(0,i.jsx)(m.Z,{children:(0,i.jsx)(a.Z,{width:88,height:88,circle:!0,containerClassName:"leading-none"})}),(0,i.jsx)("div",{children:(0,i.jsx)(d.Z,{className:"rounded-[4px] text-[8px] px-2.5 py-1 inline-block text-white whitespace-nowrap bg-[#9291A5]",children:"APPLICATION"})})]}),(0,i.jsx)(u.Z,{variant:"h4",children:g})]}):(0,i.jsx)(h.xG,{})}},98072:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return page}});var i=n(57437),r=n(61568),a=n(24033),l=n(2265),s=n(77814),c=n(11920),o=n(40542),d=n(69147),u=n(61459),h=n(57958),m=n(57389),p=n(36079),f=n(14776),g=n(43639),x=n(26188),j=n(30666),v=n(51469),y=n(96283),w=n(96507),C=n(43226),S=n(42464),credential_CredentialBasicInfo=function(e){let{credential:t}=e;return(0,i.jsxs)(w.Z,{children:[(0,i.jsx)(C.Z,{variant:"body1",fontWeight:600,lineHeight:1.2,children:t.getDisplayableTitle()}),(0,i.jsx)(C.Z,{component:"span",variant:"body2",color:"text.secondary",lineHeight:1.2,children:t.getDisplayValue()&&(0,i.jsx)(S.h,{data:t.getDisplayValue()})})]})},I=n(19959);let CredentialDisplayEntryWidget=e=>{let{claimDisplayEntry:t,credentialDisplayEntry:n,updateSummary:r}=e,[a,s]=(0,l.useState)(!1);(0,l.useEffect)(()=>{n&&s(n.selected)},[n]);let onCredentialSelection=(e,t)=>{let n=t.selected;if(p.k.log("RequestCredentialsIntent","onCredentialSelection",e,t),n)1===e.claimDescription.min&&1===e.claimDescription.max||(t.selected=!1);else{if(1===e.claimDescription.min&&1===e.claimDescription.max){let t=getFirstSelectedCredentialInClaim(e);t&&(t.selected=!1)}t.selected=!0}s(t.selected),r()},getFirstSelectedCredentialInClaim=e=>e.matchingCredentials.find(e=>e.selected);return(0,i.jsx)(I.m,{props:{hover:!0},onClick:()=>onCredentialSelection(t,n),className:"h-[3rem] cursor-pointer",avatar:(0,i.jsx)(y.J,{credential:n.credential,width:36,height:36}),rowCells:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Z,{children:(0,i.jsx)(credential_CredentialBasicInfo,{credential:n.credential})}),(0,i.jsx)(j.Z,{align:"center",children:(0,i.jsx)(v.Z,{checked:a,sx:{"&.Mui-checked":{color:"#9D3E3E"}}})})]})})};var D=n(98489);let ClaimDisplayEntryWidget=e=>{let{claimDisplayEntry:t}=e,[n,r]=(0,l.useState)("");(0,l.useEffect)(()=>{t&&updateSummary()},[t]);let claimSelectionSummary=e=>{let t=numberOfSelectedCredentialsInClaim(e);return e.claimDescription.min===e.claimDescription.max?"".concat(t," / ").concat(e.claimDescription.min):0===e.claimDescription.min?"".concat(t," / max ").concat(e.claimDescription.max):"".concat(t," / min ").concat(e.claimDescription.min,", max ").concat(e.claimDescription.max)},numberOfSelectedCredentialsInClaim=e=>e.matchingCredentials.reduce((e,t)=>t.selected?e+1:e,0),updateSummary=()=>{let e=claimSelectionSummary(t);r(e)};return(0,i.jsx)(I.J,{headCells:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Z,{children:"CREDENTIALS"}),(0,i.jsxs)(j.Z,{children:["SELECTED ",n]})]}),bodyRows:t&&t.matchingCredentials&&t.matchingCredentials.length>0?t.matchingCredentials.map(e=>(0,i.jsx)(CredentialDisplayEntryWidget,{credentialDisplayEntry:e,claimDisplayEntry:t,updateSummary:updateSummary},e.credential.id)):(0,i.jsx)(D.Z,{children:(0,i.jsx)(j.Z,{component:"th",colSpan:6,align:"center",children:(0,i.jsx)(C.Z,{variant:"body1",color:"text.primary",children:"No credential found"})})})})};var E=n(26371),N=n(83129),b=n(66267),R=n(29061);let ClaimDisplayEntryListWidget=e=>{let{claimDisplayEntryList:t}=e;return(0,i.jsx)(N.Z,{className:"w-full",title:(0,i.jsxs)("div",{className:"inline-flex items-center",children:[(0,i.jsx)(b.C,{children:(0,i.jsx)("div",{className:"w-4 h-4 flex justify-center",children:(0,i.jsx)(E.Z,{})})}),(0,i.jsx)("span",{className:"pl-2",children:"Credentials Request"})]}),able2ShowAll:!1,children:(0,i.jsx)("div",{className:"mb-1",children:t&&t.length>0?t.map((e,t)=>(0,i.jsx)(ClaimDisplayEntryWidget,{claimDisplayEntry:e},t)):(0,i.jsx)(I.J,{headCells:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Z,{children:"CREDENTIALS"}),(0,i.jsx)(j.Z,{children:"SELECT"})]}),bodyRows:t?(0,i.jsx)(D.Z,{children:(0,i.jsx)(j.Z,{component:"th",colSpan:6,align:"center",children:(0,i.jsx)(C.Z,{variant:"body1",color:"text.primary",children:"No credential found"})})}):[,,,].fill(0).map((e,t)=>(0,i.jsx)(R.IT,{},t))})})})};var O=n(13457),Z=n(49050),A=n(23785);let RequestDetails=e=>{let{intent:t}=e,a="RequestCredentialsIntent",[s]=(0,o.V)(f.jU),[j]=(0,o.V)(h.Bx),[v]=(0,o.V)(null==j?void 0:j.credentials().credentials$),[y,w]=(0,l.useState)(!1),[S,I]=(0,l.useState)(!1),[D,E]=(0,l.useState)(""),[N,b]=(0,l.useState)("Demo App"),[R,P]=(0,l.useState)(!1),[T,_]=(0,l.useState)(null),k=t.requestPayload,q=t.requestPayload.caller;p.k.log(a,"payload",k),(0,l.useEffect)(()=>{runPreliminaryChecks(),v&&k&&(fetchApplicationDidInfo(k),organizeRequestedClaims(k).then(e=>{_(e)}))},[v,k]);let runPreliminaryChecks=()=>{I(!1)},fetchApplicationDidInfo=async e=>{let t=e.caller;if(t){let e=await m.n.isPublished(t);if(e){let e=await m.n.getIssuerName(t);p.k.log(a,"Requesting App name:",e),b(e);let n=await m.n.getIssuerAvatar(t);E(n)}else p.k.warn(a,"Requesting App is not published.")}},prepareRawClaims=e=>{let t=JSON.parse(JSON.stringify(e.claims)),n=convertRawClaimsIfNeeded(e);return n&&(t=n),t.forEach(e=>(void 0===e.min&&(e.min=1),void 0===e.max&&(e.max=1),e)),t},convertRawClaimsIfNeeded=e=>{if("_version"in e)return null;{let t=[],n=e.claims;for(let e of n){let n=c.DID.claimDescription(e.reason).withMin(e.min).withMax(e.max).withNoMatchRecommendations(e.noMatchRecommendations).withClaim(new c.DID.Claim().withQuery(e.query).withIssuers(e.issuers));t.push(n)}return t}},organizeRequestedClaims=async e=>{let t=[],i=prepareRawClaims(e);for(let e of i){p.k.log(a,"Organizing claim",e);let i=[];for(let e of v){let t=JSON.parse(await e.verifiableCredential.toString());await appendTypesWithContextsToJsonCredential(e.verifiableCredential,t),i.push(t)}let r=[],l=[];for(let t of e.claims){try{let e=await n.e(9733).then(n.t.bind(n,73820,23));r=r.concat(e.query(i,t.query)),p.k.log(a,"Matching credentials (json)",r)}catch(e){p.k.warn(a,"JSON Path exception",e)}l=l.concat(r.map(e=>{let n=v.find(t=>t.verifiableCredential.getId().toString()===e.id);if(t.issuers){let e=t.issuers.find(e=>e===n.verifiableCredential.getIssuer().toString());if(!e)return null}return{credential:n,selected:!1,expired:!1}}).filter(e=>null!==e))}1==e.min&&e.max===e.min&&1===l.length&&(l[0].selected=!0);let s={claimDescription:e,matchingCredentials:l};t.push(s)}return P(!0),p.k.log(a,"Organized claims",t),t},appendTypesWithContextsToJsonCredential=async(e,t)=>{let n=await u.N.resolveTypesWithContexts(e);for(let e of n){let n="".concat(e.context,"#").concat(e.shortType),i=t.type;0>i.indexOf(n)&&i.push(n)}},buildDeliverableCredentialsList=()=>{let e=[];for(let t of T)for(let n of t.matchingCredentials)n.selected&&e.push(n.credential);return p.k.log(a,"Deliverable credentials:",e),e},approveRequest=async()=>{w(!0);let e=buildDeliverableCredentialsList(),n=await j.createVerifiablePresentation(e.map(e=>e.verifiableCredential),k.realm,k.nonce);if(!n){w(!1);return}let i=n.toString(!0),a=await (0,r.h)(t.id,i);if(a){await (null==s?void 0:s.get("activity").createActivity({type:d.T.CREDENTIALS_SHARED,credentialsCount:e.length,appDid:q})),k.caller&&await j.applications().recordRequestedCredentials(k.caller,e);let n=(0,g.Q)(t.redirectUrl,"rid",t.id);window.location.href=n}},rejectRequest=async()=>{await (0,r.h)(t.id,null);let e=(0,g.Q)(t.redirectUrl,"rid",t.id);window.location.href=e};return(0,i.jsxs)(i.Fragment,{children:[j&&(0,i.jsxs)(O.Z,{spacing:2,alignItems:"center",children:[(0,i.jsx)(x.O,{applicationDID:q}),(0,i.jsx)(C.Z,{variant:"body2",color:"text.primary",textAlign:"center",className:"max-w-lg",children:"This application is requesting access to some of your information. Please review and select the profile items (credentials) you wish to share."}),(0,i.jsx)(ClaimDisplayEntryListWidget,{claimDisplayEntryList:T}),T&&T.length>0&&(0,i.jsxs)("div",{className:"flex w-full items-center gap-4 sm:px-4 sm: gap-8",children:[(0,i.jsx)(Z.Z,{variant:"contained",className:"flex-1",onClick:rejectRequest,color:"error",children:"CANCEL"}),(0,i.jsx)(A.Kz,{className:"flex-1",onClick:approveRequest,loading:y,children:"APPROVE"})]})]}),!s&&(0,i.jsx)(C.Z,{variant:"h6",children:"Please sign in or sign up to continue"}),s&&!j&&(0,i.jsx)(C.Z,{variant:"h6",children:"Please make an identity active to continue"})]})};var P=n(63491),page=()=>{let e=(0,a.useSearchParams)(),t=e.get("rid"),[n,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),[m]=(0,o.V)(f.jU),[p]=(0,o.V)(h.Bx);return(0,l.useEffect)(()=>{t&&(0,r.S)(t).then(e=>{c(!1),u(e)})},[t]),(0,l.useEffect)(()=>{m&&p?(0,P.Ad)():(0,P.qC)(window.location.href)},[m,p]),(0,i.jsxs)("div",{className:"col-span-full",children:[n&&(0,i.jsx)(s.O,{className:"mb-6"}),!n&&d&&(0,i.jsx)(RequestDetails,{intent:d}),!n&&!d&&(0,i.jsx)("div",{children:"No matching request"})]})}},96283:function(e,t,n){"use strict";n.d(t,{J:function(){return CredentialAvatar}});var i=n(57437),r=n(40542),a=n(3283),l=n(57042),s=n(16691),c=n.n(s);let CredentialAvatar=e=>{let{credential:t,width:n=60,height:s=60,className:o}=e,[d]=(0,r.V)(null==t?void 0:t.representativeIcon$);return(0,i.jsx)(a.Z,{sx:{width:n,height:s,padding:"string"==typeof d?0:"".concat(.125*Math.floor(n/8),"rem"),backgroundColor:"#7575754d"},className:(0,l.Z)(o),children:"string"==typeof d?(0,i.jsx)(c(),{src:d,alt:"",width:n,height:s}):d})}},42464:function(e,t,n){"use strict";n.d(t,{h:function(){return JsonViewer}});var i=n(57437);function JsonViewer(e){let{data:t}=e,renderJson=e=>{if("object"!=typeof e||null===e)return(0,i.jsx)("span",{className:"json-value",children:String(e)});if(Array.isArray(e))return(0,i.jsx)("div",{className:"json-array",children:e.map((e,t)=>(0,i.jsx)("div",{children:renderJson(e)},t))});{let t=Object.keys(e);return(0,i.jsx)("div",{className:"json-object",children:t.map(t=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("span",{className:"json-key",children:[t,"："]})," ",renderJson(e[t])]},t))})}};return(0,i.jsxs)("div",{className:"json-viewer truncate",style:{textAlign:"left"},children:[renderJson(t),(0,i.jsx)("style",{children:"\n          .json-viewer {\n            font-family: Arial, sans-serif;\n          }\n          .json-object, .json-array {\n            list-style: none;\n            padding-left: 20px;\n          }\n          .json-key {\n            font-weight: bold;\n          }\n        "})]})}n(2265)},83129:function(e,t,n){"use strict";var i=n(57437),r=n(2899),a=n(15133),l=n(96507),s=n(43226),c=n(88469),o=n(35843),d=n(23785);let u=(0,o.ZP)(a.Z)(e=>{let{theme:t}=e;return{border:"1px solid #FFFFFF55",borderRadius:"0.5rem",background:"#1D1D1D",position:"relative","&:before":{opacity:.1,content:"''",position:"absolute",width:"100%",height:"200%",background:"linear-gradient(to bottom, rgba(163, 163, 163, 60%), rgba(255, 255, 255, 15%), transparent)",transform:"rotate(-30deg)",transformOrigin:"top left",top:0,right:"-40%"}}});t.Z=e=>{let{title:t,children:n,className:a="",able2ShowAll:o=!0,topRightSection:h=null,sx:m={},showAllAction:p=()=>{}}=e;return(0,i.jsxs)(u,{className:a,elevation:0,sx:m,children:[(0,i.jsxs)(l.Z,{className:"py-4 px-6 flex card-header",children:[(0,i.jsx)(s.Z,{className:"flex-1",variant:"h6",fontWeight:600,children:t}),o?(0,i.jsx)(d.UO,{size:"small",endIcon:(0,i.jsx)(r.Z,{}),onClick:p,children:"Show all"}):h]}),(0,i.jsx)(c.Z,{className:"relative z-10",sx:{px:3,pt:1},children:n})]})}},19959:function(e,t,n){"use strict";n.d(t,{J:function(){return DetailTable},m:function(){return DetailTableRow}});var i=n(57437),r=n(98489),a=n(30666),l=n(73701),s=n(66988),c=n(39279);let DetailTableRow=e=>{let{avatar:t,rowCells:n,className:l="",props:s={},onClick:c=()=>{}}=e;return(0,i.jsxs)(r.Z,{...s,className:l,onClick:c,children:[(0,i.jsx)(a.Z,{padding:"none",sx:{width:0},children:t}),n]})},DetailTable=e=>{let{headCells:t,bodyRows:n}=e;return(0,i.jsxs)(l.Z,{size:"small",sx:{th:{border:0},thead:{background:"linear-gradient(to right, transparent, #4e4e4eb3 25%, #555555b3 50%, #4e4e4eb3 75%, transparent)",th:{px:1,fontSize:{xs:12,sm:15},lineHeight:{xs:"1.2rem",sm:"1.5rem"},fontWeight:"600"},"th:last-child":{textAlign:"right"}},tbody:{td:{px:1,py:0},"td:first-child":{border:0,pl:0,pr:1},"td:last-child":{textAlign:"right",pr:0},"tr:last-child":{td:{border:0}}}},children:[(0,i.jsx)(s.Z,{children:(0,i.jsxs)(r.Z,{children:[(0,i.jsx)(a.Z,{sx:{width:0}}),t]})}),(0,i.jsx)(c.Z,{children:n})]})}},69147:function(e,t,n){"use strict";var i,r;n.d(t,{T:function(){return i}}),(r=i||(i={})).NEW_ACCOUNT="NEW_ACCOUNT",r.USER_SIGN_IN="USER_SIGN_IN",r.IDENTITY_CREATED="IDENTITY_CREATED",r.IDENTITY_DELETED="IDENTITY_DELETED",r.CREDENTIALS_IMPORTED="CREDENTIALS_IMPORTED",r.CREDENTIALS_SHARED="CREDENTIALS_SHARED",r.BIND_EMAIL="BIND_EMAIL",r.BIND_BROWSER="BIND_BROWSER",r.PASSWORD_CHANGED="PASSWORD_CHANGED"},63491:function(e,t,n){"use strict";n.d(t,{$Y:function(){return setOnGoingFlowOperation},Ad:function(){return clearPostSignInUrl},Kt:function(){return getOnGoingFlowOperation},cX:function(){return r},fK:function(){return clearOnGoingFlowOperation},qC:function(){return setPostSignInUrl},vX:function(){return usePostSignInFlow}});var i,r,a=n(92e3),l=n(36079);(i=r||(r={}))[i.OnBoardingEmailBinding=0]="OnBoardingEmailBinding",i[i.OnBoardingBrowserBinding=1]="OnBoardingBrowserBinding",i[i.EmailSignIn=2]="EmailSignIn";let s="ongoingflowoperation",c="postsigninurl";function getOnGoingFlowOperation(){return r[localStorage.getItem(s)]}function setOnGoingFlowOperation(e){localStorage.setItem(s,r[e])}function clearOnGoingFlowOperation(){localStorage.removeItem(s)}function setPostSignInUrl(e){l.k.log("flow","Setting post sign in url to:",e),localStorage.setItem(c,e)}function clearPostSignInUrl(){l.k.log("flow","Clearing post sign in url"),localStorage.removeItem(c)}function usePostSignInFlow(){let e=(0,a.useRouter)();return{navigateToPostSignInLandingPage(t){let n=localStorage.getItem(c);if(n)l.k.log("flow","Navigating to post sign in landing page:",n),e.replace(n),clearPostSignInUrl();else{let n=t||"/dashboard";l.k.log("flow","Navigating to post sign in landing page ".concat(n)),e.push(n)}}}}},61568:function(e,t,n){"use strict";n.d(t,{S:function(){return fetchIntent},h:function(){return fulfilIntentRequest}});var i=n(60230),r=n(23965);let Intent=class Intent{static async fromJson(e){let t=new Intent;return Object.assign(t,e),t.createdAt=new Date(e.createdAt),t}};var a=n(29748),l=n(91395),s=n(36079);function _templateObject(){let e=(0,i._)(["\n      query GetIntentRequest($intentId: String!) {\n        intent (id: $intentId) {\n          ","\n        }\n      }\n    "]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,i._)(["\n      mutation FulfilIntentRequest($input: FulfilIntentInput!) {\n        fulfilIntent (input: $input)\n      }\n    "]);return _templateObject1=function(){return e},e}async function fetchIntent(e){var t;let n=await (0,a.Pt)(async()=>(await (0,l.W)()).query({query:(0,r.Ps)(_templateObject(),"\n  id\n  createdAt\n  type\n  redirectUrl\n  requestPayload\n  responsePayload\n"),variables:{intentId:e}}));if(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.intent){let e=await Intent.fromJson(n.data.intent);return s.k.log("intents","Fetched intent:",e),e}return s.k.warn("intents","No intent found for id ".concat(e)),null}async function fulfilIntentRequest(e,t){var n;let i=await (0,a.Pt)(async()=>(await (0,l.W)()).mutate({mutation:(0,r.Ps)(_templateObject1()),variables:{input:{intentId:e,payload:t}}}));return(null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.fulfilIntent)?(s.k.log("intents","Successfully fulfilled intent id ".concat(e)),!0):(s.k.warn("intents","Failed to fulfil intent id ".concat(e)),!1)}},43639:function(e,t,n){"use strict";function setQueryParameter(e,t,n){let i=new URL(e),r=new URLSearchParams(i.search);return r.set(t,n),i.search=r.toString(),i.toString()}n.d(t,{Q:function(){return setQueryParameter}})}},function(e){e.O(0,[6990,9787,9443,8218,3988,395,6506,3824,1228,1711,5295,1510,6953,1396,2e3,1880,894,185,1667,6691,1462,7056,9513,1374,2971,7864,1744],function(){return e(e.s=22017)}),_N_E=e.O()}]);