(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1456],{66798:function(e,t,n){Promise.resolve().then(n.bind(n,72258))},25007:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});var i=n(57437),l=n(40471),r=n(57042);let a=e=>{let{className:t}=e;return(0,i.jsxs)("div",{className:(0,r.Z)("flex flex-col w-full",t),children:[(0,i.jsx)("div",{className:"italic",children:"Preparing request, hold on..."}),(0,i.jsx)(l.Z,{})]})}},72258:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var i=n(57437),l=n(85688),r=n(24033),a=n(2265),s=n(25007),c=n(12131),o=n(11920),d=n(451),u=n(29281),f=n(90786),h=n(53932),x=n(8106),m=n(3883),v=n(69990),p=n(53445),g=n(96507),y=n(54986),w=n(35266),j=n(77795),b=n(70555),S=n(72502),k=n(27760);let I=e=>{let{credentialDisplayEntry:t}=e,[n,l]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&l(t.selected)},[t]);let r=e=>{e.selected=!e.selected,l(e.selected)};return(0,i.jsxs)("div",{className:"flex flex-row mt-4 gap-6",children:["List of credentials",(0,i.jsxs)(S.Z,{onClick:()=>r(t),style:{display:"flex",alignItems:"center"},children:[(0,i.jsx)("div",{style:{marginRight:10},children:(0,i.jsx)(j.J,{credential:t.credential,width:60,height:60})}),(0,i.jsx)(b.Z,{credential:t.credential}),(0,i.jsx)(k.Z,{checked:n})]})]})},C=e=>{let{claimDisplayEntryList:t}=e;return(0,i.jsxs)("div",{className:"col-span-full xl:col-span-5 bg-white dark:bg-slate-800 shadow-lg rounded-sm border border-slate-200 dark:border-slate-700",children:[(0,i.jsx)(y.Z,{}),(0,i.jsx)(g.Z,{sx:{width:"100%",bgcolor:"background.paper"},children:t&&(0,i.jsx)(w.Z,{component:"nav","aria-label":"main mailbox folders",children:t.map(e=>(0,i.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,i.jsxs)("div",{children:[" ",e.claimDescription.reason," "]}),e.matchingCredentials&&(0,i.jsx)(w.Z,{component:"nav","aria-label":"main mailbox folders",children:e.matchingCredentials.map(e=>(0,i.jsxs)("div",{children:[(0,i.jsx)(I,{credentialDisplayEntry:e}),(0,i.jsx)(y.Z,{})]},e.credential.id))})]},e.claimDescription.reason))})})]})},Z=e=>{let{intent:t}=e,r="RequestCredentialsIntent",[s]=(0,d.V)(h.B),[g]=(0,d.V)(null==s?void 0:s.get("credentials").credentials$),[y,w]=(0,a.useState)(!1),[j,b]=(0,a.useState)(!1),[S,k]=(0,a.useState)(""),[I,Z]=(0,a.useState)("Demo App"),[N,P]=(0,a.useState)(!1),[D,q]=(0,a.useState)(null),O=t.requestPayload,[R]=(0,d.V)(v.jU);m.k.log(r,"payload",O),(0,a.useEffect)(()=>{A(),g&&O&&(E(O),J(O).then(e=>{q(e)}))},[g,O]);let A=()=>{b(!1)},E=async e=>{let t=e.caller;if(t){let e=await x.n.isPublished(t);if(e){let e=await x.n.getIssuerName(t);m.k.log(r,"Requesting App name:",e),Z(e);let n=await x.n.getIssuerAvatar(t);k(n)}else m.k.warn(r,"Requesting App is not published.")}},_=e=>{let t=JSON.parse(JSON.stringify(e.claims)),n=V(e);return n&&(t=n),t.forEach(e=>(void 0===e.min&&(e.min=1),void 0===e.max&&(e.max=1),e)),t},V=e=>{if("_version"in e)return null;{let t=[],n=e.claims;for(let e of n){let n=o.DID.claimDescription(e.reason).withMin(e.min).withMax(e.max).withNoMatchRecommendations(e.noMatchRecommendations).withClaim(new o.DID.Claim().withQuery(e.query).withIssuers(e.issuers));t.push(n)}return t}},J=async e=>{let t=[],i=_(e);for(let e of i){m.k.log(r,"Organizing claim",e);let i=[];for(let e of g){let t=JSON.parse(await e.verifiableCredential.toString());await F(e.verifiableCredential,t),i.push(t)}let l=[],a=[];for(let t of e.claims){try{let e=await n.e(9733).then(n.t.bind(n,73820,23));l=l.concat(e.query(i,t.query)),m.k.log(r,"Matching credentials (json)",l)}catch(e){m.k.warn(r,"JSON Path exception",e)}a=a.concat(l.map(e=>{let n=g.find(t=>t.verifiableCredential.getId().toString()===e.id);if(t.issuers){let e=t.issuers.find(e=>e===n.verifiableCredential.getIssuer().toString());if(!e)return null}return{credential:n,selected:!1,expired:!1}}).filter(e=>null!==e))}1==e.min&&e.max===e.min&&1===a.length&&(a[0].selected=!0);let s={claimDescription:e,matchingCredentials:a};t.push(s)}return P(!0),m.k.log(r,"Organized claims",t),t},F=async(e,t)=>{let n=await f.N.resolveTypesWithContexts(e);for(let e of n){let n="".concat(e.context,"#").concat(e.shortType),i=t.type;0>i.indexOf(n)&&i.push(n)}},$=()=>{let e=[];for(let t of D)for(let n of t.matchingCredentials)n.selected&&e.push(n.credential.verifiableCredential);return m.k.log(r,"Deliverable credentials:",e),e},M=async()=>{w(!0);let e=$(),n=await s.createVerifiablePresentation(e,O.realm,O.nonce);if(!n){w(!1);return}let i=n.toString(!0),a=await (0,l.h)(t.id,i);if(a){let e=await (null==R?void 0:R.get("activity").createActivity(u.T.VC_CREATED,{did:s.did}));e||m.k.warn(r,"failed to create activity for VC created by ".concat(s.did));let n=(0,p.Q)(t.redirectUrl,"rid",t.id);window.location.href=n}};return(0,i.jsxs)(i.Fragment,{children:[s&&(0,i.jsxs)("div",{children:["To run this application we need access to your Identity. Please review the following items we need from you:",(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)(C,{claimDisplayEntryList:D}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)(c.c,{onClick:M,busy:y,children:"Approve"})]}),!s&&"Make an identity active to continue"]})};var N=()=>{let e=(0,r.useSearchParams)(),t=e.get("rid"),[n,c]=(0,a.useState)(!0),[o,d]=(0,a.useState)(null);return(0,a.useEffect)(()=>{t&&(0,l.S)(t).then(e=>{c(!1),d(e),console.log("intent result",e)})},[t]),(0,i.jsxs)("div",{className:"col-span-full",children:[n&&(0,i.jsx)(s.O,{className:"mb-6"}),!n&&o&&(0,i.jsx)(Z,{intent:o}),!n&&!o&&(0,i.jsx)("div",{children:"No matching request"})]})}},77795:function(e,t,n){"use strict";n.d(t,{J:function(){return o}});var i=n(57437),l=n(451),r=n(3283),a=n(57042),s=n(16691),c=n.n(s);let o=e=>{let{credential:t,width:n=60,height:s=60,className:o}=e,[d]=(0,l.V)(null==t?void 0:t.representativeIcon$);return(0,i.jsx)(r.Z,{sx:{width:n,height:s},className:(0,a.Z)(o),children:"string"==typeof d?(0,i.jsx)(c(),{src:d,alt:"",width:n,height:s}):d})}},70555:function(e,t,n){"use strict";var i=n(57437),l=n(451),r=n(96507),a=n(43226),s=n(28874),c=n(72502),o=n(8864),d=n(16691),u=n.n(d);t.Z=function(e){let{credential:t}=e,[n]=(0,l.V)(null==t?void 0:t.issuerInfo$);return(0,i.jsxs)(r.Z,{sx:{textAlign:"left",width:"100%"},children:[(0,i.jsx)(a.Z,{gutterBottom:!0,variant:"h6",children:t.getDisplayableTitle()}),(0,i.jsx)(a.Z,{variant:"body1",sx:{color:"text.secondary"},children:t.getDisplayValue()}),(0,i.jsxs)(s.ZP,{container:!0,spacing:2,sx:{mt:1},children:[t.isSensitiveCredential()&&(0,i.jsx)(a.Z,{fontSize:14,color:"#FF6347",children:"Sensitive"}),!t.selfIssued()&&(null==n?void 0:n.isPublished)&&(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(o.Z,{children:(0,i.jsx)(u(),{unoptimized:!0,src:null==n?void 0:n.avatarIcon,width:30,height:30,style:{borderRadius:"50%"},alt:""})}),(0,i.jsxs)(a.Z,{variant:"body1",sx:{color:"text.secondary"},children:["Created by ",null==n?void 0:n.name]})]})]})]})}},85688:function(e,t,n){"use strict";n.d(t,{S:function(){return u},h:function(){return f}});var i=n(60230),l=n(23965);class r{static async fromJson(e){let t=new r;return Object.assign(t,e),t.createdAt=new Date(e.createdAt),t}}var a=n(51385),s=n(76506),c=n(3883);function o(){let e=(0,i._)(["\n      query GetIntentRequest($intentId: String!) {\n        intent (id: $intentId) {\n          ","\n        }\n      }\n    "]);return o=function(){return e},e}function d(){let e=(0,i._)(["\n      mutation FulfilIntentRequest($input: FulfilIntentInput!) {\n        fulfilIntent (input: $input)\n      }\n    "]);return d=function(){return e},e}async function u(e){var t;let n=await (0,a.Pt)(async()=>(await (0,s.W)()).query({query:(0,l.Ps)(o(),"\n  id\n  createdAt\n  type\n  redirectUrl\n  requestPayload\n  responsePayload\n"),variables:{intentId:e}}));if(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.intent){let e=await r.fromJson(n.data.intent);return c.k.log("intents","Fetched intent:",e),e}return c.k.warn("intents","No intent found for id ".concat(e)),null}async function f(e,t){var n;let i=await (0,a.Pt)(async()=>(await (0,s.W)()).mutate({mutation:(0,l.Ps)(d()),variables:{input:{intentId:e,payload:t}}}));return(null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.fulfilIntent)?(c.k.log("intents","Successfully fulfilled intent id ".concat(e)),!0):(c.k.warn("intents","Failed to fulfil intent id ".concat(e)),!1)}},53445:function(e,t,n){"use strict";function i(e,t,n){let i=new URL(e),l=new URLSearchParams(i.search);return l.set(t,n),i.search=l.toString(),i.toString()}n.d(t,{Q:function(){return i}})}},function(e){e.O(0,[6990,3988,6110,1510,8920,4057,7998,8366,4882,592,6070,1385,2971,596,1744],function(){return e(e.s=66798)}),_N_E=e.O()}]);